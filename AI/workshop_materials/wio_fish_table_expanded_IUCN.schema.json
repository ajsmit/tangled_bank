{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/wio-fish-table.schema.json",
  "title": "Western Indian Ocean – Harmonised Fish Table",
  "description": "Row-wise schema for harmonised taxonomic records used for cross-source binding. Rows represent taxa (primarily finfish; cephalopods appear when required for contextual linkage). Use 'Scientific Name' as the canonical key where available; otherwise fall back to 'FishBase accepted' or 'WoRMS accepted'. All text fields use Unicode NFC; leading/trailing whitespace should be trimmed before validation. This schema is self-describing for automated extraction from new sources. In addition to taxonomy and distribution fields, it carries IUCN conservation fields harvested from: (a) any supplied PDF reports (status, criteria, and—where present—assessment date), and (b) FishBase species pages (verbatim status string and the displayed IUCN 'Date assessed').",
  "type": "array",
  "items": {
    "type": "object",
    "additionalProperties": false,
    "required": [
      "Scientific Name"
    ],
    "properties": {
      "Common Name": {
        "type": "string",
        "description": "English vernacular name associated with the taxon; may be regionally ambiguous."
      },
      "Scientific Name": {
        "type": "string",
        "description": "Canonical binomen (Genus species) used as the primary join key for binding across data sources.",
        "pattern": "^[A-Z][a-z-]+\\s+[a-z-]+(?:\\s+[a-z-]+)?$"
      },
      "Family": {
        "type": "string",
        "description": "Taxonomic family (e.g., Serranidae, Carcharhinidae)."
      },
      "Distribution": {
        "type": "string",
        "description": "Geographic scope or region string (e.g., 'South West Indian Ocean', 'WIO reefs')."
      },
      "Additional Data Available": {
        "type": "string",
        "description": "Free-text indicator of ancillary assets or metadata available in the source (e.g., 'Pictured in report')."
      },
      "Submitted name": {
        "type": "string",
        "description": "Original string as submitted by the upstream source prior to normalisation."
      },
      "FishBase accepted": {
        "type": "string",
        "description": "Name per FishBase usage after standardisation; blank when the taxon lies outside FishBase scope (e.g., cephalopods)."
      },
      "WoRMS accepted": {
        "type": "string",
        "description": "Accepted name per WoRMS (or WoRMS→MolluscaBase); used to reconcile discordant cases (e.g., Stegostoma, Loligo)."
      },
      "Provenance": {
        "type": "string",
        "description": "Authority trail applied when standardising this row.",
        "enum": [
          "FishBase",
          "FishBase + WoRMS",
          "WoRMS + SeaLifeBase",
          "—"
        ]
      },
      "IUCN redlist status (PDFs)": {
        "type": "string",
        "description": "IUCN category harvested from provided PDFs (e.g., 'Critically Endangered', 'Endangered', 'Vulnerable', 'Near Threatened', 'Least Concern', 'Data Deficient'). Use exact wording from the source when explicit; otherwise normalise to the canonical category label."
      },
      "IUCN criteria (PDFs)": {
        "type": "string",
        "description": "Criteria string if present in the PDF (e.g., 'A2bd+4bd'). Leave blank if not stated."
      },
      "IUCN assessment date (PDFs)": {
        "type": "string",
        "description": "Assessment date as stated in the PDF (if provided). Prefer ISO-8601 'YYYY-MM-DD'; otherwise preserve the source’s exact display string.",
        "anyOf": [
          {
            "type": "string",
            "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
          },
          {
            "type": "string",
            "minLength": 4
          }
        ]
      },
      "IUCN source (PDFs)": {
        "type": "string",
        "description": "Human-readable citation for the PDF source and page(s), e.g., 'RSOCR 2015, Table 10.A3, p. 263' or 'WIO MPA Outlook 2021, Annex p. XX'."
      },
      "IUCN redlist status (FishBase)": {
        "type": "string",
        "description": "Verbatim IUCN status string as displayed on the FishBase species summary page (e.g., 'Critically Endangered (CR) (A2cd)'). Preserve criteria codes; do not recode."
      },
      "IUCN assessment date (FishBase)": {
        "type": "string",
        "description": "The FishBase 'Date assessed' shown for the species (IUCN assessment completion date). Prefer the exact display string (e.g., '02 February 2022'); ISO-8601 'YYYY-MM-DD' also permitted.",
        "anyOf": [
          {
            "type": "string",
            "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
          },
          {
            "type": "string",
            "pattern": "^[0-9]{1,2} [A-Za-z]+ [0-9]{4}$"
          },
          {
            "type": "string",
            "minLength": 4
          }
        ]
      },
      "FishBase species URL": {
        "type": "string",
        "description": "Canonical FishBase summary URL used for harvesting, formatted as 'https://www.fishbase.se/summary/Genus-species'.",
        "format": "uri"
      }
    },
    "allOf": [
      {
        "properties": {
          "Scientific Name": {
            "pattern": "^(?!\\s).*(?<!\\s)$"
          }
        }
      },
      {
        "anyOf": [
          {
            "required": [
              "FishBase accepted"
            ]
          },
          {
            "required": [
              "WoRMS accepted"
            ]
          }
        ]
      }
    ]
  },
  "$comment": "Joining rule (not formally enforceable here): bind rows primarily on 'Scientific Name'. If absent or not resolvable, match on 'FishBase accepted'; if still absent, match on 'WoRMS accepted'. Disallow binding on 'Common Name' alone. Before binding, normalise Unicode and collapse internal whitespace to single spaces.",
  "examples": [
    {
      "Common Name": "Emperor angelfish",
      "Scientific Name": "Pomacanthus imperator",
      "Family": "Pomacanthidae",
      "Distribution": "South West Indian Ocean",
      "Additional Data Available": "Pictured in report",
      "Submitted name": "Pomacanthus imperator",
      "FishBase accepted": "Pomacanthus imperator",
      "WoRMS accepted": "",
      "Provenance": "FishBase"
    }
  ],
  "x-extraction": {
    "pdfs": {
      "strategy": "regex+context",
      "notes": [
        "Scan PDF text for species binomina (italicised or capitalised patterns).",
        "Within ±5 lines of a matched binomen, search for IUCN category tokens: 'CR', 'EN', 'VU', 'NT', 'LC', 'DD', or full labels.",
        "Capture criteria codes when present (e.g., 'A2bd', 'A2bd+4bd').",
        "If an explicit assessment date appears, capture it verbatim; otherwise leave the date blank.",
        "Record a human-readable citation with document nickname and page(s) in 'IUCN source (PDFs)'."
      ],
      "regex": {
        "binomen": "([A-Z][a-z-]+\\s+[a-z-]+)",
        "category_codes": "\\b(CR|EN|VU|NT|LC|DD)\\b",
        "criteria": "\\(([A][0-5][a-e]?[a-d]?(?:\\+[A0-5a-d]+)*)\\)"
      }
    },
    "fishbase": {
      "strategy": "html+api",
      "notes": [
        "Construct the species URL as https://www.fishbase.se/summary/Genus-species (hyphen between names).",
        "Parse the page text block beginning 'IUCN Red List Status (Ref. ... Version ...)' and capture the full status string and the 'Date assessed'.",
        "If the public rfishbase API exposes IUCN fields for the taxon, use them to cross-check; prefer the HTML display for exact wording."
      ],
      "fields": {
        "status_target": "IUCN redlist status (FishBase)",
        "date_target": "IUCN assessment date (FishBase)",
        "url_target": "FishBase species URL"
      }
    }
  }
}