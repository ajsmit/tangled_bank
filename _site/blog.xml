<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>The Tangled Bank</title>
<link>http://tangledbank.netlify.app/blog.html</link>
<atom:link href="http://tangledbank.netlify.app/blog.xml" rel="self" type="application/rss+xml"/>
<description>The Blog of the Tangled Bank R Teaching Website at the University of te Western Cape</description>
<generator>quarto-1.8.24</generator>
<lastBuildDate>Tue, 21 Nov 2023 22:00:00 GMT</lastBuildDate>
<item>
  <title>heatwaveR</title>
  <dc:creator> Smit, A. J.</dc:creator>
  <dc:creator>Robert Schlegel</dc:creator>
  <link>http://tangledbank.netlify.app/blog/2023-11-23-heatwaver/</link>
  <description><![CDATA[ 




<section id="introducing-heatwaver" class="level2">
<h2 class="anchored" data-anchor-id="introducing-heatwaver">Introducing <strong>heatwaveR</strong></h2>
<p>The <strong>heatwaveR</strong> R package is a translation of the original Python code written by Eric C. J. Oliver. <strong>heatwaveR</strong> uses the same naming conventions for objects, columns, and arguments as the Python code, and it reports the same metrics.</p>
<p><strong>heatwaveR</strong> calculates and displays marine heatwaves (MHWs) according to the definition of Hobday et al.&nbsp;(2016). Additionally, it also accommodates marine cold-spells (MCSs) as first introduced in Schlegel et al.&nbsp;(2017a). MHW categories are also provided as outlined in Hobday et al.&nbsp;(2018).</p>
<p>The packages is currently undergoing active enhancements for spead that would make it suitable for applying to larger datasets on High Performance Computers (HPC). This is alleviating the bottlenecks that slowed down the climatology creation portions of the code as well as generally creating an overall increase in the speed of the calculations, and helping with memory-use efficiency. The development version of the R code, which is not yet available on CRAN, runs about twice as fast as the original python functions when applied to gridded time series of temperatures, for example those obtained from SST products.</p>
<p>Readers familiar with both languages will know about the ongoing debate around the relative speed of the two languages. In our experience, R can be as fast as python, provided that attention is paid to finding ways to reduce the computational inefficiencies that stem from i) the liberal use of complex and inefficient non-atomic data structures, such as data frames; ii) the reliance on non-vectorised calculations such as loops; and iii) lazy (but convenient) coding that comes from drawing too heavily on the <strong>tidyverse</strong> suite of packages. We will continue to ensure that <strong>heatwaveR</strong> becomes more-and-more efficient to deal with the increasingly larger (finer resolution) SST products. To that end, the extension package <strong>heatwave3</strong> is being developed. This will help the user to apply the code from <strong>heatwaveR</strong> directly onto their NetCDF and other 3D gridded data files.</p>
<p><strong>heatwaveR</strong> has also adopted mechanisms to better accommodate the inclusion of the definitions of atmospheric heatwaves in addition to MHWs. We have been quite responsive to users’ needs and welcome input regarding additional metrics and applications of our functions to extend application outside of the ‘traditional’ marine heatwave detection. Additionally, <strong>heatwaveR</strong> also provides the first implementation of a definition for a ‘compound heatwave.’ There are currently multiple different definitions for this type of event and each of which has arguments provided for it within the <code>ts2clm()</code> and <code>detect_event()</code> functions.</p>
</section>
<section id="install-from-cran" class="level2">
<h2 class="anchored" data-anchor-id="install-from-cran">Install from CRAN</h2>
<p>This package may be installed from CRAN by typing the following command into the console:</p>
<p><code>install.packages("heatwaveR")</code></p>
</section>
<section id="install-from-github" class="level2">
<h2 class="anchored" data-anchor-id="install-from-github">Install from GitHub</h2>
<p>The development version may be installed from GitHub with:</p>
<p><code>devtools::install_github("robwschlegel/heatwaveR")</code></p>
<p>The development package contains the functions <code>ts2clm3()</code> and <code>detect_event3()</code> which are the same as the original functions but with speed improvements (due to <strong>data.table</strong> internals) leading to up to a doubling of speed. The functions <code>ts2clm()</code> and <code>detect_event()</code> are still available for use.</p>
</section>
<section id="vignette" class="level2">
<h2 class="anchored" data-anchor-id="vignette">Vignette</h2>
<p>Please refer to the <strong>heatwaveR</strong> vignette for more information on how to use the package. The vignette is on our <a href="https://robwschlegel.github.io/heatwaveR/index.html">GitHub page</a> .</p>
</section>
<section id="benefits" class="level2">
<h2 class="anchored" data-anchor-id="benefits">Benefits</h2>
<p>The benefits of the <strong>heatwaveR</strong> package include:</p>
<ol type="1">
<li><p><strong>Event detection</strong>: It can identify periods of extreme temperature, both high (heatwaves) and low (cold spells), based on flexible user-defined criteria.</p></li>
<li><p><strong>Event characterisation</strong>: Once events are identified, <code>heatwaveR</code> provides summaries of the heatwaves’ characteristics, such as duration, intensity, and frequency.</p></li>
<li><p><strong>Visualisation</strong>: The package includes functions for creating informative visualisations of the detected events, helping in the interpretation and communication of results.</p></li>
<li><p><strong>Flexibility</strong>: <code>heatwaveR</code> is designed to work with a variety of temperature (and other) datasets and allows customisation in the definition of what constitutes a heatwave or cold spell.</p></li>
</ol>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{smit,_a._j.2023,
  author = {Smit, A. J., and Schlegel, Robert},
  title = {heatwaveR},
  date = {2023-11-22},
  url = {http://tangledbank.netlify.app/blog/2023-11-23-heatwaver/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-smit,_a._j.2023" class="csl-entry quarto-appendix-citeas">
Smit, A. J., Schlegel R (2023) heatwaveR. <a href="http://tangledbank.netlify.app/blog/2023-11-23-heatwaver/">http://tangledbank.netlify.app/blog/2023-11-23-heatwaver/.
</a>
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>analysis</category>
  <category>MHW</category>
  <guid>http://tangledbank.netlify.app/blog/2023-11-23-heatwaver/</guid>
  <pubDate>Tue, 21 Nov 2023 22:00:00 GMT</pubDate>
</item>
<item>
  <title>Detect event streaks based on specified thresholds</title>
  <dc:creator> Smit, A. J.</dc:creator>
  <link>http://tangledbank.netlify.app/blog/2023-11-22-run-lengths/</link>
  <description><![CDATA[ <div class="cell" data-warnings="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(heatwaveR)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(plyr) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># because I like plyr</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div></div>
</div>
<p>Here is a question we received via <strong>heatwaveR</strong>’s GitHub page regarding using our package’s functions to detect streaks of outcomes based on a threshold in some lab experiment. The question is as follows:</p>
<blockquote class="blockquote">
<p>“I was looking for a function that could help me with data wrangling and I believe the <code>exceedance()</code> function is exactly what I’m looking for. I have a dataframe with person IDs, date of treatment, day since treatment, and a lab value. Essentially, I am hoping to find the longest streak of consecutive days where the lab value is below a certain threshold, and extending the streak if the lab value does not rise above the threshold for &gt;3 days.</p>
</blockquote>
<blockquote class="blockquote">
<p>I wrangled my dataframe into a dataframe with the IDs, date, and lab value as follows …”</p>
</blockquote>
<section id="prepare-a-dataframe-with-the-ids-date-and-lab-values" class="level2"><h2 class="anchored" data-anchor-id="prepare-a-dataframe-with-the-ids-date-and-lab-values">Prepare a dataframe with the IDs, date, and lab values</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1">num_subjects <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb2-2">num_days <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span>
<span id="cb2-4">subject_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_subjects, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> num_days)</span>
<span id="cb2-5">dates <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-01"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 day"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> num_days),</span>
<span id="cb2-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> num_subjects)</span>
<span id="cb2-7">lab_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(num_subjects <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> num_days, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>)</span>
<span id="cb2-8">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb2-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SubjectID =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(subject_ids),</span>
<span id="cb2-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(dates),</span>
<span id="cb2-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lab =</span> lab_values</span>
<span id="cb2-12">)</span></code></pre></div></div>
</div>
</section><section id="calculate-streaks-lengths-based-on-linear-over-time-thresholds" class="level2"><h2 class="anchored" data-anchor-id="calculate-streaks-lengths-based-on-linear-over-time-thresholds">Calculate streaks lengths based on linear (over time) thresholds</h2>
<p>It turns out that one of the other built-in functions can exactly do what you need. We simply need to make some adjustments to the dataframe fed to the <code>detect_event()</code> function, which is the function that will count the streak lengths.</p>
<p>Calculate a mean value and a threshold; you can calculate an overall mean and threshold, or a mean and threshold for each group— this will depend on your experimental design and hypotheses.</p>
<p>I calculate a mean and threshold based on the pooled data (across A-C):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1">df2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Lab),</span>
<span id="cb3-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">thresh =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># your threshold value here</span></span></code></pre></div></div>
</div>
<p>Even though we calculated the mean value, this is not used; only the threshold is used.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> plyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dlply</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.data =</span> df2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.variables =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SubjectID"</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(sub_df) {</span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detect_event</span>(sub_df,</span>
<span id="cb4-3">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Date,</span>
<span id="cb4-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Lab,</span>
<span id="cb4-5">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seasClim =</span> seas,</span>
<span id="cb4-6">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshClim =</span> thresh,</span>
<span id="cb4-7">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minDuration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxGap =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, </span>
<span id="cb4-9">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coldSpell =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb4-10">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">protoEvents =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb4-11">})</span></code></pre></div></div>
</div>
<p><code>results</code> is a list of dataframes, one pair of dataframes for each subject. Let us look at the first list element, which is for <code>SubjectID == 1</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1">results[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span></code></pre></div></div>
<div class="cell-output cell-output-stdout">
<pre><code>$climatology
   SubjectID       Date        Lab     seas thresh threshCriterion
1          1 2023-01-01 2130.96734 1484.172    500           FALSE
2          1 2023-01-02  738.41191 1484.172    500           FALSE
3          1 2023-01-03 1168.90333 1484.172    500           FALSE
4          1 2023-01-04  274.15102 1484.172    500            TRUE
5          1 2023-01-05 2886.19363 1484.172    500           FALSE
6          1 2023-01-06   32.79999 1484.172    500            TRUE
7          1 2023-01-07 1722.88553 1484.172    500           FALSE
8          1 2023-01-08 2293.19397 1484.172    500           FALSE
9          1 2023-01-09 2620.14693 1484.172    500           FALSE
10         1 2023-01-10  123.19006 1484.172    500            TRUE
11         1 2023-01-11 1983.36480 1484.172    500           FALSE
12         1 2023-01-12 2635.11255 1484.172    500           FALSE
13         1 2023-01-13 2671.67709 1484.172    500           FALSE
14         1 2023-01-14 1698.84140 1484.172    500           FALSE
15         1 2023-01-15 1780.64203 1484.172    500           FALSE
16         1 2023-01-16 1093.54355 1484.172    500           FALSE
17         1 2023-01-17 1072.23855 1484.172    500           FALSE
18         1 2023-01-18 1774.37116 1484.172    500           FALSE
19         1 2023-01-19 2596.35438 1484.172    500           FALSE
20         1 2023-01-20 2041.57098 1484.172    500           FALSE
   durationCriterion event event_no
1              FALSE FALSE       NA
2              FALSE FALSE       NA
3              FALSE FALSE       NA
4               TRUE  TRUE        1
5              FALSE  TRUE        1
6               TRUE  TRUE        1
7              FALSE  TRUE        1
8              FALSE  TRUE        1
9              FALSE  TRUE        1
10              TRUE  TRUE        1
11             FALSE FALSE       NA
12             FALSE FALSE       NA
13             FALSE FALSE       NA
14             FALSE FALSE       NA
15             FALSE FALSE       NA
16             FALSE FALSE       NA
17             FALSE FALSE       NA
18             FALSE FALSE       NA
19             FALSE FALSE       NA
20             FALSE FALSE       NA

$event
  event_no index_start index_peak index_end duration date_start  date_peak
1        1           4          6        10        7 2023-01-04 2023-01-06
    date_end intensity_mean intensity_max intensity_var intensity_cumulative
1 2023-01-10       -62.3774     -1451.372      1249.218            -436.6417
  intensity_mean_relThresh intensity_max_relThresh intensity_var_relThresh
1                 921.7944                  -467.2                1249.218
  intensity_cumulative_relThresh intensity_mean_abs intensity_max_abs
1                       6452.561           1421.794              32.8
  intensity_var_abs intensity_cumulative_abs rate_onset rate_decline
1          1249.218                 9952.561  -275.4909    -226.7728</code></pre>
</div>
</div>
<p>The first dataframe is called <code>climatology</code> and the other is called <code>events</code>. Don’t worry about the names as the function was initially written for climate events. The <code>climatology</code> dataframe contains all the data for <code>SubjectID</code> that were initially supplied in <code>df2</code> and a few new columns, <code>threshCriterion</code>, <code>durationCriterion</code>, <code>event</code>, and <code>event_no</code> are added at the end. When the <code>Lab</code> value dips below the <code>thresh</code>, <code>threshCriterion</code> will flag as <code>TRUE</code> regardless of how long it remains below the threshold. <code>durationCriterion</code> flags as <code>TRUE</code> if the number of times <code>threshCriterion</code> is equal to or greater than <code>minDuration</code>. <code>event</code> flags as <code>TRUE</code> if <code>threshCriterion</code> is <code>TRUE</code> AND <code>durationCriterion</code> is <code>TRUE</code>. A unique identifier is given for each event in <code>event_no</code>.</p>
<p>The <code>events</code> dataframe contains the <code>event_no</code>, the start and end dates of the event, and the event <code>duration</code> (your ‘streaks’). Various other summary stats are also calculated, but these might not be relevant for your question. Or are they?</p>
<p>If you are only interested in the <code>event</code> dataframe and want to combine all the streaks into one table with the results, do this—note the use of <code>ddply()</code> rather than <code>dlply()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> plyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ddply</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.data =</span> df2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.variables =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SubjectID"</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(sub_df) {</span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detect_event</span>(sub_df,</span>
<span id="cb7-3">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Date,</span>
<span id="cb7-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Lab,</span>
<span id="cb7-5">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seasClim =</span> seas,</span>
<span id="cb7-6">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshClim =</span> thresh,</span>
<span id="cb7-7">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minDuration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb7-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxGap =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, </span>
<span id="cb7-9">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coldSpell =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-10">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">protoEvents =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event</span>
<span id="cb7-11">})</span>
<span id="cb7-12">results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(SubjectID, event_no, duration)</span></code></pre></div></div>
<div class="cell-output cell-output-stdout">
<pre><code>  SubjectID event_no duration
1         1        1        7
2         2        1        7
3         2        2        5
4         3        1        1
5         3        2        8
6         4        1        1
7         4        2        1
8         5        1        3</code></pre>
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{smit,_a._j.2023,
  author = {Smit, A. J.,},
  title = {Detect Event Streaks Based on Specified Thresholds},
  date = {2023-11-22},
  url = {http://tangledbank.netlify.app/blog/2023-11-22-run-lengths/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-smit,_a._j.2023" class="csl-entry quarto-appendix-citeas">
Smit, A. J. (2023) Detect event streaks based on specified thresholds.
<a href="http://tangledbank.netlify.app/blog/2023-11-22-run-lengths/">http://tangledbank.netlify.app/blog/2023-11-22-run-lengths/.
</a>
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>analysis</category>
  <category>MHW</category>
  <guid>http://tangledbank.netlify.app/blog/2023-11-22-run-lengths/</guid>
  <pubDate>Tue, 21 Nov 2023 22:00:00 GMT</pubDate>
</item>
<item>
  <title>Basic Detection and Visualisation of Marine Heatwaves</title>
  <dc:creator> Smit, A. J.</dc:creator>
  <dc:creator>Robert Schlegel</dc:creator>
  <link>http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/</link>
  <description><![CDATA[ <p>This material also appears as a <a href="https://robwschlegel.github.io/heatwaveR/articles/detection_and_visualisation.html">heatwaveR vignette</a>.</p>
<p>In the <a href="../../blog/2023-11-23-heatwaver/index.html">previous post</a>, we demonstrated how to use the <strong><code>heatwaveR</code></strong> package to detect and visualise marine heatwaves (MHWs) and cold spells (MCSs). In this post, we will demonstrate how to use the package to detect and visualise these extreme events. We will also demonstrate how to use the package to calculate the duration, intensity, and cumulative intensity of MHWs and MCSs.</p>
<section id="data" class="level2"><h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The <code>detect_event()</code> function is the core of this package, and it expects to be fed the output of the second core function, <code>ts2clm()</code>. By default, <code>ts2clm()</code> wants to receive a two-column dataframe with one column labelled <code>t</code> containing all of the date values, and a second column <code>temp</code> containing all of the temperature values. Please note that the date format it expects is “YYYY-MM-DD”. For example, please see the top five rows of one of the datasets included with the <strong><code>heatwaveR</code></strong> package:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(heatwaveR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>sst_WA)</span></code></pre></div></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  t           temp
  &lt;date&gt;     &lt;dbl&gt;
1 1982-01-01  20.9
2 1982-01-02  21.2
3 1982-01-03  21.4
4 1982-01-04  21.2
5 1982-01-05  21.3
6 1982-01-06  21.6</code></pre>
</div>
</div>
<p>It is possible to use different column names other than <code>t</code> and <code>temp</code> with which to calculate events. Please see the help files for <code>ts2clm()</code> or <code>detect_event()</code> for a thorough explanation of how to do so.</p>
<p>Loading ones data from a <code>.csv</code> file or other text based format is the easiest approach for the calculation of events, assuming one is not working with gridded data (e.g.&nbsp;NetCDF). Please see <a href="https://robwschlegel.github.io/heatwaveR/articles/gridded_event_detection.html">this vignette</a> for a detailed walkthrough on using the functions in this package with gridded data.</p>
</section><section id="calculating-marine-heatwaves-mhws" class="level2"><h2 class="anchored" data-anchor-id="calculating-marine-heatwaves-mhws">Calculating marine heatwaves (MHWs)</h2>
<p>Here are the <code>ts2clm()</code> and <code>detect_event()</code> function applied to the Western Australia test data included with this package (<code>sst_WA</code>), which are also discussed by Hobday et al.&nbsp;(2016):</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(heatwaveR)</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Detect the events in a time series</span></span>
<span id="cb3-6">ts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts2clm</span>(sst_WA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">climatologyPeriod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1982-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011-12-31"</span>))</span>
<span id="cb3-7">mhw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detect_event</span>(ts)</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View just a few metrics</span></span>
<span id="cb3-10">mhw<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-11">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-12">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(event_no, duration, date_start, date_peak, intensity_max, intensity_cumulative) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-13">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>intensity_max) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  event_no duration date_start date_peak  intensity_max intensity_cumulative
     &lt;int&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;             &lt;dbl&gt;                &lt;dbl&gt;
1       52      105 2010-12-24 2011-02-28          6.58                293. 
2       41       35 2008-03-25 2008-04-14          3.83                 79.3
3       29       95 1999-05-13 1999-05-22          3.64                240. 
4       60       14 2012-12-27 2012-12-31          3.42                 32.3
5       59      101 2012-01-10 2012-01-27          3.38                214. </code></pre>
</div>
</div>
</section><section id="visualising-marine-heatwaves-mhws" class="level2"><h2 class="anchored" data-anchor-id="visualising-marine-heatwaves-mhws">Visualising marine heatwaves (MHWs)</h2>
<section id="default-mhw-visuals" class="level3"><h3 class="anchored" data-anchor-id="default-mhw-visuals">Default MHW visuals</h3>
<p>One may use <code>event_line()</code> and <code>lolli_plot()</code> directly on the output of <code>detect_event()</code> in order to visualise MHWs. Here are the functions being used to visualise the massive Western Australian heatwave of 2011:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">event_line</span>(mhw, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">spread =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intensity_max"</span>, </span>
<span id="cb5-2">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start_date =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1982-01-01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end_date =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2014-12-31"</span>)</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lolli_plot</span>(mhw, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intensity_max"</span>)</span></code></pre></div></div>
<div class="cell-output-display">
<div id="fig-example1-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example1-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example1-1.svg" id="fig-example1-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-example1-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example1-2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example1-2.svg" id="fig-example1-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption></figure>
</div>
</div>
</div>
<!-- ![](vignettes/fig-example1-1.png) -->
<!-- ![](vignettes/fig-example2-1.png) -->
</section><section id="custom-mhw-visuals" class="level3"><h3 class="anchored" data-anchor-id="custom-mhw-visuals">Custom MHW visuals</h3>
<p>The <code>event_line()</code> and <code>lolli_plot()</code> functions were designed to work directly on the list returned by <code>detect_event()</code>. If more control over the figures is required, it may be useful to create them in <strong><code>ggplot2</code></strong> by stacking <code>geoms</code>. We specifically created two new <strong><code>ggplot2</code></strong> <code>geoms</code> to reproduce the functionality of <code>event_line()</code> and <code>lolli_plot()</code>. These functions are more general in their functionality and can be used outside of the <strong><code>heatwaveR</code></strong> package, too. To apply them to MHWs and MCSs first requires that we access the <code>climatology</code> or <code>event</code> dataframes within the list that is produced by <code>detect_event()</code>. Here is how:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select the region of the time series of interest</span></span>
<span id="cb6-2">mhw2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mhw<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>climatology <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10580</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10720</span>)</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mhw2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> thresh)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011-02-25"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the Destroyer</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">of Kelps"</span>))</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mhw<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date_start, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> intensity_max)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_lolli</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"salmon"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour_n =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2006-08-01"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb6-12">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The marine heatwaves</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Tend to be left skewed in a</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Given time series"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Max. intensity ["</span>, degree, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C]"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span></code></pre></div></div>
<div class="cell-output-display">
<div id="fig-example2-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example2-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;3: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example2-1.svg" id="fig-example2-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-example2-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example2-2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;4: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example2-2.svg" id="fig-example2-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption></figure>
</div>
</div>
</div>
<!-- ![](vignettes/fig-example3-1.png) -->
<!-- ![](vignettes/fig-example3-2.png) -->
</section><section id="spicy-mhw-visuals" class="level3"><h3 class="anchored" data-anchor-id="spicy-mhw-visuals">Spicy MHW visuals</h3>
<p>The default output of these function may not be to your liking. If so, not to worry. As <strong><code>ggplot2</code></strong> <code>geoms</code>, they are highly malleable. For example, if we were to choose to reproduce the format of the MHWs as seen in Hobday et al.&nbsp;(2016), the code would look something like this:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># It is necessary to give geom_flame() at least one row on either side of </span></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the event in order to calculate the polygon corners smoothly</span></span>
<span id="cb7-3">mhw_top <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mhw2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">111</span>)</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mhw2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> thresh, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mhw_top, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> thresh, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>),  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temp"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> thresh, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"thresh"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> seas, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seas"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Line Colour"</span>,</span>
<span id="cb7-13">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temp"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb7-14">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"thresh"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forestgreen"</span>, </span>
<span id="cb7-15">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seas"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Event Colour"</span>, </span>
<span id="cb7-17">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"salmon"</span>, </span>
<span id="cb7-18">                               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b %Y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature ["</span>, degree, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C]"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span></code></pre></div></div>
<div class="cell-output-display">
<div id="fig-example3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example3-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;5: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example3-1.svg" id="fig-example3" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption></figure>
</div>
</div>
</div>
<!-- ![](vignettes/fig-example4-1.png) -->
<p>It is also worth pointing out that when we use <code>geom_flame()</code> directly like this, but we don’t want to highlight events greater less than our standard five day length, allowing for a two day gap, we want to use the arguments <code>n</code> and <code>n_gap</code> respectively.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1">mhw3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mhw<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>climatology <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">850</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">950</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mhw3, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> thresh)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note the use of n = 5 and n_gap = 2 below</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_gap =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1984-05-16"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">24.5</span>,</span>
<span id="cb8-10">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"heat</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n\n\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">spike"</span>))</span></code></pre></div></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/flame_gaps-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/flame_gaps-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Should we not wish to highlight any events with <code>geom_lolli()</code>, plot them with a colour other than the default, and use a different theme, it would look like this:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mhw<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date_peak, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> intensity_max)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_lolli</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Peak Date"</span>, </span>
<span id="cb9-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Max. intensity ["</span>, degree, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C]"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_linedraw</span>()</span></code></pre></div></div>
<div class="cell-output-display">
<div id="fig-example4" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example4-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;6: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example4-1.svg" id="fig-example4" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption></figure>
</div>
</div>
</div>
<!-- ![](vignettes/fig-example5-1.png) -->
<p>Because these are simple <strong><code>ggplot2</code></strong> geoms possibilities are nearly infinite.</p>
</section></section><section id="calculating-marine-cold-spells-mcss" class="level2"><h2 class="anchored" data-anchor-id="calculating-marine-cold-spells-mcss">Calculating marine cold-spells (MCSs)</h2>
<p>The calculation and visualisation of cold-spells is also provided for within this package. The data to be fed into the functions is the same as for MHWs. The main difference is that one is now calculating the 10th percentile threshold, rather than the 90th percentile threshold. Here are the top five cold-spells (cumulative intensity) detected in the OISST data for Western Australia:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First calculate the cold-spells</span></span>
<span id="cb10-2">ts_10th <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts2clm</span>(sst_WA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">climatologyPeriod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1982-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011-12-31"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pctile =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb10-3">mcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detect_event</span>(ts_10th, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coldSpells =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Then look at the top few events</span></span>
<span id="cb10-6">mcs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-7">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-8">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(event_no, duration, date_start,</span>
<span id="cb10-9">                date_peak, intensity_mean, intensity_max, intensity_cumulative) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-10">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(intensity_cumulative) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  event_no duration date_start date_peak  intensity_mean intensity_max
     &lt;int&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;              &lt;dbl&gt;         &lt;dbl&gt;
1       15       76 1990-04-13 1990-05-11          -2.50         -3.19
2       49       58 2003-12-19 2004-01-23          -1.73         -2.59
3       83       41 2020-04-26 2020-05-25          -2.34         -3.14
4       64       52 2014-04-14 2014-05-05          -1.78         -2.54
5       77       46 2018-07-24 2018-08-02          -1.81         -2.43
# ℹ 1 more variable: intensity_cumulative &lt;dbl&gt;</code></pre>
</div>
</div>
</section><section id="visualising-marine-cold-spells-mcss" class="level2"><h2 class="anchored" data-anchor-id="visualising-marine-cold-spells-mcss">Visualising marine cold-spells (MCSs)</h2>
<section id="default-mcs-visuals" class="level3"><h3 class="anchored" data-anchor-id="default-mcs-visuals">Default MCS visuals</h3>
<p>The default plots showing cold-spells look like this:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">event_line</span>(mcs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">spread =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intensity_cumulative"</span>,</span>
<span id="cb12-2">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start_date =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1982-01-01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end_date =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2014-12-31"</span>)</span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lolli_plot</span>(mcs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intensity_cumulative"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xaxis =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"event_no"</span>)</span></code></pre></div></div>
<div class="cell-output-display">
<div id="fig-example5-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example5-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example5-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure&nbsp;7: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example5-1.svg" id="fig-example5-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example5-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-example5-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example5-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example5-2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;8: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example5-2.svg" id="fig-example5-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example5-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8
</figcaption></figure>
</div>
</div>
</div>
<!-- ![](vignettes/fig-example6-1.png) -->
<!-- ![](vignettes/fig-example6-2.png) -->
<p>Note that one does not need to specify that MCSs are to be visualised, the functions are able to understand this on their own.</p>
</section><section id="custom-mcs-visuals" class="level3"><h3 class="anchored" data-anchor-id="custom-mcs-visuals">Custom MCS visuals</h3>
<p>Cold spell figures may be created as <code>geoms</code> in <strong><code>ggplot2</code></strong>, too:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select the region of the time series of interest</span></span>
<span id="cb13-2">mcs2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mcs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>climatology <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2900</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3190</span>)</span>
<span id="cb13-4"></span>
<span id="cb13-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note that one must specify a colour other than the default 'salmon'</span></span>
<span id="cb13-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mcs2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> thresh, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> temp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue3"</span>)</span>
<span id="cb13-8"></span>
<span id="cb13-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mcs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date_start, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> intensity_max)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_lolli</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue3"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour_n =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"navy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Start Date"</span>,</span>
<span id="cb13-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Max. intensity ["</span>, degree, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C]"</span>)))</span></code></pre></div></div>
<div class="cell-output-display">
<div id="fig-example6-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example6-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example6-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;9: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example6-1.svg" id="fig-example6-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example6-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-example6-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example6-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example6-2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Figure&nbsp;10: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example6-2.svg" id="fig-example6-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example6-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10
</figcaption></figure>
</div>
</div>
</div>
</section><section id="minty-mcs-visuals" class="level3"><h3 class="anchored" data-anchor-id="minty-mcs-visuals">Minty MCS visuals</h3>
<p>Again, because <code>geom_flame()</code> and <code>geom_lolli()</code> are simple <strong><code>ggplot2</code></strong> geoms, one can go completely bananas with them:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1">mcs_top <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mcs2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">125</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">202</span>)</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mcs2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> thresh, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> temp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mcs_top, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> thresh, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> temp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temp"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> thresh, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"thresh"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> seas, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seas"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Line Colour"</span>,</span>
<span id="cb14-11">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temp"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"thresh"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forestgreen"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seas"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Event Colour"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"navy"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b %Y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature ["</span>, degree, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C]"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb14-16"></span>
<span id="cb14-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mcs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date_start, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> intensity_cumulative)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_lolli</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue3"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour_n =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"navy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>( <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Start Date"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cumulative intensity [days x "</span>, degree, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C]"</span>)))</span></code></pre></div></div>
<div class="cell-output-display">
<div id="fig-example7-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example7-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example7-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Figure&nbsp;11: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example7-1.svg" id="fig-example7-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example7-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-example7-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-example7-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-example7-2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Figure&nbsp;12: "><img src="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/index_files/figure-html/fig-example7-2.svg" id="fig-example7-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-example7-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12
</figcaption></figure>
</div>
</div>
</div>
<!-- ![](vignettes/fig-example7-1.png) -->
<!-- ![](vignettes/fig-example7-2.png) -->
</section></section><section id="interactive-visuals" class="level2"><h2 class="anchored" data-anchor-id="interactive-visuals">Interactive visuals</h2>
<p>As of <strong><code>heatwaveR</code></strong> v0.3.6.9002, <code>geom_flame()</code> was also able to be used with <strong><code>plotly</code></strong> to allow for interactive MHW visuals. Unfortunately around December of 2020 the <strong><code>plotly</code></strong> packaged was orphaned and CRAN decided it didn’t want packages to include it as an imported package. Therefore as of v0.4.4.9005 <strong><code>heatwaveR</code></strong> no longer has built in support for using <code>geom_flame()</code> with <strong><code>plotly</code></strong>. It is however still possible with a bit of work and a simple working example is given below. It is not currently possible to use <code>geom_lolli()</code> with <strong><code>plotly</code></strong>. Rather one is advised to just create the dots and segments separately with <code>geom_point()</code> and <code>geom_segment()</code> respectively as these are already recognised by <strong><code>plotly</code></strong>.</p>
<p>Note that the following code chunk is not run as it makes this vignette a bit too large.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Must load plotly library first</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(plotly)</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function needed for making geom_flame() work with plotly</span></span>
<span id="cb15-5">geom2trace.GeomFlame <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> (data,</span>
<span id="cb15-6">                                  params,</span>
<span id="cb15-7">                                  p) {</span>
<span id="cb15-8">  </span>
<span id="cb15-9">  x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb15-10">  </span>
<span id="cb15-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data.frame for ease of use</span></span>
<span id="cb15-12">  data1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>]],</span>
<span id="cb15-13">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>]],</span>
<span id="cb15-14">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y2"</span>]])</span>
<span id="cb15-15">  </span>
<span id="cb15-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grab parameters</span></span>
<span id="cb15-17">  n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>]]</span>
<span id="cb15-18">  n_gap <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_gap"</span>]]</span>
<span id="cb15-19">  </span>
<span id="cb15-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find events that meet minimum length requirement</span></span>
<span id="cb15-21">  data_event <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> heatwaveR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detect_event</span>(data1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y,</span>
<span id="cb15-22">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seasClim =</span> y,</span>
<span id="cb15-23">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshClim =</span> y2,</span>
<span id="cb15-24">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minDuration =</span> n,</span>
<span id="cb15-25">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxGap =</span> n_gap,</span>
<span id="cb15-26">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">protoEvents =</span> T)</span>
<span id="cb15-27">  </span>
<span id="cb15-28">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Detect spikes</span></span>
<span id="cb15-29">  data_event<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>screen <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> base<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(data_event<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>threshCriterion <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb15-30">                                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(data_event<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span>
<span id="cb15-31">  </span>
<span id="cb15-32">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Screen out spikes</span></span>
<span id="cb15-33">  data1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data1[data_event<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>screen <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,]</span>
<span id="cb15-34">  </span>
<span id="cb15-35">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prepare to find the polygon corners</span></span>
<span id="cb15-36">  x1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y</span>
<span id="cb15-37">  x2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y2</span>
<span id="cb15-38">  </span>
<span id="cb15-39">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Find points where x1 is above x2.</span></span>
<span id="cb15-40">  above <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x2</span>
<span id="cb15-41">  above[above <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb15-42">  above[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(above)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb15-43">  </span>
<span id="cb15-44">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Points always intersect when above=TRUE, then FALSE or reverse</span></span>
<span id="cb15-45">  intersect.points <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(above) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb15-46">  </span>
<span id="cb15-47">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the slopes for each line segment.</span></span>
<span id="cb15-48">  x1.slopes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x1[intersect.points <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x1[intersect.points]</span>
<span id="cb15-49">  x2.slopes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x2[intersect.points <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x2[intersect.points]</span>
<span id="cb15-50">  </span>
<span id="cb15-51">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Find the intersection for each segment.</span></span>
<span id="cb15-52">  x.points <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> intersect.points <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ((x2[intersect.points] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x1[intersect.points]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (x1.slopes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x2.slopes))</span>
<span id="cb15-53">  y.points <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x1[intersect.points] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (x1.slopes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (x.points <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> intersect.points))</span>
<span id="cb15-54">  </span>
<span id="cb15-55">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Coerce x.points to the same scale as x</span></span>
<span id="cb15-56">  x_gap <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> data1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb15-57">  x.points <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[intersect.points] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (x_gap<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(x.points <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> intersect.points))</span>
<span id="cb15-58">  </span>
<span id="cb15-59">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create new data frame and merge to introduce new rows of data</span></span>
<span id="cb15-60">  data2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(data1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y, y.points), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(data1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, x.points))</span>
<span id="cb15-61">  data2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data2[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(data2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x),]</span>
<span id="cb15-62">  data3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> base<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(data1, data2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">all.y =</span> T)</span>
<span id="cb15-63">  data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y2[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y2)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y2)]</span>
<span id="cb15-64">  </span>
<span id="cb15-65">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove missing values for better plotting</span></span>
<span id="cb15-66">  data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y[data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y2] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb15-67">  missing_pos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>stats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(data3[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y2"</span>)])</span>
<span id="cb15-68">  ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(missing_pos) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb15-69">  ids[missing_pos] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb15-70">  </span>
<span id="cb15-71">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the correct positions</span></span>
<span id="cb15-72">  positions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span>(data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x)),</span>
<span id="cb15-73">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span>(data3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y2)),</span>
<span id="cb15-74">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ids =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ids, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span>(ids)))</span>
<span id="cb15-75">  </span>
<span id="cb15-76">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to a format geom2trace is happy with</span></span>
<span id="cb15-77">  positions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> plotly<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group2NA</span>(positions, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupNames =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ids"</span>)</span>
<span id="cb15-78">  positions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> positions[stats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids),]</span>
<span id="cb15-79">  positions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(positions, data[,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>)</span>
<span id="cb15-80">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(stats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PANEL)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb15-81">    positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PANEL <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PANEL[stats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PANEL)][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb15-82">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(stats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb15-83">    positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group[stats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>group)][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb15-84">  </span>
<span id="cb15-85">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run the plotly polygon code</span></span>
<span id="cb15-86">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PANEL)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>){</span>
<span id="cb15-87">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getFromNamespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geom2trace.GeomPolygon"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">asNamespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plotly"</span>))(positions)</span>
<span id="cb15-88">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>{</span>
<span id="cb15-89">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>()</span>
<span id="cb15-90">  }</span>
<span id="cb15-91">}</span>
<span id="cb15-92"></span>
<span id="cb15-93"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time series</span></span>
<span id="cb15-94">ts_res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> heatwaveR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts2clm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> heatwaveR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>sst_WA,</span>
<span id="cb15-95">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">climatologyPeriod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1982-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2011-12-31"</span>))</span>
<span id="cb15-96">ts_res_sub <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ts_res[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10500</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10800</span>,]</span>
<span id="cb15-97"></span>
<span id="cb15-98"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flame Figure</span></span>
<span id="cb15-99">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> ts_res_sub, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-100">  heatwaveR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_flame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> thresh), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_gap =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-101">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-102">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> seas), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-103">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> thresh), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-104">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature (°C)"</span>)</span>
<span id="cb15-105"></span>
<span id="cb15-106"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create interactive visuals</span></span>
<span id="cb15-107"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplotly</span>(p)</span></code></pre></div></div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{smit,_a._j.2023,
  author = {Smit, A. J., and Schlegel, Robert},
  title = {Basic {Detection} and {Visualisation} of {Marine}
    {Heatwaves}},
  date = {2023-11-11},
  url = {http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-smit,_a._j.2023" class="csl-entry quarto-appendix-citeas">
Smit, A. J., Schlegel R (2023) Basic Detection and Visualisation of
Marine Heatwaves. <a href="http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/">http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/.
</a>
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>analysis</category>
  <category>MHW</category>
  <guid>http://tangledbank.netlify.app/blog/2023-11-13-basic-mhw-detect/</guid>
  <pubDate>Fri, 10 Nov 2023 22:00:00 GMT</pubDate>
</item>
</channel>
</rss>
