<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="AJ Smit">
<meta name="dcterms.date" content="2023-11-23">
<meta name="description" content="This vignette demonstrates basic ideas behind regridding.">
<title>The Tangled Bank - Detect lab event streaks based on specified thresholds</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-listing/list.min.js"></script>
<script src="../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-date','listing-title','listing-author','listing-subtitle','listing-image','listing-description',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: ["listing-date","listing-title","listing-author","listing-subtitle","listing-image","listing-description"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SCYH68M489"></script><script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SCYH68M489', { 'anonymize_ip': true});
</script><script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script><style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../styles.css">
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">The Tangled Bank</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-vignettes" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Vignettes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-vignettes">
<li>
    <a class="dropdown-item" href="../vignettes/Lab_streaks.html" rel="" target="">
 <span class="dropdown-text">Detect lab event streaks based on specified thresholds</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/netCDF_dates.html" rel="" target="">
 <span class="dropdown-text">Dates From netCDF Files: Two Approaches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/prep_NOAA_OISST.html" rel="" target="">
 <span class="dropdown-text">Downloading and Prep: ERDDAP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/chl_ERDDAP.html" rel="" target="">
 <span class="dropdown-text">Retrieving Chlorophyll-a Data from ERDDAP Servers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/MHW_basic_detection.html" rel="" target="">
 <span class="dropdown-text">Basic Detection and Visualisation of Events</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/alt_method.html" rel="" target="">
 <span class="dropdown-text">Downloading and Prep: Python + CDO</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/gridded_data.html" rel="" target="">
 <span class="dropdown-text">Detecting Events in Gridded Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/regridding.html" rel="" target="">
 <span class="dropdown-text">Regridding gridded data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/MHW_MCS_horizonplots.html" rel="" target="">
 <span class="dropdown-text">Displaying MHWs and MCSs as Horizon Plots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/heatwaveR_issues.html" rel="" target="">
 <span class="dropdown-text">heatwaveR Issues</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/chl_sightings.html" rel="" target="">
 <span class="dropdown-text">Plotting the Whale Sightings and Chlorophyll-<em>a</em> Concentrations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/chl_localisation.html" rel="" target="">
 <span class="dropdown-text">Spatial Localisation, Subsetting, and Aggregation of the Chlorophyll-<em>a</em> Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/elem_ts_methods.html" rel="" target="">
 <span class="dropdown-text">Wavelet Analysis of Diatom Time Series</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-high-performace-computing" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">High-Performace Computing</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-high-performace-computing">
<li>
    <a class="dropdown-item" href="../vignettes/README_Lengau.html" rel="" target="">
 <span class="dropdown-text">Using Lengau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/PBSPro_users.html" rel="" target="">
 <span class="dropdown-text">PBSPro user and job management</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/README_tmux.html" rel="" target="">
 <span class="dropdown-text">Using tmux</span></a>
  </li>  
    </ul>
</li>
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ajsmit" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">
<li>
    <a class="dropdown-item" href="https://github.com/ajsmit/tangled_bank" rel="" target="">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bugs.com" rel="" target="">
 <span class="dropdown-text">Report a Bug</span></a>
  </li>  
    </ul>
</li>
</ul>
<div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Detect lab event streaks based on specified thresholds</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/hex_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
 <span class="menu-text">☘︎</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">UNDERGRADUATE</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">BDC223</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/BDC223_FAQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">BDC334</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/BDC334_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BDC334: Macroecology and Global Biogeography</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Ecological Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/02a-r_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2a: R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/02b-env_dist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2b: Environmental Distance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/03-biodiversity1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3: Quantifying Biodiversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/04-biodiversity2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4: Describing Biodiversity Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/Transboundary_systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transboundary systems</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">HONOURS CORE</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">BCB744 (Intro R)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/BCB744_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744: Introduction to R, and Biostatistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/01-RStudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/02-working-with-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Working with data and code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/03-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. R workflows</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/04-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Graphics with ggplot2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/05-faceting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Faceting figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/06-brewing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Brewing colours</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/07-mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Mapping with ggplot2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/08-mapping_style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Mapping with style</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/09-mapping_rnaturalearth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Mapping with Natural Earth and the <strong>sf</strong> package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/10-mapping_quakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. The Fiji Earthquake Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/11-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Tidy data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/12-tidier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Tidier data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/13-tidiest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Tidiest data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/14-recap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Recap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/15-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15. Functions by chapter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/16-base_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16. Base R primer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/17-dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">17. Dates</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">BCB744 (Biostatistics)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/01-data-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Data classes and structures in R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/02-summarise-and-describe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Exploring with summaries and descriptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/03-visualise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Exploring with figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/04-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/05-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Statistical inference and hypothesis testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/05a-decision_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5a. A quick guide to selecting the right test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Assumptions for parametric statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/07-t_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. <em>t</em>-tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/08-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Analysis of Variance (ANOVA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/09-regressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Simple linear regressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/10-correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Correlations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/11-glance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Non-parametric statistical tests at a glance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/12-confidence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Confidence intervals</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">HONOURS ELECTIVES</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">BCB743</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/BCB743_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB743: Quantitative Ecology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/00-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1-4. Review Biogeography and Global Ecology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/05-correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Correlations and Associations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/06-deep_dive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Deep Dive into Gradients</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/07-ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Ordination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/08-PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8a. Principal Component Analysis (PCA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/08-PCA_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8b. PCA Additional Examples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/08-PCA_SDG.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8c. PCA of WHO SDGs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/09-CA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Correspondence Analysis (CA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/10-PCoA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Principal Coordinate Analysis (PCoA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/11-nMDS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11a. non-Metric Multidimensional Scaling (nMDS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/11-nMDS_diatoms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11b. nMDS of Mayombo’s Diatom Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/12-constrained_ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Constrained Ordination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/13-cluster_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Cluster Analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘︎</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">SUPPORT</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Web Resources</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/general_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/ecology_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantitative Ecology Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/spatial_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial R Resources</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘︎</span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#prepare-a-dataframe-with-the-ids-date-and-lab-values" id="toc-prepare-a-dataframe-with-the-ids-date-and-lab-values" class="nav-link active" data-scroll-target="#prepare-a-dataframe-with-the-ids-date-and-lab-values"><span class="header-section-number">1</span> Prepare a dataframe with the IDs, date, and lab values</a></li>
  <li><a href="#calculate-streaks-lengths-based-on-linear-over-time-thresholds" id="toc-calculate-streaks-lengths-based-on-linear-over-time-thresholds" class="nav-link" data-scroll-target="#calculate-streaks-lengths-based-on-linear-over-time-thresholds"><span class="header-section-number">2</span> Calculate streaks lengths based on linear (over time) thresholds</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ajsmit/tangled_bank/edit/main/vignettes/Lab_streaks.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/ajsmit/tangled_bank/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Detect lab event streaks based on specified thresholds</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>

<div>
  <div class="description">
    This vignette demonstrates basic ideas behind regridding.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>AJ Smit </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 23, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header><div class="cell" data-warnings="false">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://robwschlegel.github.io/heatwaveR/index.html">heatwaveR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr">plyr</a></span><span class="op">)</span> <span class="co"># because I like plyr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is a question we received via <strong>heatwaveR</strong>’s GitHub page regarding using our package’s functions to detect streaks of outcomes based on a threshold in some lab experiment. The question is as follows:</p>
<blockquote class="blockquote">
<p>“I was looking for a function that could help me with data wrangling and I believe the <code><a href="https://rdrr.io/pkg/heatwaveR/man/exceedance.html">exceedance()</a></code> function is exactly what I’m looking for. I have a dataframe with person IDs, date of treatment, day since treatment, and a lab value. Essentially, I am hoping to find the longest streak of consecutive days where the lab value is below a certain threshold, and extending the streak if the lab value does not rise above the threshold for &gt;3 days.</p>
</blockquote>
<blockquote class="blockquote">
<p>I wrangled my dataframe into a dataframe with the IDs, date, and lab value as follows …”</p>
</blockquote>
<section id="prepare-a-dataframe-with-the-ids-date-and-lab-values" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="prepare-a-dataframe-with-the-ids-date-and-lab-values">
<span class="header-section-number">1</span> Prepare a dataframe with the IDs, date, and lab values</h2>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">num_subjects</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">num_days</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span></span>
<span><span class="va">subject_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_subjects</span>, each <span class="op">=</span> <span class="va">num_days</span><span class="op">)</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"1 day"</span>, length.out <span class="op">=</span> <span class="va">num_days</span><span class="op">)</span>,</span>
<span>             times <span class="op">=</span> <span class="va">num_subjects</span><span class="op">)</span></span>
<span><span class="va">lab_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_subjects</span> <span class="op">*</span> <span class="va">num_days</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  SubjectID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">subject_ids</span><span class="op">)</span>,</span>
<span>  Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span>,</span>
<span>  Lab <span class="op">=</span> <span class="va">lab_values</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="calculate-streaks-lengths-based-on-linear-over-time-thresholds" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="calculate-streaks-lengths-based-on-linear-over-time-thresholds">
<span class="header-section-number">2</span> Calculate streaks lengths based on linear (over time) thresholds</h2>
<p>It turns out that one of the other built-in functions can exactly do what you need. We simply need to make some adjustments to the dataframe fed to the <code><a href="https://rdrr.io/pkg/heatwaveR/man/detect_event.html">detect_event()</a></code> function, which is the function that will count the streak lengths.</p>
<p>Calculate a mean value and a threshold; you can calculate an overall mean and threshold, or a mean and threshold for each group— this will depend on your experimental design and hypotheses.</p>
<p>I calculate a mean and threshold based on the pooled data (across A-C):</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html">mutate</a></span><span class="op">(</span>seas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Lab</span><span class="op">)</span>,</span>
<span>         thresh <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># your threshold value here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Even though we calculated the mean value, this is not used; only the threshold is used.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/dlply.html">dlply</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">df2</span>, .variables <span class="op">=</span> <span class="st">"SubjectID"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sub_df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/heatwaveR/man/detect_event.html">detect_event</a></span><span class="op">(</span><span class="va">sub_df</span>,</span>
<span>               x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>               y <span class="op">=</span> <span class="va">Lab</span>,</span>
<span>               seasClim <span class="op">=</span> <span class="va">seas</span>,</span>
<span>               threshClim <span class="op">=</span> <span class="va">thresh</span>,</span>
<span>               minDuration <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               maxGap <span class="op">=</span> <span class="fl">3</span>, </span>
<span>               coldSpell <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               protoEvents <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>results</code> is a list of dataframes, one pair of dataframes for each subject. Let us look at the first list element, which is for <code>SubjectID == 1</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$climatology
   SubjectID       Date        Lab     seas thresh threshCriterion
1          1 2023-01-01 2130.96734 1484.172    500           FALSE
2          1 2023-01-02  738.41191 1484.172    500           FALSE
3          1 2023-01-03 1168.90333 1484.172    500           FALSE
4          1 2023-01-04  274.15102 1484.172    500            TRUE
5          1 2023-01-05 2886.19363 1484.172    500           FALSE
6          1 2023-01-06   32.79999 1484.172    500            TRUE
7          1 2023-01-07 1722.88553 1484.172    500           FALSE
8          1 2023-01-08 2293.19397 1484.172    500           FALSE
9          1 2023-01-09 2620.14693 1484.172    500           FALSE
10         1 2023-01-10  123.19006 1484.172    500            TRUE
11         1 2023-01-11 1983.36480 1484.172    500           FALSE
12         1 2023-01-12 2635.11255 1484.172    500           FALSE
13         1 2023-01-13 2671.67709 1484.172    500           FALSE
14         1 2023-01-14 1698.84140 1484.172    500           FALSE
15         1 2023-01-15 1780.64203 1484.172    500           FALSE
16         1 2023-01-16 1093.54355 1484.172    500           FALSE
17         1 2023-01-17 1072.23855 1484.172    500           FALSE
18         1 2023-01-18 1774.37116 1484.172    500           FALSE
19         1 2023-01-19 2596.35438 1484.172    500           FALSE
20         1 2023-01-20 2041.57098 1484.172    500           FALSE
   durationCriterion event event_no
1              FALSE FALSE       NA
2              FALSE FALSE       NA
3              FALSE FALSE       NA
4               TRUE  TRUE        1
5              FALSE  TRUE        1
6               TRUE  TRUE        1
7              FALSE  TRUE        1
8              FALSE  TRUE        1
9              FALSE  TRUE        1
10              TRUE  TRUE        1
11             FALSE FALSE       NA
12             FALSE FALSE       NA
13             FALSE FALSE       NA
14             FALSE FALSE       NA
15             FALSE FALSE       NA
16             FALSE FALSE       NA
17             FALSE FALSE       NA
18             FALSE FALSE       NA
19             FALSE FALSE       NA
20             FALSE FALSE       NA

$event
  event_no index_start index_peak index_end duration date_start  date_peak
1        1           4          6        10        7 2023-01-04 2023-01-06
    date_end intensity_mean intensity_max intensity_var intensity_cumulative
1 2023-01-10       -62.3774     -1451.372      1249.218            -436.6417
  intensity_mean_relThresh intensity_max_relThresh intensity_var_relThresh
1                 921.7944                  -467.2                1249.218
  intensity_cumulative_relThresh intensity_mean_abs intensity_max_abs
1                       6452.561           1421.794              32.8
  intensity_var_abs intensity_cumulative_abs rate_onset rate_decline
1          1249.218                 9952.561  -275.4909    -226.7728</code></pre>
</div>
</div>
<p>The first dataframe is called <code>climatology</code> and the other is called <code>events</code>. Don’t worry about the names as the function was initially written for climate events. The <code>climatology</code> dataframe contains all the data for <code>SubjectID</code> that were initially supplied in <code>df2</code> and a few new columns, <code>threshCriterion</code>, <code>durationCriterion</code>, <code>event</code>, and <code>event_no</code> are added at the end. When the <code>Lab</code> value dips below the <code>thresh</code>, <code>threshCriterion</code> will flag as <code>TRUE</code> regardless of how long it remains below the threshold. <code>durationCriterion</code> flags as <code>TRUE</code> if the number of times <code>threshCriterion</code> is equal to or greater than <code>minDuration</code>. <code>event</code> flags as <code>TRUE</code> if <code>threshCriterion</code> is <code>TRUE</code> AND <code>durationCriterion</code> is <code>TRUE</code>. A unique identifier is given for each event in <code>event_no</code>.</p>
<p>The <code>events</code> dataframe contains the <code>event_no</code>, the start and end dates of the event, and the event <code>duration</code> (your ‘streaks’). Various other summary stats are also calculated, but these might not be relevant for your question. Or are they?</p>
<p>If you are only interested in the <code>event</code> dataframe and want to combine all the streaks into one table with the results, do this—note the use of <code><a href="https://rdrr.io/pkg/plyr/man/ddply.html">ddply()</a></code> rather than <code><a href="https://rdrr.io/pkg/plyr/man/dlply.html">dlply()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ddply.html">ddply</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">df2</span>, .variables <span class="op">=</span> <span class="st">"SubjectID"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sub_df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/heatwaveR/man/detect_event.html">detect_event</a></span><span class="op">(</span><span class="va">sub_df</span>,</span>
<span>               x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>               y <span class="op">=</span> <span class="va">Lab</span>,</span>
<span>               seasClim <span class="op">=</span> <span class="va">seas</span>,</span>
<span>               threshClim <span class="op">=</span> <span class="va">thresh</span>,</span>
<span>               minDuration <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               maxGap <span class="op">=</span> <span class="fl">3</span>, </span>
<span>               coldSpell <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               protoEvents <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">event</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SubjectID</span>, <span class="va">event_no</span>, <span class="va">duration</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  SubjectID event_no duration
1         1        1        7
2         2        1        7
3         2        2        5
4         3        1        1
5         3        2        8
6         4        1        1
7         4        2        1
8         5        1        3</code></pre>
</div>
</div>



<!-- -->

</section><div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">
<div class="quarto-post image-right" data-index="0" data-listing-date-sort="NaN" data-listing-file-modified-sort="1676441585073" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="14">
<div class="thumbnail">
<p><a href="../vignettes/MHW_basic_detection.html"> <p class="card-img-top"><img src="MHW_basic_detection_files/figure-html/fig-example1-1.svg"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="../vignettes/MHW_basic_detection.html">
<h3 class="no-anchor listing-title">
Basic Detection and Visualisation of Events
</h3>
<div class="listing-subtitle">
Marine heatwaves and cold spells as per Hobday et al (2016) and Schlegel et al (2017).
</div>
<div class="listing-description">
<p>This vignette demonstrates the basic use of the heatwaveR package for the detection and visualisation of events.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/MHW_basic_detection.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit and Robert W Schlegel
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="1" data-listing-date-sort="NaN" data-listing-file-modified-sort="1700639616324" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="3">
<div class="thumbnail">
<p><a href="../vignettes/netCDF_dates.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/netCDF_dates.html">
<h3 class="no-anchor listing-title">
Dates From netCDF Files: Two Approaches
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
<p>This vignette demonstrates basic ideas behind dates in netCDF files.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/netCDF_dates.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="2" data-listing-date-sort="NaN" data-listing-file-modified-sort="1676441585071" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="12">
<div class="thumbnail">
<p><a href="../vignettes/gridded_data.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/gridded_data.html">
<h3 class="no-anchor listing-title">
Detecting Events in Gridded Data
</h3>
<div class="listing-subtitle">
Marine heatwaves and cold spells as per Hobday et al (2016) and Schlegel et al (2017).
</div>
<div class="listing-description">
<p>This vignette demonstrates how to detect marine heatwaves (MHWs) in dataframes of gridded data in which each pixel is a separate time series.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/gridded_data.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit and Robert W Schlegel
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="3" data-listing-date-sort="NaN" data-listing-file-modified-sort="1676441585073" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="16">
<div class="thumbnail">
<p><a href="../vignettes/prep_NOAA_OISST.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/prep_NOAA_OISST.html">
<h3 class="no-anchor listing-title">
Downloading and Preparing NOAA OISST Data: ERDDAP
</h3>
<div class="listing-subtitle">
Marine heatwaves and cold spells as per Hobday et al (2016) and Schlegel et al (2017)
</div>
<div class="listing-description">
<p>This vignette demonstrates how to download NOAA OISST data and prepare them for the detection of marine heatwaves.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/prep_NOAA_OISST.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, Robert W Schlegel and AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="4" data-listing-date-sort="NaN" data-listing-file-modified-sort="1676441585035" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="7">
<div class="thumbnail">
<p><a href="../vignettes/alt_method.html"> <p class="card-img-top"><img src="../images/sst_in_oisst-avhrr-v02r01.19810901.png"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="../vignettes/alt_method.html">
<h3 class="no-anchor listing-title">
Downloading and Preparing NOAA OISST Data: python + CDO
</h3>
<div class="listing-subtitle">
Marine heatwaves and cold spells as per Hobday et al (2016) and Schlegel et al (2017).
</div>
<div class="listing-description">
<p>This vignette demonstrates an alternative method for downloading NOAA OISST data (using a python script) and preparing and detecting marine heatwaves.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/alt_method.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit and Robert W Schlegel
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="5" data-listing-date-sort="NaN" data-listing-file-modified-sort="1680352198347" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="4">
<div class="thumbnail">
<p><a href="../vignettes/MHW_MCS_horizonplots.html"> <p class="card-img-top"><img src="MHW_MCS_horizonplots_files/figure-html/unnamed-chunk-4-1.svg"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="../vignettes/MHW_MCS_horizonplots.html">
<h3 class="no-anchor listing-title">
Event horizon plots
</h3>
<div class="listing-subtitle">
Visualisation of extreme temperature events
</div>
<div class="listing-description">
Horizon plots provide a snooty, impactful approach for showing patterns in time series. Because they can be…
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/MHW_MCS_horizonplots.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="6" data-listing-date-sort="NaN" data-listing-file-modified-sort="1676441585071" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="5">
<div class="thumbnail">
<p><a href="../vignettes/gridded_data_intro.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/gridded_data_intro.html">
<h3 class="no-anchor listing-title">
Global Earth and Ocean Data
</h3>
<div class="listing-subtitle">
An Introduction to Earth and Ocean Science datasets
</div>
<div class="listing-description">
<p>This vignette intorduces the variety gridded data products available freely on the internet.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/gridded_data_intro.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="7" data-listing-file-modified-sort="1690182972548" data-listing-reading-time-sort="5">
<div class="thumbnail">
<p><a href="../vignettes/README_PBSPro.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/README_PBSPro.html">
<h3 class="no-anchor listing-title">
PBS Pro workload manager on Lengau
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
PBS Pro is a workload management system that is designed to manage and optimise the scheduling of computational tasks on supercomputers and…
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/README_PBSPro.html">
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="8" data-listing-file-modified-sort="1697255962620" data-listing-reading-time-sort="5">
<div class="thumbnail">
<p><a href="../vignettes/PBSPro_users.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/PBSPro_users.html">
<h3 class="no-anchor listing-title">
PBSPro users and nodes
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
To find active nodes associated with a user in PBSPro, you’d typically use the <code>qstat</code> command followed by some parsing to extract the node information.…
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/PBSPro_users.html">
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="9" data-listing-date-sort="NaN" data-listing-file-modified-sort="1676444963038" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="24">
<div class="thumbnail">
<p><a href="../vignettes/chl_sightings.html"> <p class="card-img-top"><img src="../images/Azores.png"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="../vignettes/chl_sightings.html">
<h3 class="no-anchor listing-title">
Plotting the Whale Sightings and Chlorophyll-<em>a</em> Concentrations
</h3>
<div class="listing-subtitle">
A brief demonstration of data summaries
</div>
<div class="listing-description">
<p>This vignette demonstrates exploratory data analyses.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/chl_sightings.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="10" data-listing-date-sort="NaN" data-listing-file-modified-sort="1686466571697" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="11">
<div class="thumbnail">
<p><a href="../vignettes/regridding.html"> <p class="card-img-top"><img src="regridding_files/figure-html/unnamed-chunk-17-1.svg"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="../vignettes/regridding.html">
<h3 class="no-anchor listing-title">
Regridding gridded data
</h3>
<div class="listing-subtitle">
Aligning and matching spatial grids
</div>
<div class="listing-description">
<p>This vignette demonstrates basic ideas behind regridding.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/regridding.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="11" data-listing-date-sort="NaN" data-listing-file-modified-sort="1676441585045" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="8">
<div class="thumbnail">
<p><a href="../vignettes/chl_ERDDAP.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/chl_ERDDAP.html">
<h3 class="no-anchor listing-title">
Retrieving Chlorophyll-<em>a</em> Data from ERDDAP Servers
</h3>
<div class="listing-subtitle">
An Introduction to ERDDAP
</div>
<div class="listing-description">
<p>This vignette demonstrates basic ideas behind ERDDAP.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/chl_ERDDAP.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="12" data-listing-date-sort="NaN" data-listing-file-modified-sort="1676443320464" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="10">
<div class="thumbnail">
<p><a href="../vignettes/chl_localisation.html"> <p class="card-img-top"><img src="chl_localisation_files/figure-html/unnamed-chunk-9-1.svg"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="../vignettes/chl_localisation.html">
<h3 class="no-anchor listing-title">
Spatial Localisation, Subsetting, and Aggregation of the Chlorophyll-<em>a</em> Data
</h3>
<div class="listing-subtitle">
An example analysis and workflow
</div>
<div class="listing-description">
<p>This vignette demonstrates an example workflow for extracting chlorophyll-<em>a</em> data at the point localities where whales were sighted.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/chl_localisation.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="13" data-listing-file-modified-sort="1691911601533" data-listing-reading-time-sort="7">
<div class="thumbnail">
<p><a href="../vignettes/README_Lengau.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/README_Lengau.html">
<h3 class="no-anchor listing-title">
Using Lengau
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
The Lengau High Performance Computing (HPC) system is a…
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/README_Lengau.html">
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="14" data-listing-file-modified-sort="1690179931386" data-listing-reading-time-sort="10">
<div class="thumbnail">
<p><a href="../vignettes/README_tmux.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/README_tmux.html">
<h3 class="no-anchor listing-title">
Using tmux
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
Always work within <strong>tmux</strong>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/README_tmux.html">
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="15" data-listing-date-sort="1488578400000" data-listing-file-modified-sort="1676441585014" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="21">
<div class="thumbnail">
<p><a href="../vignettes/elem_ts_methods.html"> <p class="card-img-top"><img src="figures/diatoms-geochem-ts-plot-1.svg"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="../vignettes/elem_ts_methods.html">
<h3 class="no-anchor listing-title">
Wavelet analysis of diatom time series
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
On this page I reproduce the analysis in the following paper:
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/elem_ts_methods.html">
<div class="listing-date">
Mar 4, 2017
</div>
<div class="listing-author">
AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="16" data-listing-date-sort="NaN" data-listing-file-modified-sort="1692259947719" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="2">
<div class="thumbnail">
<p><a href="../vignettes/Wind_stress_curl.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/Wind_stress_curl.html">
<h3 class="no-anchor listing-title">
Wind stress curl
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
<p>This vignette demonstrates the basic calculation of wind stress curl in R.</p>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/Wind_stress_curl.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="17" data-listing-date-sort="NaN" data-listing-file-modified-sort="1680111095527" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="2">
<div class="thumbnail">
<p><a href="../vignettes/heatwaveR_issues.html"> <div class="listing-item-img-placeholder card-img-top" >&nbsp;</div> </a></p>
</div>
<div class="body">
<a href="../vignettes/heatwaveR_issues.html">
<h3 class="no-anchor listing-title">
heatwaveR issues
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
Applying <code>detect_event(..., protoEvent = FALSE)</code> (the…<code></code>
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/heatwaveR_issues.html">
<div class="listing-date">
Invalid Date
</div>
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="18" data-listing-file-modified-sort="1686900856844" data-listing-reading-time-sort="1">
<div class="thumbnail">
<p><a href="../vignettes/download_earthdata.html"> <p class="card-img-top"><img src="../images/EARTHDATA1.png"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="../vignettes/download_earthdata.html">
<h3 class="no-anchor listing-title">
wget download from NASA Earthdata
</h3>
<div class="listing-subtitle">

</div>
<div class="listing-description">
Navigate to <strong>NASA’s EARTHDATA</strong> and follow the <strong>Find Data</strong> link:
</div>
</a>
</div>
<div class="metadata">
<a href="../vignettes/download_earthdata.html">
<div class="listing-author">
AJ Smit, AJ Smit
</div>
</a>
</div>
</div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{smit,
  author = {Smit, AJ and Smit, AJ},
  title = {Detect Lab Event Streaks Based on Specified Thresholds},
  date = {},
  url = {http://tangledbank.netlify.app/vignettes/Lab_streaks.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-smit" class="csl-entry quarto-appendix-citeas" role="listitem">
Smit A, Smit A Detect lab event streaks based on specified thresholds.
<a href="http://tangledbank.netlify.app/vignettes/Lab_streaks.html">http://tangledbank.netlify.app/vignettes/Lab_streaks.html.
</a>
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://utteranc.es/client.js" repo="ajsmit/tangled_bank" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Detect lab event streaks based on specified thresholds"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "AJ Smit"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="an">listing:</span><span class="co"> default</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "This vignette demonstrates basic ideas behind regridding."</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../references.bib</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> ../marine-biology.csl</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "On this page"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">    standalone: true</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| warnings: false</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(heatwaveR)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr) <span class="co"># because I like plyr</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>Here is a question we received via **heatwaveR**'s GitHub page regarding using our package's functions to detect streaks of outcomes based on a threshold in some lab experiment. The question is as follows:</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "I was looking for a function that could help me with data wrangling and I believe the </span><span class="in">`exceedance()`</span><span class="at"> function is exactly what I'm looking for. I have a dataframe with person IDs, date of treatment, day since treatment, and a lab value. Essentially, I am hoping to find the longest streak of consecutive days where the lab value is below a certain threshold, and extending the streak if the lab value does not rise above the threshold for </span><span class="sc">\&gt;</span><span class="at">3 days.</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; I wrangled my dataframe into a dataframe with the IDs, date, and lab value as follows ..."</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prepare a dataframe with the IDs, date, and lab values</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>num_subjects <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>num_days <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>subject_ids <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>num_subjects, <span class="at">each =</span> num_days)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2023-01-01"</span>), <span class="at">by =</span> <span class="st">"1 day"</span>, <span class="at">length.out =</span> num_days),</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">times =</span> num_subjects)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>lab_values <span class="ot">&lt;-</span> <span class="fu">runif</span>(num_subjects <span class="sc">*</span> num_days, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">3000</span>)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">SubjectID =</span> <span class="fu">factor</span>(subject_ids),</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">as.Date</span>(dates),</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lab =</span> lab_values</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculate streaks lengths based on linear (over time) thresholds</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>It turns out that one of the other built-in functions can exactly do what you need. We simply need to make some adjustments to the dataframe fed to the <span class="in">`detect_event()`</span> function, which is the function that will count the streak lengths.</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>Calculate a mean value and a threshold; you can calculate an overall mean and threshold, or a mean and threshold for each group--- this will depend on your experimental design and hypotheses.</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>I calculate a mean and threshold based on the pooled data (across A-C):</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seas =</span> <span class="fu">mean</span>(Lab),</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">thresh =</span> <span class="dv">500</span>) <span class="co"># your threshold value here</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>Even though we calculated the mean value, this is not used; only the threshold is used.</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">dlply</span>(<span class="at">.data =</span> df2, <span class="at">.variables =</span> <span class="st">"SubjectID"</span>, <span class="cf">function</span>(sub_df) {</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">detect_event</span>(sub_df,</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> Date,</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> Lab,</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>               <span class="at">seasClim =</span> seas,</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>               <span class="at">threshClim =</span> thresh,</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>               <span class="at">minDuration =</span> <span class="dv">1</span>,</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>               <span class="at">maxGap =</span> <span class="dv">3</span>, </span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>               <span class="at">coldSpell =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>               <span class="at">protoEvents =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="in">`results`</span> is a list of dataframes, one pair of dataframes for each subject. Let us look at the first list element, which is for <span class="in">`SubjectID == 1`</span>:</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>results[[<span class="dv">1</span>]]</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>The first dataframe is called <span class="in">`climatology`</span> and the other is called <span class="in">`events`</span>. Don't worry about the names as the function was initially written for climate events. The <span class="in">`climatology`</span> dataframe contains all the data for <span class="in">`SubjectID`</span> that were initially supplied in <span class="in">`df2`</span> and a few new columns, <span class="in">`threshCriterion`</span>, <span class="in">`durationCriterion`</span>, <span class="in">`event`</span>, and <span class="in">`event_no`</span> are added at the end. When the <span class="in">`Lab`</span> value dips below the <span class="in">`thresh`</span>, <span class="in">`threshCriterion`</span> will flag as <span class="in">`TRUE`</span> regardless of how long it remains below the threshold. <span class="in">`durationCriterion`</span> flags as <span class="in">`TRUE`</span> if the number of times <span class="in">`threshCriterion`</span> is equal to or greater than <span class="in">`minDuration`</span>. <span class="in">`event`</span> flags as <span class="in">`TRUE`</span> if <span class="in">`threshCriterion`</span> is <span class="in">`TRUE`</span> AND <span class="in">`durationCriterion`</span> is <span class="in">`TRUE`</span>. A unique identifier is given for each event in <span class="in">`event_no`</span>.</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>The <span class="in">`events`</span> dataframe contains the <span class="in">`event_no`</span>, the start and end dates of the event, and the event <span class="in">`duration`</span> (your 'streaks'). Various other summary stats are also calculated, but these might not be relevant for your question. Or are they?</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>If you are only interested in the <span class="in">`event`</span> dataframe and want to combine all the streaks into one table with the results, do this---note the use of <span class="in">`ddply()`</span> rather than <span class="in">`dlply()`</span>:</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">ddply</span>(<span class="at">.data =</span> df2, <span class="at">.variables =</span> <span class="st">"SubjectID"</span>, <span class="cf">function</span>(sub_df) {</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">detect_event</span>(sub_df,</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> Date,</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> Lab,</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>               <span class="at">seasClim =</span> seas,</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>               <span class="at">threshClim =</span> thresh,</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>               <span class="at">minDuration =</span> <span class="dv">1</span>,</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>               <span class="at">maxGap =</span> <span class="dv">3</span>, </span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>               <span class="at">coldSpell =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>               <span class="at">protoEvents =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>event</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> </span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjectID, event_no, duration)</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">© 2023, AJ Smit</div>   
    <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">This page is built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>