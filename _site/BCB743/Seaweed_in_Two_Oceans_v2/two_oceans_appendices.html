<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="AJ Smit">
<meta name="author" content="JJ Bolton">
<meta name="author" content="RJ Anderson">
<meta name="dcterms.date" content="2017-03-19">
<title>The Tangled Bank - Seaweeds in Two Oceans: Beta-diversity (Appendices)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SCYH68M489"></script><script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SCYH68M489', { 'anonymize_ip': true});
</script><script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"dark",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script><style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="The Tangled Bank - Seaweeds in Two Oceans: Beta-diversity (Appendices)">
<meta property="og:description" content="">
<meta property="og:site_name" content="The Tangled Bank">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">The Tangled Bank</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-vignettes" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Vignettes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-vignettes">
<li>
    <a class="dropdown-item" href="../../vignettes/netCDF_dates.html">
 <span class="dropdown-text">Dates From netCDF Files: Two Approaches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/prep_NOAA_OISST.html">
 <span class="dropdown-text">Downloading and Prep: ERDDAP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/chl_ERDDAP.html">
 <span class="dropdown-text">Retrieving Chlorophyll-a Data from ERDDAP Servers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/alt_method.html">
 <span class="dropdown-text">Downloading and Prep: Python + CDO</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/gridded_data.html">
 <span class="dropdown-text">Detecting Events in Gridded Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/regridding.html">
 <span class="dropdown-text">Regridding gridded data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/MHW_MCS_horizonplots.html">
 <span class="dropdown-text">Displaying MHWs and MCSs as Horizon Plots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/heatwaveR_issues.html">
 <span class="dropdown-text">heatwaveR Issues</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/chl_sightings.html">
 <span class="dropdown-text">Plotting the Whale Sightings and Chlorophyll-<em>a</em> Concentrations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/chl_localisation.html">
 <span class="dropdown-text">Spatial Localisation, Subsetting, and Aggregation of the Chlorophyll-<em>a</em> Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/elem_ts_methods.html">
 <span class="dropdown-text">Wavelet Analysis of Diatom Time Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/buffer_data_extract.html">
 <span class="dropdown-text">Extracting gridded data within a buffer</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-high-performace-computing" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">High-Performace Computing</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-high-performace-computing">
<li>
    <a class="dropdown-item" href="../../vignettes/README_Lengau.html">
 <span class="dropdown-text">Using Lengau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/PBSPro_users.html">
 <span class="dropdown-text">PBSPro user and job management</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/README_tmux.html">
 <span class="dropdown-text">Using tmux</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Tangled Bank Blog</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-blogroll" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Blogroll</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-blogroll">
<li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">R-bloggers</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">
<li>
    <a class="dropdown-item" href="https://github.com/ajsmit/tangled_bank">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bugs.com">
 <span class="dropdown-text">Report a Bug</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Seaweeds in Two Oceans: Beta-diversity (Appendices)</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-end sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/hex_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
 <span class="menu-text">☘︎</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">UNDERGRADUATE</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">BDC223</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/BDC223_FAQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">BDC334</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/BDC334_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BDC334: Macroecology and Global Biogeography</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Ecological Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/02a-r_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2a: R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/02b-env_dist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2b: Environmental Distance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/03-biodiversity1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3: Quantifying Biodiversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/04-biodiversity2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4: Describing Biodiversity Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/Transboundary_systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transboundary systems</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">HONOURS CORE</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">BCB744 (Intro R)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/BCB744_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744: Introduction to R, and Biostatistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/01-RStudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/02-working-with-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Working with data and code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/03-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. R workflows</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/04-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Graphics with ggplot2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/05-faceting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Faceting figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/06-brewing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Brewing colours</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/07-mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Mapping with ggplot2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/08-mapping_style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Mapping with style</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/09-mapping_rnaturalearth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Mapping with Natural Earth and the <strong>sf</strong> package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/10-mapping_quakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. The Fiji Earthquake data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/11-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Tidy data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/12-tidier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Tidier data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/13-tidiest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Tidiest data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/14-recap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Recap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/15-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15. Functions by chapter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/16-base_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16. Base R primer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/17-dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">17. Dates</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">BCB744 (Biostatistics)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/BCB744_scientific_philosophy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Biostatistics and the philosophy of scientific inquiry</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/01-data-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Data classes and structures in R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/02-summarise-and-describe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Exploring with summaries and descriptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/03-visualise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Exploring with figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/04-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/05-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Statistical inference and hypothesis testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Assumptions for parametric statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/07-t_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. <em>t</em>-tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/08-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Analysis of Variance (ANOVA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/09-regressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Simple linear regressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/10-correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Correlations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/11-decision_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. A guide to selecting the right parametric test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/12-glance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Non-parametric statistical tests at a glance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/13-confidence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Confidence intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/14-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Data transformations</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">HONOURS ELECTIVES</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">BCB743 (Quantitative Ecology)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/BCB743_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB743: Quantitative Ecology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/00-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1-4. Review Biogeography and Global Ecology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/05-correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Correlations and Associations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/06-deep_dive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Deep Dive into Gradients</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/07-ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Ordination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/dis-metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Useful distance and dissimilarities metrics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/08-PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8a. Principal Component Analysis (PCA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/08-PCA_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8b. PCA Additional Examples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/08-PCA_SDG.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8c. PCA of WHO SDGs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/09-CA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Correspondence Analysis (CA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/10-PCoA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Principal Coordinate Analysis (PCoA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/11-nMDS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11a. non-Metric Multidimensional Scaling (nMDS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/11-nMDS_diatoms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11b. nMDS of Mayombo’s Diatom Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/unconstrained-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary: Unconstrained Ordinations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/12-constrained_ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Constrained Ordination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/13-cluster_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Cluster Analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘︎</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">SUPPORT</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Web Resources</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/general_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/ecology_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantitative Ecology Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/spatial_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial R Resources</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘︎</span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#appendix-b" id="toc-appendix-b" class="nav-link active" data-scroll-target="#appendix-b">Appendix B</a>
  <ul class="collapse">
<li><a href="#spatial-analysis-background-and-code" id="toc-spatial-analysis-background-and-code" class="nav-link" data-scroll-target="#spatial-analysis-background-and-code">Spatial analysis background and code</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The data</a></li>
  <li><a href="#setting-up-the-analysis-environment" id="toc-setting-up-the-analysis-environment" class="nav-link" data-scroll-target="#setting-up-the-analysis-environment">Setting up the analysis environment</a></li>
  <li><a href="#preparation-of-spatial-variables" id="toc-preparation-of-spatial-variables" class="nav-link" data-scroll-target="#preparation-of-spatial-variables">Preparation of spatial variables</a></li>
  <li><a href="#db-rda-on-the-mems" id="toc-db-rda-on-the-mems" class="nav-link" data-scroll-target="#db-rda-on-the-mems">db-RDA on the MEMs</a></li>
  <li><a href="#a-few-visualisations" id="toc-a-few-visualisations" class="nav-link" data-scroll-target="#a-few-visualisations">A few visualisations</a></li>
  <li><a href="#analysis-of-the-thermal-variables" id="toc-analysis-of-the-thermal-variables" class="nav-link" data-scroll-target="#analysis-of-the-thermal-variables">Analysis of the thermal variables</a></li>
  <li><a href="#partitioning-of-variance" id="toc-partitioning-of-variance" class="nav-link" data-scroll-target="#partitioning-of-variance">Partitioning of variance</a></li>
  </ul>
</li>
  <li>
<a href="#appendix-c" id="toc-appendix-c" class="nav-link" data-scroll-target="#appendix-c">Appendix C</a>
  <ul class="collapse">
<li><a href="#network-graphs-of-beta-diversity" id="toc-network-graphs-of-beta-diversity" class="nav-link" data-scroll-target="#network-graphs-of-beta-diversity">Network graphs of <span class="math inline">\(\beta\)</span>-diversity</a></li>
  </ul>
</li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/ajsmit/tangled_bank/edit/main/BCB743/Seaweed_in_Two_Oceans_v2/two_oceans_appendices.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ajsmit/tangled_bank/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Seaweeds in Two Oceans: Beta-diversity (Appendices)</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>


<div class="quarto-title-meta-author column-body">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">AJ Smit </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of the Western Cape
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">JJ Bolton </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Cape Town
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">RJ Anderson </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Agriculture, Forestry and Fisheries and University of Cape Town
          </p>
      </div>
  </div>

<div class="quarto-title-meta column-body">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 19, 2017</p>
    </div>
  </div>
  
    
  </div>
  


</header><p>In this document you will find examples of a fairly complicated series of constrained ordinations performed for the paper <span class="citation" data-cites="smit2017seaweeds">Smit et al. (<a href="#ref-smit2017seaweeds" role="doc-biblioref">2017</a>)</span>. The analyses are based on the distribution of seaweeds around the coast of South Africa, and the environmental variables that might explain these distributions.</p>
<section id="appendix-b" class="level2"><h2 class="anchored" data-anchor-id="appendix-b">Appendix B</h2>
<section id="spatial-analysis-background-and-code" class="level3"><h3 class="anchored" data-anchor-id="spatial-analysis-background-and-code">Spatial analysis background and code</h3>
<p>The intention of this section is to show the approach and <strong>R</strong> scripts used to pull apart the spatial scales at which seaweed assemblages are structured around the coast of South Africa. Specifically, I wish to determine if these scales match those expressed by the coastal thermal provinces and the ocean regime underpinned by the Agulhas and Benguela Currents.</p>
</section><section id="the-data" class="level3"><h3 class="anchored" data-anchor-id="the-data">The data</h3>
<p>I use two data sets. The first, <span class="math inline">\(Y\)</span>, comprises distribution records of 846 macroalgal species within each of 58 × 50 km-long sections (Appendix A) of the South African coast <span class="citation" data-cites="Bolton2002">(updated from <a href="#ref-Bolton2002" role="doc-biblioref">Bolton and Stegenga 2002</a>)</span>. This represents <em>ca</em>. 90% of the known seaweed flora of South Africa, but excludes some very small and/or very rare species for which data are insufficient. The data are from verifiable literature sources and John Bolton and Rob Anderson’s own collections, assembled from information collected by teams of phycologists over three decades <span class="citation" data-cites="Bolton1986 Stegenga1997 Bolton2002 DeClerck2005">(<a href="#ref-Bolton1986" role="doc-biblioref">Bolton 1986</a>; <a href="#ref-Stegenga1997" role="doc-biblioref">Stegenga et al. 1997</a>; <a href="#ref-Bolton2002" role="doc-biblioref">Bolton and Stegenga 2002</a>; <a href="#ref-DeClerck2005" role="doc-biblioref">De Clerck et al. 2005</a>)</span>. The second, <span class="math inline">\(E\)</span>, is a dataset of <em>in situ</em> coastal seawater temperatures <span class="citation" data-cites="Smit2013">(<a href="#ref-Smit2013" role="doc-biblioref">Smit et al. 2013</a>)</span> derived from daily measurements over up to 40 years.</p>
<p>A third data set of explanatory variables — the spatial variables (<span class="math inline">\(S\)</span>) — is constructed as per the instructions in section <em>Preparation of spatial variables</em>, later on.</p>
</section><section id="setting-up-the-analysis-environment" class="level3"><h3 class="anchored" data-anchor-id="setting-up-the-analysis-environment">Setting up the analysis environment</h3>
<p>This is <strong>R</strong>, so first I need to find, install and load various packages. Some of the packages will be available on CRAN and can be accessed and installed in the usual way, but others will have to be downloaded from <a href="https://r-forge.r-project.org/R/?group_id=195">R Forge</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(betapart)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(vegan)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(grid)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(gridBase)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(spdep) <span class="co"># for dnearneigh() in PCNM.R</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># library(devtools)</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># install.packages("packfor", repos = "http://R-Forge.R-project.org")</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># library(packfor) # replaced with vegan::ordistep()</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># install.packages("AEM", repos = "http://R-Forge.R-project.org")</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="fu">library</span>(AEM) <span class="co"># for moran.I.multi() in PCNM.R</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="fu">source</span>(<span class="st">"functions/pcoa_all.R"</span>)</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">source</span>(<span class="st">"functions/PCNM.R"</span>)</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">source</span>(<span class="st">"functions/spatial_MEM.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I get to the data. The first step involves the species table (<span class="math inline">\(Y\)</span>). First I compute the Sørensen dissimilarity and then I decompose the dissimilarity into the ‘turnover’ (β) and ‘nestedness-resultant’ (β) components <span class="citation" data-cites="Baselga2010 Baselga2013">(<a href="#ref-Baselga2010" role="doc-biblioref">Baselga 2010</a>; <a href="#ref-Baselga2013" role="doc-biblioref">Baselga et al. 2013</a>)</span> using the <code>betapart.core()</code> and <code>betapart.pair()</code> functions of the <strong>betapart</strong> package <span class="citation" data-cites="Baselga2013">(<a href="#ref-Baselga2013" role="doc-biblioref">Baselga et al. 2013</a>)</span>. These are placed into the matrices <span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span>. Optionally, I can apply a principal components analysis (PCA) on <span class="math inline">\(Y\)</span> to find the major patterns in the community data. In <strong>vegan</strong> this is done using the <code>rda()</code> function and not supplying the constraints (<em>i.e.</em> the environment table, <span class="math inline">\(E\)</span>, or the spatial table, <span class="math inline">\(S\)</span>). The formal analysis will use the species data in distance-based redundancy analyses (db-RDA as per <strong>vegan</strong>’s <code>capscale()</code> function) by coupling them with <span class="math inline">\(E\)</span> and <span class="math inline">\(S\)</span>. I provide the pre-calculated data only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Read in the species data (note: on GitHub only the distance</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># matrices obtained via 'beta.part' and 'beta.pair' (below) </span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># will be provided -- they are read in as 'Y1.Rdata' and 'Y2.Rdata';</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># the raw data cannot be shared at this stage, but the distance matrix is provided):</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># spp &lt;- read.csv('../stats/seaweeds.csv')</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co"># spp &lt;- dplyr::select(spp, -1)</span></span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># Decompose total Sørensen dissimilarity into turnover and </span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co"># nestedness-resultant components:</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co"># Y.core &lt;- betapart.core(spp) </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co"># Y.pair &lt;- beta.pair(Y.core, index.family = "sor")</span></span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co"># Let Y1 be the turnover component (beta-sim):</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co"># Y1 &lt;- as.matrix(Y.pair$beta.sim)</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co"># save(Y1, file = "data/Y1.Rdata")</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="fu">load</span>(<span class="st">"data/Y1.Rdata"</span>)</span>
<span id="cb2-17"><a href="#cb2-17"></a></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co"># Let Y2 be the nestedness-resultant component (beta-sne):</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co"># Y2 &lt;- as.matrix(Y.pair$beta.sne)</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co"># save(Y2, file = "data/Y2.Rdata")</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="fu">load</span>(<span class="st">"data/Y2.Rdata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is now necessary to load the environmental data and some setup files that partition the 58 coastal sections (and the species and environmental data that fall within these sections) into bioregions.</p>
<p>The thermal (environmental) data contain various variables, but in the analysis I use only some of them. These data were obtained from many sites along the South African coast, but using interpolation (not included here) I calculated the thermal properties for each of the coastal sections for which seaweed data are available. Consequently we have a data frame with 58 rows and a column for each of the thermal metrics. Before use, I apply <strong>vegan</strong>’s <code>decostand()</code> function to scale the data to zero mean and unit variance.</p>
<p>Four bioregions are recognised for South Africa <span class="citation" data-cites="Bolton2004">(<a href="#ref-Bolton2004" role="doc-biblioref">Bolton and Anderson 2004</a>)</span>, namely the Benguela Marine Province (BMP; coastal sections <strong>1</strong>–<strong>17</strong>), the Benguela-Agulhas Transition Zone (B-ATZ; <strong>18</strong>–<strong>22</strong>), the Agulhas Marine Province (AMP; <strong>19</strong>–<strong>43</strong>/<strong>44</strong>) and the East Coast Transition Zone (ECTZ; <strong>44</strong>/<strong>45</strong>–<strong>58</strong>). My plotting functions partition the data into the bioregions and colour code the figures accordingly so I can see regional patterns in -diversity emerging.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Now comes in the in situ temperatures for the 58 coastal sections </span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># (interpolated temperaures as per version 2 of the South African Coastal Temperature Network):</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">load</span>(<span class="st">'data/E.RData'</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>env <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(interpOut)</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co"># I select only some of the thermal vars; the rest</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># are collinear with some of the ones I import:</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>E1 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(env, febMean, febRange, febSD, augMean,</span>
<span id="cb3-9"><a href="#cb3-9"></a>                    augRange, augSD, annMean, annRange, annSD)</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co"># Calculate z-scores:</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>E1 <span class="ot">&lt;-</span> <span class="fu">decostand</span>(E1, <span class="at">method =</span> <span class="st">"standardize"</span>)</span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co"># Load the coordinates of the coastal sections:</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>sites <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/sites.csv"</span>)</span>
<span id="cb3-16"><a href="#cb3-16"></a>sites <span class="ot">&lt;-</span> sites[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)]</span>
<span id="cb3-17"><a href="#cb3-17"></a></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co"># Load the bioregion definition:</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>bioreg <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/bioregions.csv'</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="preparation-of-spatial-variables" class="level3"><h3 class="anchored" data-anchor-id="preparation-of-spatial-variables">Preparation of spatial variables</h3>
<p>I test the niche difference mechanism as the primary species compositional assembly process operating along South African shores. I suggest that the thermal gradient along the coast provides a suite of abiotic (thermal) conditions from which species can select based on their physiological tolerances, and hence this will structure -diversity. For this mechanism to function one would assume that all species have equal access to all sections along this stretch of coast, thus following Beijerinck’s ‘Law’ that everything is everywhere but the environment selects <span class="citation" data-cites="Sauer1988">(<a href="#ref-Sauer1988" role="doc-biblioref">Sauer 1988</a>)</span> (but see main text!).</p>
<p>The basic approach to a spatial analysis structured around a biological response (<em>e.g.</em> community structure and composition; <span class="math inline">\(Y\)</span>), environmental variables (<span class="math inline">\(E\)</span>) and their spatial representation (<span class="math inline">\(S\)</span>) involves an analysis of Moran’s eigenvector maps (MEM), followed by db-RDA and variance partitioning. Various literature sources discuss principle behind Moran’s eigenvector maps <span class="citation" data-cites="Dray2006 Dray2012a">(<a href="#ref-Dray2006" role="doc-biblioref">Dray et al. 2006</a>; <a href="#ref-Dray2012a" role="doc-biblioref">Dray et al. 2012</a>)</span>. Worked examples are also presented in the excellent book <em>Numerical Ecology with R</em> <span class="citation" data-cites="Borcard2011">(<a href="#ref-Borcard2011" role="doc-biblioref">Borcard et al. 2011</a>)</span> in Section 7.4. The method followed here has been adapted from these and other sources.</p>
<p>Obtaining the MEMs to use in the analysis is based on the procedure introduced by Borcard and Legendre (2002), which was later modified by <span class="citation" data-cites="Dray2006">Dray et al. (<a href="#ref-Dray2006" role="doc-biblioref">2006</a>)</span>. The basic approach involves:</p>
<ol type="1">
<li><p>Set up a geographic or Euclidian distance matrix representing the pairwise distances between the <span class="math inline">\(n\)</span> sites (<span class="math inline">\(D=[d_{ij}]\)</span>). I already did this when I applied the <code>decostand</code> function earlier.</p></li>
<li><p>Construct a truncated distance matrix by calculating a Minimum Spanning Tree (<span class="math inline">\(S^{\star}\)</span>) and noting the following rules: <span class="math display">\[S^{\star} =\left\{ \begin{array}{rl} 0 &amp; \mbox{if}~i = j \\ d_{ij} &amp; \mbox{if}~d_{ij} \leq t \\ 4t &amp; \mbox{if}~d_{ij} &gt; t \end{array} \right.\]</span> Weighting may be applied if desired, resulting in <span class="math inline">\(S^{\star}_w\)</span>. It is not done here.</p></li>
<li><p>Do a Principal Coordinates Analysis (PCoA) of the truncated distance matrix <span class="math inline">\(S^{\star}\)</span>.</p></li>
</ol>
<p>The spatial properties imprinted on the species and their environment can be specified using a matrix of Euclidian or geographic distances. These coordinates are ‘truncated’ into a square (section <span class="math inline">\(\times\)</span> section) matrix containing non-negative values (<span class="math inline">\(S^{\star}\)</span>). By convention the diagonal values are set to zero. A very basic spatial matrix is binary, where 1 codes for pairs of neigbouring sites while 0 denotes non-connected sites according to the chosen network topology. Such matrices are called ‘binary connectivity matrices’ and relate to graphs made using distance criteria derived from graph theory.</p>
<p>Truncation produced by Minimum Spanning Trees (MST) focuses on the binary relationships between neighbouring sites, discarding any other connections (<em>i.e.</em> some sites are considered to be neighbours, while for others the relationships are null). One could also choose a Gabriel graph or another kind of network topology. Such matrix representations show section-to-section connectivities. In the case of South Africa’s coastline data, the MST causes sections to be connected only to other sections adjacent to two sides of it: for example, Section <strong>4</strong> is directly connected to <em>only</em> Sections <strong>3</strong> and <strong>5</strong>; sections at the termini of the coastal ‘string’ of sections are each connected to only one other section. The binary connectivity matrices, also called <em>topology-based connectivity matrices</em>, can be produced from Euclidian or geographic coordinates using functions in at least two <strong>R</strong> packages (I start with geographic coordinates). One option is to use the <strong>spdep</strong> package’s <code>mst.nb()</code> function to calculate a MST, but there are also options in the <strong>vegan</strong> package and elsewhere. The neighbours list arrived at from the MST represents the spatial component, <span class="math inline">\(S^{\star}\)</span>. The MST results in small connectivity artefacts in the Saldanha Bay region where the closest sections are not necessarily the ones adjacent one-another following along the path around the coast, because sections at opposite sides of the bay may in fact be closer together. This topological inconsistency does not affect the spatial analysis in any way.</p>
<p>Once the truncated distance matrix has been prepared, it is subjected to a PCoA and I keep the eigenvectors that represent positive spatial correlation (positive Moran’s <span class="math inline">\(I\)</span>). For the MEM analysis I use the function <code>PCNM()</code> that resides in the <code>functions</code> folder in the file <code>PCNM.R</code> (see notes inside about authorship). PCNM stands for Principal Coordinates Analysis of Neighbourhood Matrices (the neighbourhood matrix in this instance being the MST). This method automatically constructs the spatial variables and calculates the Moran’s I for each. The MEMs are completely orthogonal and represent the spatial structures over the full range of scales from 50 to 2,700 km. The large eigenvectors represent broad spatial scales while smaller ones cover finer features. The <em>spatial data</em> will be used as a set of explanatory variables in the multiple regression type analyses applied to a species dissimilarity matrix [<em>i.e.</em> the db-RDA; <span class="citation" data-cites="Dray2012a">Dray et al. (<a href="#ref-Dray2012a" role="doc-biblioref">2012</a>)</span>]</p>
<p>The code below reproduces the spatial analysis in the paper. Due to the length of the output I have prevented the script from returning any output here; rather, if the reader is for some odd reason interested in repeating this analysis, s/he may find the data and scripts in my <a href="https://github.com/ajsmit/Seaweed-beta">GitHub</a> repository, and the full code can be run in its entirety. Well, I hope this will work, but if it doesn’t (probably very likely) then write to me at <a href="mailto:ajsmit@uwc.ac.za" class="email">ajsmit@uwc.ac.za</a> and I shall assist — this may depend on if your email has a catchy title that will make it stand out from among all the other emails which other people think are equally important.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="do">## Auto PCNM:</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>S.auto <span class="ot">&lt;-</span> <span class="fu">PCNM</span>(<span class="fu">dist</span>(sites), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="two_oceans_appendices_files/figure-html/pcnm-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># summary(S.auto)</span></span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># The truncation distance:</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>S.dmin <span class="ot">&lt;-</span> S.auto<span class="sc">$</span>thresh</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># The number of eigenvalues:</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>S.len <span class="ot">&lt;-</span> <span class="fu">length</span>(S.auto<span class="sc">$</span>values)</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co"># Expected value of I, no spatial correlation:</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>S.auto<span class="sc">$</span>expected_Moran</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01754386</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Select eigenfunction with positive spatial correlation:</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>S.sel <span class="ot">&lt;-</span> <span class="fu">which</span>(S.auto<span class="sc">$</span>Moran_I<span class="sc">$</span>Positive <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># length(S.sel)</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># there are 27 MEMs, i.e. 27 of the PCNM variables (eigenvalues) relate</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co"># significantly to Moran's I</span></span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># Extract the eigenvectors associated with those MEMs:</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>S.pos <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.auto<span class="sc">$</span>vectors)[, S.sel]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code below lets us visualise the configuration of the 58 coastal sections as represented by the minimum spanning tree. Because the sites are constrained by the coast the MST network topology results in a string of coastal sections arranged along the shore between Section <strong>1</strong> and Section <strong>58</strong>. This spatial network therefore also captures the spatial connectivity in the seaweed’s dispersal ability along the shore, although no directionality is associated with dispersal. In the paper I discuss the possible influence of ocean currents <span class="citation" data-cites="Wernberg2013">(<em>e.g.</em> <a href="#ref-Wernberg2013" role="doc-biblioref">Wernberg et al. 2013</a>)</span> and I pointed out that it is tempting to assume that seaweeds would disperse in the direction the major ocean currents. These kinds of networks could conceivably be configured to model dispersal due to currents, but here it is simply used for representing the spatial scale of the study region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># The spatial netwwork topology of the coastal sections can be seen by:</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">plot</span>(S.auto<span class="sc">$</span>spanning, sites)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="two_oceans_appendices_files/figure-html/plot-mst-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="db-rda-on-the-mems" class="level3"><h3 class="anchored" data-anchor-id="db-rda-on-the-mems">db-RDA on the MEMs</h3>
<p>The next step of the spatial analysis is to apply a db-RDA with the seaweed data (<span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span>) coupled with the MEMs. I now run a full (global) db-RDA on the significant, positive MEMs selected above, and I then perform a permutation test to see if the fit is significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>S.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span>., S.pos)</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># Permutation test to test for the significance of the global fit:</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="fu">anova</span>(S.Y1.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes, significant!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ V1 + V2 + V3 + V4 + V5 + V6 + V7 + V8 + V9 + V10 + V11 + V12 + V13 + V14 + V15 + V16 + V17 + V18 + V19 + V20 + V21 + V22 + V23 + V24 + V25 + V26 + V27, data = S.pos)
         Df SumOfSqs      F Pr(&gt;F)    
Model    27   7.7090 46.715  0.001 ***
Residual 30   0.1834                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># The global adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>S.Y1.cs.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y1.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># Variance explained by full model:</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="fu">sum</span>(S.Y1.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y1.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 102.4669</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># And on the Y2 data (uncommented, but same as above):</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>S.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span>., S.pos)</span>
<span id="cb13-3"><a href="#cb13-3"></a>S.Y2.cs.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y2.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="fu">sum</span>(S.Y2.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y2.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 128.8837</code></pre>
</div>
</div>
<p><strong>Initial analysis (pre-2017):</strong> Since the analysis is significant, I compute the adjusted <em>R</em><sup>2</sup> and run forward selection of the MEMs. The forward selection procedure of <span class="citation" data-cites="Blanchet2008">Blanchet et al. (<a href="#ref-Blanchet2008" role="doc-biblioref">2008</a>)</span> is implemented in the <strong>packfor</strong> package for R, and I use it to reduce the number of MEM variables and retain only those that best fit the biotic data. Forward selection prevents the inflation of the overall type I error and reduces the number of explanatory variables used in the final model, which improves parsimony. I then run a new db-RDA analysis on the ‘best’ (reduced) set of MEM variables that was selected.</p>
<p><strong>Update (2024):</strong> The <strong>packfor</strong> package is no longer available so I have updated my methods to use <strong>vegan</strong>’s <code>ordiR2step()</code> function instead. This function is a stepwise model selection procedure that uses adjusted <em>R</em><sup>2</sup> as the criterion (as in <strong>packfor</strong>) for selecting the best model. I run the forward selection procedure on the full model and retain the significant (‘best’, reduced) MEMs in the final model. I then use only the retained MEMs in subsequent steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>S.Y1.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>, S.pos) <span class="co"># a null model</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>S.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., S.pos)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a>S.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(S.Y1.cs.null, S.Y1.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co"># the significant MEMs to retain are</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="fu">as.data.frame</span>(S.Y1.fwd<span class="sc">$</span>anova)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   R2.adj Df         AIC         F Pr(&gt;F)
+ V5            0.3419875  1  98.9761247 28.465163  0.002
+ V2            0.5916369  1  74.8236384 31.335263  0.002
+ V3            0.8000212  1  40.8987168 46.321422  0.002
+ V4            0.8462844  1  30.3120901 12.844949  0.002
+ V6            0.8940338  1  16.3211393 16.507948  0.002
+ V1            0.9138880  1   9.9315617  7.937262  0.008
+ V8            0.9289989  1   4.7075038  6.632087  0.002
+ V7            0.9420975  1  -0.2041116  6.201277  0.002
+ V10           0.9512619  1  -3.5708726  4.653429  0.016
+ V16           0.9607722  1  -7.4594140  5.022389  0.008
+ V15           0.9678252  1 -10.1943398  3.912828  0.010
+ V9            0.9741619  1 -12.6673984  3.607809  0.018
+ V19           0.9805613  1 -15.3566916  3.705158  0.012
+ V13           0.9861936  1 -17.6699025  3.319629  0.010
+ V20           0.9920930  1 -20.3288673  3.512936  0.024
+ V17           0.9977616  1 -22.9663830  3.412867  0.006
+ V14           1.0031945  1 -25.5538792  3.292275  0.014
+ V18           1.0085029  1 -28.1642539  3.226622  0.020
+ V12           1.0133225  1 -30.4287077  2.899230  0.038
+ V21           1.0177606  1 -32.3837909  2.611085  0.040
&lt;All variables&gt; 1.0468703 NA          NA        NA     NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>S.Y1.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(S.Y1.fwd)<span class="sc">$</span>biplot))]</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">names</span>(S.Y1.red) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^V"</span>, <span class="st">"MEM"</span>, <span class="fu">names</span>(S.Y1.red)) <span class="co"># rename them</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Run the db-RDA on the Y2 data:</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>S.Y2.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> <span class="dv">1</span>, S.pos) <span class="co"># a null model</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>S.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., S.pos)</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a>S.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(S.Y2.cs.null, S.Y2.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co"># the significant MEMs to retain are</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="fu">as.data.frame</span>(S.Y2.fwd<span class="sc">$</span>anova)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   R2.adj Df        AIC         F Pr(&gt;F)
+ V5            0.4780438  1  -81.77292 25.585731  0.002
+ V1            0.6353686  1  -89.26366  9.778047  0.002
+ V3            0.7914705  1  -98.09917 11.092093  0.002
+ V2            0.8633772  1 -101.81749  5.491629  0.012
+ V6            0.9240356  1 -104.95897  4.820089  0.024
+ V7            0.9725744  1 -107.28462  3.949022  0.030
+ V20           1.0141966  1 -109.12012  3.418240  0.028
+ V16           1.0547935  1 -110.95852  3.352499  0.040
+ V4            1.0961265  1 -112.97023  3.437541  0.042
+ V10           1.1268540  1 -113.94787  2.475932  0.050
&lt;All variables&gt; 1.5487904 NA         NA        NA     NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>S.Y2.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(S.Y2.fwd)<span class="sc">$</span>biplot))]</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">names</span>(S.Y2.red) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^V"</span>, <span class="st">"MEM"</span>, <span class="fu">names</span>(S.Y2.red)) <span class="co"># rename them</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I run a new db-RDA analysis on the ‘best’ (reduced) set of MEM variables that was selected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Run a new db-RDA on the best MEM variables:</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>S.Y1.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span>., <span class="at">data =</span> S.Y1.red)</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co"># no need to check these for collinearity as the </span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co"># MEMs are completely orthogonal..</span></span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co"># Permutation test to test for significance:</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">parallel =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15 + MEM9 + MEM19 + MEM13 + MEM20 + MEM17 + MEM14 + MEM18 + MEM12 + MEM21, data = S.Y1.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model    20   7.6102 49.887  0.001 ***
Residual 37   0.2822                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Test by axis:</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Forward tests for axes
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15 + MEM9 + MEM19 + MEM13 + MEM20 + MEM17 + MEM14 + MEM18 + MEM12 + MEM21, data = S.Y1.red)
         Df SumOfSqs        F Pr(&gt;F)    
CAP1      1   5.7962 759.9148  0.001 ***
CAP2      1   1.5395 201.8412  0.001 ***
CAP3      1   0.1624  21.2963  0.001 ***
CAP4      1   0.0339   4.4467  0.889    
CAP5      1   0.0316   4.1472  0.915    
CAP6      1   0.0160   2.0913  1.000    
CAP7      1   0.0102   1.3333  1.000    
CAP8      1   0.0068   0.8886  1.000    
CAP9      1   0.0051   0.6735  1.000    
CAP10     1   0.0027   0.3527  1.000    
CAP11     1   0.0023   0.3043  1.000    
CAP12     1   0.0012   0.1602  1.000    
CAP13     1   0.0009   0.1156  1.000    
CAP14     1   0.0005   0.0699  1.000    
CAP15     1   0.0004   0.0508  1.000    
CAP16     1   0.0002   0.0317  1.000    
CAP17     1   0.0001   0.0140  1.000    
CAP18     1   0.0000   0.0031  1.000    
CAP19     1   0.0000   0.0022  1.000    
CAP20     1   0.0000   0.0010  1.000    
Residual 37   0.2822                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># The significant axes:</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>S.Y1.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a>S.Y1.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y1.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb25-4"><a href="#cb25-4"></a>S.Y1.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y1.red[,S.Y1.ax])</span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="co"># Test by terms:</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15 + MEM9 + MEM19 + MEM13 + MEM20 + MEM17 + MEM14 + MEM18 + MEM12 + MEM21, data = S.Y1.red)
         Df SumOfSqs        F Pr(&gt;F)    
MEM5      1  2.65977 348.7118  0.001 ***
MEM2      1  1.89917 248.9924  0.001 ***
MEM3      1  1.53915 201.7919  0.001 ***
MEM4      1  0.35003  45.8908  0.001 ***
MEM6      1  0.34802  45.6269  0.001 ***
MEM1      1  0.14764  19.3558  0.001 ***
MEM8      1  0.11109  14.5646  0.001 ***
MEM7      1  0.09409  12.3353  0.001 ***
MEM10     1  0.06570   8.6141  0.003 ** 
MEM16     1  0.06543   8.5783  0.004 ** 
MEM15     1  0.04800   6.2931  0.003 ** 
MEM9      1  0.04188   5.4912  0.008 ** 
MEM19     1  0.04058   5.3196  0.012 *  
MEM13     1  0.03453   4.5274  0.018 *  
MEM20     1  0.03453   4.5265  0.015 *  
MEM17     1  0.03172   4.1587  0.028 *  
MEM14     1  0.02898   3.7993  0.043 *  
MEM18     1  0.02690   3.5272  0.040 *  
MEM12     1  0.02305   3.0221  0.059 .  
MEM21     1  0.01992   2.6111  0.082 .  
Residual 37  0.28221                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co"># S.Y1.s2.R2 &lt;- RsquareAdj(S.Y1.s2)$adj.r.squared</span></span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co"># Variance explained by reduced model:</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="fu">sum</span>(S.Y1.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y1.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 101.1529</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Show only the first 6 rows:</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="fu">scores</span>(S.Y1.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            CAP1       CAP2        CAP3       CAP4
MEM5 -0.66638977  0.2324777 -0.02348013 -0.1109129
MEM2 -0.55850366  0.2341195 -0.15482672  0.1870963
MEM3  0.41265888  0.5719467 -0.53536311  0.1663092
MEM4 -0.05638993  0.4424862  0.37525094  0.1764590
MEM6  0.08457426  0.4325520  0.25691479  0.2550990
MEM1  0.08067915 -0.2083399  0.43757849  0.4164481</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>S.Y2.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span>., <span class="at">data =</span> S.Y2.red)</span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes, significant!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ MEM5 + MEM1 + MEM3 + MEM2 + MEM6 + MEM7 + MEM20 + MEM16 + MEM4 + MEM10, data = S.Y2.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model    10 0.240218 11.564  0.001 ***
Residual 47 0.097633                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Forward tests for axes
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ MEM5 + MEM1 + MEM3 + MEM2 + MEM6 + MEM7 + MEM20 + MEM16 + MEM4 + MEM10, data = S.Y2.red)
         Df SumOfSqs        F Pr(&gt;F)    
CAP1      1 0.210325 101.2490  0.001 ***
CAP2      1 0.019740   9.5027  0.052 .  
CAP3      1 0.006660   3.2062  0.811    
CAP4      1 0.001659   0.7986  0.999    
CAP5      1 0.001215   0.5850  1.000    
CAP6      1 0.000226   0.1088  1.000    
CAP7      1 0.000167   0.0806  1.000    
CAP8      1 0.000126   0.0607  1.000    
CAP9      1 0.000095   0.0456  1.000    
CAP10     1 0.000005   0.0022  1.000    
Residual 47 0.097633                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>S.Y2.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a>S.Y2.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y2.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb35-3"><a href="#cb35-3"></a>S.Y2.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y2.red[,S.Y2.ax])</span>
<span id="cb35-4"><a href="#cb35-4"></a>S.Y2.s2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y2.s2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="fu">sum</span>(S.Y2.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y2.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 110.4599</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">scores</span>(S.Y2.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            CAP1        CAP2         CAP3        CAP4
MEM5  -0.7078184  0.14311986  0.079397978  0.24900449
MEM1   0.4050368 -0.08012953 -0.006120443  0.03523688
MEM3  -0.3876470 -0.26478333 -0.204391543  0.23681505
MEM2  -0.0325433 -0.85424176 -0.291188240 -0.01401998
MEM6  -0.2304812  0.10824415 -0.392535120 -0.12972099
MEM7   0.2046975 -0.08026844 -0.104737594  0.53287698
MEM20  0.1779168  0.15636968  0.020387030  0.50353412
MEM16  0.1838637 -0.11068980 -0.030430027 -0.14889717
MEM4  -0.0716198 -0.32859787  0.778240435  0.21945102
MEM10 -0.1341523 -0.10206216  0.308283037 -0.50578262
attr(,"const")
[1] 1.876372</code></pre>
</div>
</div>
</section><section id="a-few-visualisations" class="level3"><h3 class="anchored" data-anchor-id="a-few-visualisations">A few visualisations</h3>
<p>Now I make a visualisation to reveal the spatial arrangement of the MEMs used in the final db-RDA involving the spatial variables (<em>i.e.</em> and ). The spatial configuration relates to broad scales as seen in Fig. 3 in the paper. Here are plots of the site scores for the MEMs and <span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span> (a few panels belonging with Fig. 3):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Plot the first canonical axis of the db-RDA with the significant MEMs for Y1;</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co"># (see Fig. 3):</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>S.Y1.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y1.s2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb39-4"><a href="#cb39-4"></a>S.Y1.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">ggmap</span>() <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sites, <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude,</span>
<span id="cb39-6"><a href="#cb39-6"></a>                               <span class="at">size =</span> <span class="fu">abs</span>(S.Y1.axes[, <span class="dv">1</span>]),</span>
<span id="cb39-7"><a href="#cb39-7"></a>                               <span class="at">col =</span> <span class="fu">ifelse</span>(S.Y1.axes[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">guide =</span> <span class="st">"none"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"grey60"</span>)) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of spatial variables, "</span>, beta[sim])))</span>
<span id="cb39-11"><a href="#cb39-11"></a></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="co"># And the same for Y2 (see Fig. 3):</span></span>
<span id="cb39-13"><a href="#cb39-13"></a>S.Y2.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y2.s2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb39-14"><a href="#cb39-14"></a>S.Y2.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">ggmap</span>() <span class="sc">+</span></span>
<span id="cb39-15"><a href="#cb39-15"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sites, <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude,</span>
<span id="cb39-16"><a href="#cb39-16"></a>                               <span class="at">size =</span> <span class="fu">abs</span>(S.Y2.axes[, <span class="dv">1</span>]),</span>
<span id="cb39-17"><a href="#cb39-17"></a>                               <span class="at">col =</span> <span class="fu">ifelse</span>(S.Y2.axes[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb39-19"><a href="#cb39-19"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">guide =</span> <span class="st">"none"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"grey60"</span>)) <span class="sc">+</span></span>
<span id="cb39-20"><a href="#cb39-20"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of spatial variables, "</span>, beta[sne])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that I know that spatial structures are present in the seaweed data I check how these significant spatial patterns (two significant canonical axes, CAP1 and CAP2) are related to the environmental variables using linear regression. Checks for normality are also done but none of the output is printed here.</p>
<p>Next I want to show the ordination biplots of the MEM variables with respect to the sites using scaling = 2 (species) and showing the LC scores. Now I can see the major directions of influence of the spatial variables with respect to the sites. The code below produces a few panels of Fig. 2 (the figure is reproduced at the end of this document):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># A few of the panels that go with Fig. 2;</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="co"># first for Y1...:</span></span>
<span id="cb40-3"><a href="#cb40-3"></a>S.Y1.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y1.s2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>,<span class="st">"wa"</span>,<span class="st">"lc"</span>,<span class="st">"bp"</span>,<span class="st">"cn"</span>))</span>
<span id="cb40-4"><a href="#cb40-4"></a>S.Y1.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(S.Y1.scrs<span class="sc">$</span>constraints)</span>
<span id="cb40-5"><a href="#cb40-5"></a>S.Y1.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb40-6"><a href="#cb40-6"></a>S.Y1.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb40-7"><a href="#cb40-7"></a><span class="fu">colnames</span>(S.Y1.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb40-8"><a href="#cb40-8"></a></span>
<span id="cb40-9"><a href="#cb40-9"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(S.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb40-10"><a href="#cb40-10"></a>S.Y1.bp <span class="ot">&lt;-</span> S.Y1.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb40-11"><a href="#cb40-11"></a>S.Y1.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y1.bp)</span>
<span id="cb40-12"><a href="#cb40-12"></a>S.Y1.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y1.bp)</span>
<span id="cb40-13"><a href="#cb40-13"></a><span class="fu">colnames</span>(S.Y1.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb40-14"><a href="#cb40-14"></a>S.Y1.bp.sign <span class="ot">&lt;-</span> S.Y1.bp[S.Y1.bp<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y1.sign.ax,]</span>
<span id="cb40-15"><a href="#cb40-15"></a></span>
<span id="cb40-16"><a href="#cb40-16"></a><span class="co"># A modification of the vegan ordiArrowTextXY() function to prevent the </span></span>
<span id="cb40-17"><a href="#cb40-17"></a><span class="co"># "plot.new has not been called yet" from occuring</span></span>
<span id="cb40-18"><a href="#cb40-18"></a><span class="fu">source</span>(<span class="st">"functions/text_mult.R"</span>)</span>
<span id="cb40-19"><a href="#cb40-19"></a></span>
<span id="cb40-20"><a href="#cb40-20"></a>S.Y1.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(S.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb40-21"><a href="#cb40-21"></a>S.Y1.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y1.text)</span>
<span id="cb40-22"><a href="#cb40-22"></a>S.Y1.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y1.text)</span>
<span id="cb40-23"><a href="#cb40-23"></a><span class="fu">colnames</span>(S.Y1.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb40-24"><a href="#cb40-24"></a>S.Y1.text.sign <span class="ot">&lt;-</span> S.Y1.text[S.Y1.text<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y1.sign.ax,]</span>
<span id="cb40-25"><a href="#cb40-25"></a></span>
<span id="cb40-26"><a href="#cb40-26"></a>S.Y1.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> S.Y1.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span> </span>
<span id="cb40-27"><a href="#cb40-27"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span> </span>
<span id="cb40-28"><a href="#cb40-28"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb40-29"><a href="#cb40-29"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> S.Y1.bp, </span>
<span id="cb40-30"><a href="#cb40-30"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb40-31"><a href="#cb40-31"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)), </span>
<span id="cb40-32"><a href="#cb40-32"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb40-33"><a href="#cb40-33"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(S.Y1.text), </span>
<span id="cb40-34"><a href="#cb40-34"></a>            <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(S.Y1.text)),</span>
<span id="cb40-35"><a href="#cb40-35"></a>            <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb40-36"><a href="#cb40-36"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span> </span>
<span id="cb40-37"><a href="#cb40-37"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Spatial variables and "</span>, beta[sim]))) <span class="sc">+</span></span>
<span id="cb40-38"><a href="#cb40-38"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb40-39"><a href="#cb40-39"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-40"><a href="#cb40-40"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb40-41"><a href="#cb40-41"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb40-42"><a href="#cb40-42"></a></span>
<span id="cb40-43"><a href="#cb40-43"></a><span class="co"># ...then for Y2:</span></span>
<span id="cb40-44"><a href="#cb40-44"></a>S.Y2.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y2.s2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>,<span class="st">"wa"</span>,<span class="st">"lc"</span>,<span class="st">"bp"</span>,<span class="st">"cn"</span>))</span>
<span id="cb40-45"><a href="#cb40-45"></a>S.Y2.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(S.Y2.scrs<span class="sc">$</span>constraints)</span>
<span id="cb40-46"><a href="#cb40-46"></a>S.Y2.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb40-47"><a href="#cb40-47"></a>S.Y2.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb40-48"><a href="#cb40-48"></a><span class="fu">colnames</span>(S.Y2.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb40-49"><a href="#cb40-49"></a></span>
<span id="cb40-50"><a href="#cb40-50"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(S.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.25</span>)</span>
<span id="cb40-51"><a href="#cb40-51"></a>S.Y2.bp <span class="ot">&lt;-</span> S.Y2.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb40-52"><a href="#cb40-52"></a>S.Y2.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y2.bp)</span>
<span id="cb40-53"><a href="#cb40-53"></a>S.Y2.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y2.bp)</span>
<span id="cb40-54"><a href="#cb40-54"></a><span class="fu">colnames</span>(S.Y2.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb40-55"><a href="#cb40-55"></a>S.Y2.bp.sign <span class="ot">&lt;-</span> S.Y2.bp[S.Y2.bp<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y2.sign.ax,]</span>
<span id="cb40-56"><a href="#cb40-56"></a></span>
<span id="cb40-57"><a href="#cb40-57"></a>S.Y2.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(S.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.25</span>)</span>
<span id="cb40-58"><a href="#cb40-58"></a>S.Y2.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y2.text)</span>
<span id="cb40-59"><a href="#cb40-59"></a>S.Y2.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y2.text)</span>
<span id="cb40-60"><a href="#cb40-60"></a><span class="fu">colnames</span>(S.Y2.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb40-61"><a href="#cb40-61"></a>S.Y2.text.sign <span class="ot">&lt;-</span> S.Y2.text[S.Y2.text<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y2.sign.ax,]</span>
<span id="cb40-62"><a href="#cb40-62"></a></span>
<span id="cb40-63"><a href="#cb40-63"></a>S.Y2.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> S.Y2.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span> </span>
<span id="cb40-64"><a href="#cb40-64"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span> </span>
<span id="cb40-65"><a href="#cb40-65"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb40-66"><a href="#cb40-66"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> S.Y2.bp.sign, </span>
<span id="cb40-67"><a href="#cb40-67"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb40-68"><a href="#cb40-68"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)), </span>
<span id="cb40-69"><a href="#cb40-69"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb40-70"><a href="#cb40-70"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(S.Y2.text.sign), </span>
<span id="cb40-71"><a href="#cb40-71"></a>            <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(S.Y2.text.sign)),</span>
<span id="cb40-72"><a href="#cb40-72"></a>            <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb40-73"><a href="#cb40-73"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span> </span>
<span id="cb40-74"><a href="#cb40-74"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Spatial variables and "</span>, beta[sne]))) <span class="sc">+</span></span>
<span id="cb40-75"><a href="#cb40-75"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb40-76"><a href="#cb40-76"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-77"><a href="#cb40-77"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb40-78"><a href="#cb40-78"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="analysis-of-the-thermal-variables" class="level3"><h3 class="anchored" data-anchor-id="analysis-of-the-thermal-variables">Analysis of the thermal variables</h3>
<p>As before with the spatial variable, I now do a db-RDA involving all the thermal variables (<span class="math inline">\(E\)</span>) followed by forward selection. There is less explanation provided here as the reader should now be familiar with db-RDA — the procedure is the same as with the MEMs, just different explanatory variables are supplied. Another difference is that the thermal variables are not necessarily orthogonal, so I check for collinearity using variance inflation factors (VIF).</p>
<p>I start with the full model and then run forward selection and repeat the db-RDA on the reduced set. Analyses shown for <span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># First Y1:</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>E.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span>., E1)</span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co"># Is the fit significant?</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="fu">anova</span>(E.Y1.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ febMean + febRange + febSD + augMean + augRange + augSD + annMean + annRange + annSD, data = E1)
         Df SumOfSqs      F Pr(&gt;F)    
Model     8   6.8640 40.881  0.001 ***
Residual 49   1.0284                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>E.Y1.R2a <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y1.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb43-3"><a href="#cb43-3"></a></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co"># Variance explained by full model:</span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="fu">sum</span>(E.Y1.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y1.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 91.23468</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># ...and now Y2:</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>E.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span>., E1)</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="fu">anova</span>(E.Y2.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ febMean + febRange + febSD + augMean + augRange + augSD + annMean + annRange + annSD, data = E1)
         Df SumOfSqs      F Pr(&gt;F)    
Model     8  0.16208 5.6478  0.001 ***
Residual 49  0.17577                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>E.Y2.R2a <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y2.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="fu">sum</span>(E.Y2.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y2.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 74.52904</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>E.Y1.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>, E1) <span class="co"># a null model</span></span>
<span id="cb49-4"><a href="#cb49-4"></a></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>E.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(E.Y1.cs.null, E.Y1.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-7"><a href="#cb49-7"></a>E.Y1.fwd<span class="sc">$</span>anova</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 R2.adj Df    AIC        F Pr(&gt;F)   
+ augMean       0.72355  1 54.065 127.2180  0.002 **
+ febRange      0.85867  1 24.298  40.1105  0.002 **
+ febSD         0.87924  1 18.983   7.2578  0.002 **
+ augSD         0.88986  1 16.561   4.1988  0.012 * 
&lt;All variables&gt; 0.89804                             
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Now Y2:</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>E.Y2.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> <span class="dv">1</span>, E1) <span class="co"># a null model</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>E.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(E.Y2.cs.null, E.Y2.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-4"><a href="#cb51-4"></a>E.Y2.fwd<span class="sc">$</span>anova</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 R2.adj Df     AIC       F Pr(&gt;F)   
+ annSD         0.49607  1 -82.745 26.9639  0.002 **
+ annMean       0.55700  1 -84.611  3.7918  0.028 * 
+ febRange      0.64592  1 -88.324  5.5891  0.006 **
&lt;All variables&gt; 0.70371                             
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Write the significant envs to a new object, and</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="co"># identity of significant envs in increasing order;</span></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="co"># first Y1:</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>E.Y1.sign <span class="ot">&lt;-</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(E.Y1.fwd)<span class="sc">$</span>biplot))</span>
<span id="cb53-5"><a href="#cb53-5"></a></span>
<span id="cb53-6"><a href="#cb53-6"></a>E.Y1.red <span class="ot">&lt;-</span> E1[, E.Y1.sign]</span>
<span id="cb53-7"><a href="#cb53-7"></a></span>
<span id="cb53-8"><a href="#cb53-8"></a><span class="co"># Run a new env analysis on the best env variables:</span></span>
<span id="cb53-9"><a href="#cb53-9"></a>E.Y1.cs2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span>., E.Y1.red)</span>
<span id="cb53-10"><a href="#cb53-10"></a></span>
<span id="cb53-11"><a href="#cb53-11"></a><span class="co"># Check for collinearity:</span></span>
<span id="cb53-12"><a href="#cb53-12"></a><span class="fu">vif.cca</span>(E.Y1.cs2) <span class="co"># seems fine</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> augMean febRange    febSD    augSD 
1.153254 3.621599 4.172278 1.561752 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Test for significance:</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="fu">anova</span>(E.Y1.cs2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD, data = E.Y1.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model     4   6.7530 78.528  0.001 ***
Residual 53   1.1394                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Which axes are significant?</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="fu">anova</span>(E.Y1.cs2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Forward tests for axes
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD, data = E.Y1.red)
         Df SumOfSqs        F Pr(&gt;F)    
CAP1      1   5.5925 260.1358  0.001 ***
CAP2      1   1.1231  52.2396  0.001 ***
CAP3      1   0.0347   1.6150  0.377    
CAP4      1   0.0027   0.1236  0.994    
Residual 53   1.1394                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># The significant axes:</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>E.Y1.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(E.Y1.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb59-3"><a href="#cb59-3"></a>E.Y1.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(E.Y1.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb59-4"><a href="#cb59-4"></a>E.Y1.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(E.Y1.red[,E.Y1.ax])</span>
<span id="cb59-5"><a href="#cb59-5"></a></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb59-7"><a href="#cb59-7"></a>E.Y1.cs2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y1.cs2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb59-8"><a href="#cb59-8"></a></span>
<span id="cb59-9"><a href="#cb59-9"></a><span class="co"># Variance explained by reduced (final) model:</span></span>
<span id="cb59-10"><a href="#cb59-10"></a><span class="fu">sum</span>(E.Y1.cs2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y1.cs2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 89.7591</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># The biplot scores for constraining variables:</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">scores</span>(E.Y1.cs2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                CAP1        CAP2
augMean   0.98741583  0.15628849
febRange -0.17999916 -0.90243974
febSD    -0.08286071 -0.51021047
augSD    -0.01956960 -0.07535446
attr(,"const")
[1] 4.550643</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># ...then Y2</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>E.Y2.sign <span class="ot">&lt;-</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(E.Y2.fwd)<span class="sc">$</span>biplot))</span>
<span id="cb63-3"><a href="#cb63-3"></a>E.Y2.red <span class="ot">&lt;-</span> E1[, E.Y2.sign]</span>
<span id="cb63-4"><a href="#cb63-4"></a></span>
<span id="cb63-5"><a href="#cb63-5"></a>E.Y2.cs2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span>., E.Y2.red)</span>
<span id="cb63-6"><a href="#cb63-6"></a></span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="fu">vif.cca</span>(E.Y2.cs2) <span class="co"># seems fine</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   annSD  annMean febRange 
1.740039 1.464132 1.740465 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="fu">anova</span>(E.Y2.cs2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ annSD + annMean + febRange, data = E.Y2.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model     3  0.14452 13.456  0.001 ***
Residual 54  0.19333                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>E.Y2.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(E.Y2.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="co"># E.Y2.ax &lt;- which(E.Y2.axis.test[, 4] &lt; 0.05) # doesn't work...</span></span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="co"># E.Y2.sign.ax &lt;- colnames(E.Y2.red[,E.Y2.ax])</span></span>
<span id="cb67-4"><a href="#cb67-4"></a>E.Y2.sign.ax <span class="ot">&lt;-</span> <span class="st">"annMean"</span> <span class="co"># a manual cheat</span></span>
<span id="cb67-5"><a href="#cb67-5"></a></span>
<span id="cb67-6"><a href="#cb67-6"></a><span class="fu">anova</span>(E.Y2.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ annSD + annMean + febRange, data = E.Y2.red)
         Df SumOfSqs       F Pr(&gt;F)    
annSD     1 0.109804 30.6701  0.001 ***
annMean   1 0.014708  4.1081  0.029 *  
febRange  1 0.020010  5.5891  0.015 *  
Residual 54 0.193329                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>E.Y2.cs2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y2.cs2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb69-2"><a href="#cb69-2"></a></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="fu">sum</span>(E.Y2.cs2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y2.cs2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 66.45583</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">scores</span>(E.Y2.cs2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              CAP1        CAP2
annSD    0.8907338 -0.35414025
annMean  0.5645966 -0.05434144
febRange 0.5256591  0.51665741
attr(,"const")
[1] 1.876372</code></pre>
</div>
</div>
<p>Now I make the remaining panels of Fig. 3, these showing the spatial arrangement associated with the site scores of the environmental variables for <span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># Plot the two significant canonical axes of the </span></span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="co"># db-RDA with the significant MEMs. This part of Fig. 3:</span></span>
<span id="cb73-3"><a href="#cb73-3"></a>E.Y1.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y1.cs2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb73-4"><a href="#cb73-4"></a>                   <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb73-5"><a href="#cb73-5"></a>E.Y1.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">ggmap</span>() <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sites, <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y1.axes[, <span class="dv">1</span>]),</span>
<span id="cb73-7"><a href="#cb73-7"></a>             <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-8"><a href="#cb73-8"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of thermal variables, "</span>, beta[sim])))</span>
<span id="cb73-10"><a href="#cb73-10"></a></span>
<span id="cb73-11"><a href="#cb73-11"></a>E.Y1.plt.axis2 <span class="ot">&lt;-</span> <span class="fu">ggmap</span>() <span class="sc">+</span></span>
<span id="cb73-12"><a href="#cb73-12"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sites, <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y1.axes[, <span class="dv">2</span>]),</span>
<span id="cb73-13"><a href="#cb73-13"></a>             <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-14"><a href="#cb73-14"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb73-15"><a href="#cb73-15"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP2 of thermal variables, "</span>, beta[sim])))</span>
<span id="cb73-16"><a href="#cb73-16"></a></span>
<span id="cb73-17"><a href="#cb73-17"></a>E.Y2.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y2.cs2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb73-18"><a href="#cb73-18"></a>                    <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb73-19"><a href="#cb73-19"></a></span>
<span id="cb73-20"><a href="#cb73-20"></a>E.Y2.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">ggmap</span>() <span class="sc">+</span></span>
<span id="cb73-21"><a href="#cb73-21"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sites, <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y2.axes[, <span class="dv">1</span>]),</span>
<span id="cb73-22"><a href="#cb73-22"></a>             <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-23"><a href="#cb73-23"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb73-24"><a href="#cb73-24"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of thermal variables, "</span>, beta[sne])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now I make the remaining panels of Fig. 2 (below) for Y1 and Y2 and the environmental constraining vectors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># The ordiplots in Fig. 2:</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>E.Y1.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y1.cs2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>,<span class="st">"wa"</span>,<span class="st">"lc"</span>,<span class="st">"bp"</span>,<span class="st">"cn"</span>))</span>
<span id="cb74-3"><a href="#cb74-3"></a>E.Y1.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(E.Y1.scrs<span class="sc">$</span>constraints)</span>
<span id="cb74-4"><a href="#cb74-4"></a>E.Y1.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb74-5"><a href="#cb74-5"></a>E.Y1.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="fu">colnames</span>(E.Y1.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb74-7"><a href="#cb74-7"></a></span>
<span id="cb74-8"><a href="#cb74-8"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(E.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb74-9"><a href="#cb74-9"></a>E.Y1.bp <span class="ot">&lt;-</span> E.Y1.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb74-10"><a href="#cb74-10"></a>E.Y1.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y1.bp)</span>
<span id="cb74-11"><a href="#cb74-11"></a>E.Y1.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y1.bp)</span>
<span id="cb74-12"><a href="#cb74-12"></a><span class="fu">colnames</span>(E.Y1.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb74-13"><a href="#cb74-13"></a>E.Y1.bp.sign <span class="ot">&lt;-</span> E.Y1.bp[E.Y1.bp<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y1.sign.ax,]</span>
<span id="cb74-14"><a href="#cb74-14"></a></span>
<span id="cb74-15"><a href="#cb74-15"></a>E.Y1.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(E.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb74-16"><a href="#cb74-16"></a>E.Y1.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y1.text)</span>
<span id="cb74-17"><a href="#cb74-17"></a>E.Y1.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y1.text)</span>
<span id="cb74-18"><a href="#cb74-18"></a><span class="fu">colnames</span>(E.Y1.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb74-19"><a href="#cb74-19"></a>E.Y1.text.sign <span class="ot">&lt;-</span> E.Y1.text[E.Y1.text<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y1.sign.ax,]</span>
<span id="cb74-20"><a href="#cb74-20"></a></span>
<span id="cb74-21"><a href="#cb74-21"></a>E.Y1.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> E.Y1.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span> </span>
<span id="cb74-22"><a href="#cb74-22"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span> </span>
<span id="cb74-23"><a href="#cb74-23"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb74-24"><a href="#cb74-24"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> E.Y1.bp.sign, </span>
<span id="cb74-25"><a href="#cb74-25"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb74-26"><a href="#cb74-26"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)), </span>
<span id="cb74-27"><a href="#cb74-27"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb74-28"><a href="#cb74-28"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(E.Y1.text.sign), </span>
<span id="cb74-29"><a href="#cb74-29"></a>            <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(E.Y1.text.sign)),</span>
<span id="cb74-30"><a href="#cb74-30"></a>            <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb74-31"><a href="#cb74-31"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span> </span>
<span id="cb74-32"><a href="#cb74-32"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Thermal variables and "</span>, beta[sim]))) <span class="sc">+</span></span>
<span id="cb74-33"><a href="#cb74-33"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb74-34"><a href="#cb74-34"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-35"><a href="#cb74-35"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb74-36"><a href="#cb74-36"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb74-37"><a href="#cb74-37"></a></span>
<span id="cb74-38"><a href="#cb74-38"></a>E.Y2.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y2.cs2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>,<span class="st">"wa"</span>,<span class="st">"lc"</span>,<span class="st">"bp"</span>,<span class="st">"cn"</span>))</span>
<span id="cb74-39"><a href="#cb74-39"></a>E.Y2.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(E.Y2.scrs<span class="sc">$</span>constraints)</span>
<span id="cb74-40"><a href="#cb74-40"></a>E.Y2.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb74-41"><a href="#cb74-41"></a>E.Y2.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb74-42"><a href="#cb74-42"></a><span class="fu">colnames</span>(E.Y2.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb74-43"><a href="#cb74-43"></a></span>
<span id="cb74-44"><a href="#cb74-44"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(E.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.45</span>)</span>
<span id="cb74-45"><a href="#cb74-45"></a>E.Y2.bp <span class="ot">&lt;-</span> E.Y2.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb74-46"><a href="#cb74-46"></a>E.Y2.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y2.bp)</span>
<span id="cb74-47"><a href="#cb74-47"></a>E.Y2.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y2.bp)</span>
<span id="cb74-48"><a href="#cb74-48"></a><span class="fu">colnames</span>(E.Y2.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb74-49"><a href="#cb74-49"></a>E.Y2.bp.sign <span class="ot">&lt;-</span> E.Y2.bp[E.Y2.bp<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y2.sign.ax,]</span>
<span id="cb74-50"><a href="#cb74-50"></a></span>
<span id="cb74-51"><a href="#cb74-51"></a>E.Y2.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(E.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.45</span>)</span>
<span id="cb74-52"><a href="#cb74-52"></a>E.Y2.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y2.text)</span>
<span id="cb74-53"><a href="#cb74-53"></a>E.Y2.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y2.text)</span>
<span id="cb74-54"><a href="#cb74-54"></a><span class="fu">colnames</span>(E.Y2.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb74-55"><a href="#cb74-55"></a>E.Y2.text.sign <span class="ot">&lt;-</span> E.Y2.text[E.Y2.text<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y2.sign.ax,]</span>
<span id="cb74-56"><a href="#cb74-56"></a></span>
<span id="cb74-57"><a href="#cb74-57"></a>E.Y2.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> E.Y2.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span> </span>
<span id="cb74-58"><a href="#cb74-58"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span> </span>
<span id="cb74-59"><a href="#cb74-59"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb74-60"><a href="#cb74-60"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> E.Y2.bp.sign, </span>
<span id="cb74-61"><a href="#cb74-61"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb74-62"><a href="#cb74-62"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)), </span>
<span id="cb74-63"><a href="#cb74-63"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb74-64"><a href="#cb74-64"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(E.Y2.text.sign), </span>
<span id="cb74-65"><a href="#cb74-65"></a>            <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(E.Y2.text.sign)),</span>
<span id="cb74-66"><a href="#cb74-66"></a>            <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb74-67"><a href="#cb74-67"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span> </span>
<span id="cb74-68"><a href="#cb74-68"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Thermal variables and "</span>, beta[sne]))) <span class="sc">+</span></span>
<span id="cb74-69"><a href="#cb74-69"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb74-70"><a href="#cb74-70"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-71"><a href="#cb74-71"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">80</span>, .<span class="dv">75</span>),</span>
<span id="cb74-72"><a href="#cb74-72"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here I now assemble the various panels into what we see produced in Fig. 2 in the paper:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># pdf("Fig2.pdf", width = 9, height = 8)</span></span>
<span id="cb75-2"><a href="#cb75-2"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb75-3"><a href="#cb75-3"></a>grid<span class="sc">::</span><span class="fu">pushViewport</span>(grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout =</span> grid<span class="sc">::</span><span class="fu">grid.layout</span>(<span class="dv">2</span>,<span class="dv">2</span>)))</span>
<span id="cb75-4"><a href="#cb75-4"></a>vplayout <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout.pos.row =</span> x, <span class="at">layout.pos.col =</span> y)</span>
<span id="cb75-5"><a href="#cb75-5"></a><span class="fu">print</span>(E.Y1.p, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb75-6"><a href="#cb75-6"></a><span class="fu">print</span>(E.Y2.p, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb75-7"><a href="#cb75-7"></a><span class="fu">print</span>(S.Y1.p, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb75-8"><a href="#cb75-8"></a><span class="fu">print</span>(S.Y2.p, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="two_oceans_appendices_files/figure-html/make-fig-2a-d-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And I do the same with assembling the panels that form Fig. 3 in the paper:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># pdf("Fig3.pdf", width = 9, height = 7)</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb77-3"><a href="#cb77-3"></a>grid<span class="sc">::</span><span class="fu">pushViewport</span>(grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout =</span> grid<span class="sc">::</span><span class="fu">grid.layout</span>(<span class="dv">3</span>,<span class="dv">2</span>)))</span>
<span id="cb77-4"><a href="#cb77-4"></a>vplayout <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout.pos.row =</span> x, <span class="at">layout.pos.col =</span> y)</span>
<span id="cb77-5"><a href="#cb77-5"></a><span class="fu">print</span>(E.Y1.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb77-6"><a href="#cb77-6"></a><span class="fu">print</span>(E.Y1.plt.axis2, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb77-7"><a href="#cb77-7"></a><span class="fu">print</span>(E.Y2.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb77-8"><a href="#cb77-8"></a><span class="fu">print</span>(S.Y1.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb77-9"><a href="#cb77-9"></a><span class="fu">print</span>(S.Y2.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="two_oceans_appendices_files/figure-html/make-fig-3a-e-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="partitioning-of-variance" class="level3"><h3 class="anchored" data-anchor-id="partitioning-of-variance">Partitioning of variance</h3>
<p>Lastly, using <strong>vegan</strong>’s <code>varpart()</code> function, I partition the variance between the MEM variables and the thermal variables <span class="citation" data-cites="Peres-Neto2006 PeresNeto2010">(<a href="#ref-Peres-Neto2006" role="doc-biblioref">Peres-Neto et al. 2006</a>; <a href="#ref-PeresNeto2010" role="doc-biblioref">Peres-Neto and Legendre 2010</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># These lines of code produce a few figures to visually understand</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="co"># the variance partitioning on Y1:</span></span>
<span id="cb79-3"><a href="#cb79-3"></a>vp2.Y1 <span class="ot">&lt;-</span> <span class="fu">varpart</span>(Y1, E.Y1.red, S.Y1.red)</span>
<span id="cb79-4"><a href="#cb79-4"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb79-5"><a href="#cb79-5"></a><span class="fu">showvarparts</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"Environ-</span><span class="sc">\n</span><span class="st">ment"</span>,<span class="st">""</span>,<span class="st">"Spatial"</span>,<span class="st">""</span>))</span>
<span id="cb79-6"><a href="#cb79-6"></a><span class="fu">plot</span>(vp2.Y1, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="two_oceans_appendices_files/figure-html/Y1-Y2-varpart-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb80-2"><a href="#cb80-2"></a></span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="co"># Now I test the significant fractions [a], [b] and [c]...</span></span>
<span id="cb80-4"><a href="#cb80-4"></a>ES.Y1.red <span class="ot">&lt;-</span> <span class="fu">cbind</span>(E.Y1.red, S.Y1.red)</span>
<span id="cb80-5"><a href="#cb80-5"></a></span>
<span id="cb80-6"><a href="#cb80-6"></a><span class="co"># Fraction E | S; pure environmental, i.e. [a]:</span></span>
<span id="cb80-7"><a href="#cb80-7"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span> augMean <span class="sc">+</span> febRange <span class="sc">+</span> febSD <span class="sc">+</span> augSD <span class="sc">+</span></span>
<span id="cb80-8"><a href="#cb80-8"></a>                  <span class="fu">Condition</span>(MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3 <span class="sc">+</span> MEM4 <span class="sc">+</span> MEM5 <span class="sc">+</span></span>
<span id="cb80-9"><a href="#cb80-9"></a>                              MEM6 <span class="sc">+</span> MEM7 <span class="sc">+</span> MEM8 <span class="sc">+</span> MEM9 <span class="sc">+</span> MEM10 <span class="sc">+</span></span>
<span id="cb80-10"><a href="#cb80-10"></a>                              MEM13 <span class="sc">+</span> MEM15 <span class="sc">+</span> MEM16 <span class="sc">+</span></span>
<span id="cb80-11"><a href="#cb80-11"></a>                              MEM18 <span class="sc">+</span> MEM19 <span class="sc">+</span> MEM20),</span>
<span id="cb80-12"><a href="#cb80-12"></a>                <span class="at">data =</span> ES.Y1.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD + Condition(MEM1 + MEM2 + MEM3 + MEM4 + MEM5 + MEM6 + MEM7 + MEM8 + MEM9 + MEM10 + MEM13 + MEM15 + MEM16 + MEM18 + MEM19 + MEM20), data = ES.Y1.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model     4  0.18004 8.0906  0.001 ***
Residual 37  0.20584                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># Fraction S | E; pure spatial, i.e. [c]:</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span> MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3 <span class="sc">+</span> MEM4 <span class="sc">+</span> MEM5 <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3"></a>                              MEM6 <span class="sc">+</span> MEM7 <span class="sc">+</span> MEM8 <span class="sc">+</span> MEM9 <span class="sc">+</span> MEM10 <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4"></a>                              MEM13 <span class="sc">+</span> MEM15 <span class="sc">+</span> MEM16 <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5"></a>                              MEM18 <span class="sc">+</span> MEM19 <span class="sc">+</span> MEM20 <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6"></a>                  <span class="fu">Condition</span>(augMean <span class="sc">+</span> febRange <span class="sc">+</span> febSD <span class="sc">+</span> augSD),</span>
<span id="cb82-7"><a href="#cb82-7"></a>                <span class="at">data =</span> ES.Y1.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ MEM1 + MEM2 + MEM3 + MEM4 + MEM5 + MEM6 + MEM7 + MEM8 + MEM9 + MEM10 + MEM13 + MEM15 + MEM16 + MEM18 + MEM19 + MEM20 + Condition(augMean + febRange + febSD + augSD), data = ES.Y1.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model    16  0.93358 10.488  0.001 ***
Residual 37  0.20584                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># Fraction E; environmental, i.e. [a] + [b]:</span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span>., E.Y1.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD, data = E.Y1.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model     4   6.7530 78.528  0.001 ***
Residual 53   1.1394                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="co"># Fractions S; spatial, i.e. [b] + [c]:</span></span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span>., S.Y1.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15 + MEM9 + MEM19 + MEM13 + MEM20 + MEM17 + MEM14 + MEM18 + MEM12 + MEM21, data = S.Y1.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model    20   7.6102 49.887  0.001 ***
Residual 37   0.2822                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># Fractions E + S; spatial and environmental, i.e. [a] + [b] + [c]:</span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span>., <span class="fu">cbind</span>(E.Y1.red, S.Y1.red)), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD + MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15 + MEM9 + MEM19 + MEM13 + MEM20 + MEM17 + MEM14 + MEM18 + MEM12 + MEM21, data = cbind(E.Y1.red, S.Y1.red))
         Df SumOfSqs      F Pr(&gt;F)    
Model    24   7.7326 66.548  0.001 ***
Residual 33   0.1598                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># And now the partitioning of the variance in Y2:</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>(vp2.Y2 <span class="ot">&lt;-</span> <span class="fu">varpart</span>(Y2, E.Y2.red, S.Y2.red))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Partition of squared Unknown user-supplied distance in dbRDA 

Call: varpart(Y = Y2, X = E.Y2.red, S.Y2.red)

Explanatory tables:
X1:  E.Y2.red
X2:  S.Y2.red 

No. of explanatory tables: 2 
Total variation (SS): 0.21747 
No. of observations: 58 

Partition table:
                     Df R.squared Adj.R.squared Testable
[a+c] = X1            3   0.31333       0.27519     TRUE
[b+c] = X2           10   0.67180       0.60197     TRUE
[a+b+c] = X1+X2      13   0.70927       0.62337     TRUE
Individual fractions                                    
[a] = X1|X2           3                 0.02140     TRUE
[b] = X2|X1          10                 0.34818     TRUE
[c]                   0                 0.25379    FALSE
[d] = Residuals                         0.37663    FALSE
---
Use function 'dbrda' to test significance of fractions of interest</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="fu">showvarparts</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"Environ-</span><span class="sc">\n</span><span class="st">ment"</span>,<span class="st">""</span>,<span class="st">"Spatial"</span>,<span class="st">""</span>))</span>
<span id="cb92-3"><a href="#cb92-3"></a><span class="fu">plot</span>(vp2.Y2, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="two_oceans_appendices_files/figure-html/Y1-Y2-varpart-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb93-2"><a href="#cb93-2"></a></span>
<span id="cb93-3"><a href="#cb93-3"></a><span class="co"># Tests the significant fractions [a], [b] and [c]...</span></span>
<span id="cb93-4"><a href="#cb93-4"></a>ES.Y2.red <span class="ot">&lt;-</span> <span class="fu">cbind</span>(E.Y2.red, S.Y2.red)</span>
<span id="cb93-5"><a href="#cb93-5"></a></span>
<span id="cb93-6"><a href="#cb93-6"></a><span class="co"># Fraction E | S; pure environmental, i.e. [a]:</span></span>
<span id="cb93-7"><a href="#cb93-7"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span> annMean <span class="sc">+</span></span>
<span id="cb93-8"><a href="#cb93-8"></a>                  <span class="fu">Condition</span>(MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3 <span class="sc">+</span> MEM5),</span>
<span id="cb93-9"><a href="#cb93-9"></a>                <span class="at">data =</span> ES.Y2.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ annMean + Condition(MEM1 + MEM2 + MEM3 + MEM5), data = ES.Y2.red)
         Df SumOfSqs      F Pr(&gt;F)
Model     1  0.00422 1.5263  0.202
Residual 52  0.14379              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># Fraction S | E; pure spatial, i.e. [c]:</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span> MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3 <span class="sc">+</span> MEM5 <span class="sc">+</span></span>
<span id="cb95-3"><a href="#cb95-3"></a>                  <span class="fu">Condition</span>(annMean),</span>
<span id="cb95-4"><a href="#cb95-4"></a>                <span class="at">data =</span> ES.Y2.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ MEM1 + MEM2 + MEM3 + MEM5 + Condition(annMean), data = ES.Y2.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model     4  0.14994 13.557  0.001 ***
Residual 52  0.14379                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># Fraction E; environmental, i.e. [a] + [b]:</span></span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span>., E.Y2.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ annSD + annMean + febRange, data = E.Y2.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model     3  0.14452 13.456  0.001 ***
Residual 54  0.19333                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># Fractions S; spatial, i.e. [b] + [c]:</span></span>
<span id="cb99-2"><a href="#cb99-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span>., S.Y2.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ MEM5 + MEM1 + MEM3 + MEM2 + MEM6 + MEM7 + MEM20 + MEM16 + MEM4 + MEM10, data = S.Y2.red)
         Df SumOfSqs      F Pr(&gt;F)    
Model    10 0.240218 11.564  0.001 ***
Residual 47 0.097633                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># Fractions E + S; spatial and environmental, i.e. [a] + [b] + [c]:</span></span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span>., <span class="fu">cbind</span>(E.Y2.red, S.Y2.red)), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for capscale under reduced model
Permutation: free
Number of permutations: 999

Model: capscale(formula = Y2 ~ annSD + annMean + febRange + MEM5 + MEM1 + MEM3 + MEM2 + MEM6 + MEM7 + MEM20 + MEM16 + MEM4 + MEM10, data = cbind(E.Y2.red, S.Y2.red))
         Df SumOfSqs      F Pr(&gt;F)    
Model    13 0.251887 9.9173  0.001 ***
Residual 44 0.085965                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section></section><section id="appendix-c" class="level2"><h2 class="anchored" data-anchor-id="appendix-c">Appendix C</h2>
<section id="network-graphs-of-beta-diversity" class="level3"><h3 class="anchored" data-anchor-id="network-graphs-of-beta-diversity">Network graphs of <span class="math inline">\(\beta\)</span>-diversity</h3>
<p>I delved deeper into the patterns of -diversity by examining the properties of the full dissimilarity matrix, which gives regional -diversity mentioned above. This matrix describes all pairwise combinations of sections (582 – 1 = 3363), and as such gives us a regional perspective <span class="citation" data-cites="Anderson2013">(<a href="#ref-Anderson2013" role="doc-biblioref">Anderson et al. 2013</a>)</span>.</p>
<p>The usual visualisation approach is to plot the dissimilarity metric as a function of geographical distance along the gradient or with respect to the distance between corresponding pairs of sections <span class="citation" data-cites="Nekola1999 Davidar2007">(<em>e.g.</em> <a href="#ref-Nekola1999" role="doc-biblioref">Nekola et al. 1999</a>; <a href="#ref-Davidar2007" role="doc-biblioref">Davidar et al. 2007</a>)</span>; these visualisations are provided here. The plots of dissimilarities were colour-coded according to the bioregion to which the section pairs belong (the Benguela Marine Province (BMP; <strong>1</strong>–<strong>17</strong>), the Benguela-Agulhas Transition Zone (B-ATZ; <strong>18</strong>–<strong>22</strong>), the Agulhas Marine Province (AMP; <strong>19</strong>–<strong>43</strong>/<strong>44</strong> — the location of this transition is somewhat uncertain at this stage) and the East Coast Transition Zone (ECTZ; <strong>44</strong>/<strong>45</strong>–<strong>58</strong>) <span class="citation" data-cites="Bolton2004">(<em>sensu</em> <a href="#ref-Bolton2004" role="doc-biblioref">Bolton and Anderson 2004</a>)</span> to distinguish bioregional properties of species distribution from the wider geographical scale structure along the whole coastline.</p>
<p>In doing so, the change in <span class="math inline">\(\beta\)</span>-diversity per unit of separating distance between sections (km<sup>-1</sup>) could be calculated for each bioregion using linear regression. Since the connectivity between sections is constrained by their location along the shore, I calculated the distances between sections not as ‘as the crow ﬂies’ distances (<em>e.g.</em> Section <strong>1</strong> is not connected in a straight line to Section <strong>58</strong> because of the intervening land in-between), but as the great circle geodesic distances between each pair of sections along a network of connected sections (vertices on a network graph). In other words, travelling from Section <strong>1</strong> to Section <strong>58</strong> requires travelling first along the coast through Section <strong>2</strong>, then Section <strong>3</strong>, and eventually all the way up to Section <strong>58</strong>. The total distance between a pair of arbitrary sections is therefore the cumulative sum of the great circle distances between each consecutive pair of intervening sections along the ‘route’. This information is encapsulated as a square geodesic distance matrix, and can supply the distance along the abscissa against which species dissimilarities are plotted along the ordinate. The plots showing the relationship between -diversity with distance are limited because they do not provide a geographical context.</p>
<p>To overcome this problem, I relied on a visualisation technique not commonly found in biogeographical studies to explicitly provide the geographical context. I structured the sections as vertices of a network graph and assigned to them their geographical coordinates to force a familiar layout of the graph — when plotted on geographic coordinates, the sections form a map of South Africa. The species dissimilarities were assigned as edge weights (the lines connecting the <strong>58</strong> coastal sections) between pairs of sections, and added to the map. The weights are directly proportional to the thickness of the edges, and colours assigned to vertices (points, or the 58 coastal sections) cluster the sections into their bioregions. Initially I used the <strong>igraph</strong> package that many people rave about, but I found it bothersome. So I devised a cunning way to create network graphs from scratch with some <strong>dplyr</strong> and <strong>ggplot2</strong> magic. I suppose that if I really wanted to I could have made neat functions here (and elsewhere) to reduce some of the repetitive nature of my code, but I really couldn’t be bother doing that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="co"># Visualise the pairwise dissimilarities as network graphs where the </span></span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="co"># vertices are geographical coordinates and the edge lengths are the geodesic </span></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="co"># distances. </span></span>
<span id="cb103-4"><a href="#cb103-4"></a><span class="co"># These visualisations appear in the paper as Fig. 4.</span></span>
<span id="cb103-5"><a href="#cb103-5"></a><span class="fu">colnames</span>(sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>)</span>
<span id="cb103-6"><a href="#cb103-6"></a>sites <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">site =</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)), sites)</span>
<span id="cb103-7"><a href="#cb103-7"></a></span>
<span id="cb103-8"><a href="#cb103-8"></a>Y1.sl <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">expand.grid</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>), <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)))</span>
<span id="cb103-9"><a href="#cb103-9"></a><span class="fu">colnames</span>(Y1.sl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"to"</span>, <span class="st">"from"</span>)</span>
<span id="cb103-10"><a href="#cb103-10"></a></span>
<span id="cb103-11"><a href="#cb103-11"></a>Y2.sl <span class="ot">&lt;-</span> Y1.sl</span>
<span id="cb103-12"><a href="#cb103-12"></a></span>
<span id="cb103-13"><a href="#cb103-13"></a><span class="co"># First Y1:</span></span>
<span id="cb103-14"><a href="#cb103-14"></a>Y1.sl<span class="sc">$</span>Y1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Y1)</span>
<span id="cb103-15"><a href="#cb103-15"></a></span>
<span id="cb103-16"><a href="#cb103-16"></a>Y1.sl.BMP <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb103-17"><a href="#cb103-17"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-18"><a href="#cb103-18"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-19"><a href="#cb103-19"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-20"><a href="#cb103-20"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">16</span>)</span>
<span id="cb103-21"><a href="#cb103-21"></a></span>
<span id="cb103-22"><a href="#cb103-22"></a>Y1.sl.BATZ <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb103-23"><a href="#cb103-23"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-24"><a href="#cb103-24"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-25"><a href="#cb103-25"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-26"><a href="#cb103-26"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">21</span>)</span>
<span id="cb103-27"><a href="#cb103-27"></a></span>
<span id="cb103-28"><a href="#cb103-28"></a>Y1.sl.AMP <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb103-29"><a href="#cb103-29"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-30"><a href="#cb103-30"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-31"><a href="#cb103-31"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-32"><a href="#cb103-32"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">21</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">41</span>)</span>
<span id="cb103-33"><a href="#cb103-33"></a></span>
<span id="cb103-34"><a href="#cb103-34"></a>Y1.sl.ECTZ <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb103-35"><a href="#cb103-35"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-36"><a href="#cb103-36"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-37"><a href="#cb103-37"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-38"><a href="#cb103-38"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">41</span>)</span>
<span id="cb103-39"><a href="#cb103-39"></a></span>
<span id="cb103-40"><a href="#cb103-40"></a>Y1.sl <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Y1.sl.BMP, Y1.sl.BATZ, Y1.sl.AMP, Y1.sl.ECTZ)</span>
<span id="cb103-41"><a href="#cb103-41"></a></span>
<span id="cb103-42"><a href="#cb103-42"></a><span class="co"># and then Y2:</span></span>
<span id="cb103-43"><a href="#cb103-43"></a>Y2.sl<span class="sc">$</span>Y2 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Y2)</span>
<span id="cb103-44"><a href="#cb103-44"></a></span>
<span id="cb103-45"><a href="#cb103-45"></a>Y2.sl.BMP <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb103-46"><a href="#cb103-46"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-47"><a href="#cb103-47"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-48"><a href="#cb103-48"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-49"><a href="#cb103-49"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">16</span>)</span>
<span id="cb103-50"><a href="#cb103-50"></a></span>
<span id="cb103-51"><a href="#cb103-51"></a>Y2.sl.BATZ <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb103-52"><a href="#cb103-52"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-53"><a href="#cb103-53"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-54"><a href="#cb103-54"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-55"><a href="#cb103-55"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">21</span>)</span>
<span id="cb103-56"><a href="#cb103-56"></a></span>
<span id="cb103-57"><a href="#cb103-57"></a>Y2.sl.AMP <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb103-58"><a href="#cb103-58"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-59"><a href="#cb103-59"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-60"><a href="#cb103-60"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-61"><a href="#cb103-61"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">21</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">41</span>)</span>
<span id="cb103-62"><a href="#cb103-62"></a></span>
<span id="cb103-63"><a href="#cb103-63"></a>Y2.sl.ECTZ <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb103-64"><a href="#cb103-64"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-65"><a href="#cb103-65"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-66"><a href="#cb103-66"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-67"><a href="#cb103-67"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">41</span>)</span>
<span id="cb103-68"><a href="#cb103-68"></a></span>
<span id="cb103-69"><a href="#cb103-69"></a><span class="co"># Load coastline</span></span>
<span id="cb103-70"><a href="#cb103-70"></a><span class="fu">load</span>(<span class="st">"data/coast.RData"</span>)</span>
<span id="cb103-71"><a href="#cb103-71"></a></span>
<span id="cb103-72"><a href="#cb103-72"></a>sa_lats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">38</span>, <span class="sc">-</span><span class="dv">26</span>); sa_lons <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">34</span>)</span>
<span id="cb103-73"><a href="#cb103-73"></a></span>
<span id="cb103-74"><a href="#cb103-74"></a>net.plot.Y1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dissim =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">col.seq =</span> <span class="cn">NULL</span>) {</span>
<span id="cb103-75"><a href="#cb103-75"></a>  <span class="fu">ggplot</span>(dissim, <span class="fu">aes</span>(lon.x, lat.x)) <span class="sc">+</span></span>
<span id="cb103-76"><a href="#cb103-76"></a>    <span class="fu">geom_polygon</span>(<span class="at">data =</span> south_africa_coast, </span>
<span id="cb103-77"><a href="#cb103-77"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group), </span>
<span id="cb103-78"><a href="#cb103-78"></a>                 <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">"#F9FAEC"</span>) <span class="sc">+</span></span>
<span id="cb103-79"><a href="#cb103-79"></a>    <span class="fu">geom_curve</span>(<span class="fu">aes</span>(<span class="at">xend =</span> lon.y, <span class="at">yend =</span> lat.y, <span class="at">col =</span> Y1, <span class="at">alpha =</span> (<span class="dv">1</span> <span class="sc">-</span> Y1) <span class="sc">-</span> <span class="fl">0.4</span>),</span>
<span id="cb103-80"><a href="#cb103-80"></a>               <span class="at">curvature =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb103-81"><a href="#cb103-81"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> sites, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">fill =</span> bioreg<span class="sc">$</span>bolton), </span>
<span id="cb103-82"><a href="#cb103-82"></a>               <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb103-83"><a href="#cb103-83"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"AMP"</span>, <span class="st">"B-ATZ"</span>, <span class="st">"BMP"</span>, <span class="st">"ECTZ"</span>),</span>
<span id="cb103-84"><a href="#cb103-84"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorchid1"</span>, <span class="st">"aquamarine2"</span>, <span class="st">"blue1"</span>, <span class="st">"orangered1"</span>),</span>
<span id="cb103-85"><a href="#cb103-85"></a>                      <span class="at">name =</span> <span class="st">"Bioregion"</span>, <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb103-86"><a href="#cb103-86"></a>    <span class="fu">scale_colour_gradient</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(beta[sim])), </span>
<span id="cb103-87"><a href="#cb103-87"></a>                          <span class="at">low =</span> <span class="st">"antiquewhite4"</span>, <span class="at">high =</span> <span class="st">"antiquewhite"</span>) <span class="sc">+</span></span>
<span id="cb103-88"><a href="#cb103-88"></a>    <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb103-89"><a href="#cb103-89"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">"°E"</span>)) <span class="sc">+</span></span>
<span id="cb103-90"><a href="#cb103-90"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">"°S"</span>)) <span class="sc">+</span></span>
<span id="cb103-91"><a href="#cb103-91"></a>    <span class="fu">scale_alpha_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb103-92"><a href="#cb103-92"></a>    <span class="fu">theme_grey</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb103-93"><a href="#cb103-93"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb103-94"><a href="#cb103-94"></a>    <span class="fu">ggtitle</span>(title)}</span>
<span id="cb103-95"><a href="#cb103-95"></a></span>
<span id="cb103-96"><a href="#cb103-96"></a>a <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(Y1.sl.BMP, <span class="st">"Benguela Marine Province"</span>, </span>
<span id="cb103-97"><a href="#cb103-97"></a>                 <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"white"</span>, <span class="st">"black"</span>)) <span class="sc">+</span> <span class="co"># alphabetical</span></span>
<span id="cb103-98"><a href="#cb103-98"></a>  <span class="fu">theme</span>(<span class="at">legend.direction =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb103-99"><a href="#cb103-99"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.8</span>),</span>
<span id="cb103-100"><a href="#cb103-100"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)) </span>
<span id="cb103-101"><a href="#cb103-101"></a>b <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(Y1.sl.BATZ, <span class="st">"Benguela-Agulhas Transition Zone"</span>, </span>
<span id="cb103-102"><a href="#cb103-102"></a>                 <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb103-103"><a href="#cb103-103"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb103-104"><a href="#cb103-104"></a>c <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(Y1.sl.AMP, <span class="st">"Agulhas Marine Province"</span>, </span>
<span id="cb103-105"><a href="#cb103-105"></a>                 <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb103-106"><a href="#cb103-106"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb103-107"><a href="#cb103-107"></a>d <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(Y1.sl.ECTZ, <span class="st">"East Coast Transition Zone"</span>, </span>
<span id="cb103-108"><a href="#cb103-108"></a>                 <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb103-109"><a href="#cb103-109"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb103-110"><a href="#cb103-110"></a></span>
<span id="cb103-111"><a href="#cb103-111"></a><span class="co"># pdf("Fig4.pdf", width = 7, height = 3.8)</span></span>
<span id="cb103-112"><a href="#cb103-112"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb103-113"><a href="#cb103-113"></a>grid<span class="sc">::</span><span class="fu">pushViewport</span>(grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout =</span> grid<span class="sc">::</span><span class="fu">grid.layout</span>(<span class="dv">2</span>,<span class="dv">2</span>)))</span>
<span id="cb103-114"><a href="#cb103-114"></a>vplayout <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout.pos.row =</span> x, <span class="at">layout.pos.col =</span> y)</span>
<span id="cb103-115"><a href="#cb103-115"></a><span class="fu">print</span>(a, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb103-116"><a href="#cb103-116"></a><span class="fu">print</span>(b, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb103-117"><a href="#cb103-117"></a><span class="fu">print</span>(c, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb103-118"><a href="#cb103-118"></a><span class="fu">print</span>(d, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="two_oceans_appendices_files/figure-html/network-graphs-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="co"># dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And that’s it, folks. You’ll notice that I haven’t reproduced Fig. 5 here. I’ll leave that up to you… or ask me and I’ll send the code. All of the matrices have (mostly) been calculated above and they can be used together with some <strong>dplyr</strong> and <strong>ggplot2</strong> know-how in the creation of that graph.</p>
<p>Legalise seaweed!</p>
</section></section><section id="references" class="level2">


<!-- -->


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Anderson2013" class="csl-entry" role="listitem">
Anderson MJ, Tolimieri N, Millar RB (2013) <span class="nocase">Beta diversity of demersal fish assemblages in the North-Eastern Pacific: interactions of latitude and depth</span>. PLOS ONE 8:e57918.
</div>
<div id="ref-Baselga2010" class="csl-entry" role="listitem">
Baselga A (2010) <span class="nocase">Partitioning the turnover and nestedness components of beta diversity</span>. Global Ecology and Biogeography 19:134–143.
</div>
<div id="ref-Baselga2013" class="csl-entry" role="listitem">
Baselga A, Orme D, Villeger S, Bortoli JD, Leprieur F (2013) <a href="http://CRAN.R-project.org/package=betapart"><span class="nocase">betapart: Partitioning beta diversity into turnover and nestedness components</span></a>.
</div>
<div id="ref-Blanchet2008" class="csl-entry" role="listitem">
Blanchet FG, Legendre P, Borcard D (2008) <span class="nocase">Forward selection of explanatory variables</span>. Ecology 89:2623–2632.
</div>
<div id="ref-Bolton1986" class="csl-entry" role="listitem">
Bolton JJ (1986) <span class="nocase">Marine phytogeography of the Benguela upwelling region on the west coast of southern Africa: A temperature dependent approach</span>. Botanica Marina 29:251–256.
</div>
<div id="ref-Bolton2004" class="csl-entry" role="listitem">
Bolton JJ, Anderson RJ (2004) <span>Marine Vegetation</span>. In: Cowling RM, Richardson DM, Pierce SM (eds) Vegetation of southern africa. Cambridge University Press, pp 348–370
</div>
<div id="ref-Bolton2002" class="csl-entry" role="listitem">
Bolton JJ, Stegenga H (2002) <span class="nocase">Seaweed species diversity in South Africa</span>. South African Journal of Marine Science 24:9–18.
</div>
<div id="ref-Borcard2011" class="csl-entry" role="listitem">
Borcard D, Gillet F, Legendre P (2011) Numerical ecology with r. Springer
</div>
<div id="ref-Davidar2007" class="csl-entry" role="listitem">
Davidar P, Rajagopal B, Mohandass D, Puyravaud J-P, Condit R, Wright S, Leigh E (2007) The effect of climatic gradients, topographic variation and species traits on the beta diversity of rain forest trees. Global Ecology and Biogeography 16:510–518.
</div>
<div id="ref-DeClerck2005" class="csl-entry" role="listitem">
De Clerck O, Bolton JJ, Anderson RJ, Coppejans E (2005) <span class="nocase">Guide to the seaweeds of KwaZulu-Natal</span>. Scripta Botanica Belgica 33:294 pp.
</div>
<div id="ref-Dray2006" class="csl-entry" role="listitem">
Dray S, Legendre P, Peres-Neto PR (2006) <span class="nocase">Spatial modelling: a comprehensive framework for principal coordinate analysis of neighbour matrices (PCNM)</span>. Ecological Modelling 196:483–493.
</div>
<div id="ref-Dray2012a" class="csl-entry" role="listitem">
Dray S, Pélissier R, Couteron P, Fortin MJ, Legendre P, Peres-Neto PR, Bellier E, Bivand R, Blanchet FG, De Cáceres M, Dufour aB, Heegaard E, Jombart T, Munoz F, Oksanen J, Thioulouse J, Wagner HH (2012) <span class="nocase">Community ecology in the age of multivariate multiscale spatial analysis</span>. Ecological Monographs 82:257–275.
</div>
<div id="ref-Nekola1999" class="csl-entry" role="listitem">
Nekola JC, White PS, Carolina N, Nekola C, Curriculum PSW (1999) <span class="nocase">The distance decay of similarity in biogeography and ecology</span>. Journal of Biogeography 26:867–878.
</div>
<div id="ref-PeresNeto2010" class="csl-entry" role="listitem">
Peres-Neto PR, Legendre P (2010) <span class="nocase">Estimating and controlling for spatial structure in the study of ecological communities</span>. Global Ecology and Biogeography 19:174–184.
</div>
<div id="ref-Peres-Neto2006" class="csl-entry" role="listitem">
Peres-Neto PR, Legendre P, Dray S, Borcard D (2006) <span class="nocase">Variation partitioning of species data matrices: estimation and comparison of fractions</span>. Ecology 87:2614–2625.
</div>
<div id="ref-Sauer1988" class="csl-entry" role="listitem">
Sauer JD (1988) Plant migration: The dynamics of geographic patterning in seed plant species. University of California Press
</div>
<div id="ref-Smit2013" class="csl-entry" role="listitem">
Smit AJ, Roberts M, Anderson RJ, Dufois F, Dudley SFJ, Bornman TG, Olbers J, Bolton JJ (2013) <span class="nocase">A coastal seawater temperature dataset for biogeographical studies: large biases between <em>in situ</em> and remotely-sensed data sets around the coast of South Africa</span>. PLOS ONE 8:e81944.
</div>
<div id="ref-smit2017seaweeds" class="csl-entry" role="listitem">
Smit AJ, Bolton JJ, Anderson RJ (2017) Seaweeds in two oceans: Beta-diversity. <span>Frontiers in Marine Science</span> 4:404.
</div>
<div id="ref-Stegenga1997" class="csl-entry" role="listitem">
Stegenga H, Bolton JJ, Anderson RJ (1997) <span class="nocase">Seaweeds of the South African west coast</span>. Contributions of the Bolus Herbarium 18:3–637.
</div>
<div id="ref-Wernberg2013" class="csl-entry" role="listitem">
Wernberg T, Thomsen MS, Connell SD, Russell BD, Waters JM, Zuccarello GC, Kraft GT, Sanderson C, West JA, Gurgel CFD (2013) <span class="nocase">The footprint of continental-scale ocean currents on the biogeography of seaweeds.</span> PLOS ONE 8:e80168.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{smit2017,
  author = {Smit, AJ and Smit, AJ and Bolton, JJ and Anderson, RJ},
  title = {Seaweeds in {Two} {Oceans:} {Beta-diversity} {(Appendices)}},
  date = {2017-03-19},
  url = {http://tangledbank.netlify.app/BCB743/Seaweed_in_Two_Oceans_v2/two_oceans_appendices.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-smit2017" class="csl-entry quarto-appendix-citeas" role="listitem">
Smit A, Smit A, Bolton J, Anderson R (2017) Seaweeds in Two Oceans:
Beta-diversity (Appendices). <a href="http://tangledbank.netlify.app/BCB743/Seaweed_in_Two_Oceans_v2/two_oceans_appendices.html">http://tangledbank.netlify.app/BCB743/Seaweed_in_Two_Oceans_v2/two_oceans_appendices.html.
</a>
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("http:\/\/tangledbank\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb105" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb105-1"><a href="#cb105-1"></a><span class="co">---</span></span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="an">title:</span><span class="co"> 'Seaweeds in Two Oceans: Beta-diversity (Appendices)'</span></span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="an">author:</span></span>
<span id="cb105-4"><a href="#cb105-4"></a><span class="co">- affiliation: University of the Western Cape</span></span>
<span id="cb105-5"><a href="#cb105-5"></a><span class="co">  name: AJ Smit</span></span>
<span id="cb105-6"><a href="#cb105-6"></a><span class="co">- affiliation: University of Cape Town</span></span>
<span id="cb105-7"><a href="#cb105-7"></a><span class="co">  name: JJ Bolton</span></span>
<span id="cb105-8"><a href="#cb105-8"></a><span class="co">- affiliation: Department of Agriculture, Forestry and Fisheries and University of Cape Town</span></span>
<span id="cb105-9"><a href="#cb105-9"></a><span class="co">  name: RJ Anderson</span></span>
<span id="cb105-10"><a href="#cb105-10"></a><span class="an">date:</span><span class="co"> "19 March 2017"</span></span>
<span id="cb105-11"><a href="#cb105-11"></a><span class="an">output:</span></span>
<span id="cb105-12"><a href="#cb105-12"></a><span class="co">  html_document:</span></span>
<span id="cb105-13"><a href="#cb105-13"></a><span class="co">    fig_caption: yes</span></span>
<span id="cb105-14"><a href="#cb105-14"></a><span class="co">    fig_height: 12</span></span>
<span id="cb105-15"><a href="#cb105-15"></a><span class="co">    fig_width: 12</span></span>
<span id="cb105-16"><a href="#cb105-16"></a><span class="co">    fig_retina: 2</span></span>
<span id="cb105-17"><a href="#cb105-17"></a><span class="co">    highlight: espresso</span></span>
<span id="cb105-18"><a href="#cb105-18"></a><span class="co">    theme: cerulean</span></span>
<span id="cb105-19"><a href="#cb105-19"></a><span class="co">    toc_float: yes</span></span>
<span id="cb105-20"><a href="#cb105-20"></a><span class="co">    self-contained: false</span></span>
<span id="cb105-21"><a href="#cb105-21"></a><span class="co">    standalone: true</span></span>
<span id="cb105-22"><a href="#cb105-22"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb105-23"><a href="#cb105-23"></a><span class="an">fontsize:</span><span class="co"> 11pt</span></span>
<span id="cb105-24"><a href="#cb105-24"></a><span class="an">geometry:</span><span class="co"> margin=1in</span></span>
<span id="cb105-25"><a href="#cb105-25"></a><span class="an">tables:</span><span class="co"> yes</span></span>
<span id="cb105-26"><a href="#cb105-26"></a><span class="an">bibliography:</span><span class="co"> seaweed-bibliography.bib</span></span>
<span id="cb105-27"><a href="#cb105-27"></a><span class="co">---</span></span>
<span id="cb105-28"><a href="#cb105-28"></a></span>
<span id="cb105-29"><a href="#cb105-29"></a>In this document you will find examples of a fairly complicated series of constrained ordinations performed for the paper @smit2017seaweeds. The analyses are based on the distribution of seaweeds around the coast of South Africa, and the environmental variables that might explain these distributions. </span>
<span id="cb105-30"><a href="#cb105-30"></a></span>
<span id="cb105-31"><a href="#cb105-31"></a><span class="fu">## Appendix B</span></span>
<span id="cb105-32"><a href="#cb105-32"></a></span>
<span id="cb105-33"><a href="#cb105-33"></a><span class="fu">### Spatial analysis background and code</span></span>
<span id="cb105-34"><a href="#cb105-34"></a></span>
<span id="cb105-35"><a href="#cb105-35"></a>The intention of this section is to show the approach and **R** scripts used to pull apart the spatial scales at which seaweed assemblages are structured around the coast of South Africa. Specifically, I wish to determine if these scales match those expressed by the coastal thermal provinces and the ocean regime underpinned by the Agulhas and Benguela Currents.</span>
<span id="cb105-36"><a href="#cb105-36"></a></span>
<span id="cb105-37"><a href="#cb105-37"></a><span class="fu">### The data</span></span>
<span id="cb105-38"><a href="#cb105-38"></a></span>
<span id="cb105-39"><a href="#cb105-39"></a>I use two data sets. The first, $Y$, comprises distribution records of 846 macroalgal species within each of 58 × 50 km-long sections (Appendix A) of the South African coast <span class="co">[</span><span class="ot">updated from @Bolton2002</span><span class="co">]</span>. This represents *ca*. 90% of the known seaweed flora of South Africa, but excludes some very small and/or very rare species for which data are insufficient. The data are from verifiable literature sources and John Bolton and Rob Anderson's own collections, assembled from information collected by teams of phycologists over three decades [@Bolton1986; @Stegenga1997; @Bolton2002; @DeClerck2005]. The second, $E$, is a dataset of *in situ* coastal seawater temperatures <span class="co">[</span><span class="ot">@Smit2013</span><span class="co">]</span> derived from daily measurements over up to 40 years.</span>
<span id="cb105-40"><a href="#cb105-40"></a></span>
<span id="cb105-41"><a href="#cb105-41"></a>A third data set of explanatory variables --- the spatial variables ($S$) --- is constructed as per the instructions in section *Preparation of spatial variables*, later on.</span>
<span id="cb105-42"><a href="#cb105-42"></a></span>
<span id="cb105-43"><a href="#cb105-43"></a><span class="fu">### Setting up the analysis environment</span></span>
<span id="cb105-44"><a href="#cb105-44"></a></span>
<span id="cb105-45"><a href="#cb105-45"></a>This is **R**, so first I need to find, install and load various packages. Some of the packages will be available on CRAN and can be accessed and installed in the usual way, but others will have to be downloaded from <span class="co">[</span><span class="ot">R Forge</span><span class="co">](https://r-forge.r-project.org/R/?group_id=195)</span>.</span>
<span id="cb105-46"><a href="#cb105-46"></a></span>
<span id="cb105-47"><a href="#cb105-47"></a><span class="in">```{r setup}</span></span>
<span id="cb105-48"><a href="#cb105-48"></a><span class="in">library(betapart)</span></span>
<span id="cb105-49"><a href="#cb105-49"></a><span class="in">library(vegan)</span></span>
<span id="cb105-50"><a href="#cb105-50"></a><span class="in">library(gridExtra)</span></span>
<span id="cb105-51"><a href="#cb105-51"></a><span class="in">library(grid)</span></span>
<span id="cb105-52"><a href="#cb105-52"></a><span class="in">library(gridBase)</span></span>
<span id="cb105-53"><a href="#cb105-53"></a><span class="in">library(tidyr)</span></span>
<span id="cb105-54"><a href="#cb105-54"></a><span class="in">library(spdep) # for dnearneigh() in PCNM.R</span></span>
<span id="cb105-55"><a href="#cb105-55"></a><span class="in"># library(devtools)</span></span>
<span id="cb105-56"><a href="#cb105-56"></a><span class="in"># install.packages("packfor", repos = "http://R-Forge.R-project.org")</span></span>
<span id="cb105-57"><a href="#cb105-57"></a><span class="in"># library(packfor) # replaced with vegan::ordistep()</span></span>
<span id="cb105-58"><a href="#cb105-58"></a><span class="in"># install.packages("AEM", repos = "http://R-Forge.R-project.org")</span></span>
<span id="cb105-59"><a href="#cb105-59"></a><span class="in">library(AEM) # for moran.I.multi() in PCNM.R</span></span>
<span id="cb105-60"><a href="#cb105-60"></a><span class="in">source("functions/pcoa_all.R")</span></span>
<span id="cb105-61"><a href="#cb105-61"></a><span class="in">source("functions/PCNM.R")</span></span>
<span id="cb105-62"><a href="#cb105-62"></a><span class="in">source("functions/spatial_MEM.R")</span></span>
<span id="cb105-63"><a href="#cb105-63"></a><span class="in">```</span></span>
<span id="cb105-64"><a href="#cb105-64"></a></span>
<span id="cb105-65"><a href="#cb105-65"></a>Now I get to the data. The first step involves the species table ($Y$). First I compute the Sørensen dissimilarity and then I decompose the dissimilarity into the 'turnover' (β\textsubscript{sim}) and 'nestedness-resultant' (β\textsubscript{sne}) components <span class="co">[</span><span class="ot">@Baselga2010; @Baselga2013</span><span class="co">]</span> using the <span class="in">`betapart.core()`</span> and <span class="in">`betapart.pair()`</span> functions of the **betapart** package [@Baselga2013]. These are placed into the matrices $Y1$ and $Y2$. Optionally, I can apply a principal components analysis (PCA) on $Y$ to find the major patterns in the community data. In **vegan** this is done using the `rda()` function and not supplying the constraints (*i.e.* the environment table, $E$, or the spatial table, $S$). The formal analysis will use the species data in distance-based redundancy analyses (db-RDA as per **vegan**'s <span class="in">`capscale()`</span> function) by coupling them with $E$ and $S$. I provide the pre-calculated data only.</span>
<span id="cb105-66"><a href="#cb105-66"></a></span>
<span id="cb105-67"><a href="#cb105-67"></a><span class="in">```{r species-data}</span></span>
<span id="cb105-68"><a href="#cb105-68"></a><span class="in"># Read in the species data (note: on GitHub only the distance</span></span>
<span id="cb105-69"><a href="#cb105-69"></a><span class="in"># matrices obtained via 'beta.part' and 'beta.pair' (below) </span></span>
<span id="cb105-70"><a href="#cb105-70"></a><span class="in"># will be provided -- they are read in as 'Y1.Rdata' and 'Y2.Rdata';</span></span>
<span id="cb105-71"><a href="#cb105-71"></a><span class="in"># the raw data cannot be shared at this stage, but the distance matrix is provided):</span></span>
<span id="cb105-72"><a href="#cb105-72"></a><span class="in"># spp &lt;- read.csv('../stats/seaweeds.csv')</span></span>
<span id="cb105-73"><a href="#cb105-73"></a><span class="in"># spp &lt;- dplyr::select(spp, -1)</span></span>
<span id="cb105-74"><a href="#cb105-74"></a></span>
<span id="cb105-75"><a href="#cb105-75"></a><span class="in"># Decompose total Sørensen dissimilarity into turnover and </span></span>
<span id="cb105-76"><a href="#cb105-76"></a><span class="in"># nestedness-resultant components:</span></span>
<span id="cb105-77"><a href="#cb105-77"></a><span class="in"># Y.core &lt;- betapart.core(spp) </span></span>
<span id="cb105-78"><a href="#cb105-78"></a><span class="in"># Y.pair &lt;- beta.pair(Y.core, index.family = "sor")</span></span>
<span id="cb105-79"><a href="#cb105-79"></a></span>
<span id="cb105-80"><a href="#cb105-80"></a><span class="in"># Let Y1 be the turnover component (beta-sim):</span></span>
<span id="cb105-81"><a href="#cb105-81"></a><span class="in"># Y1 &lt;- as.matrix(Y.pair$beta.sim)</span></span>
<span id="cb105-82"><a href="#cb105-82"></a><span class="in"># save(Y1, file = "data/Y1.Rdata")</span></span>
<span id="cb105-83"><a href="#cb105-83"></a><span class="in">load("data/Y1.Rdata")</span></span>
<span id="cb105-84"><a href="#cb105-84"></a></span>
<span id="cb105-85"><a href="#cb105-85"></a><span class="in"># Let Y2 be the nestedness-resultant component (beta-sne):</span></span>
<span id="cb105-86"><a href="#cb105-86"></a><span class="in"># Y2 &lt;- as.matrix(Y.pair$beta.sne)</span></span>
<span id="cb105-87"><a href="#cb105-87"></a><span class="in"># save(Y2, file = "data/Y2.Rdata")</span></span>
<span id="cb105-88"><a href="#cb105-88"></a><span class="in">load("data/Y2.Rdata")</span></span>
<span id="cb105-89"><a href="#cb105-89"></a><span class="in">```</span></span>
<span id="cb105-90"><a href="#cb105-90"></a></span>
<span id="cb105-91"><a href="#cb105-91"></a>It is now necessary to load the environmental data and some setup files that partition the 58 coastal sections (and the species and environmental data that fall within these sections) into bioregions.</span>
<span id="cb105-92"><a href="#cb105-92"></a></span>
<span id="cb105-93"><a href="#cb105-93"></a>The thermal (environmental) data contain various variables, but in the analysis I use only some of them. These data were obtained from many sites along the South African coast, but using interpolation (not included here) I calculated the thermal properties for each of the coastal sections for which seaweed data are available. Consequently we have a data frame with 58 rows and a column for each of the thermal metrics. Before use, I apply **vegan**'s <span class="in">`decostand()`</span> function to scale the data to zero mean and unit variance.</span>
<span id="cb105-94"><a href="#cb105-94"></a></span>
<span id="cb105-95"><a href="#cb105-95"></a>Four bioregions are recognised for South Africa <span class="co">[</span><span class="ot">@Bolton2004</span><span class="co">]</span>, namely the Benguela Marine Province (BMP; coastal sections **1**--**17**), the Benguela-Agulhas Transition Zone (B-ATZ; **18**--**22**), the Agulhas Marine Province (AMP; **19**--**43**/**44**) and the East Coast Transition Zone (ECTZ; **44**/**45**--**58**). My plotting functions partition the data into the bioregions and colour code the figures accordingly so I can see regional patterns in \textbeta-diversity emerging.</span>
<span id="cb105-96"><a href="#cb105-96"></a></span>
<span id="cb105-97"><a href="#cb105-97"></a><span class="in">```{r env-data}</span></span>
<span id="cb105-98"><a href="#cb105-98"></a><span class="in"># Now comes in the in situ temperatures for the 58 coastal sections </span></span>
<span id="cb105-99"><a href="#cb105-99"></a><span class="in"># (interpolated temperaures as per version 2 of the South African Coastal Temperature Network):</span></span>
<span id="cb105-100"><a href="#cb105-100"></a><span class="in">load('data/E.RData')</span></span>
<span id="cb105-101"><a href="#cb105-101"></a><span class="in">env &lt;- as.data.frame(interpOut)</span></span>
<span id="cb105-102"><a href="#cb105-102"></a></span>
<span id="cb105-103"><a href="#cb105-103"></a><span class="in"># I select only some of the thermal vars; the rest</span></span>
<span id="cb105-104"><a href="#cb105-104"></a><span class="in"># are collinear with some of the ones I import:</span></span>
<span id="cb105-105"><a href="#cb105-105"></a><span class="in">E1 &lt;- dplyr::select(env, febMean, febRange, febSD, augMean,</span></span>
<span id="cb105-106"><a href="#cb105-106"></a><span class="in">                    augRange, augSD, annMean, annRange, annSD)</span></span>
<span id="cb105-107"><a href="#cb105-107"></a></span>
<span id="cb105-108"><a href="#cb105-108"></a><span class="in"># Calculate z-scores:</span></span>
<span id="cb105-109"><a href="#cb105-109"></a><span class="in">E1 &lt;- decostand(E1, method = "standardize")</span></span>
<span id="cb105-110"><a href="#cb105-110"></a></span>
<span id="cb105-111"><a href="#cb105-111"></a><span class="in"># Load the coordinates of the coastal sections:</span></span>
<span id="cb105-112"><a href="#cb105-112"></a><span class="in">sites &lt;- read.csv("data/sites.csv")</span></span>
<span id="cb105-113"><a href="#cb105-113"></a><span class="in">sites &lt;- sites[, c(2, 1)]</span></span>
<span id="cb105-114"><a href="#cb105-114"></a></span>
<span id="cb105-115"><a href="#cb105-115"></a><span class="in"># Load the bioregion definition:</span></span>
<span id="cb105-116"><a href="#cb105-116"></a><span class="in">bioreg &lt;- read.csv('data/bioregions.csv', header = TRUE)</span></span>
<span id="cb105-117"><a href="#cb105-117"></a><span class="in">```</span></span>
<span id="cb105-118"><a href="#cb105-118"></a></span>
<span id="cb105-119"><a href="#cb105-119"></a><span class="fu">### Preparation of spatial variables</span></span>
<span id="cb105-120"><a href="#cb105-120"></a></span>
<span id="cb105-121"><a href="#cb105-121"></a>I test the niche difference mechanism as the primary species compositional assembly process operating along South African shores. I suggest that the thermal gradient along the coast provides a suite of abiotic (thermal) conditions from which species can select based on their physiological tolerances, and hence this will structure \textbeta-diversity. For this mechanism to function one would assume that all species have equal access to all sections along this stretch of coast, thus following Beijerinck's 'Law' that everything is everywhere but the environment selects <span class="co">[</span><span class="ot">@Sauer1988</span><span class="co">]</span> (but see main text!).</span>
<span id="cb105-122"><a href="#cb105-122"></a></span>
<span id="cb105-123"><a href="#cb105-123"></a>The basic approach to a spatial analysis structured around a biological response (*e.g.* community structure and composition; $Y$), environmental variables ($E$) and their spatial representation ($S$) involves an analysis of Moran's eigenvector maps (MEM), followed by db-RDA and variance partitioning. Various literature sources discuss principle behind Moran's eigenvector maps [@Dray2006; @Dray2012a]. Worked examples are also presented in the excellent book *Numerical Ecology with R* <span class="co">[</span><span class="ot">@Borcard2011</span><span class="co">]</span> in Section 7.4. The method followed here has been adapted from these and other sources.</span>
<span id="cb105-124"><a href="#cb105-124"></a></span>
<span id="cb105-125"><a href="#cb105-125"></a>Obtaining the MEMs to use in the analysis is based on the procedure introduced by Borcard and Legendre (2002), which was later modified by @Dray2006. The basic approach involves:</span>
<span id="cb105-126"><a href="#cb105-126"></a></span>
<span id="cb105-127"><a href="#cb105-127"></a><span class="ss">1.  </span>Set up a geographic or Euclidian distance matrix representing the pairwise distances between the $n$ sites ($D=<span class="co">[</span><span class="ot">d_{ij}</span><span class="co">]</span>$). I already did this when I applied the <span class="in">`decostand`</span> function earlier.</span>
<span id="cb105-128"><a href="#cb105-128"></a></span>
<span id="cb105-129"><a href="#cb105-129"></a><span class="ss">2.  </span>Construct a truncated distance matrix by calculating a Minimum Spanning Tree ($S^{\star}$) and noting the following rules: $$S^{\star} =\left<span class="sc">\{</span> \begin{array}{rl} 0 &amp; \mbox{if}~i = j <span class="sc">\\</span> d_{ij} &amp; \mbox{if}~d_{ij} \leq t \\ 4t &amp; \mbox{if}~d_{ij} &gt; t \end{array} \right.$$ Weighting may be applied if desired, resulting in $S^{\star}_w$. It is not done here.</span>
<span id="cb105-130"><a href="#cb105-130"></a></span>
<span id="cb105-131"><a href="#cb105-131"></a><span class="ss">3.  </span>Do a Principal Coordinates Analysis (PCoA) of the truncated distance matrix $S^{\star}$.</span>
<span id="cb105-132"><a href="#cb105-132"></a></span>
<span id="cb105-133"><a href="#cb105-133"></a>The spatial properties imprinted on the species and their environment can be specified using a matrix of Euclidian or geographic distances. These coordinates are 'truncated' into a square (section $\times$ section) matrix containing non-negative values ($S^{\star}$). By convention the diagonal values are set to zero. A very basic spatial matrix is binary, where 1 codes for pairs of neigbouring sites while 0 denotes non-connected sites according to the chosen network topology. Such matrices are called 'binary connectivity matrices' and relate to graphs made using distance criteria derived from graph theory.</span>
<span id="cb105-134"><a href="#cb105-134"></a></span>
<span id="cb105-135"><a href="#cb105-135"></a>Truncation produced by Minimum Spanning Trees (MST) focuses on the binary relationships between neighbouring sites, discarding any other connections (*i.e.* some sites are considered to be neighbours, while for others the relationships are null). One could also choose a Gabriel graph or another kind of network topology. Such matrix representations show section-to-section connectivities. In the case of South Africa's coastline data, the MST causes sections to be connected only to other sections adjacent to two sides of it: for example, Section **4** is directly connected to *only* Sections **3** and **5**; sections at the termini of the coastal 'string' of sections are each connected to only one other section. The binary connectivity matrices, also called *topology-based connectivity matrices*, can be produced from Euclidian or geographic coordinates using functions in at least two **R** packages (I start with geographic coordinates). One option is to use the **spdep** package's `mst.nb()` function to calculate a MST, but there are also options in the **vegan** package and elsewhere. The neighbours list arrived at from the MST represents the spatial component, $S^{\star}$. The MST results in small connectivity artefacts in the Saldanha Bay region where the closest sections are not necessarily the ones adjacent one-another following along the path around the coast, because sections at opposite sides of the bay may in fact be closer together. This topological inconsistency does not affect the spatial analysis in any way.</span>
<span id="cb105-136"><a href="#cb105-136"></a></span>
<span id="cb105-137"><a href="#cb105-137"></a>Once the truncated distance matrix has been prepared, it is subjected to a PCoA and I keep the eigenvectors that represent positive spatial correlation (positive Moran's $I$). For the MEM analysis I use the function <span class="in">`PCNM()`</span> that resides in the <span class="in">`functions`</span> folder in the file <span class="in">`PCNM.R`</span> (see notes inside about authorship). PCNM stands for Principal Coordinates Analysis of Neighbourhood Matrices (the neighbourhood matrix in this instance being the MST). This method automatically constructs the spatial variables and calculates the Moran's I for each. The MEMs are completely orthogonal and represent the spatial structures over the full range of scales from 50 to 2,700 km. The large eigenvectors represent broad spatial scales while smaller ones cover finer features. The *spatial data* will be used as a set of explanatory variables in the multiple regression type analyses applied to a species dissimilarity matrix [*i.e.* the db-RDA; @Dray2012a]</span>
<span id="cb105-138"><a href="#cb105-138"></a></span>
<span id="cb105-139"><a href="#cb105-139"></a>The code below reproduces the spatial analysis in the paper. Due to the length of the output I have prevented the script from returning any output here; rather, if the reader is for some odd reason interested in repeating this analysis, s/he may find the data and scripts in my <span class="co">[</span><span class="ot">GitHub</span><span class="co">](https://github.com/ajsmit/Seaweed-beta)</span> repository, and the full code can be run in its entirety. Well, I hope this will work, but if it doesn't (probably very likely) then write to me at <span class="co">[</span><span class="ot">ajsmit\@uwc.ac.za</span><span class="co">](mailto:ajsmit@uwc.ac.za)</span>{.email} and I shall assist --- this may depend on if your email has a catchy title that will make it stand out from among all the other emails which other people think are equally important.</span>
<span id="cb105-140"><a href="#cb105-140"></a></span>
<span id="cb105-141"><a href="#cb105-141"></a><span class="in">```{r pcnm}</span></span>
<span id="cb105-142"><a href="#cb105-142"></a><span class="in">## Auto PCNM:</span></span>
<span id="cb105-143"><a href="#cb105-143"></a><span class="in">S.auto &lt;- PCNM(dist(sites), silent = TRUE)</span></span>
<span id="cb105-144"><a href="#cb105-144"></a><span class="in"># summary(S.auto)</span></span>
<span id="cb105-145"><a href="#cb105-145"></a></span>
<span id="cb105-146"><a href="#cb105-146"></a><span class="in"># The truncation distance:</span></span>
<span id="cb105-147"><a href="#cb105-147"></a><span class="in">S.dmin &lt;- S.auto$thresh</span></span>
<span id="cb105-148"><a href="#cb105-148"></a></span>
<span id="cb105-149"><a href="#cb105-149"></a><span class="in"># The number of eigenvalues:</span></span>
<span id="cb105-150"><a href="#cb105-150"></a><span class="in">S.len &lt;- length(S.auto$values)</span></span>
<span id="cb105-151"><a href="#cb105-151"></a></span>
<span id="cb105-152"><a href="#cb105-152"></a><span class="in"># Expected value of I, no spatial correlation:</span></span>
<span id="cb105-153"><a href="#cb105-153"></a><span class="in">S.auto$expected_Moran</span></span>
<span id="cb105-154"><a href="#cb105-154"></a></span>
<span id="cb105-155"><a href="#cb105-155"></a><span class="in"># Select eigenfunction with positive spatial correlation:</span></span>
<span id="cb105-156"><a href="#cb105-156"></a><span class="in">S.sel &lt;- which(S.auto$Moran_I$Positive == TRUE)</span></span>
<span id="cb105-157"><a href="#cb105-157"></a><span class="in"># length(S.sel)</span></span>
<span id="cb105-158"><a href="#cb105-158"></a><span class="in"># there are 27 MEMs, i.e. 27 of the PCNM variables (eigenvalues) relate</span></span>
<span id="cb105-159"><a href="#cb105-159"></a><span class="in"># significantly to Moran's I</span></span>
<span id="cb105-160"><a href="#cb105-160"></a></span>
<span id="cb105-161"><a href="#cb105-161"></a><span class="in"># Extract the eigenvectors associated with those MEMs:</span></span>
<span id="cb105-162"><a href="#cb105-162"></a><span class="in">S.pos &lt;- as.data.frame(S.auto$vectors)[, S.sel]</span></span>
<span id="cb105-163"><a href="#cb105-163"></a><span class="in">```</span></span>
<span id="cb105-164"><a href="#cb105-164"></a></span>
<span id="cb105-165"><a href="#cb105-165"></a>The code below lets us visualise the configuration of the 58 coastal sections as represented by the minimum spanning tree. Because the sites are constrained by the coast the MST network topology results in a string of coastal sections arranged along the shore between Section **1** and Section **58**. This spatial network therefore also captures the spatial connectivity in the seaweed's dispersal ability along the shore, although no directionality is associated with dispersal. In the paper I discuss the possible influence of ocean currents <span class="co">[</span><span class="ot">*e.g.* @Wernberg2013</span><span class="co">]</span> and I pointed out that it is tempting to assume that seaweeds would disperse in the direction the major ocean currents. These kinds of networks could conceivably be configured to model dispersal due to currents, but here it is simply used for representing the spatial scale of the study region.</span>
<span id="cb105-166"><a href="#cb105-166"></a></span>
<span id="cb105-167"><a href="#cb105-167"></a><span class="in">```{r plot-mst}</span></span>
<span id="cb105-168"><a href="#cb105-168"></a><span class="in"># The spatial netwwork topology of the coastal sections can be seen by:</span></span>
<span id="cb105-169"><a href="#cb105-169"></a><span class="in">plot(S.auto$spanning, sites)</span></span>
<span id="cb105-170"><a href="#cb105-170"></a><span class="in">```</span></span>
<span id="cb105-171"><a href="#cb105-171"></a></span>
<span id="cb105-172"><a href="#cb105-172"></a><span class="fu">### db-RDA on the MEMs</span></span>
<span id="cb105-173"><a href="#cb105-173"></a></span>
<span id="cb105-174"><a href="#cb105-174"></a>The next step of the spatial analysis is to apply a db-RDA with the seaweed data ($Y1$ and $Y2$) coupled with the MEMs. I now run a full (global) db-RDA on the significant, positive MEMs selected above, and I then perform a permutation test to see if the fit is significant.</span>
<span id="cb105-175"><a href="#cb105-175"></a></span>
<span id="cb105-176"><a href="#cb105-176"></a><span class="in">```{r Y1-pcnm-capscale-global}</span></span>
<span id="cb105-177"><a href="#cb105-177"></a><span class="in"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb105-178"><a href="#cb105-178"></a><span class="in">S.Y1.cs &lt;- capscale(Y1 ~., S.pos)</span></span>
<span id="cb105-179"><a href="#cb105-179"></a></span>
<span id="cb105-180"><a href="#cb105-180"></a><span class="in"># Permutation test to test for the significance of the global fit:</span></span>
<span id="cb105-181"><a href="#cb105-181"></a><span class="in">anova(S.Y1.cs, parallel = 4) # ... yes, significant!</span></span>
<span id="cb105-182"><a href="#cb105-182"></a></span>
<span id="cb105-183"><a href="#cb105-183"></a><span class="in"># The global adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb105-184"><a href="#cb105-184"></a><span class="in">S.Y1.cs.R2 &lt;- RsquareAdj(S.Y1.cs)$adj.r.squared</span></span>
<span id="cb105-185"><a href="#cb105-185"></a></span>
<span id="cb105-186"><a href="#cb105-186"></a><span class="in"># Variance explained by full model:</span></span>
<span id="cb105-187"><a href="#cb105-187"></a><span class="in">sum(S.Y1.cs$CCA$eig) / S.Y1.cs$tot.chi * 100</span></span>
<span id="cb105-188"><a href="#cb105-188"></a><span class="in">```</span></span>
<span id="cb105-189"><a href="#cb105-189"></a></span>
<span id="cb105-190"><a href="#cb105-190"></a><span class="in">```{r Y2-pcnm-capscale-global}</span></span>
<span id="cb105-191"><a href="#cb105-191"></a><span class="in"># And on the Y2 data (uncommented, but same as above):</span></span>
<span id="cb105-192"><a href="#cb105-192"></a><span class="in">S.Y2.cs &lt;- capscale(Y2 ~., S.pos)</span></span>
<span id="cb105-193"><a href="#cb105-193"></a><span class="in">S.Y2.cs.R2 &lt;- RsquareAdj(S.Y2.cs)$adj.r.squared</span></span>
<span id="cb105-194"><a href="#cb105-194"></a><span class="in">sum(S.Y2.cs$CCA$eig) / S.Y2.cs$tot.chi * 100</span></span>
<span id="cb105-195"><a href="#cb105-195"></a><span class="in">```</span></span>
<span id="cb105-196"><a href="#cb105-196"></a></span>
<span id="cb105-197"><a href="#cb105-197"></a>**Initial analysis (pre-2017):** Since the analysis is significant, I compute the adjusted *R*^2^ and run forward selection of the MEMs. The forward selection procedure of @Blanchet2008 is implemented in the **packfor** package for R, and I use it to reduce the number of MEM variables and retain only those that best fit the biotic data. Forward selection prevents the inflation of the overall type I error and reduces the number of explanatory variables used in the final model, which improves parsimony. I then run a new db-RDA analysis on the 'best' (reduced) set of MEM variables that was selected.</span>
<span id="cb105-198"><a href="#cb105-198"></a></span>
<span id="cb105-201"><a href="#cb105-201"></a><span class="in">```{r}</span></span>
<span id="cb105-202"><a href="#cb105-202"></a><span class="co">#| eval: false</span></span>
<span id="cb105-203"><a href="#cb105-203"></a><span class="co">#| echo: false</span></span>
<span id="cb105-204"><a href="#cb105-204"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb105-205"><a href="#cb105-205"></a>S.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(Y1, <span class="fu">as.matrix</span>(S.pos), <span class="at">adjR2thresh =</span> S.Y1.cs.R2)</span>
<span id="cb105-206"><a href="#cb105-206"></a></span>
<span id="cb105-207"><a href="#cb105-207"></a><span class="co"># Forward selection on Y2:</span></span>
<span id="cb105-208"><a href="#cb105-208"></a>S.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(Y2, <span class="fu">as.matrix</span>(S.pos), <span class="at">adjR2thresh =</span> S.Y2.cs.R2)</span>
<span id="cb105-209"><a href="#cb105-209"></a><span class="in">```</span></span>
<span id="cb105-210"><a href="#cb105-210"></a></span>
<span id="cb105-213"><a href="#cb105-213"></a><span class="in">```{r}</span></span>
<span id="cb105-214"><a href="#cb105-214"></a><span class="co">#| eval: false</span></span>
<span id="cb105-215"><a href="#cb105-215"></a><span class="co">#| echo: false</span></span>
<span id="cb105-216"><a href="#cb105-216"></a></span>
<span id="cb105-217"><a href="#cb105-217"></a><span class="co"># Write the significant MEMs to a new object:</span></span>
<span id="cb105-218"><a href="#cb105-218"></a>S.Y1.no.sig <span class="ot">&lt;-</span> <span class="fu">nrow</span>(S.Y1.fwd)</span>
<span id="cb105-219"><a href="#cb105-219"></a>S.Y1.sign <span class="ot">&lt;-</span> <span class="fu">sort</span>(S.Y1.fwd[, <span class="dv">2</span>])</span>
<span id="cb105-220"><a href="#cb105-220"></a>S.Y1.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">c</span>(S.Y1.sign)]</span>
<span id="cb105-221"><a href="#cb105-221"></a><span class="fu">colnames</span>(S.Y1.red) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">"MEM"</span>, S.Y1.no.sig),</span>
<span id="cb105-222"><a href="#cb105-222"></a>                            <span class="fu">as.character</span>(S.Y1.sign), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb105-223"><a href="#cb105-223"></a></span>
<span id="cb105-224"><a href="#cb105-224"></a><span class="co"># Identity of significant MEMs:</span></span>
<span id="cb105-225"><a href="#cb105-225"></a><span class="fu">colnames</span>(S.Y1.red)</span>
<span id="cb105-226"><a href="#cb105-226"></a></span>
<span id="cb105-227"><a href="#cb105-227"></a><span class="co"># Run a new db-RDA on the best MEM variables:</span></span>
<span id="cb105-228"><a href="#cb105-228"></a>S.Y1.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span>., <span class="at">data =</span> S.Y1.red)</span>
<span id="cb105-229"><a href="#cb105-229"></a><span class="co"># no need to check these for collinearity as the </span></span>
<span id="cb105-230"><a href="#cb105-230"></a><span class="co"># MEMs are completely orthogonal..</span></span>
<span id="cb105-231"><a href="#cb105-231"></a></span>
<span id="cb105-232"><a href="#cb105-232"></a><span class="co"># Permutation test to test for significance:</span></span>
<span id="cb105-233"><a href="#cb105-233"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb105-234"><a href="#cb105-234"></a></span>
<span id="cb105-235"><a href="#cb105-235"></a><span class="co"># Test by axis:</span></span>
<span id="cb105-236"><a href="#cb105-236"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb105-237"><a href="#cb105-237"></a></span>
<span id="cb105-238"><a href="#cb105-238"></a><span class="co"># The significant axes:</span></span>
<span id="cb105-239"><a href="#cb105-239"></a>S.Y1.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb105-240"><a href="#cb105-240"></a>S.Y1.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y1.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb105-241"><a href="#cb105-241"></a>S.Y1.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y1.red[,S.Y1.ax])</span>
<span id="cb105-242"><a href="#cb105-242"></a></span>
<span id="cb105-243"><a href="#cb105-243"></a><span class="co"># Test by terms:</span></span>
<span id="cb105-244"><a href="#cb105-244"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb105-245"><a href="#cb105-245"></a></span>
<span id="cb105-246"><a href="#cb105-246"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb105-247"><a href="#cb105-247"></a><span class="co"># S.Y1.s2.R2 &lt;- RsquareAdj(S.Y1.s2)$adj.r.squared</span></span>
<span id="cb105-248"><a href="#cb105-248"></a></span>
<span id="cb105-249"><a href="#cb105-249"></a><span class="co"># Variance explained by reduced model:</span></span>
<span id="cb105-250"><a href="#cb105-250"></a><span class="fu">sum</span>(S.Y1.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y1.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb105-251"><a href="#cb105-251"></a></span>
<span id="cb105-252"><a href="#cb105-252"></a><span class="co"># Show only the first 6 rows:</span></span>
<span id="cb105-253"><a href="#cb105-253"></a><span class="fu">scores</span>(S.Y1.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span>
<span id="cb105-254"><a href="#cb105-254"></a><span class="in">```</span></span>
<span id="cb105-255"><a href="#cb105-255"></a></span>
<span id="cb105-258"><a href="#cb105-258"></a><span class="in">```{r}</span></span>
<span id="cb105-259"><a href="#cb105-259"></a><span class="co">#| eval: false</span></span>
<span id="cb105-260"><a href="#cb105-260"></a><span class="co">#| echo: false</span></span>
<span id="cb105-261"><a href="#cb105-261"></a></span>
<span id="cb105-262"><a href="#cb105-262"></a><span class="co"># As above, but now with Y2:</span></span>
<span id="cb105-263"><a href="#cb105-263"></a>S.Y2.no.sig <span class="ot">&lt;-</span> <span class="fu">nrow</span>(S.Y2.fwd)</span>
<span id="cb105-264"><a href="#cb105-264"></a>S.Y2.sign <span class="ot">&lt;-</span> <span class="fu">sort</span>(S.Y2.fwd[, <span class="dv">2</span>])</span>
<span id="cb105-265"><a href="#cb105-265"></a>S.Y2.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">c</span>(S.Y2.sign)]</span>
<span id="cb105-266"><a href="#cb105-266"></a><span class="fu">colnames</span>(S.Y2.red) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">"MEM"</span>, S.Y2.no.sig),</span>
<span id="cb105-267"><a href="#cb105-267"></a>                            <span class="fu">as.character</span>(S.Y2.sign), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb105-268"><a href="#cb105-268"></a><span class="fu">colnames</span>(S.Y2.red)</span>
<span id="cb105-269"><a href="#cb105-269"></a>S.Y2.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span>., <span class="at">data =</span> S.Y2.red)</span>
<span id="cb105-270"><a href="#cb105-270"></a></span>
<span id="cb105-271"><a href="#cb105-271"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes, significant!</span></span>
<span id="cb105-272"><a href="#cb105-272"></a></span>
<span id="cb105-273"><a href="#cb105-273"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb105-274"><a href="#cb105-274"></a></span>
<span id="cb105-275"><a href="#cb105-275"></a>S.Y2.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb105-276"><a href="#cb105-276"></a>S.Y2.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y2.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb105-277"><a href="#cb105-277"></a>S.Y2.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y2.red[,S.Y2.ax])</span>
<span id="cb105-278"><a href="#cb105-278"></a></span>
<span id="cb105-279"><a href="#cb105-279"></a>S.Y2.s2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y2.s2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb105-280"><a href="#cb105-280"></a></span>
<span id="cb105-281"><a href="#cb105-281"></a><span class="fu">sum</span>(S.Y2.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y2.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb105-282"><a href="#cb105-282"></a></span>
<span id="cb105-283"><a href="#cb105-283"></a><span class="fu">scores</span>(S.Y2.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb105-284"><a href="#cb105-284"></a><span class="in">```</span></span>
<span id="cb105-285"><a href="#cb105-285"></a></span>
<span id="cb105-286"><a href="#cb105-286"></a>**Update (2024):** The **packfor** package is no longer available so I have updated my methods to use **vegan**'s `ordiR2step()` function instead. This function is a stepwise model selection procedure that uses adjusted *R*^2^ as the criterion (as in **packfor**) for selecting the best model. I run the forward selection procedure on the full model and retain the significant ('best', reduced) MEMs in the final model. I then use only the retained MEMs in subsequent steps.</span>
<span id="cb105-287"><a href="#cb105-287"></a></span>
<span id="cb105-290"><a href="#cb105-290"></a><span class="in">```{r}</span></span>
<span id="cb105-291"><a href="#cb105-291"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb105-292"><a href="#cb105-292"></a>S.Y1.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>, S.pos) <span class="co"># a null model</span></span>
<span id="cb105-293"><a href="#cb105-293"></a>S.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., S.pos)</span>
<span id="cb105-294"><a href="#cb105-294"></a></span>
<span id="cb105-295"><a href="#cb105-295"></a>S.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(S.Y1.cs.null, S.Y1.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-296"><a href="#cb105-296"></a></span>
<span id="cb105-297"><a href="#cb105-297"></a><span class="co"># the significant MEMs to retain are</span></span>
<span id="cb105-298"><a href="#cb105-298"></a><span class="fu">as.data.frame</span>(S.Y1.fwd<span class="sc">$</span>anova)</span>
<span id="cb105-299"><a href="#cb105-299"></a>S.Y1.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(S.Y1.fwd)<span class="sc">$</span>biplot))]</span>
<span id="cb105-300"><a href="#cb105-300"></a><span class="fu">names</span>(S.Y1.red) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^V"</span>, <span class="st">"MEM"</span>, <span class="fu">names</span>(S.Y1.red)) <span class="co"># rename them</span></span>
<span id="cb105-301"><a href="#cb105-301"></a><span class="in">```</span></span>
<span id="cb105-302"><a href="#cb105-302"></a></span>
<span id="cb105-305"><a href="#cb105-305"></a><span class="in">```{r}</span></span>
<span id="cb105-306"><a href="#cb105-306"></a><span class="co"># Run the db-RDA on the Y2 data:</span></span>
<span id="cb105-307"><a href="#cb105-307"></a>S.Y2.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> <span class="dv">1</span>, S.pos) <span class="co"># a null model</span></span>
<span id="cb105-308"><a href="#cb105-308"></a>S.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., S.pos)</span>
<span id="cb105-309"><a href="#cb105-309"></a></span>
<span id="cb105-310"><a href="#cb105-310"></a>S.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(S.Y2.cs.null, S.Y2.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-311"><a href="#cb105-311"></a></span>
<span id="cb105-312"><a href="#cb105-312"></a><span class="co"># the significant MEMs to retain are</span></span>
<span id="cb105-313"><a href="#cb105-313"></a><span class="fu">as.data.frame</span>(S.Y2.fwd<span class="sc">$</span>anova)</span>
<span id="cb105-314"><a href="#cb105-314"></a>S.Y2.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(S.Y2.fwd)<span class="sc">$</span>biplot))]</span>
<span id="cb105-315"><a href="#cb105-315"></a><span class="fu">names</span>(S.Y2.red) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^V"</span>, <span class="st">"MEM"</span>, <span class="fu">names</span>(S.Y2.red)) <span class="co"># rename them</span></span>
<span id="cb105-316"><a href="#cb105-316"></a><span class="in">```</span></span>
<span id="cb105-317"><a href="#cb105-317"></a></span>
<span id="cb105-318"><a href="#cb105-318"></a>Now I run a new db-RDA analysis on the 'best' (reduced) set of MEM variables that was selected. </span>
<span id="cb105-319"><a href="#cb105-319"></a></span>
<span id="cb105-320"><a href="#cb105-320"></a><span class="in">```{r Y1-pcnm-capscale-final}</span></span>
<span id="cb105-321"><a href="#cb105-321"></a><span class="in"># Run a new db-RDA on the best MEM variables:</span></span>
<span id="cb105-322"><a href="#cb105-322"></a><span class="in">S.Y1.s2 &lt;- capscale(Y1 ~., data = S.Y1.red)</span></span>
<span id="cb105-323"><a href="#cb105-323"></a><span class="in"># no need to check these for collinearity as the </span></span>
<span id="cb105-324"><a href="#cb105-324"></a><span class="in"># MEMs are completely orthogonal..</span></span>
<span id="cb105-325"><a href="#cb105-325"></a></span>
<span id="cb105-326"><a href="#cb105-326"></a><span class="in"># Permutation test to test for significance:</span></span>
<span id="cb105-327"><a href="#cb105-327"></a><span class="in">anova(S.Y1.s2, parallel = 4)</span></span>
<span id="cb105-328"><a href="#cb105-328"></a></span>
<span id="cb105-329"><a href="#cb105-329"></a><span class="in"># Test by axis:</span></span>
<span id="cb105-330"><a href="#cb105-330"></a><span class="in">anova(S.Y1.s2, by = "axis", parallel = 4)</span></span>
<span id="cb105-331"><a href="#cb105-331"></a></span>
<span id="cb105-332"><a href="#cb105-332"></a><span class="in"># The significant axes:</span></span>
<span id="cb105-333"><a href="#cb105-333"></a><span class="in">S.Y1.axis.test &lt;- anova(S.Y1.s2, by = "terms", parallel = 4)</span></span>
<span id="cb105-334"><a href="#cb105-334"></a><span class="in">S.Y1.ax &lt;- which(S.Y1.axis.test[, 4] &lt; 0.05)</span></span>
<span id="cb105-335"><a href="#cb105-335"></a><span class="in">S.Y1.sign.ax &lt;- colnames(S.Y1.red[,S.Y1.ax])</span></span>
<span id="cb105-336"><a href="#cb105-336"></a></span>
<span id="cb105-337"><a href="#cb105-337"></a><span class="in"># Test by terms:</span></span>
<span id="cb105-338"><a href="#cb105-338"></a><span class="in">anova(S.Y1.s2, by = "terms", parallel = 4)</span></span>
<span id="cb105-339"><a href="#cb105-339"></a></span>
<span id="cb105-340"><a href="#cb105-340"></a><span class="in"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb105-341"><a href="#cb105-341"></a><span class="in"># S.Y1.s2.R2 &lt;- RsquareAdj(S.Y1.s2)$adj.r.squared</span></span>
<span id="cb105-342"><a href="#cb105-342"></a></span>
<span id="cb105-343"><a href="#cb105-343"></a><span class="in"># Variance explained by reduced model:</span></span>
<span id="cb105-344"><a href="#cb105-344"></a><span class="in">sum(S.Y1.s2$CCA$eig) / S.Y1.s2$tot.chi * 100</span></span>
<span id="cb105-345"><a href="#cb105-345"></a></span>
<span id="cb105-346"><a href="#cb105-346"></a><span class="in"># Show only the first 6 rows:</span></span>
<span id="cb105-347"><a href="#cb105-347"></a><span class="in">scores(S.Y1.s2, display = "bp", choices = c(1:4))[1:6, ]</span></span>
<span id="cb105-348"><a href="#cb105-348"></a><span class="in">```</span></span>
<span id="cb105-349"><a href="#cb105-349"></a></span>
<span id="cb105-350"><a href="#cb105-350"></a><span class="in">```{r Y2-pcnm-capscale-final}</span></span>
<span id="cb105-351"><a href="#cb105-351"></a><span class="in">S.Y2.s2 &lt;- capscale(Y2 ~., data = S.Y2.red)</span></span>
<span id="cb105-352"><a href="#cb105-352"></a></span>
<span id="cb105-353"><a href="#cb105-353"></a><span class="in">anova(S.Y2.s2, parallel = 4) # ... yes, significant!</span></span>
<span id="cb105-354"><a href="#cb105-354"></a><span class="in">anova(S.Y2.s2, by = "axis", parallel = 4)</span></span>
<span id="cb105-355"><a href="#cb105-355"></a></span>
<span id="cb105-356"><a href="#cb105-356"></a><span class="in">S.Y2.axis.test &lt;- anova(S.Y2.s2, by = "terms", parallel = 4)</span></span>
<span id="cb105-357"><a href="#cb105-357"></a><span class="in">S.Y2.ax &lt;- which(S.Y2.axis.test[, 4] &lt; 0.05)</span></span>
<span id="cb105-358"><a href="#cb105-358"></a><span class="in">S.Y2.sign.ax &lt;- colnames(S.Y2.red[,S.Y2.ax])</span></span>
<span id="cb105-359"><a href="#cb105-359"></a><span class="in">S.Y2.s2.R2 &lt;- RsquareAdj(S.Y2.s2)$adj.r.squared</span></span>
<span id="cb105-360"><a href="#cb105-360"></a><span class="in">sum(S.Y2.s2$CCA$eig) / S.Y2.s2$tot.chi * 100</span></span>
<span id="cb105-361"><a href="#cb105-361"></a><span class="in">scores(S.Y2.s2, display = "bp", choices = c(1:4))</span></span>
<span id="cb105-362"><a href="#cb105-362"></a><span class="in">```</span></span>
<span id="cb105-363"><a href="#cb105-363"></a></span>
<span id="cb105-364"><a href="#cb105-364"></a><span class="fu">### A few visualisations</span></span>
<span id="cb105-365"><a href="#cb105-365"></a></span>
<span id="cb105-366"><a href="#cb105-366"></a>Now I make a visualisation to reveal the spatial arrangement of the MEMs used in the final db-RDA involving the spatial variables (*i.e.* \texttt{S.Y1.s2} and \texttt{S.Y2.s2}). The spatial configuration relates to broad scales as seen in Fig. 3 in the paper. Here are plots of the site scores for the MEMs and $Y1$ and $Y2$ (a few panels belonging with Fig. 3):</span>
<span id="cb105-367"><a href="#cb105-367"></a></span>
<span id="cb105-368"><a href="#cb105-368"></a><span class="in">```{r Y1-Y2-sa-score-plot}</span></span>
<span id="cb105-369"><a href="#cb105-369"></a><span class="in"># Plot the first canonical axis of the db-RDA with the significant MEMs for Y1;</span></span>
<span id="cb105-370"><a href="#cb105-370"></a><span class="in"># (see Fig. 3):</span></span>
<span id="cb105-371"><a href="#cb105-371"></a><span class="in">S.Y1.axes &lt;- scores(S.Y1.s2, choices = c(1:3), display = "lc", scaling = 1)</span></span>
<span id="cb105-372"><a href="#cb105-372"></a><span class="in">S.Y1.plt.axis1 &lt;- ggmap() +</span></span>
<span id="cb105-373"><a href="#cb105-373"></a><span class="in">  geom_point(data = sites, aes(x = Longitude, y = Latitude,</span></span>
<span id="cb105-374"><a href="#cb105-374"></a><span class="in">                               size = abs(S.Y1.axes[, 1]),</span></span>
<span id="cb105-375"><a href="#cb105-375"></a><span class="in">                               col = ifelse(S.Y1.axes[, 1] &lt; 0, "a", "b")), shape = 1) +</span></span>
<span id="cb105-376"><a href="#cb105-376"></a><span class="in">  scale_size_continuous(guide = FALSE) +</span></span>
<span id="cb105-377"><a href="#cb105-377"></a><span class="in">  scale_colour_manual(guide = "none", values = c("black", "grey60")) +</span></span>
<span id="cb105-378"><a href="#cb105-378"></a><span class="in">  ggtitle(expression(paste("CAP1 of spatial variables, ", beta[sim])))</span></span>
<span id="cb105-379"><a href="#cb105-379"></a></span>
<span id="cb105-380"><a href="#cb105-380"></a><span class="in"># And the same for Y2 (see Fig. 3):</span></span>
<span id="cb105-381"><a href="#cb105-381"></a><span class="in">S.Y2.axes &lt;- scores(S.Y2.s2, choices = c(1:3), display = "lc", scaling = 1)</span></span>
<span id="cb105-382"><a href="#cb105-382"></a><span class="in">S.Y2.plt.axis1 &lt;- ggmap() +</span></span>
<span id="cb105-383"><a href="#cb105-383"></a><span class="in">  geom_point(data = sites, aes(x = Longitude, y = Latitude,</span></span>
<span id="cb105-384"><a href="#cb105-384"></a><span class="in">                               size = abs(S.Y2.axes[, 1]),</span></span>
<span id="cb105-385"><a href="#cb105-385"></a><span class="in">                               col = ifelse(S.Y2.axes[, 1] &lt; 0, "a", "b")), shape = 1) +</span></span>
<span id="cb105-386"><a href="#cb105-386"></a><span class="in">  scale_size_continuous(guide = FALSE) +</span></span>
<span id="cb105-387"><a href="#cb105-387"></a><span class="in">  scale_colour_manual(guide = "none", values = c("black", "grey60")) +</span></span>
<span id="cb105-388"><a href="#cb105-388"></a><span class="in">  ggtitle(expression(paste("CAP1 of spatial variables, ", beta[sne])))</span></span>
<span id="cb105-389"><a href="#cb105-389"></a><span class="in">```</span></span>
<span id="cb105-390"><a href="#cb105-390"></a></span>
<span id="cb105-391"><a href="#cb105-391"></a>Now that I know that spatial structures are present in the seaweed data I check how these significant spatial patterns (two significant canonical axes, CAP1 and CAP2) are related to the environmental variables using linear regression. Checks for normality are also done but none of the output is printed here.</span>
<span id="cb105-392"><a href="#cb105-392"></a></span>
<span id="cb105-393"><a href="#cb105-393"></a>Next I want to show the ordination biplots of the MEM variables with respect to the sites using scaling = 2 (species) and showing the LC scores. Now I can see the major directions of influence of the spatial variables with respect to the sites. The code below produces a few panels of Fig. 2 (the figure is reproduced at the end of this document):</span>
<span id="cb105-394"><a href="#cb105-394"></a></span>
<span id="cb105-395"><a href="#cb105-395"></a><span class="in">```{r Y1-Y2-spatial-ordiplot}</span></span>
<span id="cb105-396"><a href="#cb105-396"></a><span class="in"># A few of the panels that go with Fig. 2;</span></span>
<span id="cb105-397"><a href="#cb105-397"></a><span class="in"># first for Y1...:</span></span>
<span id="cb105-398"><a href="#cb105-398"></a><span class="in">S.Y1.scrs &lt;- scores(S.Y1.s2, display = c("sp","wa","lc","bp","cn"))</span></span>
<span id="cb105-399"><a href="#cb105-399"></a><span class="in">S.Y1.df_sites &lt;- data.frame(S.Y1.scrs$constraints)</span></span>
<span id="cb105-400"><a href="#cb105-400"></a><span class="in">S.Y1.df_sites$bioreg &lt;- bioreg$bolton</span></span>
<span id="cb105-401"><a href="#cb105-401"></a><span class="in">S.Y1.df_sites$section &lt;- seq(1:58)</span></span>
<span id="cb105-402"><a href="#cb105-402"></a><span class="in">colnames(S.Y1.df_sites) &lt;- c("x", "y", "Bioregion", "Section")</span></span>
<span id="cb105-403"><a href="#cb105-403"></a></span>
<span id="cb105-404"><a href="#cb105-404"></a><span class="in">multiplier &lt;- ordiArrowMul(S.Y1.scrs$biplot)</span></span>
<span id="cb105-405"><a href="#cb105-405"></a><span class="in">S.Y1.bp &lt;- S.Y1.scrs$biplot * multiplier</span></span>
<span id="cb105-406"><a href="#cb105-406"></a><span class="in">S.Y1.bp &lt;- as.data.frame(S.Y1.bp)</span></span>
<span id="cb105-407"><a href="#cb105-407"></a><span class="in">S.Y1.bp$labels &lt;- rownames(S.Y1.bp)</span></span>
<span id="cb105-408"><a href="#cb105-408"></a><span class="in">colnames(S.Y1.bp) &lt;- c("x", "y", "labels")</span></span>
<span id="cb105-409"><a href="#cb105-409"></a><span class="in">S.Y1.bp.sign &lt;- S.Y1.bp[S.Y1.bp$labels %in% S.Y1.sign.ax,]</span></span>
<span id="cb105-410"><a href="#cb105-410"></a></span>
<span id="cb105-411"><a href="#cb105-411"></a><span class="in"># A modification of the vegan ordiArrowTextXY() function to prevent the </span></span>
<span id="cb105-412"><a href="#cb105-412"></a><span class="in"># "plot.new has not been called yet" from occuring</span></span>
<span id="cb105-413"><a href="#cb105-413"></a><span class="in">source("functions/text_mult.R")</span></span>
<span id="cb105-414"><a href="#cb105-414"></a></span>
<span id="cb105-415"><a href="#cb105-415"></a><span class="in">S.Y1.text &lt;- text.mult(S.Y1.scrs$biplot)</span></span>
<span id="cb105-416"><a href="#cb105-416"></a><span class="in">S.Y1.text &lt;- as.data.frame(S.Y1.text)</span></span>
<span id="cb105-417"><a href="#cb105-417"></a><span class="in">S.Y1.text$labels &lt;- rownames(S.Y1.text)</span></span>
<span id="cb105-418"><a href="#cb105-418"></a><span class="in">colnames(S.Y1.text) &lt;- c("x", "y", "labels")</span></span>
<span id="cb105-419"><a href="#cb105-419"></a><span class="in">S.Y1.text.sign &lt;- S.Y1.text[S.Y1.text$labels %in% S.Y1.sign.ax,]</span></span>
<span id="cb105-420"><a href="#cb105-420"></a></span>
<span id="cb105-421"><a href="#cb105-421"></a><span class="in">S.Y1.p &lt;- ggplot(data = S.Y1.df_sites, aes(x, y, colour = Bioregion)) + </span></span>
<span id="cb105-422"><a href="#cb105-422"></a><span class="in">  geom_point(size = 4.0) + </span></span>
<span id="cb105-423"><a href="#cb105-423"></a><span class="in">  geom_text(aes(label = Section), size = 3.0, col = "white") + </span></span>
<span id="cb105-424"><a href="#cb105-424"></a><span class="in">  geom_segment(data = S.Y1.bp, </span></span>
<span id="cb105-425"><a href="#cb105-425"></a><span class="in">               aes(x = 0, y = 0, xend = x, yend = y),</span></span>
<span id="cb105-426"><a href="#cb105-426"></a><span class="in">               arrow = arrow(length = unit(0.2, "cm")), </span></span>
<span id="cb105-427"><a href="#cb105-427"></a><span class="in">               color = "red", alpha = 1, size = 0.7) +</span></span>
<span id="cb105-428"><a href="#cb105-428"></a><span class="in">  geom_text(data = as.data.frame(S.Y1.text), </span></span>
<span id="cb105-429"><a href="#cb105-429"></a><span class="in">            aes(x, y, label = rownames(S.Y1.text)),</span></span>
<span id="cb105-430"><a href="#cb105-430"></a><span class="in">            color = "black") +</span></span>
<span id="cb105-431"><a href="#cb105-431"></a><span class="in">  xlab("CAP1") + ylab("CAP2") + </span></span>
<span id="cb105-432"><a href="#cb105-432"></a><span class="in">  ggtitle(expression(paste("Spatial variables and ", beta[sim]))) +</span></span>
<span id="cb105-433"><a href="#cb105-433"></a><span class="in">  theme_grey() +</span></span>
<span id="cb105-434"><a href="#cb105-434"></a><span class="in">  theme(panel.grid.minor = element_blank(),</span></span>
<span id="cb105-435"><a href="#cb105-435"></a><span class="in">        legend.position = "none",</span></span>
<span id="cb105-436"><a href="#cb105-436"></a><span class="in">        aspect.ratio = 0.8)</span></span>
<span id="cb105-437"><a href="#cb105-437"></a></span>
<span id="cb105-438"><a href="#cb105-438"></a><span class="in"># ...then for Y2:</span></span>
<span id="cb105-439"><a href="#cb105-439"></a><span class="in">S.Y2.scrs &lt;- scores(S.Y2.s2, display = c("sp","wa","lc","bp","cn"))</span></span>
<span id="cb105-440"><a href="#cb105-440"></a><span class="in">S.Y2.df_sites &lt;- data.frame(S.Y2.scrs$constraints)</span></span>
<span id="cb105-441"><a href="#cb105-441"></a><span class="in">S.Y2.df_sites$bioreg &lt;- bioreg$bolton</span></span>
<span id="cb105-442"><a href="#cb105-442"></a><span class="in">S.Y2.df_sites$section &lt;- seq(1:58)</span></span>
<span id="cb105-443"><a href="#cb105-443"></a><span class="in">colnames(S.Y2.df_sites) &lt;- c("x", "y", "Bioregion", "Section")</span></span>
<span id="cb105-444"><a href="#cb105-444"></a></span>
<span id="cb105-445"><a href="#cb105-445"></a><span class="in">multiplier &lt;- ordiArrowMul(S.Y2.scrs$biplot, fill = 0.25)</span></span>
<span id="cb105-446"><a href="#cb105-446"></a><span class="in">S.Y2.bp &lt;- S.Y2.scrs$biplot * multiplier</span></span>
<span id="cb105-447"><a href="#cb105-447"></a><span class="in">S.Y2.bp &lt;- as.data.frame(S.Y2.bp)</span></span>
<span id="cb105-448"><a href="#cb105-448"></a><span class="in">S.Y2.bp$labels &lt;- rownames(S.Y2.bp)</span></span>
<span id="cb105-449"><a href="#cb105-449"></a><span class="in">colnames(S.Y2.bp) &lt;- c("x", "y", "labels")</span></span>
<span id="cb105-450"><a href="#cb105-450"></a><span class="in">S.Y2.bp.sign &lt;- S.Y2.bp[S.Y2.bp$labels %in% S.Y2.sign.ax,]</span></span>
<span id="cb105-451"><a href="#cb105-451"></a></span>
<span id="cb105-452"><a href="#cb105-452"></a><span class="in">S.Y2.text &lt;- text.mult(S.Y2.scrs$biplot, fill = 0.25)</span></span>
<span id="cb105-453"><a href="#cb105-453"></a><span class="in">S.Y2.text &lt;- as.data.frame(S.Y2.text)</span></span>
<span id="cb105-454"><a href="#cb105-454"></a><span class="in">S.Y2.text$labels &lt;- rownames(S.Y2.text)</span></span>
<span id="cb105-455"><a href="#cb105-455"></a><span class="in">colnames(S.Y2.text) &lt;- c("x", "y", "labels")</span></span>
<span id="cb105-456"><a href="#cb105-456"></a><span class="in">S.Y2.text.sign &lt;- S.Y2.text[S.Y2.text$labels %in% S.Y2.sign.ax,]</span></span>
<span id="cb105-457"><a href="#cb105-457"></a></span>
<span id="cb105-458"><a href="#cb105-458"></a><span class="in">S.Y2.p &lt;- ggplot(data = S.Y2.df_sites, aes(x, y, colour = Bioregion)) + </span></span>
<span id="cb105-459"><a href="#cb105-459"></a><span class="in">  geom_point(size = 4.0) + </span></span>
<span id="cb105-460"><a href="#cb105-460"></a><span class="in">  geom_text(aes(label = Section), size = 3.0, col = "white") + </span></span>
<span id="cb105-461"><a href="#cb105-461"></a><span class="in">  geom_segment(data = S.Y2.bp.sign, </span></span>
<span id="cb105-462"><a href="#cb105-462"></a><span class="in">               aes(x = 0, y = 0, xend = x, yend = y),</span></span>
<span id="cb105-463"><a href="#cb105-463"></a><span class="in">               arrow = arrow(length = unit(0.2, "cm")), </span></span>
<span id="cb105-464"><a href="#cb105-464"></a><span class="in">               color = "red", alpha = 1, size = 0.7) +</span></span>
<span id="cb105-465"><a href="#cb105-465"></a><span class="in">  geom_text(data = as.data.frame(S.Y2.text.sign), </span></span>
<span id="cb105-466"><a href="#cb105-466"></a><span class="in">            aes(x, y, label = rownames(S.Y2.text.sign)),</span></span>
<span id="cb105-467"><a href="#cb105-467"></a><span class="in">            color = "black") +</span></span>
<span id="cb105-468"><a href="#cb105-468"></a><span class="in">  xlab("CAP1") + ylab("CAP2") + </span></span>
<span id="cb105-469"><a href="#cb105-469"></a><span class="in">  ggtitle(expression(paste("Spatial variables and ", beta[sne]))) +</span></span>
<span id="cb105-470"><a href="#cb105-470"></a><span class="in">  theme_grey() +</span></span>
<span id="cb105-471"><a href="#cb105-471"></a><span class="in">  theme(panel.grid.minor = element_blank(),</span></span>
<span id="cb105-472"><a href="#cb105-472"></a><span class="in">        legend.position = "none",</span></span>
<span id="cb105-473"><a href="#cb105-473"></a><span class="in">        aspect.ratio = 0.8)</span></span>
<span id="cb105-474"><a href="#cb105-474"></a><span class="in">```</span></span>
<span id="cb105-475"><a href="#cb105-475"></a></span>
<span id="cb105-476"><a href="#cb105-476"></a><span class="fu">### Analysis of the thermal variables</span></span>
<span id="cb105-477"><a href="#cb105-477"></a></span>
<span id="cb105-478"><a href="#cb105-478"></a>As before with the spatial variable, I now do a db-RDA involving all the thermal variables ($E$) followed by forward selection. There is less explanation provided here as the reader should now be familiar with db-RDA --- the procedure is the same as with the MEMs, just different explanatory variables are supplied. Another difference is that the thermal variables are not necessarily orthogonal, so I check for collinearity using variance inflation factors (VIF).</span>
<span id="cb105-479"><a href="#cb105-479"></a></span>
<span id="cb105-480"><a href="#cb105-480"></a>I start with the full model and then run forward selection and repeat the db-RDA on the reduced set. Analyses shown for $Y1$ and $Y2$:</span>
<span id="cb105-481"><a href="#cb105-481"></a></span>
<span id="cb105-482"><a href="#cb105-482"></a><span class="in">```{r Y1-env-capscale-global}</span></span>
<span id="cb105-483"><a href="#cb105-483"></a><span class="in"># First Y1:</span></span>
<span id="cb105-484"><a href="#cb105-484"></a><span class="in">E.Y1.cs &lt;- capscale(Y1 ~., E1)</span></span>
<span id="cb105-485"><a href="#cb105-485"></a></span>
<span id="cb105-486"><a href="#cb105-486"></a><span class="in"># Is the fit significant?</span></span>
<span id="cb105-487"><a href="#cb105-487"></a><span class="in">anova(E.Y1.cs, parallel = 4) # ... yes!</span></span>
<span id="cb105-488"><a href="#cb105-488"></a></span>
<span id="cb105-489"><a href="#cb105-489"></a><span class="in"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb105-490"><a href="#cb105-490"></a><span class="in">E.Y1.R2a &lt;- RsquareAdj(E.Y1.cs)$adj.r.squared</span></span>
<span id="cb105-491"><a href="#cb105-491"></a></span>
<span id="cb105-492"><a href="#cb105-492"></a><span class="in"># Variance explained by full model:</span></span>
<span id="cb105-493"><a href="#cb105-493"></a><span class="in">sum(E.Y1.cs$CCA$eig) / E.Y1.cs$tot.chi * 100</span></span>
<span id="cb105-494"><a href="#cb105-494"></a><span class="in">```</span></span>
<span id="cb105-495"><a href="#cb105-495"></a></span>
<span id="cb105-496"><a href="#cb105-496"></a><span class="in">```{r Y2-env-capscale-global}</span></span>
<span id="cb105-497"><a href="#cb105-497"></a><span class="in"># ...and now Y2:</span></span>
<span id="cb105-498"><a href="#cb105-498"></a><span class="in">E.Y2.cs &lt;- capscale(Y2 ~., E1)</span></span>
<span id="cb105-499"><a href="#cb105-499"></a><span class="in">anova(E.Y2.cs, parallel = 4) # ... yes!</span></span>
<span id="cb105-500"><a href="#cb105-500"></a><span class="in">E.Y2.R2a &lt;- RsquareAdj(E.Y2.cs)$adj.r.squared</span></span>
<span id="cb105-501"><a href="#cb105-501"></a><span class="in">sum(E.Y2.cs$CCA$eig) / E.Y2.cs$tot.chi * 100</span></span>
<span id="cb105-502"><a href="#cb105-502"></a><span class="in">```</span></span>
<span id="cb105-503"><a href="#cb105-503"></a></span>
<span id="cb105-506"><a href="#cb105-506"></a><span class="in">```{r}</span></span>
<span id="cb105-507"><a href="#cb105-507"></a><span class="co">#| echo: false</span></span>
<span id="cb105-508"><a href="#cb105-508"></a><span class="co">#| eval: false</span></span>
<span id="cb105-509"><a href="#cb105-509"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb105-510"><a href="#cb105-510"></a>E.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(Y1, E1, <span class="at">adjR2thresh =</span> E.Y1.R2a, <span class="at">nperm =</span> <span class="dv">999</span>)</span>
<span id="cb105-511"><a href="#cb105-511"></a></span>
<span id="cb105-512"><a href="#cb105-512"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb105-513"><a href="#cb105-513"></a>E.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(Y2, E1, <span class="at">adjR2thresh =</span> E.Y2.R2a, <span class="at">nperm =</span> <span class="dv">999</span>)</span>
<span id="cb105-514"><a href="#cb105-514"></a><span class="in">```</span></span>
<span id="cb105-515"><a href="#cb105-515"></a></span>
<span id="cb105-516"><a href="#cb105-516"></a><span class="in">```{r Y1-Y2-env-forward-select-final}</span></span>
<span id="cb105-517"><a href="#cb105-517"></a><span class="in"># Forward selection on Y1:</span></span>
<span id="cb105-518"><a href="#cb105-518"></a><span class="in"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb105-519"><a href="#cb105-519"></a><span class="in">E.Y1.cs.null &lt;- capscale(Y1 ~ 1, E1) # a null model</span></span>
<span id="cb105-520"><a href="#cb105-520"></a></span>
<span id="cb105-521"><a href="#cb105-521"></a><span class="in"># Forward selection on Y1:</span></span>
<span id="cb105-522"><a href="#cb105-522"></a><span class="in">E.Y1.fwd &lt;- ordiR2step(E.Y1.cs.null, E.Y1.cs, trace = FALSE)</span></span>
<span id="cb105-523"><a href="#cb105-523"></a><span class="in">E.Y1.fwd$anova</span></span>
<span id="cb105-524"><a href="#cb105-524"></a><span class="in">```</span></span>
<span id="cb105-525"><a href="#cb105-525"></a></span>
<span id="cb105-528"><a href="#cb105-528"></a><span class="in">```{r}</span></span>
<span id="cb105-529"><a href="#cb105-529"></a><span class="co"># Now Y2:</span></span>
<span id="cb105-530"><a href="#cb105-530"></a>E.Y2.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> <span class="dv">1</span>, E1) <span class="co"># a null model</span></span>
<span id="cb105-531"><a href="#cb105-531"></a>E.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(E.Y2.cs.null, E.Y2.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-532"><a href="#cb105-532"></a>E.Y2.fwd<span class="sc">$</span>anova</span>
<span id="cb105-533"><a href="#cb105-533"></a><span class="in">```</span></span>
<span id="cb105-534"><a href="#cb105-534"></a></span>
<span id="cb105-535"><a href="#cb105-535"></a><span class="in">```{r Y1-env-capscale-final}</span></span>
<span id="cb105-536"><a href="#cb105-536"></a><span class="in"># Write the significant envs to a new object, and</span></span>
<span id="cb105-537"><a href="#cb105-537"></a><span class="in"># identity of significant envs in increasing order;</span></span>
<span id="cb105-538"><a href="#cb105-538"></a><span class="in"># first Y1:</span></span>
<span id="cb105-539"><a href="#cb105-539"></a><span class="in">E.Y1.sign &lt;- row.names(as.data.frame(scores(E.Y1.fwd)$biplot))</span></span>
<span id="cb105-540"><a href="#cb105-540"></a></span>
<span id="cb105-541"><a href="#cb105-541"></a><span class="in">E.Y1.red &lt;- E1[, E.Y1.sign]</span></span>
<span id="cb105-542"><a href="#cb105-542"></a></span>
<span id="cb105-543"><a href="#cb105-543"></a><span class="in"># Run a new env analysis on the best env variables:</span></span>
<span id="cb105-544"><a href="#cb105-544"></a><span class="in">E.Y1.cs2 &lt;- capscale(Y1 ~., E.Y1.red)</span></span>
<span id="cb105-545"><a href="#cb105-545"></a></span>
<span id="cb105-546"><a href="#cb105-546"></a><span class="in"># Check for collinearity:</span></span>
<span id="cb105-547"><a href="#cb105-547"></a><span class="in">vif.cca(E.Y1.cs2) # seems fine</span></span>
<span id="cb105-548"><a href="#cb105-548"></a></span>
<span id="cb105-549"><a href="#cb105-549"></a><span class="in"># Test for significance:</span></span>
<span id="cb105-550"><a href="#cb105-550"></a><span class="in">anova(E.Y1.cs2, parallel = 4) # ... yes!</span></span>
<span id="cb105-551"><a href="#cb105-551"></a></span>
<span id="cb105-552"><a href="#cb105-552"></a><span class="in"># Which axes are significant?</span></span>
<span id="cb105-553"><a href="#cb105-553"></a><span class="in">anova(E.Y1.cs2, by = "axis", parallel = 4) # ... yes!</span></span>
<span id="cb105-554"><a href="#cb105-554"></a></span>
<span id="cb105-555"><a href="#cb105-555"></a><span class="in"># The significant axes:</span></span>
<span id="cb105-556"><a href="#cb105-556"></a><span class="in">E.Y1.axis.test &lt;- anova(E.Y1.cs2, by = "terms", parallel = 4)</span></span>
<span id="cb105-557"><a href="#cb105-557"></a><span class="in">E.Y1.ax &lt;- which(E.Y1.axis.test[, 4] &lt; 0.05)</span></span>
<span id="cb105-558"><a href="#cb105-558"></a><span class="in">E.Y1.sign.ax &lt;- colnames(E.Y1.red[,E.Y1.ax])</span></span>
<span id="cb105-559"><a href="#cb105-559"></a></span>
<span id="cb105-560"><a href="#cb105-560"></a><span class="in"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb105-561"><a href="#cb105-561"></a><span class="in">E.Y1.cs2.R2 &lt;- RsquareAdj(E.Y1.cs2)$adj.r.squared</span></span>
<span id="cb105-562"><a href="#cb105-562"></a></span>
<span id="cb105-563"><a href="#cb105-563"></a><span class="in"># Variance explained by reduced (final) model:</span></span>
<span id="cb105-564"><a href="#cb105-564"></a><span class="in">sum(E.Y1.cs2$CCA$eig) / E.Y1.cs2$tot.chi * 100</span></span>
<span id="cb105-565"><a href="#cb105-565"></a></span>
<span id="cb105-566"><a href="#cb105-566"></a><span class="in"># The biplot scores for constraining variables:</span></span>
<span id="cb105-567"><a href="#cb105-567"></a><span class="in">scores(E.Y1.cs2, display = "bp", choices = c(1:2))</span></span>
<span id="cb105-568"><a href="#cb105-568"></a><span class="in">```</span></span>
<span id="cb105-569"><a href="#cb105-569"></a></span>
<span id="cb105-570"><a href="#cb105-570"></a><span class="in">```{r Y2-env-capscale-final}</span></span>
<span id="cb105-571"><a href="#cb105-571"></a><span class="in"># ...then Y2</span></span>
<span id="cb105-572"><a href="#cb105-572"></a><span class="in">E.Y2.sign &lt;- row.names(as.data.frame(scores(E.Y2.fwd)$biplot))</span></span>
<span id="cb105-573"><a href="#cb105-573"></a><span class="in">E.Y2.red &lt;- E1[, E.Y2.sign]</span></span>
<span id="cb105-574"><a href="#cb105-574"></a></span>
<span id="cb105-575"><a href="#cb105-575"></a><span class="in">E.Y2.cs2 &lt;- capscale(Y2 ~., E.Y2.red)</span></span>
<span id="cb105-576"><a href="#cb105-576"></a></span>
<span id="cb105-577"><a href="#cb105-577"></a><span class="in">vif.cca(E.Y2.cs2) # seems fine</span></span>
<span id="cb105-578"><a href="#cb105-578"></a></span>
<span id="cb105-579"><a href="#cb105-579"></a><span class="in">anova(E.Y2.cs2, parallel = 4) # ... yes!</span></span>
<span id="cb105-580"><a href="#cb105-580"></a></span>
<span id="cb105-581"><a href="#cb105-581"></a><span class="in">E.Y2.axis.test &lt;- anova(E.Y2.cs2, by = "terms", parallel = 4)</span></span>
<span id="cb105-582"><a href="#cb105-582"></a><span class="in"># E.Y2.ax &lt;- which(E.Y2.axis.test[, 4] &lt; 0.05) # doesn't work...</span></span>
<span id="cb105-583"><a href="#cb105-583"></a><span class="in"># E.Y2.sign.ax &lt;- colnames(E.Y2.red[,E.Y2.ax])</span></span>
<span id="cb105-584"><a href="#cb105-584"></a><span class="in">E.Y2.sign.ax &lt;- "annMean" # a manual cheat</span></span>
<span id="cb105-585"><a href="#cb105-585"></a></span>
<span id="cb105-586"><a href="#cb105-586"></a><span class="in">anova(E.Y2.cs2, by = "terms", parallel = 4) # ... yes!</span></span>
<span id="cb105-587"><a href="#cb105-587"></a></span>
<span id="cb105-588"><a href="#cb105-588"></a><span class="in">E.Y2.cs2.R2 &lt;- RsquareAdj(E.Y2.cs2)$adj.r.squared</span></span>
<span id="cb105-589"><a href="#cb105-589"></a></span>
<span id="cb105-590"><a href="#cb105-590"></a><span class="in">sum(E.Y2.cs2$CCA$eig) / E.Y2.cs2$tot.chi * 100</span></span>
<span id="cb105-591"><a href="#cb105-591"></a></span>
<span id="cb105-592"><a href="#cb105-592"></a><span class="in">scores(E.Y2.cs2, display = "bp", choices = c(1:2))</span></span>
<span id="cb105-593"><a href="#cb105-593"></a><span class="in">```</span></span>
<span id="cb105-594"><a href="#cb105-594"></a></span>
<span id="cb105-595"><a href="#cb105-595"></a>Now I make the remaining panels of Fig. 3, these showing the spatial arrangement associated with the site scores of the environmental variables for $Y1$ and $Y2$:</span>
<span id="cb105-596"><a href="#cb105-596"></a></span>
<span id="cb105-597"><a href="#cb105-597"></a><span class="in">```{r Y1-Y2-sa-env-score-plot}</span></span>
<span id="cb105-598"><a href="#cb105-598"></a><span class="in"># Plot the two significant canonical axes of the </span></span>
<span id="cb105-599"><a href="#cb105-599"></a><span class="in"># db-RDA with the significant MEMs. This part of Fig. 3:</span></span>
<span id="cb105-600"><a href="#cb105-600"></a><span class="in">E.Y1.axes &lt;- scores(E.Y1.cs2, choices = c(1:2),</span></span>
<span id="cb105-601"><a href="#cb105-601"></a><span class="in">                   display = "lc", scaling = 1)</span></span>
<span id="cb105-602"><a href="#cb105-602"></a><span class="in">E.Y1.plt.axis1 &lt;- ggmap() +</span></span>
<span id="cb105-603"><a href="#cb105-603"></a><span class="in">  geom_point(data = sites, aes(x = Longitude, y = Latitude, size = E.Y1.axes[, 1]),</span></span>
<span id="cb105-604"><a href="#cb105-604"></a><span class="in">             col = "black", shape = 1) +</span></span>
<span id="cb105-605"><a href="#cb105-605"></a><span class="in">  scale_size_continuous(guide = FALSE) +</span></span>
<span id="cb105-606"><a href="#cb105-606"></a><span class="in">  ggtitle(expression(paste("CAP1 of thermal variables, ", beta[sim])))</span></span>
<span id="cb105-607"><a href="#cb105-607"></a></span>
<span id="cb105-608"><a href="#cb105-608"></a><span class="in">E.Y1.plt.axis2 &lt;- ggmap() +</span></span>
<span id="cb105-609"><a href="#cb105-609"></a><span class="in">  geom_point(data = sites, aes(x = Longitude, y = Latitude, size = E.Y1.axes[, 2]),</span></span>
<span id="cb105-610"><a href="#cb105-610"></a><span class="in">             col = "black", shape = 1) +</span></span>
<span id="cb105-611"><a href="#cb105-611"></a><span class="in">  scale_size_continuous(guide = FALSE) +</span></span>
<span id="cb105-612"><a href="#cb105-612"></a><span class="in">  ggtitle(expression(paste("CAP2 of thermal variables, ", beta[sim])))</span></span>
<span id="cb105-613"><a href="#cb105-613"></a></span>
<span id="cb105-614"><a href="#cb105-614"></a><span class="in">E.Y2.axes &lt;- scores(E.Y2.cs2, choices = c(1:3),</span></span>
<span id="cb105-615"><a href="#cb105-615"></a><span class="in">                    display = "lc", scaling = 1)</span></span>
<span id="cb105-616"><a href="#cb105-616"></a></span>
<span id="cb105-617"><a href="#cb105-617"></a><span class="in">E.Y2.plt.axis1 &lt;- ggmap() +</span></span>
<span id="cb105-618"><a href="#cb105-618"></a><span class="in">  geom_point(data = sites, aes(x = Longitude, y = Latitude, size = E.Y2.axes[, 1]),</span></span>
<span id="cb105-619"><a href="#cb105-619"></a><span class="in">             col = "black", shape = 1) +</span></span>
<span id="cb105-620"><a href="#cb105-620"></a><span class="in">  scale_size_continuous(guide = FALSE) +</span></span>
<span id="cb105-621"><a href="#cb105-621"></a><span class="in">  ggtitle(expression(paste("CAP1 of thermal variables, ", beta[sne])))</span></span>
<span id="cb105-622"><a href="#cb105-622"></a><span class="in">```</span></span>
<span id="cb105-623"><a href="#cb105-623"></a></span>
<span id="cb105-624"><a href="#cb105-624"></a>And now I make the remaining panels of Fig. 2 (below) for Y1 and Y2 and the environmental constraining vectors:</span>
<span id="cb105-625"><a href="#cb105-625"></a></span>
<span id="cb105-626"><a href="#cb105-626"></a><span class="in">```{r Y1-env-ordiplot}</span></span>
<span id="cb105-627"><a href="#cb105-627"></a><span class="in"># The ordiplots in Fig. 2:</span></span>
<span id="cb105-628"><a href="#cb105-628"></a><span class="in">E.Y1.scrs &lt;- scores(E.Y1.cs2, display = c("sp","wa","lc","bp","cn"))</span></span>
<span id="cb105-629"><a href="#cb105-629"></a><span class="in">E.Y1.df_sites &lt;- data.frame(E.Y1.scrs$constraints)</span></span>
<span id="cb105-630"><a href="#cb105-630"></a><span class="in">E.Y1.df_sites$bioreg &lt;- bioreg$bolton</span></span>
<span id="cb105-631"><a href="#cb105-631"></a><span class="in">E.Y1.df_sites$section &lt;- seq(1:58)</span></span>
<span id="cb105-632"><a href="#cb105-632"></a><span class="in">colnames(E.Y1.df_sites) &lt;- c("x", "y", "Bioregion", "Section")</span></span>
<span id="cb105-633"><a href="#cb105-633"></a></span>
<span id="cb105-634"><a href="#cb105-634"></a><span class="in">multiplier &lt;- ordiArrowMul(E.Y1.scrs$biplot)</span></span>
<span id="cb105-635"><a href="#cb105-635"></a><span class="in">E.Y1.bp &lt;- E.Y1.scrs$biplot * multiplier</span></span>
<span id="cb105-636"><a href="#cb105-636"></a><span class="in">E.Y1.bp &lt;- as.data.frame(E.Y1.bp)</span></span>
<span id="cb105-637"><a href="#cb105-637"></a><span class="in">E.Y1.bp$labels &lt;- rownames(E.Y1.bp)</span></span>
<span id="cb105-638"><a href="#cb105-638"></a><span class="in">colnames(E.Y1.bp) &lt;- c("x", "y", "labels")</span></span>
<span id="cb105-639"><a href="#cb105-639"></a><span class="in">E.Y1.bp.sign &lt;- E.Y1.bp[E.Y1.bp$labels %in% E.Y1.sign.ax,]</span></span>
<span id="cb105-640"><a href="#cb105-640"></a></span>
<span id="cb105-641"><a href="#cb105-641"></a><span class="in">E.Y1.text &lt;- text.mult(E.Y1.scrs$biplot)</span></span>
<span id="cb105-642"><a href="#cb105-642"></a><span class="in">E.Y1.text &lt;- as.data.frame(E.Y1.text)</span></span>
<span id="cb105-643"><a href="#cb105-643"></a><span class="in">E.Y1.text$labels &lt;- rownames(E.Y1.text)</span></span>
<span id="cb105-644"><a href="#cb105-644"></a><span class="in">colnames(E.Y1.text) &lt;- c("x", "y", "labels")</span></span>
<span id="cb105-645"><a href="#cb105-645"></a><span class="in">E.Y1.text.sign &lt;- E.Y1.text[E.Y1.text$labels %in% E.Y1.sign.ax,]</span></span>
<span id="cb105-646"><a href="#cb105-646"></a></span>
<span id="cb105-647"><a href="#cb105-647"></a><span class="in">E.Y1.p &lt;- ggplot(data = E.Y1.df_sites, aes(x, y, colour = Bioregion)) + </span></span>
<span id="cb105-648"><a href="#cb105-648"></a><span class="in">  geom_point(size = 4.0) + </span></span>
<span id="cb105-649"><a href="#cb105-649"></a><span class="in">  geom_text(aes(label = Section), size = 3.0, col = "white") + </span></span>
<span id="cb105-650"><a href="#cb105-650"></a><span class="in">  geom_segment(data = E.Y1.bp.sign, </span></span>
<span id="cb105-651"><a href="#cb105-651"></a><span class="in">               aes(x = 0, y = 0, xend = x, yend = y),</span></span>
<span id="cb105-652"><a href="#cb105-652"></a><span class="in">               arrow = arrow(length = unit(0.2, "cm")), </span></span>
<span id="cb105-653"><a href="#cb105-653"></a><span class="in">               color = "red", alpha = 1, size = 0.7) +</span></span>
<span id="cb105-654"><a href="#cb105-654"></a><span class="in">  geom_text(data = as.data.frame(E.Y1.text.sign), </span></span>
<span id="cb105-655"><a href="#cb105-655"></a><span class="in">            aes(x, y, label = rownames(E.Y1.text.sign)),</span></span>
<span id="cb105-656"><a href="#cb105-656"></a><span class="in">            color = "black") +</span></span>
<span id="cb105-657"><a href="#cb105-657"></a><span class="in">  xlab("CAP1") + ylab("CAP2") + </span></span>
<span id="cb105-658"><a href="#cb105-658"></a><span class="in">  ggtitle(expression(paste("Thermal variables and ", beta[sim]))) +</span></span>
<span id="cb105-659"><a href="#cb105-659"></a><span class="in">  theme_grey() +</span></span>
<span id="cb105-660"><a href="#cb105-660"></a><span class="in">  theme(panel.grid.minor = element_blank(),</span></span>
<span id="cb105-661"><a href="#cb105-661"></a><span class="in">        legend.position = "none",</span></span>
<span id="cb105-662"><a href="#cb105-662"></a><span class="in">        aspect.ratio = 0.8)</span></span>
<span id="cb105-663"><a href="#cb105-663"></a></span>
<span id="cb105-664"><a href="#cb105-664"></a><span class="in">E.Y2.scrs &lt;- scores(E.Y2.cs2, display = c("sp","wa","lc","bp","cn"))</span></span>
<span id="cb105-665"><a href="#cb105-665"></a><span class="in">E.Y2.df_sites &lt;- data.frame(E.Y2.scrs$constraints)</span></span>
<span id="cb105-666"><a href="#cb105-666"></a><span class="in">E.Y2.df_sites$bioreg &lt;- bioreg$bolton</span></span>
<span id="cb105-667"><a href="#cb105-667"></a><span class="in">E.Y2.df_sites$section &lt;- seq(1:58)</span></span>
<span id="cb105-668"><a href="#cb105-668"></a><span class="in">colnames(E.Y2.df_sites) &lt;- c("x", "y", "Bioregion", "Section")</span></span>
<span id="cb105-669"><a href="#cb105-669"></a></span>
<span id="cb105-670"><a href="#cb105-670"></a><span class="in">multiplier &lt;- ordiArrowMul(E.Y2.scrs$biplot, fill = 0.45)</span></span>
<span id="cb105-671"><a href="#cb105-671"></a><span class="in">E.Y2.bp &lt;- E.Y2.scrs$biplot * multiplier</span></span>
<span id="cb105-672"><a href="#cb105-672"></a><span class="in">E.Y2.bp &lt;- as.data.frame(E.Y2.bp)</span></span>
<span id="cb105-673"><a href="#cb105-673"></a><span class="in">E.Y2.bp$labels &lt;- rownames(E.Y2.bp)</span></span>
<span id="cb105-674"><a href="#cb105-674"></a><span class="in">colnames(E.Y2.bp) &lt;- c("x", "y", "labels")</span></span>
<span id="cb105-675"><a href="#cb105-675"></a><span class="in">E.Y2.bp.sign &lt;- E.Y2.bp[E.Y2.bp$labels %in% E.Y2.sign.ax,]</span></span>
<span id="cb105-676"><a href="#cb105-676"></a></span>
<span id="cb105-677"><a href="#cb105-677"></a><span class="in">E.Y2.text &lt;- text.mult(E.Y2.scrs$biplot, fill = 0.45)</span></span>
<span id="cb105-678"><a href="#cb105-678"></a><span class="in">E.Y2.text &lt;- as.data.frame(E.Y2.text)</span></span>
<span id="cb105-679"><a href="#cb105-679"></a><span class="in">E.Y2.text$labels &lt;- rownames(E.Y2.text)</span></span>
<span id="cb105-680"><a href="#cb105-680"></a><span class="in">colnames(E.Y2.text) &lt;- c("x", "y", "labels")</span></span>
<span id="cb105-681"><a href="#cb105-681"></a><span class="in">E.Y2.text.sign &lt;- E.Y2.text[E.Y2.text$labels %in% E.Y2.sign.ax,]</span></span>
<span id="cb105-682"><a href="#cb105-682"></a></span>
<span id="cb105-683"><a href="#cb105-683"></a><span class="in">E.Y2.p &lt;- ggplot(data = E.Y2.df_sites, aes(x, y, colour = Bioregion)) + </span></span>
<span id="cb105-684"><a href="#cb105-684"></a><span class="in">  geom_point(size = 4.0) + </span></span>
<span id="cb105-685"><a href="#cb105-685"></a><span class="in">  geom_text(aes(label = Section), size = 3.0, col = "white") + </span></span>
<span id="cb105-686"><a href="#cb105-686"></a><span class="in">  geom_segment(data = E.Y2.bp.sign, </span></span>
<span id="cb105-687"><a href="#cb105-687"></a><span class="in">               aes(x = 0, y = 0, xend = x, yend = y),</span></span>
<span id="cb105-688"><a href="#cb105-688"></a><span class="in">               arrow = arrow(length = unit(0.2, "cm")), </span></span>
<span id="cb105-689"><a href="#cb105-689"></a><span class="in">               color = "red", alpha = 1, size = 0.7) +</span></span>
<span id="cb105-690"><a href="#cb105-690"></a><span class="in">  geom_text(data = as.data.frame(E.Y2.text.sign), </span></span>
<span id="cb105-691"><a href="#cb105-691"></a><span class="in">            aes(x, y, label = rownames(E.Y2.text.sign)),</span></span>
<span id="cb105-692"><a href="#cb105-692"></a><span class="in">            color = "black") +</span></span>
<span id="cb105-693"><a href="#cb105-693"></a><span class="in">  xlab("CAP1") + ylab("CAP2") + </span></span>
<span id="cb105-694"><a href="#cb105-694"></a><span class="in">  ggtitle(expression(paste("Thermal variables and ", beta[sne]))) +</span></span>
<span id="cb105-695"><a href="#cb105-695"></a><span class="in">  theme_grey() +</span></span>
<span id="cb105-696"><a href="#cb105-696"></a><span class="in">  theme(panel.grid.minor = element_blank(),</span></span>
<span id="cb105-697"><a href="#cb105-697"></a><span class="in">        legend.position = c(.80, .75),</span></span>
<span id="cb105-698"><a href="#cb105-698"></a><span class="in">        aspect.ratio = 0.8)</span></span>
<span id="cb105-699"><a href="#cb105-699"></a><span class="in">```</span></span>
<span id="cb105-700"><a href="#cb105-700"></a></span>
<span id="cb105-701"><a href="#cb105-701"></a>Here I now assemble the various panels into what we see produced in Fig. 2 in the paper:</span>
<span id="cb105-702"><a href="#cb105-702"></a></span>
<span id="cb105-703"><a href="#cb105-703"></a><span class="in">```{r make-fig-2a-d}</span></span>
<span id="cb105-704"><a href="#cb105-704"></a><span class="in"># pdf("Fig2.pdf", width = 9, height = 8)</span></span>
<span id="cb105-705"><a href="#cb105-705"></a><span class="in">grid::grid.newpage()</span></span>
<span id="cb105-706"><a href="#cb105-706"></a><span class="in">grid::pushViewport(grid::viewport(layout = grid::grid.layout(2,2)))</span></span>
<span id="cb105-707"><a href="#cb105-707"></a><span class="in">vplayout &lt;- function(x, y) grid::viewport(layout.pos.row = x, layout.pos.col = y)</span></span>
<span id="cb105-708"><a href="#cb105-708"></a><span class="in">print(E.Y1.p, vp = vplayout(1,1))</span></span>
<span id="cb105-709"><a href="#cb105-709"></a><span class="in">print(E.Y2.p, vp = vplayout(1,2))</span></span>
<span id="cb105-710"><a href="#cb105-710"></a><span class="in">print(S.Y1.p, vp = vplayout(2,1))</span></span>
<span id="cb105-711"><a href="#cb105-711"></a><span class="in">print(S.Y2.p, vp = vplayout(2,2))</span></span>
<span id="cb105-712"><a href="#cb105-712"></a><span class="in"># dev.off()</span></span>
<span id="cb105-713"><a href="#cb105-713"></a><span class="in">```</span></span>
<span id="cb105-714"><a href="#cb105-714"></a></span>
<span id="cb105-715"><a href="#cb105-715"></a>And I do the same with assembling the panels that form Fig. 3 in the paper:</span>
<span id="cb105-716"><a href="#cb105-716"></a></span>
<span id="cb105-717"><a href="#cb105-717"></a><span class="in">```{r make-fig-3a-e}</span></span>
<span id="cb105-718"><a href="#cb105-718"></a><span class="in"># pdf("Fig3.pdf", width = 9, height = 7)</span></span>
<span id="cb105-719"><a href="#cb105-719"></a><span class="in">grid::grid.newpage()</span></span>
<span id="cb105-720"><a href="#cb105-720"></a><span class="in">grid::pushViewport(grid::viewport(layout = grid::grid.layout(3,2)))</span></span>
<span id="cb105-721"><a href="#cb105-721"></a><span class="in">vplayout &lt;- function(x, y) grid::viewport(layout.pos.row = x, layout.pos.col = y)</span></span>
<span id="cb105-722"><a href="#cb105-722"></a><span class="in">print(E.Y1.plt.axis1, vp = vplayout(1,1))</span></span>
<span id="cb105-723"><a href="#cb105-723"></a><span class="in">print(E.Y1.plt.axis2, vp = vplayout(1,2))</span></span>
<span id="cb105-724"><a href="#cb105-724"></a><span class="in">print(E.Y2.plt.axis1, vp = vplayout(2,1))</span></span>
<span id="cb105-725"><a href="#cb105-725"></a><span class="in">print(S.Y1.plt.axis1, vp = vplayout(3,1))</span></span>
<span id="cb105-726"><a href="#cb105-726"></a><span class="in">print(S.Y2.plt.axis1, vp = vplayout(3,2))</span></span>
<span id="cb105-727"><a href="#cb105-727"></a><span class="in"># dev.off()</span></span>
<span id="cb105-728"><a href="#cb105-728"></a><span class="in">```</span></span>
<span id="cb105-729"><a href="#cb105-729"></a></span>
<span id="cb105-730"><a href="#cb105-730"></a><span class="fu">### Partitioning of variance</span></span>
<span id="cb105-731"><a href="#cb105-731"></a></span>
<span id="cb105-732"><a href="#cb105-732"></a>Lastly, using **vegan**'s <span class="in">`varpart()`</span> function, I partition the variance between the MEM variables and the thermal variables <span class="co">[</span><span class="ot">@Peres-Neto2006; @PeresNeto2010</span><span class="co">]</span>.</span>
<span id="cb105-733"><a href="#cb105-733"></a></span>
<span id="cb105-734"><a href="#cb105-734"></a><span class="in">```{r Y1-Y2-varpart}</span></span>
<span id="cb105-735"><a href="#cb105-735"></a><span class="in"># These lines of code produce a few figures to visually understand</span></span>
<span id="cb105-736"><a href="#cb105-736"></a><span class="in"># the variance partitioning on Y1:</span></span>
<span id="cb105-737"><a href="#cb105-737"></a><span class="in">vp2.Y1 &lt;- varpart(Y1, E.Y1.red, S.Y1.red)</span></span>
<span id="cb105-738"><a href="#cb105-738"></a><span class="in">par(mfrow = c(1, 2))</span></span>
<span id="cb105-739"><a href="#cb105-739"></a><span class="in">showvarparts(2, c("Environ-\nment","","Spatial",""))</span></span>
<span id="cb105-740"><a href="#cb105-740"></a><span class="in">plot(vp2.Y1, digits = 2)</span></span>
<span id="cb105-741"><a href="#cb105-741"></a><span class="in">par(mfrow = c(1, 1))</span></span>
<span id="cb105-742"><a href="#cb105-742"></a></span>
<span id="cb105-743"><a href="#cb105-743"></a><span class="in"># Now I test the significant fractions [a], [b] and [c]...</span></span>
<span id="cb105-744"><a href="#cb105-744"></a><span class="in">ES.Y1.red &lt;- cbind(E.Y1.red, S.Y1.red)</span></span>
<span id="cb105-745"><a href="#cb105-745"></a></span>
<span id="cb105-746"><a href="#cb105-746"></a><span class="in"># Fraction E | S; pure environmental, i.e. [a]:</span></span>
<span id="cb105-747"><a href="#cb105-747"></a><span class="in">anova.cca(capscale(Y1 ~ augMean + febRange + febSD + augSD +</span></span>
<span id="cb105-748"><a href="#cb105-748"></a><span class="in">                  Condition(MEM1 + MEM2 + MEM3 + MEM4 + MEM5 +</span></span>
<span id="cb105-749"><a href="#cb105-749"></a><span class="in">                              MEM6 + MEM7 + MEM8 + MEM9 + MEM10 +</span></span>
<span id="cb105-750"><a href="#cb105-750"></a><span class="in">                              MEM13 + MEM15 + MEM16 +</span></span>
<span id="cb105-751"><a href="#cb105-751"></a><span class="in">                              MEM18 + MEM19 + MEM20),</span></span>
<span id="cb105-752"><a href="#cb105-752"></a><span class="in">                data = ES.Y1.red), parallel = 4, step = 1000)</span></span>
<span id="cb105-753"><a href="#cb105-753"></a></span>
<span id="cb105-754"><a href="#cb105-754"></a><span class="in"># Fraction S | E; pure spatial, i.e. [c]:</span></span>
<span id="cb105-755"><a href="#cb105-755"></a><span class="in">anova.cca(capscale(Y1 ~ MEM1 + MEM2 + MEM3 + MEM4 + MEM5 +</span></span>
<span id="cb105-756"><a href="#cb105-756"></a><span class="in">                              MEM6 + MEM7 + MEM8 + MEM9 + MEM10 +</span></span>
<span id="cb105-757"><a href="#cb105-757"></a><span class="in">                              MEM13 + MEM15 + MEM16 +</span></span>
<span id="cb105-758"><a href="#cb105-758"></a><span class="in">                              MEM18 + MEM19 + MEM20 +</span></span>
<span id="cb105-759"><a href="#cb105-759"></a><span class="in">                  Condition(augMean + febRange + febSD + augSD),</span></span>
<span id="cb105-760"><a href="#cb105-760"></a><span class="in">                data = ES.Y1.red), parallel = 4, step = 1000)</span></span>
<span id="cb105-761"><a href="#cb105-761"></a></span>
<span id="cb105-762"><a href="#cb105-762"></a><span class="in"># Fraction E; environmental, i.e. [a] + [b]:</span></span>
<span id="cb105-763"><a href="#cb105-763"></a><span class="in">anova.cca(capscale(Y1 ~., E.Y1.red), parallel = 4, step = 1000)</span></span>
<span id="cb105-764"><a href="#cb105-764"></a></span>
<span id="cb105-765"><a href="#cb105-765"></a><span class="in"># Fractions S; spatial, i.e. [b] + [c]:</span></span>
<span id="cb105-766"><a href="#cb105-766"></a><span class="in">anova.cca(capscale(Y1 ~., S.Y1.red), parallel = 4, step = 1000)</span></span>
<span id="cb105-767"><a href="#cb105-767"></a></span>
<span id="cb105-768"><a href="#cb105-768"></a><span class="in"># Fractions E + S; spatial and environmental, i.e. [a] + [b] + [c]:</span></span>
<span id="cb105-769"><a href="#cb105-769"></a><span class="in">anova.cca(capscale(Y1 ~., cbind(E.Y1.red, S.Y1.red)), parallel = 4, step = 1000)</span></span>
<span id="cb105-770"><a href="#cb105-770"></a></span>
<span id="cb105-771"><a href="#cb105-771"></a><span class="in"># And now the partitioning of the variance in Y2:</span></span>
<span id="cb105-772"><a href="#cb105-772"></a><span class="in">(vp2.Y2 &lt;- varpart(Y2, E.Y2.red, S.Y2.red))</span></span>
<span id="cb105-773"><a href="#cb105-773"></a><span class="in">par(mfrow = c(1, 2))</span></span>
<span id="cb105-774"><a href="#cb105-774"></a><span class="in">showvarparts(2, c("Environ-\nment","","Spatial",""))</span></span>
<span id="cb105-775"><a href="#cb105-775"></a><span class="in">plot(vp2.Y2, digits = 2)</span></span>
<span id="cb105-776"><a href="#cb105-776"></a><span class="in">par(mfrow = c(1, 1))</span></span>
<span id="cb105-777"><a href="#cb105-777"></a></span>
<span id="cb105-778"><a href="#cb105-778"></a><span class="in"># Tests the significant fractions [a], [b] and [c]...</span></span>
<span id="cb105-779"><a href="#cb105-779"></a><span class="in">ES.Y2.red &lt;- cbind(E.Y2.red, S.Y2.red)</span></span>
<span id="cb105-780"><a href="#cb105-780"></a></span>
<span id="cb105-781"><a href="#cb105-781"></a><span class="in"># Fraction E | S; pure environmental, i.e. [a]:</span></span>
<span id="cb105-782"><a href="#cb105-782"></a><span class="in">anova.cca(capscale(Y2 ~ annMean +</span></span>
<span id="cb105-783"><a href="#cb105-783"></a><span class="in">                  Condition(MEM1 + MEM2 + MEM3 + MEM5),</span></span>
<span id="cb105-784"><a href="#cb105-784"></a><span class="in">                data = ES.Y2.red), parallel = 4, step = 1000)</span></span>
<span id="cb105-785"><a href="#cb105-785"></a></span>
<span id="cb105-786"><a href="#cb105-786"></a><span class="in"># Fraction S | E; pure spatial, i.e. [c]:</span></span>
<span id="cb105-787"><a href="#cb105-787"></a><span class="in">anova.cca(capscale(Y2 ~ MEM1 + MEM2 + MEM3 + MEM5 +</span></span>
<span id="cb105-788"><a href="#cb105-788"></a><span class="in">                  Condition(annMean),</span></span>
<span id="cb105-789"><a href="#cb105-789"></a><span class="in">                data = ES.Y2.red), parallel = 4, step = 1000)</span></span>
<span id="cb105-790"><a href="#cb105-790"></a></span>
<span id="cb105-791"><a href="#cb105-791"></a><span class="in"># Fraction E; environmental, i.e. [a] + [b]:</span></span>
<span id="cb105-792"><a href="#cb105-792"></a><span class="in">anova.cca(capscale(Y2 ~., E.Y2.red), parallel = 4, step = 1000)</span></span>
<span id="cb105-793"><a href="#cb105-793"></a></span>
<span id="cb105-794"><a href="#cb105-794"></a><span class="in"># Fractions S; spatial, i.e. [b] + [c]:</span></span>
<span id="cb105-795"><a href="#cb105-795"></a><span class="in">anova.cca(capscale(Y2 ~., S.Y2.red), parallel = 4, step = 1000)</span></span>
<span id="cb105-796"><a href="#cb105-796"></a></span>
<span id="cb105-797"><a href="#cb105-797"></a><span class="in"># Fractions E + S; spatial and environmental, i.e. [a] + [b] + [c]:</span></span>
<span id="cb105-798"><a href="#cb105-798"></a><span class="in">anova.cca(capscale(Y2 ~., cbind(E.Y2.red, S.Y2.red)), parallel = 4, step = 1000)</span></span>
<span id="cb105-799"><a href="#cb105-799"></a><span class="in">```</span></span>
<span id="cb105-800"><a href="#cb105-800"></a></span>
<span id="cb105-801"><a href="#cb105-801"></a><span class="fu">## Appendix C</span></span>
<span id="cb105-802"><a href="#cb105-802"></a></span>
<span id="cb105-803"><a href="#cb105-803"></a><span class="fu">### Network graphs of $\beta$-diversity</span></span>
<span id="cb105-804"><a href="#cb105-804"></a></span>
<span id="cb105-805"><a href="#cb105-805"></a>I delved deeper into the patterns of \textbeta-diversity by examining the properties of the full dissimilarity matrix, which gives regional \textbeta-diversity mentioned above. This matrix describes all pairwise combinations of sections (582 -- 1 = 3363), and as such gives us a regional perspective <span class="co">[</span><span class="ot">@Anderson2013</span><span class="co">]</span>.</span>
<span id="cb105-806"><a href="#cb105-806"></a></span>
<span id="cb105-807"><a href="#cb105-807"></a>The usual visualisation approach is to plot the dissimilarity metric as a function of geographical distance along the gradient or with respect to the distance between corresponding pairs of sections <span class="co">[</span><span class="ot">*e.g.* @Nekola1999; @Davidar2007</span><span class="co">]</span>; these visualisations are provided here. The plots of dissimilarities were colour-coded according to the bioregion to which the section pairs belong (the Benguela Marine Province (BMP; **1**--**17**), the Benguela-Agulhas Transition Zone (B-ATZ; **18**--**22**), the Agulhas Marine Province (AMP; **19**--**43**/**44** --- the location of this transition is somewhat uncertain at this stage) and the East Coast Transition Zone (ECTZ; **44**/**45**--**58**) <span class="co">[</span><span class="ot">*sensu* @Bolton2004</span><span class="co">]</span> to distinguish bioregional properties of species distribution from the wider geographical scale structure along the whole coastline.</span>
<span id="cb105-808"><a href="#cb105-808"></a></span>
<span id="cb105-809"><a href="#cb105-809"></a>In doing so, the change in $\beta$-diversity per unit of separating distance between sections (km^-1^) could be calculated for each bioregion using linear regression. Since the connectivity between sections is constrained by their location along the shore, I calculated the distances between sections not as 'as the crow ﬂies' distances (*e.g.* Section **1** is not connected in a straight line to Section **58** because of the intervening land in-between), but as the great circle geodesic distances between each pair of sections along a network of connected sections (vertices on a network graph). In other words, travelling from Section **1** to Section **58** requires travelling first along the coast through Section **2**, then Section **3**, and eventually all the way up to Section **58**. The total distance between a pair of arbitrary sections is therefore the cumulative sum of the great circle distances between each consecutive pair of intervening sections along the 'route'. This information is encapsulated as a square geodesic distance matrix, and can supply the distance along the abscissa against which species dissimilarities are plotted along the ordinate. The plots showing the relationship between \textbeta-diversity with distance are limited because they do not provide a geographical context.</span>
<span id="cb105-810"><a href="#cb105-810"></a></span>
<span id="cb105-811"><a href="#cb105-811"></a>To overcome this problem, I relied on a visualisation technique not commonly found in biogeographical studies to explicitly provide the geographical context. I structured the sections as vertices of a network graph and assigned to them their geographical coordinates to force a familiar layout of the graph --- when plotted on geographic coordinates, the sections form a map of South Africa. The species dissimilarities were assigned as edge weights (the lines connecting the **58** coastal sections) between pairs of sections, and added to the map. The weights are directly proportional to the thickness of the edges, and colours assigned to vertices (points, or the 58 coastal sections) cluster the sections into their bioregions. Initially I used the **igraph** package that many people rave about, but I found it bothersome. So I devised a cunning way to create network graphs from scratch with some **dplyr** and **ggplot2** magic. I suppose that if I really wanted to I could have made neat functions here (and elsewhere) to reduce some of the repetitive nature of my code, but I really couldn't be bother doing that.</span>
<span id="cb105-812"><a href="#cb105-812"></a></span>
<span id="cb105-813"><a href="#cb105-813"></a><span class="in">```{r network-graphs}</span></span>
<span id="cb105-814"><a href="#cb105-814"></a><span class="in"># Visualise the pairwise dissimilarities as network graphs where the </span></span>
<span id="cb105-815"><a href="#cb105-815"></a><span class="in"># vertices are geographical coordinates and the edge lengths are the geodesic </span></span>
<span id="cb105-816"><a href="#cb105-816"></a><span class="in"># distances. </span></span>
<span id="cb105-817"><a href="#cb105-817"></a><span class="in"># These visualisations appear in the paper as Fig. 4.</span></span>
<span id="cb105-818"><a href="#cb105-818"></a><span class="in">colnames(sites) &lt;- c("lon", "lat")</span></span>
<span id="cb105-819"><a href="#cb105-819"></a><span class="in">sites &lt;- cbind(data.frame(site = seq(1:58)), sites)</span></span>
<span id="cb105-820"><a href="#cb105-820"></a></span>
<span id="cb105-821"><a href="#cb105-821"></a><span class="in">Y1.sl &lt;- as.data.frame(expand.grid(seq(1:58), seq(1:58)))</span></span>
<span id="cb105-822"><a href="#cb105-822"></a><span class="in">colnames(Y1.sl) &lt;- c("to", "from")</span></span>
<span id="cb105-823"><a href="#cb105-823"></a></span>
<span id="cb105-824"><a href="#cb105-824"></a><span class="in">Y2.sl &lt;- Y1.sl</span></span>
<span id="cb105-825"><a href="#cb105-825"></a></span>
<span id="cb105-826"><a href="#cb105-826"></a><span class="in"># First Y1:</span></span>
<span id="cb105-827"><a href="#cb105-827"></a><span class="in">Y1.sl$Y1 &lt;- as.vector(Y1)</span></span>
<span id="cb105-828"><a href="#cb105-828"></a></span>
<span id="cb105-829"><a href="#cb105-829"></a><span class="in">Y1.sl.BMP &lt;- Y1.sl %&gt;%</span></span>
<span id="cb105-830"><a href="#cb105-830"></a><span class="in">  dplyr::left_join(., sites, by = c("to" = "site")) %&gt;% </span></span>
<span id="cb105-831"><a href="#cb105-831"></a><span class="in">  dplyr::left_join(., sites, by = c("from" = "site")) %&gt;% </span></span>
<span id="cb105-832"><a href="#cb105-832"></a><span class="in">  dplyr::filter(Y1 &lt;= 0.5 &amp; Y1 != 0) %&gt;% </span></span>
<span id="cb105-833"><a href="#cb105-833"></a><span class="in">  dplyr::filter(from != to &amp; from &lt;= 16)</span></span>
<span id="cb105-834"><a href="#cb105-834"></a></span>
<span id="cb105-835"><a href="#cb105-835"></a><span class="in">Y1.sl.BATZ &lt;- Y1.sl %&gt;%</span></span>
<span id="cb105-836"><a href="#cb105-836"></a><span class="in">  dplyr::left_join(., sites, by = c("to" = "site")) %&gt;% </span></span>
<span id="cb105-837"><a href="#cb105-837"></a><span class="in">  dplyr::left_join(., sites, by = c("from" = "site")) %&gt;% </span></span>
<span id="cb105-838"><a href="#cb105-838"></a><span class="in">  dplyr::filter(Y1 &lt;= 0.5 &amp; Y1 != 0) %&gt;% </span></span>
<span id="cb105-839"><a href="#cb105-839"></a><span class="in">  dplyr::filter(from != to &amp; from &gt; 16 &amp; from &lt;= 21)</span></span>
<span id="cb105-840"><a href="#cb105-840"></a></span>
<span id="cb105-841"><a href="#cb105-841"></a><span class="in">Y1.sl.AMP &lt;- Y1.sl %&gt;%</span></span>
<span id="cb105-842"><a href="#cb105-842"></a><span class="in">  dplyr::left_join(., sites, by = c("to" = "site")) %&gt;% </span></span>
<span id="cb105-843"><a href="#cb105-843"></a><span class="in">  dplyr::left_join(., sites, by = c("from" = "site")) %&gt;% </span></span>
<span id="cb105-844"><a href="#cb105-844"></a><span class="in">  dplyr::filter(Y1 &lt;= 0.5 &amp; Y1 != 0) %&gt;% </span></span>
<span id="cb105-845"><a href="#cb105-845"></a><span class="in">  dplyr::filter(from != to &amp; from &gt; 21 &amp; from &lt;= 41)</span></span>
<span id="cb105-846"><a href="#cb105-846"></a></span>
<span id="cb105-847"><a href="#cb105-847"></a><span class="in">Y1.sl.ECTZ &lt;- Y1.sl %&gt;%</span></span>
<span id="cb105-848"><a href="#cb105-848"></a><span class="in">  dplyr::left_join(., sites, by = c("to" = "site")) %&gt;% </span></span>
<span id="cb105-849"><a href="#cb105-849"></a><span class="in">  dplyr::left_join(., sites, by = c("from" = "site")) %&gt;% </span></span>
<span id="cb105-850"><a href="#cb105-850"></a><span class="in">  dplyr::filter(Y1 &lt;= 0.5 &amp; Y1 != 0) %&gt;% </span></span>
<span id="cb105-851"><a href="#cb105-851"></a><span class="in">  dplyr::filter(from != to &amp; from &gt; 41)</span></span>
<span id="cb105-852"><a href="#cb105-852"></a></span>
<span id="cb105-853"><a href="#cb105-853"></a><span class="in">Y1.sl &lt;- rbind(Y1.sl.BMP, Y1.sl.BATZ, Y1.sl.AMP, Y1.sl.ECTZ)</span></span>
<span id="cb105-854"><a href="#cb105-854"></a></span>
<span id="cb105-855"><a href="#cb105-855"></a><span class="in"># and then Y2:</span></span>
<span id="cb105-856"><a href="#cb105-856"></a><span class="in">Y2.sl$Y2 &lt;- as.vector(Y2)</span></span>
<span id="cb105-857"><a href="#cb105-857"></a></span>
<span id="cb105-858"><a href="#cb105-858"></a><span class="in">Y2.sl.BMP &lt;- Y2.sl %&gt;%</span></span>
<span id="cb105-859"><a href="#cb105-859"></a><span class="in">  dplyr::left_join(., sites, by = c("to" = "site")) %&gt;% </span></span>
<span id="cb105-860"><a href="#cb105-860"></a><span class="in">  dplyr::left_join(., sites, by = c("from" = "site")) %&gt;% </span></span>
<span id="cb105-861"><a href="#cb105-861"></a><span class="in">  dplyr::filter(Y2 &lt;= 0.5 &amp; Y2 != 0) %&gt;% </span></span>
<span id="cb105-862"><a href="#cb105-862"></a><span class="in">  dplyr::filter(from != to &amp; from &lt;= 16)</span></span>
<span id="cb105-863"><a href="#cb105-863"></a></span>
<span id="cb105-864"><a href="#cb105-864"></a><span class="in">Y2.sl.BATZ &lt;- Y2.sl %&gt;%</span></span>
<span id="cb105-865"><a href="#cb105-865"></a><span class="in">  dplyr::left_join(., sites, by = c("to" = "site")) %&gt;% </span></span>
<span id="cb105-866"><a href="#cb105-866"></a><span class="in">  dplyr::left_join(., sites, by = c("from" = "site")) %&gt;% </span></span>
<span id="cb105-867"><a href="#cb105-867"></a><span class="in">  dplyr::filter(Y2 &lt;= 0.5 &amp; Y2 != 0) %&gt;% </span></span>
<span id="cb105-868"><a href="#cb105-868"></a><span class="in">  dplyr::filter(from != to &amp; from &gt; 16 &amp; from &lt;= 21)</span></span>
<span id="cb105-869"><a href="#cb105-869"></a></span>
<span id="cb105-870"><a href="#cb105-870"></a><span class="in">Y2.sl.AMP &lt;- Y2.sl %&gt;%</span></span>
<span id="cb105-871"><a href="#cb105-871"></a><span class="in">  dplyr::left_join(., sites, by = c("to" = "site")) %&gt;% </span></span>
<span id="cb105-872"><a href="#cb105-872"></a><span class="in">  dplyr::left_join(., sites, by = c("from" = "site")) %&gt;% </span></span>
<span id="cb105-873"><a href="#cb105-873"></a><span class="in">  dplyr::filter(Y2 &lt;= 0.5 &amp; Y2 != 0) %&gt;% </span></span>
<span id="cb105-874"><a href="#cb105-874"></a><span class="in">  dplyr::filter(from != to &amp; from &gt; 21 &amp; from &lt;= 41)</span></span>
<span id="cb105-875"><a href="#cb105-875"></a></span>
<span id="cb105-876"><a href="#cb105-876"></a><span class="in">Y2.sl.ECTZ &lt;- Y2.sl %&gt;%</span></span>
<span id="cb105-877"><a href="#cb105-877"></a><span class="in">  dplyr::left_join(., sites, by = c("to" = "site")) %&gt;% </span></span>
<span id="cb105-878"><a href="#cb105-878"></a><span class="in">  dplyr::left_join(., sites, by = c("from" = "site")) %&gt;% </span></span>
<span id="cb105-879"><a href="#cb105-879"></a><span class="in">  dplyr::filter(Y2 &lt;= 0.5 &amp; Y2 != 0) %&gt;% </span></span>
<span id="cb105-880"><a href="#cb105-880"></a><span class="in">  dplyr::filter(from != to &amp; from &gt; 41)</span></span>
<span id="cb105-881"><a href="#cb105-881"></a></span>
<span id="cb105-882"><a href="#cb105-882"></a><span class="in"># Load coastline</span></span>
<span id="cb105-883"><a href="#cb105-883"></a><span class="in">load("data/coast.RData")</span></span>
<span id="cb105-884"><a href="#cb105-884"></a></span>
<span id="cb105-885"><a href="#cb105-885"></a><span class="in">sa_lats &lt;- c(-38, -26); sa_lons &lt;- c(14, 34)</span></span>
<span id="cb105-886"><a href="#cb105-886"></a></span>
<span id="cb105-887"><a href="#cb105-887"></a><span class="in">net.plot.Y1 &lt;- function(dissim = NULL, title = NULL, col.seq = NULL) {</span></span>
<span id="cb105-888"><a href="#cb105-888"></a><span class="in">  ggplot(dissim, aes(lon.x, lat.x)) +</span></span>
<span id="cb105-889"><a href="#cb105-889"></a><span class="in">    geom_polygon(data = south_africa_coast, </span></span>
<span id="cb105-890"><a href="#cb105-890"></a><span class="in">                 aes(x = long, y = lat, group = group), </span></span>
<span id="cb105-891"><a href="#cb105-891"></a><span class="in">                 show.legend = FALSE, fill = "#F9FAEC") +</span></span>
<span id="cb105-892"><a href="#cb105-892"></a><span class="in">    geom_curve(aes(xend = lon.y, yend = lat.y, col = Y1, alpha = (1 - Y1) - 0.4),</span></span>
<span id="cb105-893"><a href="#cb105-893"></a><span class="in">               curvature = 0.3) + </span></span>
<span id="cb105-894"><a href="#cb105-894"></a><span class="in">    geom_point(data = sites, aes(x = lon, y = lat, fill = bioreg$bolton), </span></span>
<span id="cb105-895"><a href="#cb105-895"></a><span class="in">               col = "black", shape = 21) +</span></span>
<span id="cb105-896"><a href="#cb105-896"></a><span class="in">    scale_fill_manual(breaks = c("AMP", "B-ATZ", "BMP", "ECTZ"),</span></span>
<span id="cb105-897"><a href="#cb105-897"></a><span class="in">                      values = c("darkorchid1", "aquamarine2", "blue1", "orangered1"),</span></span>
<span id="cb105-898"><a href="#cb105-898"></a><span class="in">                      name = "Bioregion", guide = FALSE) +</span></span>
<span id="cb105-899"><a href="#cb105-899"></a><span class="in">    scale_colour_gradient(name = expression(paste(beta[sim])), </span></span>
<span id="cb105-900"><a href="#cb105-900"></a><span class="in">                          low = "antiquewhite4", high = "antiquewhite") +</span></span>
<span id="cb105-901"><a href="#cb105-901"></a><span class="in">    coord_fixed(ratio = 1, expand = TRUE) +</span></span>
<span id="cb105-902"><a href="#cb105-902"></a><span class="in">    scale_x_continuous(labels = function(x) paste0(x, "°E")) +</span></span>
<span id="cb105-903"><a href="#cb105-903"></a><span class="in">    scale_y_continuous(labels = function(x) paste0(x, "°S")) +</span></span>
<span id="cb105-904"><a href="#cb105-904"></a><span class="in">    scale_alpha_continuous(guide = FALSE) +</span></span>
<span id="cb105-905"><a href="#cb105-905"></a><span class="in">    theme_grey() + xlab(NULL) + ylab(NULL) +</span></span>
<span id="cb105-906"><a href="#cb105-906"></a><span class="in">    theme(panel.grid.minor = element_blank()) +</span></span>
<span id="cb105-907"><a href="#cb105-907"></a><span class="in">    ggtitle(title)}</span></span>
<span id="cb105-908"><a href="#cb105-908"></a></span>
<span id="cb105-909"><a href="#cb105-909"></a><span class="in">a &lt;- net.plot.Y1(Y1.sl.BMP, "Benguela Marine Province", </span></span>
<span id="cb105-910"><a href="#cb105-910"></a><span class="in">                 col.seq = c("black", "black", "white", "black")) + # alphabetical</span></span>
<span id="cb105-911"><a href="#cb105-911"></a><span class="in">  theme(legend.direction = "horizontal",</span></span>
<span id="cb105-912"><a href="#cb105-912"></a><span class="in">        legend.position = c(x = 0.5, y = 0.8),</span></span>
<span id="cb105-913"><a href="#cb105-913"></a><span class="in">        legend.key.height = unit(0.3, "cm")) </span></span>
<span id="cb105-914"><a href="#cb105-914"></a><span class="in">b &lt;- net.plot.Y1(Y1.sl.BATZ, "Benguela-Agulhas Transition Zone", </span></span>
<span id="cb105-915"><a href="#cb105-915"></a><span class="in">                 col.seq = c("black", "white", "black", "black")) +</span></span>
<span id="cb105-916"><a href="#cb105-916"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb105-917"><a href="#cb105-917"></a><span class="in">c &lt;- net.plot.Y1(Y1.sl.AMP, "Agulhas Marine Province", </span></span>
<span id="cb105-918"><a href="#cb105-918"></a><span class="in">                 col.seq = c("white", "black", "black", "black")) +</span></span>
<span id="cb105-919"><a href="#cb105-919"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb105-920"><a href="#cb105-920"></a><span class="in">d &lt;- net.plot.Y1(Y1.sl.ECTZ, "East Coast Transition Zone", </span></span>
<span id="cb105-921"><a href="#cb105-921"></a><span class="in">                 col.seq = c("black", "black", "black", "white")) +</span></span>
<span id="cb105-922"><a href="#cb105-922"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb105-923"><a href="#cb105-923"></a></span>
<span id="cb105-924"><a href="#cb105-924"></a><span class="in"># pdf("Fig4.pdf", width = 7, height = 3.8)</span></span>
<span id="cb105-925"><a href="#cb105-925"></a><span class="in">grid::grid.newpage()</span></span>
<span id="cb105-926"><a href="#cb105-926"></a><span class="in">grid::pushViewport(grid::viewport(layout = grid::grid.layout(2,2)))</span></span>
<span id="cb105-927"><a href="#cb105-927"></a><span class="in">vplayout &lt;- function(x, y) grid::viewport(layout.pos.row = x, layout.pos.col = y)</span></span>
<span id="cb105-928"><a href="#cb105-928"></a><span class="in">print(a, vp = vplayout(1,1))</span></span>
<span id="cb105-929"><a href="#cb105-929"></a><span class="in">print(b, vp = vplayout(1,2))</span></span>
<span id="cb105-930"><a href="#cb105-930"></a><span class="in">print(c, vp = vplayout(2,1))</span></span>
<span id="cb105-931"><a href="#cb105-931"></a><span class="in">print(d, vp = vplayout(2,2))</span></span>
<span id="cb105-932"><a href="#cb105-932"></a><span class="in"># dev.off()</span></span>
<span id="cb105-933"><a href="#cb105-933"></a><span class="in">```</span></span>
<span id="cb105-934"><a href="#cb105-934"></a></span>
<span id="cb105-935"><a href="#cb105-935"></a>And that's it, folks. You'll notice that I haven't reproduced Fig. 5 here. I'll leave that up to you... or ask me and I'll send the code. All of the matrices have (mostly) been calculated above and they can be used together with some **dplyr** and **ggplot2** know-how in the creation of that graph.</span>
<span id="cb105-936"><a href="#cb105-936"></a></span>
<span id="cb105-937"><a href="#cb105-937"></a>Legalise seaweed!</span>
<span id="cb105-938"><a href="#cb105-938"></a></span>
<span id="cb105-939"><a href="#cb105-939"></a><span class="fu">## References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024, AJ Smit</p>
</div>   
    <div class="nav-footer-center">

<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ajsmit/tangled_bank/edit/main/BCB743/Seaweed_in_Two_Oceans_v2/two_oceans_appendices.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ajsmit/tangled_bank/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>