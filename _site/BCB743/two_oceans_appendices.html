<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="AJ Smit">
<meta name="author" content="JJ Bolton">
<meta name="author" content="RJ Anderson">
<meta name="dcterms.date" content="2017-03-19">
<title>Seaweeds in Two Oceans: Beta-Diversity (Appendices) – The Tangled Bank</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../BCB743/cluster_analysis.html" rel="next">
<link href="../BCB743/constrained_ordination.html" rel="prev">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-8b4baf804e461d9b72633f0de59a0cac.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-37d9842ca13b32c9c58adfc4ed5d9451.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SCYH68M489"></script><script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SCYH68M489', { 'anonymize_ip': true});
</script><script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script><style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../styles/styles.css">
<meta property="og:title" content="Seaweeds in Two Oceans: Beta-Diversity (Appendices) – The Tangled Bank">
<meta property="og:description" content="UWC’s Biodiversity &amp; Conservation Biology Department Pages For BDC223, BDC334, BCB743, and BCB744.">
<meta property="og:image" content="http://tangledbank.netlify.app/BCB743/two_oceans_appendices_files/figure-html/code-pcnm-1.svg">
<meta property="og:site_name" content="The Tangled Bank">
</head>
<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">The Tangled Bank</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-vignettes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Vignettes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-vignettes">
<li>
    <a class="dropdown-item" href="../vignettes/netCDF_dates.html">
 <span class="dropdown-text">Dates From netCDF Files: Two Approaches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/prep_NOAA_OISST.html">
 <span class="dropdown-text">Downloading and Prep: ERDDAP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/chl_ERDDAP.html">
 <span class="dropdown-text">Retrieving Chlorophyll-a Data from ERDDAP Servers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/alt_method.html">
 <span class="dropdown-text">Downloading and Prep: Python + CDO</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/gridded_data.html">
 <span class="dropdown-text">Detecting Events in Gridded Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/regridding.html">
 <span class="dropdown-text">Regridding gridded data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/MHW_MCS_horizonplots.html">
 <span class="dropdown-text">Displaying MHWs and MCSs as Horizon Plots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/heatwaveR_issues.html">
 <span class="dropdown-text">heatwaveR Issues</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/chl_sightings.html">
 <span class="dropdown-text">Plotting the Whale Sightings and Chlorophyll-<em>a</em> Concentrations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/chl_localisation.html">
 <span class="dropdown-text">Spatial Localisation, Subsetting, and Aggregation of the Chlorophyll-<em>a</em> Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/elem_ts_methods.html">
 <span class="dropdown-text">Wavelet Analysis of Diatom Time Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/buffer_data_extract.html">
 <span class="dropdown-text">Extracting gridded data within a buffer</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-high-performance-computing" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">High-Performance Computing</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-high-performance-computing">
<li>
    <a class="dropdown-item" href="../vignettes/README_Lengau.html">
 <span class="dropdown-text">Using Lengau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/PBSPro_users.html">
 <span class="dropdown-text">PBSPro user and job management</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/README_tmux.html">
 <span class="dropdown-text">Using tmux</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Tangled Bank Blog</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-blogroll" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Blogroll</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-blogroll">
<li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">R-bloggers</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item compact">
    <a class="nav-link" href="../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">
<li>
    <a class="dropdown-item" href="https://github.com/ajsmit/tangled_bank">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../BCB743/BCB743_index.html">BCB743: Quantitative Ecology</a></li><li class="breadcrumb-item"><a href="../BCB743/two_oceans_appendices.html">13b: db-RDA: Seaweeds Example</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/my_tree_hex.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none"><img src="../images/my_tree_hex.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">UNDERGRADUATE</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">BDC223: Plant Ecophysiology</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/BDC223_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L00-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductory Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L01-worldmapper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 1: the Limits to Life</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L02-SA_V.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 2: Surface Area to Volume (SA:V) Ratio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L03-climate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 3: Earth’s Climate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L04-carbon_cycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 4: Climate Change (Carbon Cycle)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L05-light.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 5: Light</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L06-pigments_photosynthesis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 6: Pigments &amp; Photosynthesis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L07-chromatic_adaptation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 7: Chromatic Adaptation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L08a-nutrient_uptake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 8a: Nutrient Uptake</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L08b-nutrients_michaelis_menten.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 8b: Nutrient Uptake</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/L09-plant_stress.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 3: Plant Stress</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/Lab1_SA_V.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Surface Area to Volume (SA/V) Ratios in Biology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/Lab2_misc_calcs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2: Miscellaneous Calculations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/Lab3_PI_curves.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3: PI Curves — Jassby &amp; Platt</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/Lab4_nitrogen_uptake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4: Uptake Kinetics — Michaelis-Menten</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC223/BDC223_FAQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">BDC334: Biogeography &amp; Global Ecology</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/BDC334_syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/BDC334-Lecture-Transcripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="my-highlight">BCB334 Lecture Transcript</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lec-01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 1: Introductory Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lec-02-ecosystems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 2. Overview of Ecosystems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lec-03-gradients.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 3. Ecological Gradients</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lec-04-biodiversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 4: Biodiversity Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">Lecture 5: Multivariate Data</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lec-06-unified-ecology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 6: Unified Ecology</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">Lecture 7: Threats to Biodiversity</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">Lecture 8: Nature's Contribution to People</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/IKS_Conservation.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 9: Indigenous Knowledge Systems and Conservation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lab-01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1. Ecological Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lab-02a-r_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2a. Introduction to R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lab-02b-env_dist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2b. Environmental Distance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lab-03-biodiversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3. Quantifying Biodiversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/Lab-04-biodiversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4. Species Distribution Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BDC334/BDC334_AI_Tutor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="my-highlight">BCB334 AI Tutor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pages/Transboundary_systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transboundary Systems</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">HONOURS CORE</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">BCB744: Introduction to R, &amp; Biostatistics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/BCB744_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About</strong></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/01-RStudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/02-working-with-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Working with Data and Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/03-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. R Markdown and Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/04-data-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data Classes and Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/05-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. R Workflows</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/06-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Graphics with <strong>ggplot2</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/07-faceting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Faceting Figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/08-brewing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Brewing Colours</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/09-mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Mapping with <strong>ggplot2</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/10-mapping_style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Mapping with Style</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/11-mapping_rnaturalearth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Mapping with Natural Earth</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/12-mapping_quakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. The Fiji Earthquake Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/13-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Tidy Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/14-tidier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Tidier Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/15-tidiest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15. Tidiest Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/intro_r/16-recap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16. Synthesis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/assessments/BCB744_Intro_R_Self-Assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="my-highlight">Intro R Self-Assessment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/assessments/BCB744_Intro_R_Example_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Intro R Example 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/assessments/BCB744_Intro_R_Example_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Intro R Example 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../self-assessment_v1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self-Assessment Form</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
 <span class="menu-text">1. Introduction to Statistics</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/02-summarise-and-describe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Data Summaries &amp; Descriptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/03-visualise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Statistical Figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/04-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/05-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Statistical Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Assumptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/07-t_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. <em>t</em>-Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/08-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/09-regressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Simple Linear Regressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/10-correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Correlations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/11-decision_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Parametric Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/12-glance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Non-Parametric Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/13-confidence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/basic_stats/14-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Data Transformations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/assessments/BCB744_Biostatistics_Self-Assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="my-highlight">Biostatistics Self-Assessment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB744/assessments/BCB744_BioStats_Example_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 BioStats 2025 Example 1</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">HONOURS ELECTIVES</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">BCB743: Quantitative Ecology</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/BCB743_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1-4: Review Concepts of Biodiversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5: Correlations &amp; Associations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7: Intro to Ordination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8a: Principal Components Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/PCA_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8b: PCA: Additional Examples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/PCA_SDG_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8c: PCA: WHO SDG Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/CA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9a: Correspondence Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/DCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9b: Detrended Correspondence Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/PCoA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10: Principal Coordinates Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/nMDS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11a: Non-metric Multidimensional Scaling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/nMDS_diatoms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11b: nMDS: PERMANOVA (Diatoms) Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/unconstrained-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12: Unconstrained Ordination Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/constrained_ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13a: Distance-Based Redundancy Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/two_oceans_appendices.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">13b: db-RDA: Seaweeds Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/cluster_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14: Cluster Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/model_building.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15: Model Building</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/deep_dive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16a: Deep Dive Into Gradients</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../BCB743/multiple_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16b: Multiple Regression</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">AI &amp; POLICY</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../docs/Combined Faculty AI Policy 15082025.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Faculty of Natural Sciences AI Policy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../AI/BCB_AI_Workshop_Sep_2025.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB AI Workshop</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘︎</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">SUPPORT</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Web Resources</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/general_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/ecology_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantitative Ecology Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/spatial_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial R Resources</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘︎</span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#spatial-analysis-background-and-code" id="toc-spatial-analysis-background-and-code" class="nav-link active" data-scroll-target="#spatial-analysis-background-and-code"><span class="header-section-number">1</span> Spatial Analysis Background and Code</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data"><span class="header-section-number">2</span> The Data</a></li>
  <li><a href="#setting-up-the-analysis-environment" id="toc-setting-up-the-analysis-environment" class="nav-link" data-scroll-target="#setting-up-the-analysis-environment"><span class="header-section-number">3</span> Setting up the Analysis Environment</a></li>
  <li><a href="#preparation-of-spatial-variables" id="toc-preparation-of-spatial-variables" class="nav-link" data-scroll-target="#preparation-of-spatial-variables"><span class="header-section-number">4</span> Preparation of Spatial Variables</a></li>
  <li><a href="#db-rda-on-morans-eigenvector-maps" id="toc-db-rda-on-morans-eigenvector-maps" class="nav-link" data-scroll-target="#db-rda-on-morans-eigenvector-maps"><span class="header-section-number">5</span> db-RDA on Moran’s Eigenvector Maps</a></li>
  <li><a href="#a-few-visualisations" id="toc-a-few-visualisations" class="nav-link" data-scroll-target="#a-few-visualisations"><span class="header-section-number">6</span> A Few Visualisations</a></li>
  <li><a href="#analysis-of-the-thermal-variables" id="toc-analysis-of-the-thermal-variables" class="nav-link" data-scroll-target="#analysis-of-the-thermal-variables"><span class="header-section-number">7</span> Analysis of the Thermal Variables</a></li>
  <li><a href="#partitioning-of-variance" id="toc-partitioning-of-variance" class="nav-link" data-scroll-target="#partitioning-of-variance"><span class="header-section-number">8</span> Partitioning of Variance</a></li>
  <li><a href="#network-graphs-of-beta-diversity" id="toc-network-graphs-of-beta-diversity" class="nav-link" data-scroll-target="#network-graphs-of-beta-diversity"><span class="header-section-number">9</span> Network Graphs of <span class="math inline">\(\beta\)</span>-Diversity</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">10</span> References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/ajsmit/tangled_bank/edit/main/BCB743/two_oceans_appendices.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ajsmit/tangled_bank/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../BCB743/BCB743_index.html">BCB743: Quantitative Ecology</a></li><li class="breadcrumb-item"><a href="../BCB743/two_oceans_appendices.html">13b: db-RDA: Seaweeds Example</a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Seaweeds in Two Oceans: Beta-Diversity (Appendices)</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">AJ Smit </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of the Western Cape
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">JJ Bolton </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Cape Town
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">RJ Anderson </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Agriculture, Forestry and Fisheries and University of Cape Town
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 19, 2017</p>
    </div>
  </div>
  
    
  </div>
  


</header><p>In this document you will find examples of a fairly complicated series of constrained ordinations performed for the paper <span class="citation" data-cites="smit2017seaweeds">Smit et al. (<a href="#ref-smit2017seaweeds" role="doc-biblioref">2017</a>)</span>. The analyses are based on the distribution of seaweeds around the coast of South Africa, and the environmental variables that might explain these distributions.</p>
<section id="spatial-analysis-background-and-code" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="spatial-analysis-background-and-code">
<span class="header-section-number">1</span> Spatial Analysis Background and Code</h2>
<p>This is Appendix B of the paper <span class="citation" data-cites="smit2017seaweeds">Smit et al. (<a href="#ref-smit2017seaweeds" role="doc-biblioref">2017</a>)</span>.</p>
<p>The intention of this section is to show the approach and <strong>R</strong> scripts used to pull apart the spatial scales at which seaweed assemblages are structured around the coast of South Africa. Specifically, I wish to determine if these scales match those expressed by the coastal thermal provinces and the ocean regime underpinned by the Agulhas and Benguela Currents.</p>
</section><section id="the-data" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="the-data">
<span class="header-section-number">2</span> The Data</h2>
<p>I use two data sets. The first, <span class="math inline">\(Y\)</span>, comprises distribution records of 846 macroalgal species within each of 58 × 50 km-long sections (Appendix A) of the South African coast <span class="citation" data-cites="Bolton2002">(updated from <a href="#ref-Bolton2002" role="doc-biblioref">Bolton and Stegenga 2002</a>)</span>. This represents <em>ca</em>. 90% of the known seaweed flora of South Africa, but excludes some very small and/or very rare species for which data are insufficient. The data are from verifiable literature sources and John Bolton and Rob Anderson’s own collections, assembled from information collected by teams of phycologists over three decades <span class="citation" data-cites="Bolton1986 Stegenga1997 Bolton2002 DeClerck2005">(<a href="#ref-Bolton1986" role="doc-biblioref">Bolton 1986</a>; <a href="#ref-Stegenga1997" role="doc-biblioref">Stegenga et al. 1997</a>; <a href="#ref-Bolton2002" role="doc-biblioref">Bolton and Stegenga 2002</a>; <a href="#ref-DeClerck2005" role="doc-biblioref">De Clerck et al. 2005</a>)</span>. The second, <span class="math inline">\(E\)</span>, is a dataset of <em>in situ</em> coastal seawater temperatures <span class="citation" data-cites="Smit2013">(<a href="#ref-Smit2013" role="doc-biblioref">Smit et al. 2013</a>)</span> derived from daily measurements over up to 40 years.</p>
<p>A third data set of explanatory variables — the spatial variables (<span class="math inline">\(S\)</span>) — is constructed as per the instructions in section <em>Preparation of spatial variables</em>, later on.</p>
</section><section id="setting-up-the-analysis-environment" class="level2" data-number="3"><h2 data-number="3" class="anchored" data-anchor-id="setting-up-the-analysis-environment">
<span class="header-section-number">3</span> Setting up the Analysis Environment</h2>
<p>This is <strong>R</strong>, so first I need to find, install, and load various packages. Some of the packages will be available on CRAN and can be accessed and installed in the usual way, but others will have to be downloaded from <a href="https://r-forge.r-project.org/R/?group_id=195">R Forge</a>.</p>
<p>Note: R-Forge repositories can be fragile (packages can disappear, builds can fail, and HTTP repos may be blocked). If you cannot install an R-Forge package, look for a CRAN/GitHub alternative, or ask for a pre-packaged/locked environment.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(betapart)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(vegan)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(grid)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(gridBase)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(spdep) <span class="co"># for dnearneigh() in PCNM.R</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># library(devtools)</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># install.packages("packfor", repos = "http://R-Forge.R-project.org")</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># library(packfor) # replaced with vegan::ordistep()</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># install.packages("AEM", repos = "http://R-Forge.R-project.org")</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># library(AEM) # for moran.I.multi() in PCNM.R</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"pcoa_all.R"</span>))</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"PCNM.R"</span>))</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"spatial_MEM.R"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now I get to the data. The first step involves the species table (<span class="math inline">\(Y\)</span>). First I compute the Sørensen dissimilarity and then I decompose the dissimilarity into the ‘turnover’ (β) and ‘nestedness-resultant’ (β) components <span class="citation" data-cites="Baselga2010 Baselga2013">(<a href="#ref-Baselga2010" role="doc-biblioref">Baselga 2010</a>; <a href="#ref-Baselga2013" role="doc-biblioref">Baselga et al. 2013</a>)</span> using the <code>betapart.core()</code> and <code>betapart.pair()</code> functions of the <strong>betapart</strong> package <span class="citation" data-cites="Baselga2013">(<a href="#ref-Baselga2013" role="doc-biblioref">Baselga et al. 2013</a>)</span>. These are placed into the matrices <span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span>. Optionally, I can apply a principal components analysis (PCA) on <span class="math inline">\(Y\)</span> to find the major patterns in the community data. In <strong>vegan</strong> this is done using the <code>rda()</code> function and not supplying the constraints (<em>i.e.</em>, the environment table, <span class="math inline">\(E\)</span>, or the spatial table, <span class="math inline">\(S\)</span>). The formal analysis will use the species data in distance-based redundancy analyses (db-RDA as per <strong>vegan</strong>’s <code>capscale()</code> function) by coupling them with <span class="math inline">\(E\)</span> and <span class="math inline">\(S\)</span>. I provide the pre-calculated data only.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Read in the species data (note: on GitHub only the distance</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># matrices obtained via 'beta.part' and 'beta.pair' (below)</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># will be provided -- they are read in as 'Y1.Rdata' and 'Y2.Rdata':</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>spp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB743"</span>, <span class="st">"seaweed"</span>, <span class="st">"SeaweedSpp.csv"</span>))</span>
<span id="cb2-5"><a href="#cb2-5"></a>spp <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(spp, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># Decompose total Sørensen dissimilarity into turnover and</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># nestedness-resultant components:</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>Y.core <span class="ot">&lt;-</span> <span class="fu">betapart.core</span>(spp)</span>
<span id="cb2-10"><a href="#cb2-10"></a>Y.pair <span class="ot">&lt;-</span> <span class="fu">beta.pair</span>(Y.core, <span class="at">index.family =</span> <span class="st">"sor"</span>)</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co"># Let Y1 be the turnover component (beta-sim):</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Y.pair<span class="sc">$</span>beta.sim)</span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co"># save(Y1, file = "data/BCB743/Y1.Rdata")</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co"># load("data/BCB743/Y1.Rdata")</span></span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co"># Let Y2 be the nestedness-resultant component (beta-sne):</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>Y2 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Y.pair<span class="sc">$</span>beta.sne)</span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co"># save(Y2, file = "data/BCB743/Y2.Rdata")</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co"># load("data/BCB743/Y2.Rdata")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">summary</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; 
R&gt; Call:
R&gt; capscale(formula = Y1 ~ 1) 
R&gt; 
R&gt; Partitioning of squared Unknown distance:
R&gt;               Inertia Proportion
R&gt; Total           7.892          1
R&gt; Unconstrained   7.892          1
R&gt; 
R&gt; Eigenvalues, and their contribution to the squared Unknown distance 
R&gt; 
R&gt; Importance of components:
R&gt;                         MDS1   MDS2    MDS3     MDS4     MDS5     MDS6     MDS7
R&gt; Eigenvalue            5.9245 1.5822 0.18139 0.046891 0.040669 0.027027 0.021500
R&gt; Proportion Explained  0.7507 0.2005 0.02298 0.005941 0.005153 0.003424 0.002724
R&gt; Cumulative Proportion 0.7507 0.9511 0.97411 0.980047 0.985200 0.988624 0.991349
R&gt;                           MDS8     MDS9    MDS10     MDS11     MDS12     MDS13
R&gt; Eigenvalue            0.013198 0.009752 0.008260 0.0069049 0.0063106 0.0057420
R&gt; Proportion Explained  0.001672 0.001236 0.001047 0.0008749 0.0007996 0.0007275
R&gt; Cumulative Proportion 0.993021 0.994256 0.995303 0.9961778 0.9969774 0.9977049
R&gt;                           MDS14     MDS15     MDS16     MDS17     MDS18
R&gt; Eigenvalue            0.0036196 0.0030613 0.0027952 0.0022481 0.0018842
R&gt; Proportion Explained  0.0004586 0.0003879 0.0003542 0.0002848 0.0002387
R&gt; Cumulative Proportion 0.9981636 0.9985514 0.9989056 0.9991905 0.9994292
R&gt;                           MDS19     MDS20     MDS21     MDS22     MDS23
R&gt; Eigenvalue            0.0013464 0.0009864 6.768e-04 5.064e-04 4.008e-04
R&gt; Proportion Explained  0.0001706 0.0001250 8.575e-05 6.417e-05 5.078e-05
R&gt; Cumulative Proportion 0.9995998 0.9997248 9.998e-01 9.999e-01 9.999e-01
R&gt;                           MDS24     MDS25     MDS26     MDS27     MDS28
R&gt; Eigenvalue            2.812e-04 0.0002297 4.689e-05 2.739e-05 3.142e-06
R&gt; Proportion Explained  3.563e-05 0.0000291 5.942e-06 3.471e-06 3.982e-07
R&gt; Cumulative Proportion 1.000e+00 0.9999902 1.000e+00 1.000e+00 1.000e+00</code></pre>
</div>
</div>
<p>It is now necessary to load the environmental data and some setup files that partition the 58 coastal sections (and the species and environmental data that fall within these sections) into bioregions.</p>
<p>The thermal (environmental) data contain various variables, but in the analysis I use only some of them. These data were obtained from many sites along the South African coast, but using interpolation (not included here) I calculated the thermal properties for each of the coastal sections for which seaweed data are available. Consequently we have a data frame with 58 rows and a column for each of the thermal metrics. Before use, I apply <strong>vegan</strong>’s <code>decostand()</code> function to scale the data to zero mean and unit variance.</p>
<p>Four bioregions are recognised for South Africa <span class="citation" data-cites="Bolton2004">(<a href="#ref-Bolton2004" role="doc-biblioref">Bolton and Anderson 2004</a>)</span>, namely the Benguela Marine Province (BMP; coastal sections <strong>1</strong>–<strong>17</strong>), the Benguela-Agulhas Transition Zone (B-ATZ; <strong>18</strong>–<strong>22</strong>), the Agulhas Marine Province (AMP; <strong>19</strong>–<strong>43</strong>/<strong>44</strong>), and the East Coast Transition Zone (ECTZ; <strong>44</strong>/<strong>45</strong>–<strong>58</strong>). My plotting functions partition the data into the bioregions and colour code the figures accordingly so I can see regional patterns in -diversity emerging.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Now comes in the in situ temperatures for the 58 coastal sections</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># (interpolated temperaures as per version 2 of the South African Coastal Temperature Network):</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB743"</span>, <span class="st">"seaweed"</span>, <span class="st">"SeaweedEnv.RData"</span>))</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># I select only some of the thermal vars; the rest</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># are collinear with some of the ones I import:</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>E1 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb5-8"><a href="#cb5-8"></a>  env,</span>
<span id="cb5-9"><a href="#cb5-9"></a>  febMean,</span>
<span id="cb5-10"><a href="#cb5-10"></a>  febRange,</span>
<span id="cb5-11"><a href="#cb5-11"></a>  febSD,</span>
<span id="cb5-12"><a href="#cb5-12"></a>  augMean,</span>
<span id="cb5-13"><a href="#cb5-13"></a>  augRange,</span>
<span id="cb5-14"><a href="#cb5-14"></a>  augSD,</span>
<span id="cb5-15"><a href="#cb5-15"></a>  annMean,</span>
<span id="cb5-16"><a href="#cb5-16"></a>  annRange,</span>
<span id="cb5-17"><a href="#cb5-17"></a>  annSD</span>
<span id="cb5-18"><a href="#cb5-18"></a>)</span>
<span id="cb5-19"><a href="#cb5-19"></a></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co"># Calculate z-scores:</span></span>
<span id="cb5-21"><a href="#cb5-21"></a>E1 <span class="ot">&lt;-</span> <span class="fu">decostand</span>(E1, <span class="at">method =</span> <span class="st">"standardize"</span>)</span>
<span id="cb5-22"><a href="#cb5-22"></a></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co"># Load the coordinates of the coastal sections:</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>sites <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB743"</span>, <span class="st">"seaweed"</span>, <span class="st">"sites.csv"</span>))</span>
<span id="cb5-25"><a href="#cb5-25"></a>sites <span class="ot">&lt;-</span> sites[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)]</span>
<span id="cb5-26"><a href="#cb5-26"></a></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="co"># Load the bioregion definition:</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>bioreg <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb5-29"><a href="#cb5-29"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB743"</span>, <span class="st">"seaweed"</span>, <span class="st">"bioregions.csv"</span>),</span>
<span id="cb5-30"><a href="#cb5-30"></a>  <span class="at">header =</span> <span class="cn">TRUE</span></span>
<span id="cb5-31"><a href="#cb5-31"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="preparation-of-spatial-variables" class="level2" data-number="4"><h2 data-number="4" class="anchored" data-anchor-id="preparation-of-spatial-variables">
<span class="header-section-number">4</span> Preparation of Spatial Variables</h2>
<p>I test the niche difference mechanism as the primary species compositional assembly process operating along South African shores. I suggest that the thermal gradient along the coast provides a suite of abiotic (thermal) conditions from which species can select based on their physiological tolerances, and hence this will structure -diversity. For this mechanism to function one would assume that all species have equal access to all sections along this stretch of coast, thus following Beijerinck’s ‘Law’ that everything is everywhere but the environment selects <span class="citation" data-cites="Sauer1988">(<a href="#ref-Sauer1988" role="doc-biblioref">Sauer 1988</a>)</span> (but see main text!).</p>
<p>The basic approach to a spatial analysis structured around a biological response (<em>e.g.</em>, community structure and composition; <span class="math inline">\(Y\)</span>), environmental variables (<span class="math inline">\(E\)</span>) and their spatial representation (<span class="math inline">\(S\)</span>) involves an analysis of Moran’s eigenvector maps (MEM), followed by db-RDA and variance partitioning. Various literature sources discuss principle behind Moran’s eigenvector maps <span class="citation" data-cites="Dray2006 Dray2012a">(<a href="#ref-Dray2006" role="doc-biblioref">Dray et al. 2006</a>; <a href="#ref-Dray2012a" role="doc-biblioref">Dray et al. 2012</a>)</span>. Worked examples are also presented in the excellent book <em>Numerical Ecology with R</em> <span class="citation" data-cites="Borcard2011">(<a href="#ref-Borcard2011" role="doc-biblioref">Borcard et al. 2011</a>)</span> in Section 7.4. The method followed here has been adapted from these and other sources.</p>
<p>Obtaining the MEMs to use in the analysis is based on the procedure introduced by Borcard and Legendre (2002), which was later modified by <span class="citation" data-cites="Dray2006">Dray et al. (<a href="#ref-Dray2006" role="doc-biblioref">2006</a>)</span>. The basic approach involves:</p>
<ol type="1">
<li><p>Set up a geographic or Euclidean distance matrix representing the pairwise distances between the <span class="math inline">\(n\)</span> sites (<span class="math inline">\(D=[d_{ij}]\)</span>). I already did this when I applied the <code>decostand</code> function earlier.</p></li>
<li><p>Construct a truncated distance matrix by calculating a Minimum Spanning Tree (<span class="math inline">\(S^{\star}\)</span>) and noting the following rules: <span class="math display">\[S^{\star} =\left\{ \begin{array}{rl} 0 &amp; \mbox{if}~i = j \\ d_{ij} &amp; \mbox{if}~d_{ij} \leq t \\ 4t &amp; \mbox{if}~d_{ij} &gt; t \end{array} \right.\]</span> Weighting may be applied if desired, resulting in <span class="math inline">\(S^{\star}_w\)</span>. It is not done here.</p></li>
<li><p>Do a Principal Coordinates Analysis (PCoA) of the truncated distance matrix <span class="math inline">\(S^{\star}\)</span>.</p></li>
</ol>
<p>The spatial properties imprinted on the species and their environment can be specified using a matrix of Euclidean or geographic distances. These coordinates are ‘truncated’ into a square (section <span class="math inline">\(\times\)</span> section) matrix containing non-negative values (<span class="math inline">\(S^{\star}\)</span>). By convention the diagonal values are set to zero. A very basic spatial matrix is binary, where 1 codes for pairs of neighbouring sites while 0 denotes non-connected sites according to the chosen network topology. Such matrices are called ‘binary connectivity matrices’ and relate to graphs made using distance criteria derived from graph theory.</p>
<p>Truncation produced by Minimum Spanning Trees (MST) focuses on the binary relationships between neighbouring sites, discarding any other connections (<em>i.e.</em>, some sites are considered to be neighbours, while for others the relationships are null). One could also choose a Gabriel graph or another kind of network topology. Such matrix representations show section-to-section connectivities. In the case of South Africa’s coastline data, the MST causes sections to be connected only to other sections adjacent to two sides of it: for example, Section <strong>4</strong> is directly connected to <em>only</em> Sections <strong>3</strong> and <strong>5</strong>; sections at the termini of the coastal ‘string’ of sections are each connected to only one other section. The binary connectivity matrices, also called <em>topology-based connectivity matrices</em>, can be produced from Euclidean or geographic coordinates using functions in at least two <strong>R</strong> packages (I start with geographic coordinates). One option is to use the <strong>spdep</strong> package’s <code>mst.nb()</code> function to calculate a MST, but there are also options in the <strong>vegan</strong> package and elsewhere. The neighbours list arrived at from the MST represents the spatial component, <span class="math inline">\(S^{\star}\)</span>. The MST results in small connectivity artefacts in the Saldanha Bay region where the closest sections are not necessarily the ones adjacent one-another following along the path around the coast, because sections at opposite sides of the bay may in fact be closer together. This topological inconsistency does not affect the spatial analysis in any way.</p>
<p>Once the truncated distance matrix has been prepared, it is subjected to a PCoA and I keep the eigenvectors that represent positive spatial correlation (positive Moran’s <span class="math inline">\(I\)</span>). For the MEM analysis I use the function <code>PCNM()</code> that resides in the <code>functions</code> folder in the file <code>PCNM.R</code> (see notes inside about authorship). PCNM stands for Principal Coordinates Analysis of Neighbourhood Matrices (the neighbourhood matrix in this instance being the MST). This method automatically constructs the spatial variables and calculates the Moran’s I for each. The MEMs are completely orthogonal and represent the spatial structures over the full range of scales from 50 to 2,700 km. The large eigenvectors represent broad spatial scales while smaller ones cover finer features. The <em>spatial data</em> will be used as a set of explanatory variables in the multiple regression type analyses applied to a species dissimilarity matrix [<em>i.e.</em>, the db-RDA; <span class="citation" data-cites="Dray2012a">Dray et al. (<a href="#ref-Dray2012a" role="doc-biblioref">2012</a>)</span>]</p>
<p>The code below reproduces the spatial analysis in the paper. Due to the length of the output I have prevented the script from returning any output here; rather, if the reader is for some odd reason interested in repeating this analysis, s/he may find the data and scripts in my <a href="https://github.com/ajsmit/Seaweed-beta">GitHub</a> repository, and the full code can be run in its entirety. Well, I hope this will work, but if it does not (probably very likely) then write to me at <a href="mailto:ajsmit@uwc.ac.za" class="email">ajsmit@uwc.ac.za</a> and I shall assist — this may depend on if your email has a catchy title that will make it stand out from among all the other emails which other people think are equally important.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="do">## Auto PCNM:</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>S.auto <span class="ot">&lt;-</span> <span class="fu">PCNM</span>(<span class="fu">dist</span>(sites), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="two_oceans_appendices_files/figure-html/code-pcnm-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="two_oceans_appendices_files/figure-html/code-pcnm-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># summary(S.auto)</span></span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># The truncation distance:</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>S.dmin <span class="ot">&lt;-</span> S.auto<span class="sc">$</span>thresh</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co"># The number of eigenvalues:</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>S.len <span class="ot">&lt;-</span> <span class="fu">length</span>(S.auto<span class="sc">$</span>values)</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># Expected value of I, no spatial correlation:</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>S.auto<span class="sc">$</span>expected_Moran</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] -0.01754386</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Select eigenfunction with positive spatial correlation:</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>S.sel <span class="ot">&lt;-</span> <span class="fu">which</span>(S.auto<span class="sc">$</span>Moran_I<span class="sc">$</span>Positive <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co"># length(S.sel)</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># there are 27 MEMs, i.e. 27 of the PCNM variables (eigenvalues) relate</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co"># significantly to Moran's I</span></span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co"># Extract the eigenvectors associated with those MEMs:</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>S.pos <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.auto<span class="sc">$</span>vectors)[, S.sel]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The code below lets us visualise the configuration of the 58 coastal sections as represented by the minimum spanning tree. Because the sites are constrained by the coast the MST network topology results in a string of coastal sections arranged along the shore between Section <strong>1</strong> and Section <strong>58</strong>. This spatial network therefore also captures the spatial connectivity in the seaweed’s dispersal ability along the shore, although no directionality is associated with dispersal. In the paper I discuss the possible influence of ocean currents <span class="citation" data-cites="Wernberg2013">(<em>e.g.</em>, <a href="#ref-Wernberg2013" role="doc-biblioref">Wernberg et al. 2013</a>)</span> and I pointed out that it is tempting to assume that seaweeds would disperse in the direction the major ocean currents. These kinds of networks could conceivably be configured to model dispersal due to currents, but here it is simply used for representing the spatial scale of the study region.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># The spatial netwwork topology of the coastal sections can be seen by:</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">plot</span>(S.auto<span class="sc">$</span>spanning, sites)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-plot-mst" class="quarto-float quarto-figure quarto-figure-center anchored" width="75%" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-plot-mst-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="two_oceans_appendices_files/figure-html/fig-plot-mst-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;1: "><img src="two_oceans_appendices_files/figure-html/fig-plot-mst-1.svg" id="fig-plot-mst" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-plot-mst-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption></figure>
</div>
</div>
</div>
</section><section id="db-rda-on-morans-eigenvector-maps" class="level2" data-number="5"><h2 data-number="5" class="anchored" data-anchor-id="db-rda-on-morans-eigenvector-maps">
<span class="header-section-number">5</span> db-RDA on Moran’s Eigenvector Maps</h2>
<p>The next step of the spatial analysis is to apply a db-RDA with the seaweed data (<span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span>) coupled with the MEMs. I now run a full (global) db-RDA on the significant, positive MEMs selected above, and I then perform a permutation test to see if the fit is significant.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>S.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., S.pos)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># Permutation test to test for the significance of the global fit:</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="fu">anova</span>(S.Y1.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes, significant!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ V1 + V2 + V3 + V4 + V5 + V6 + V7 + V8 + V9 + V10 + V11 + V12 + V13 + V14 + V15 + V16 + V17 + V18 + V19 + V20 + V21 + V22 + V23 + V24 + V25 + V26 + V27, data = S.pos)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model    27   7.7090 46.715  0.001 ***
R&gt; Residual 30   0.1834                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># The global adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>S.Y1.cs.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y1.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># Variance explained by full model:</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="fu">sum</span>(S.Y1.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y1.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 102.4669</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># And on the Y2 data (uncommented, but same as above):</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>S.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., S.pos)</span>
<span id="cb15-3"><a href="#cb15-3"></a>S.Y2.cs.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y2.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="fu">sum</span>(S.Y2.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y2.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 128.8837</code></pre>
</div>
</div>
<p><strong>Initial analysis (pre-2017):</strong> Since the analysis is significant, I compute the adjusted <em>R</em><sup>2</sup> and run forward selection of the MEMs. The forward selection procedure of <span class="citation" data-cites="Blanchet2008">Blanchet et al. (<a href="#ref-Blanchet2008" role="doc-biblioref">2008</a>)</span> is implemented in the <strong>packfor</strong> package for R, and I use it to reduce the number of MEM variables and retain only those that best fit the biotic data. Forward selection prevents the inflation of the overall type I error and reduces the number of explanatory variables used in the final model, which improves parsimony. I then run a new db-RDA analysis on the ‘best’ (reduced) set of MEM variables that was selected.</p>
<p><strong>Update (2024):</strong> The <strong>packfor</strong> package is no longer available so I have updated my methods to use <strong>vegan</strong>’s <code>ordiR2step()</code> function instead. This function is a stepwise model selection procedure that uses adjusted <em>R</em><sup>2</sup> as the criterion (as in <strong>packfor</strong>) for selecting the best model. I run the forward selection procedure on the full model and retain the significant (‘best’, reduced) MEMs in the final model. I then use only the retained MEMs in subsequent steps.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>S.Y1.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>, S.pos) <span class="co"># a null model</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>S.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., S.pos)</span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a>S.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(S.Y1.cs.null, S.Y1.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co"># the significant MEMs to retain are</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="fu">as.data.frame</span>(S.Y1.fwd<span class="sc">$</span>anova)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;                    R2.adj Df         AIC         F Pr(&gt;F)
R&gt; + V5            0.3251656  1  98.9761247 28.465163  0.002
R&gt; + V2            0.5622793  1  74.8236384 31.335263  0.002
R&gt; + V3            0.7600250  1  40.8987168 46.321422  0.002
R&gt; + V4            0.8031944  1  30.3120901 12.844949  0.002
R&gt; + V6            0.8477448  1  16.3211393 16.507948  0.002
R&gt; + V1            0.8656661  1   9.9315617  7.937262  0.008
R&gt; + V8            0.8790257  1   4.7075038  6.632087  0.010
R&gt; + V7            0.8904243  1  -0.2041116  6.201277  0.016
R&gt; + V10           0.8980274  1  -3.5708726  4.653429  0.022
R&gt; + V16           0.9059119  1  -7.4594140  5.022389  0.008
R&gt; + V15           0.9114028  1 -10.1943398  3.912828  0.044
R&gt; &lt;All variables&gt; 0.9558585 NA          NA        NA     NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>S.Y1.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(S.Y1.fwd)<span class="sc">$</span>biplot))]</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">names</span>(S.Y1.red) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^V"</span>, <span class="st">"MEM"</span>, <span class="fu">names</span>(S.Y1.red)) <span class="co"># rename them</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Run the db-RDA on the Y2 data:</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>S.Y2.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> <span class="dv">1</span>, S.pos) <span class="co"># a null model</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>S.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., S.pos)</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a>S.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(S.Y2.cs.null, S.Y2.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co"># the significant MEMs to retain are</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="fu">as.data.frame</span>(S.Y2.fwd<span class="sc">$</span>anova)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;                    R2.adj Df        AIC         F Pr(&gt;F)
R&gt; + V5            0.3013484  1  -81.77292 25.585731  0.002
R&gt; + V1            0.3960224  1  -89.26366  9.778047  0.004
R&gt; + V3            0.4896651  1  -98.09917 11.092093  0.004
R&gt; + V2            0.5288542  1 -101.81749  5.491629  0.014
R&gt; + V6            0.5605300  1 -104.95897  4.820089  0.024
R&gt; + V7            0.5841156  1 -107.28462  3.949022  0.046
R&gt; + V20           0.6029426  1 -109.12012  3.418240  0.040
R&gt; &lt;All variables&gt; 0.6762573 NA         NA        NA     NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>S.Y2.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(S.Y2.fwd)<span class="sc">$</span>biplot))]</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">names</span>(S.Y2.red) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^V"</span>, <span class="st">"MEM"</span>, <span class="fu">names</span>(S.Y2.red)) <span class="co"># rename them</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now I run a new db-RDA analysis on the ‘best’ (reduced) set of MEM variables that was selected.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Run a new db-RDA on the best MEM variables:</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>S.Y1.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., <span class="at">data =</span> S.Y1.red)</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="co"># no need to check these for collinearity as the</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co"># MEMs are completely orthogonal..</span></span>
<span id="cb23-5"><a href="#cb23-5"></a></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co"># Permutation test to test for significance:</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">parallel =</span> <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15, data = S.Y1.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model    11   7.3281 54.306  0.001 ***
R&gt; Residual 46   0.5643                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Test by axis:</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Forward tests for axes
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15, data = S.Y1.red)
R&gt;          Df SumOfSqs        F Pr(&gt;F)    
R&gt; CAP1      1   5.6871 463.5893  0.001 ***
R&gt; CAP2      1   1.4356 119.5655  0.001 ***
R&gt; CAP3      1   0.1493  12.6981  0.001 ***
R&gt; CAP4      1   0.0194   1.6850  0.987    
R&gt; CAP5      1   0.0136   1.2067  0.997    
R&gt; CAP6      1   0.0094   0.8453  0.999    
R&gt; CAP7      1   0.0078   0.7178  0.999    
R&gt; CAP8      1   0.0032   0.3032  1.000    
R&gt; CAP9      1   0.0024   0.1921           
R&gt; CAP10     1   0.0004   0.0332           
R&gt; CAP11     1   0.0000   0.0033           
R&gt; Residual 46   0.5643                    
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># The significant axes:</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>S.Y1.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a>S.Y1.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y1.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb27-4"><a href="#cb27-4"></a>S.Y1.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y1.red[, S.Y1.ax])</span>
<span id="cb27-5"><a href="#cb27-5"></a></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co"># Test by terms:</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Terms added sequentially (first to last)
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15, data = S.Y1.red)
R&gt;          Df SumOfSqs        F Pr(&gt;F)    
R&gt; MEM5      1  2.65977 216.8157  0.001 ***
R&gt; MEM2      1  1.89917 154.8140  0.001 ***
R&gt; MEM3      1  1.53915 125.4665  0.001 ***
R&gt; MEM4      1  0.35003  28.5331  0.001 ***
R&gt; MEM6      1  0.34802  28.3691  0.001 ***
R&gt; MEM1      1  0.14764  12.0347  0.001 ***
R&gt; MEM8      1  0.11109   9.0557  0.001 ***
R&gt; MEM7      1  0.09409   7.6696  0.003 ** 
R&gt; MEM10     1  0.06570   5.3559  0.012 *  
R&gt; MEM16     1  0.06543   5.3337  0.015 *  
R&gt; MEM15     1  0.04800   3.9128  0.032 *  
R&gt; Residual 46  0.56430                    
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># S.Y1.s2.R2 &lt;- RsquareAdj(S.Y1.s2)$adj.r.squared</span></span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co"># Variance explained by reduced model:</span></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="fu">sum</span>(S.Y1.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y1.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 97.40344</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Show only the first 6 rows:</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="fu">scores</span>(S.Y1.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;             CAP1       CAP2        CAP3        CAP4
R&gt; MEM5 -0.67457167  0.2200339 -0.03399924 -0.02861473
R&gt; MEM2 -0.56541397  0.2274806 -0.15335856 -0.22854014
R&gt; MEM3  0.41248244  0.6093916 -0.49482419 -0.18805595
R&gt; MEM4 -0.06065301  0.4540869  0.42800507  0.34429595
R&gt; MEM6  0.08179483  0.4487126  0.31322362 -0.36562510
R&gt; MEM1  0.08273951 -0.2157100  0.45710145 -0.67050680</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>S.Y2.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., <span class="at">data =</span> S.Y2.red)</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes, significant!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ MEM5 + MEM1 + MEM3 + MEM2 + MEM6 + MEM7 + MEM20, data = S.Y2.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     7  0.22018 13.365  0.001 ***
R&gt; Residual 50  0.11767                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Forward tests for axes
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ MEM5 + MEM1 + MEM3 + MEM2 + MEM6 + MEM7 + MEM20, data = S.Y2.red)
R&gt;          Df SumOfSqs       F Pr(&gt;F)    
R&gt; CAP1      1 0.198438 84.3180  0.001 ***
R&gt; CAP2      1 0.017833  7.7292  0.045 *  
R&gt; CAP3      1 0.001448  0.6401  0.998    
R&gt; CAP4      1 0.001171  0.5274  0.998    
R&gt; CAP5      1 0.001086  0.4985  0.998    
R&gt; CAP6      1 0.000190  0.0887  1.000    
R&gt; CAP7      1 0.000012  0.0052           
R&gt; Residual 50 0.117672                   
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>S.Y2.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb37-2"><a href="#cb37-2"></a>S.Y2.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y2.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb37-3"><a href="#cb37-3"></a>S.Y2.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y2.red[, S.Y2.ax])</span>
<span id="cb37-4"><a href="#cb37-4"></a>S.Y2.s2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y2.s2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="fu">sum</span>(S.Y2.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y2.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 101.2453</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">scores</span>(S.Y2.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;              CAP1        CAP2       CAP3        CAP4
R&gt; MEM5  -0.72858408  0.15326636  0.1394231  0.26049797
R&gt; MEM1   0.41700664 -0.08014806 -0.2927086 -0.11028303
R&gt; MEM3  -0.39934920 -0.29932937 -0.3505844  0.13307416
R&gt; MEM2  -0.03297536 -0.91702626  0.1807603  0.08401846
R&gt; MEM6  -0.23879815  0.06266243 -0.7124017 -0.17630590
R&gt; MEM7   0.21035185 -0.09360481 -0.4706981  0.51236779
R&gt; MEM20  0.18284169  0.16389644  0.1011254  0.77563271
R&gt; attr(,"const")
R&gt; [1] 1.876372</code></pre>
</div>
</div>
</section><section id="a-few-visualisations" class="level2" data-number="6"><h2 data-number="6" class="anchored" data-anchor-id="a-few-visualisations">
<span class="header-section-number">6</span> A Few Visualisations</h2>
<p>Now I make a visualisation to reveal the spatial arrangement of the MEMs used in the final db-RDA involving the spatial variables (<em>i.e.</em>, and ). The spatial configuration relates to broad scales as seen in Fig. 3 in the paper. Here are plots of the site scores for the MEMs and <span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span> (a few panels belonging with Fig. 3):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Build a simple South Africa basemap using Natural Earth polygons.</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>sa_basemap <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb41-3"><a href="#cb41-3"></a>  sa_lats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">35.5</span>, <span class="sc">-</span><span class="dv">26</span>)</span>
<span id="cb41-4"><a href="#cb41-4"></a>  sa_lons <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">34</span>)</span>
<span id="cb41-5"><a href="#cb41-5"></a>  sa_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(</span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="fu">c</span>(<span class="at">xmin =</span> sa_lons[<span class="dv">1</span>], <span class="at">xmax =</span> sa_lons[<span class="dv">2</span>], <span class="at">ymin =</span> sa_lats[<span class="dv">1</span>], <span class="at">ymax =</span> sa_lats[<span class="dv">2</span>]),</span>
<span id="cb41-7"><a href="#cb41-7"></a>    <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)</span>
<span id="cb41-8"><a href="#cb41-8"></a>  )</span>
<span id="cb41-9"><a href="#cb41-9"></a>  sa_world <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb41-10"><a href="#cb41-10"></a>  sa_world <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(sa_world, sa_bbox)</span>
<span id="cb41-11"><a href="#cb41-11"></a></span>
<span id="cb41-12"><a href="#cb41-12"></a>  <span class="cf">function</span>() {</span>
<span id="cb41-13"><a href="#cb41-13"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>      <span class="fu">geom_sf</span>(</span>
<span id="cb41-15"><a href="#cb41-15"></a>        <span class="at">data =</span> sa_world,</span>
<span id="cb41-16"><a href="#cb41-16"></a>        <span class="at">fill =</span> <span class="st">"#F9FAEC"</span>,</span>
<span id="cb41-17"><a href="#cb41-17"></a>        <span class="at">col =</span> <span class="st">"#F9FAEC"</span>,</span>
<span id="cb41-18"><a href="#cb41-18"></a>        <span class="at">linewidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb41-19"><a href="#cb41-19"></a>        <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb41-20"><a href="#cb41-20"></a>      ) <span class="sc">+</span></span>
<span id="cb41-21"><a href="#cb41-21"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> sa_lons, <span class="at">ylim =</span> sa_lats, <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb41-22"><a href="#cb41-22"></a>      <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb41-23"><a href="#cb41-23"></a>      <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb41-24"><a href="#cb41-24"></a>      <span class="fu">theme</span>(</span>
<span id="cb41-25"><a href="#cb41-25"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb41-26"><a href="#cb41-26"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb41-27"><a href="#cb41-27"></a>      )</span>
<span id="cb41-28"><a href="#cb41-28"></a>  }</span>
<span id="cb41-29"><a href="#cb41-29"></a>})</span>
<span id="cb41-30"><a href="#cb41-30"></a></span>
<span id="cb41-31"><a href="#cb41-31"></a><span class="co"># Plot the first canonical axis of the db-RDA with the significant MEMs for Y1;</span></span>
<span id="cb41-32"><a href="#cb41-32"></a><span class="co"># (see Fig. 3):</span></span>
<span id="cb41-33"><a href="#cb41-33"></a>S.Y1.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y1.s2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb41-34"><a href="#cb41-34"></a>S.Y1.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb41-35"><a href="#cb41-35"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb41-36"><a href="#cb41-36"></a>    <span class="at">data =</span> sites,</span>
<span id="cb41-37"><a href="#cb41-37"></a>    <span class="fu">aes</span>(</span>
<span id="cb41-38"><a href="#cb41-38"></a>      <span class="at">x =</span> Longitude,</span>
<span id="cb41-39"><a href="#cb41-39"></a>      <span class="at">y =</span> Latitude,</span>
<span id="cb41-40"><a href="#cb41-40"></a>      <span class="at">size =</span> <span class="fu">abs</span>(S.Y1.axes[, <span class="dv">1</span>]),</span>
<span id="cb41-41"><a href="#cb41-41"></a>      <span class="at">col =</span> <span class="fu">ifelse</span>(S.Y1.axes[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)</span>
<span id="cb41-42"><a href="#cb41-42"></a>    ),</span>
<span id="cb41-43"><a href="#cb41-43"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb41-44"><a href="#cb41-44"></a>  ) <span class="sc">+</span></span>
<span id="cb41-45"><a href="#cb41-45"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb41-46"><a href="#cb41-46"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">guide =</span> <span class="st">"none"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"grey60"</span>)) <span class="sc">+</span></span>
<span id="cb41-47"><a href="#cb41-47"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of spatial variables, "</span>, beta[sim])))</span>
<span id="cb41-48"><a href="#cb41-48"></a></span>
<span id="cb41-49"><a href="#cb41-49"></a><span class="co"># And the same for Y2 (see Fig. 3):</span></span>
<span id="cb41-50"><a href="#cb41-50"></a>S.Y2.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y2.s2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb41-51"><a href="#cb41-51"></a>S.Y2.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb41-52"><a href="#cb41-52"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb41-53"><a href="#cb41-53"></a>    <span class="at">data =</span> sites,</span>
<span id="cb41-54"><a href="#cb41-54"></a>    <span class="fu">aes</span>(</span>
<span id="cb41-55"><a href="#cb41-55"></a>      <span class="at">x =</span> Longitude,</span>
<span id="cb41-56"><a href="#cb41-56"></a>      <span class="at">y =</span> Latitude,</span>
<span id="cb41-57"><a href="#cb41-57"></a>      <span class="at">size =</span> <span class="fu">abs</span>(S.Y2.axes[, <span class="dv">1</span>]),</span>
<span id="cb41-58"><a href="#cb41-58"></a>      <span class="at">col =</span> <span class="fu">ifelse</span>(S.Y2.axes[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)</span>
<span id="cb41-59"><a href="#cb41-59"></a>    ),</span>
<span id="cb41-60"><a href="#cb41-60"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb41-61"><a href="#cb41-61"></a>  ) <span class="sc">+</span></span>
<span id="cb41-62"><a href="#cb41-62"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb41-63"><a href="#cb41-63"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">guide =</span> <span class="st">"none"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"grey60"</span>)) <span class="sc">+</span></span>
<span id="cb41-64"><a href="#cb41-64"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of spatial variables, "</span>, beta[sne])))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now that I know that spatial structures are present in the seaweed data I check how these significant spatial patterns (two significant canonical axes, CAP1 and CAP2) are related to the environmental variables using linear regression. Checks for normality are also done but none of the output is printed here.</p>
<p>Next I want to show the ordination biplots of the MEM variables with respect to the sites using scaling = 2 (species) and showing the LC scores. Now I can see the major directions of influence of the spatial variables with respect to the sites. The code below produces a few panels of Fig. 2 (the figure is reproduced at the end of this document):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># A few of the panels that go with Fig. 2;</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="co"># first for Y1...:</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>S.Y1.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y1.s2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>, <span class="st">"wa"</span>, <span class="st">"lc"</span>, <span class="st">"bp"</span>, <span class="st">"cn"</span>))</span>
<span id="cb42-4"><a href="#cb42-4"></a>S.Y1.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(S.Y1.scrs<span class="sc">$</span>constraints)</span>
<span id="cb42-5"><a href="#cb42-5"></a>S.Y1.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb42-6"><a href="#cb42-6"></a>S.Y1.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb42-7"><a href="#cb42-7"></a><span class="fu">colnames</span>(S.Y1.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb42-8"><a href="#cb42-8"></a></span>
<span id="cb42-9"><a href="#cb42-9"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(S.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb42-10"><a href="#cb42-10"></a>S.Y1.bp <span class="ot">&lt;-</span> S.Y1.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb42-11"><a href="#cb42-11"></a>S.Y1.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y1.bp)</span>
<span id="cb42-12"><a href="#cb42-12"></a>S.Y1.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y1.bp)</span>
<span id="cb42-13"><a href="#cb42-13"></a><span class="fu">colnames</span>(S.Y1.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb42-14"><a href="#cb42-14"></a>S.Y1.bp.sign <span class="ot">&lt;-</span> S.Y1.bp[S.Y1.bp<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y1.sign.ax, ]</span>
<span id="cb42-15"><a href="#cb42-15"></a></span>
<span id="cb42-16"><a href="#cb42-16"></a><span class="co"># A modification of the vegan ordiArrowTextXY() function to prevent the</span></span>
<span id="cb42-17"><a href="#cb42-17"></a><span class="co"># "plot.new has not been called yet" from occurring</span></span>
<span id="cb42-18"><a href="#cb42-18"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"text_mult.R"</span>))</span>
<span id="cb42-19"><a href="#cb42-19"></a></span>
<span id="cb42-20"><a href="#cb42-20"></a>S.Y1.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(S.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb42-21"><a href="#cb42-21"></a>S.Y1.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y1.text)</span>
<span id="cb42-22"><a href="#cb42-22"></a>S.Y1.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y1.text)</span>
<span id="cb42-23"><a href="#cb42-23"></a><span class="fu">colnames</span>(S.Y1.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb42-24"><a href="#cb42-24"></a>S.Y1.text.sign <span class="ot">&lt;-</span> S.Y1.text[S.Y1.text<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y1.sign.ax, ]</span>
<span id="cb42-25"><a href="#cb42-25"></a></span>
<span id="cb42-26"><a href="#cb42-26"></a>S.Y1.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> S.Y1.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span></span>
<span id="cb42-27"><a href="#cb42-27"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span></span>
<span id="cb42-28"><a href="#cb42-28"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb42-29"><a href="#cb42-29"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb42-30"><a href="#cb42-30"></a>    <span class="at">data =</span> S.Y1.bp,</span>
<span id="cb42-31"><a href="#cb42-31"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb42-32"><a href="#cb42-32"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)),</span>
<span id="cb42-33"><a href="#cb42-33"></a>    <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb42-34"><a href="#cb42-34"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb42-35"><a href="#cb42-35"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb42-36"><a href="#cb42-36"></a>  ) <span class="sc">+</span></span>
<span id="cb42-37"><a href="#cb42-37"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb42-38"><a href="#cb42-38"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(S.Y1.text),</span>
<span id="cb42-39"><a href="#cb42-39"></a>    <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(S.Y1.text)),</span>
<span id="cb42-40"><a href="#cb42-40"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb42-41"><a href="#cb42-41"></a>  ) <span class="sc">+</span></span>
<span id="cb42-42"><a href="#cb42-42"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span></span>
<span id="cb42-43"><a href="#cb42-43"></a>  <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span></span>
<span id="cb42-44"><a href="#cb42-44"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Spatial variables and "</span>, beta[sim]))) <span class="sc">+</span></span>
<span id="cb42-45"><a href="#cb42-45"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb42-46"><a href="#cb42-46"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-47"><a href="#cb42-47"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb42-48"><a href="#cb42-48"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb42-49"><a href="#cb42-49"></a>    <span class="at">aspect.ratio =</span> <span class="fl">0.8</span></span>
<span id="cb42-50"><a href="#cb42-50"></a>  )</span>
<span id="cb42-51"><a href="#cb42-51"></a></span>
<span id="cb42-52"><a href="#cb42-52"></a><span class="co"># ...then for Y2:</span></span>
<span id="cb42-53"><a href="#cb42-53"></a>S.Y2.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y2.s2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>, <span class="st">"wa"</span>, <span class="st">"lc"</span>, <span class="st">"bp"</span>, <span class="st">"cn"</span>))</span>
<span id="cb42-54"><a href="#cb42-54"></a>S.Y2.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(S.Y2.scrs<span class="sc">$</span>constraints)</span>
<span id="cb42-55"><a href="#cb42-55"></a>S.Y2.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb42-56"><a href="#cb42-56"></a>S.Y2.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb42-57"><a href="#cb42-57"></a><span class="fu">colnames</span>(S.Y2.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb42-58"><a href="#cb42-58"></a></span>
<span id="cb42-59"><a href="#cb42-59"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(S.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.25</span>)</span>
<span id="cb42-60"><a href="#cb42-60"></a>S.Y2.bp <span class="ot">&lt;-</span> S.Y2.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb42-61"><a href="#cb42-61"></a>S.Y2.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y2.bp)</span>
<span id="cb42-62"><a href="#cb42-62"></a>S.Y2.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y2.bp)</span>
<span id="cb42-63"><a href="#cb42-63"></a><span class="fu">colnames</span>(S.Y2.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb42-64"><a href="#cb42-64"></a>S.Y2.bp.sign <span class="ot">&lt;-</span> S.Y2.bp[S.Y2.bp<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y2.sign.ax, ]</span>
<span id="cb42-65"><a href="#cb42-65"></a></span>
<span id="cb42-66"><a href="#cb42-66"></a>S.Y2.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(S.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.25</span>)</span>
<span id="cb42-67"><a href="#cb42-67"></a>S.Y2.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y2.text)</span>
<span id="cb42-68"><a href="#cb42-68"></a>S.Y2.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y2.text)</span>
<span id="cb42-69"><a href="#cb42-69"></a><span class="fu">colnames</span>(S.Y2.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb42-70"><a href="#cb42-70"></a>S.Y2.text.sign <span class="ot">&lt;-</span> S.Y2.text[S.Y2.text<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y2.sign.ax, ]</span>
<span id="cb42-71"><a href="#cb42-71"></a></span>
<span id="cb42-72"><a href="#cb42-72"></a>S.Y2.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> S.Y2.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span></span>
<span id="cb42-73"><a href="#cb42-73"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span></span>
<span id="cb42-74"><a href="#cb42-74"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb42-75"><a href="#cb42-75"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb42-76"><a href="#cb42-76"></a>    <span class="at">data =</span> S.Y2.bp.sign,</span>
<span id="cb42-77"><a href="#cb42-77"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb42-78"><a href="#cb42-78"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)),</span>
<span id="cb42-79"><a href="#cb42-79"></a>    <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb42-80"><a href="#cb42-80"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb42-81"><a href="#cb42-81"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb42-82"><a href="#cb42-82"></a>  ) <span class="sc">+</span></span>
<span id="cb42-83"><a href="#cb42-83"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb42-84"><a href="#cb42-84"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(S.Y2.text.sign),</span>
<span id="cb42-85"><a href="#cb42-85"></a>    <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(S.Y2.text.sign)),</span>
<span id="cb42-86"><a href="#cb42-86"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb42-87"><a href="#cb42-87"></a>  ) <span class="sc">+</span></span>
<span id="cb42-88"><a href="#cb42-88"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span></span>
<span id="cb42-89"><a href="#cb42-89"></a>  <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span></span>
<span id="cb42-90"><a href="#cb42-90"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Spatial variables and "</span>, beta[sne]))) <span class="sc">+</span></span>
<span id="cb42-91"><a href="#cb42-91"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb42-92"><a href="#cb42-92"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-93"><a href="#cb42-93"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb42-94"><a href="#cb42-94"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb42-95"><a href="#cb42-95"></a>    <span class="at">aspect.ratio =</span> <span class="fl">0.8</span></span>
<span id="cb42-96"><a href="#cb42-96"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="analysis-of-the-thermal-variables" class="level2" data-number="7"><h2 data-number="7" class="anchored" data-anchor-id="analysis-of-the-thermal-variables">
<span class="header-section-number">7</span> Analysis of the Thermal Variables</h2>
<p>As before with the spatial variable, I now do a db-RDA involving all the thermal variables (<span class="math inline">\(E\)</span>) followed by forward selection. There is less explanation provided here as the reader should now be familiar with db-RDA — the procedure is the same as with the MEMs, just different explanatory variables are supplied. Another difference is that the thermal variables are not necessarily orthogonal, so I check for collinearity using variance inflation factors (VIF).</p>
<p>I start with the full model and then run forward selection and repeat the db-RDA on the reduced set. Analyses shown for <span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># First Y1:</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>E.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., E1)</span>
<span id="cb43-3"><a href="#cb43-3"></a></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co"># Is the fit significant?</span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="fu">anova</span>(E.Y1.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ febMean + febRange + febSD + augMean + augRange + augSD + annMean + annRange + annSD, data = E1)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     8   6.8640 40.881  0.001 ***
R&gt; Residual 49   1.0284                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>E.Y1.R2a <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y1.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="co"># Variance explained by full model:</span></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="fu">sum</span>(E.Y1.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y1.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 91.23468</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># ...and now Y2:</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>E.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., E1)</span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="fu">anova</span>(E.Y2.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ febMean + febRange + febSD + augMean + augRange + augSD + annMean + annRange + annSD, data = E1)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     8  0.16208 5.6478  0.001 ***
R&gt; Residual 49  0.17577                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>E.Y2.R2a <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y2.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="fu">sum</span>(E.Y2.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y2.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 74.52904</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>E.Y1.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>, E1) <span class="co"># a null model</span></span>
<span id="cb51-4"><a href="#cb51-4"></a></span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb51-6"><a href="#cb51-6"></a>E.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(E.Y1.cs.null, E.Y1.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-7"><a href="#cb51-7"></a>E.Y1.fwd<span class="sc">$</span>anova</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;                  R2.adj Df    AIC        F Pr(&gt;F)   
R&gt; + augMean       0.68890  1 54.065 127.2180  0.002 **
R&gt; + febRange      0.81682  1 24.298  40.1105  0.002 **
R&gt; + febSD         0.83554  1 18.983   7.2578  0.004 **
R&gt; + augSD         0.84473  1 16.561   4.1988  0.016 * 
R&gt; &lt;All variables&gt; 0.84842                             
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Now Y2:</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>E.Y2.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> <span class="dv">1</span>, E1) <span class="co"># a null model</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>E.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(E.Y2.cs.null, E.Y2.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb53-4"><a href="#cb53-4"></a>E.Y2.fwd<span class="sc">$</span>anova</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;                  R2.adj Df     AIC       F Pr(&gt;F)   
R&gt; + annSD         0.31295  1 -82.745 26.9639  0.002 **
R&gt; + annMean       0.34558  1 -84.611  3.7918  0.042 * 
R&gt; &lt;All variables&gt; 0.39479                             
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Write the significant envs to a new object, and</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="co"># identity of significant envs in increasing order;</span></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="co"># first Y1:</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>E.Y1.sign <span class="ot">&lt;-</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(E.Y1.fwd)<span class="sc">$</span>biplot))</span>
<span id="cb55-5"><a href="#cb55-5"></a></span>
<span id="cb55-6"><a href="#cb55-6"></a>E.Y1.red <span class="ot">&lt;-</span> E1[, E.Y1.sign]</span>
<span id="cb55-7"><a href="#cb55-7"></a></span>
<span id="cb55-8"><a href="#cb55-8"></a><span class="co"># Run a new env analysis on the best env variables:</span></span>
<span id="cb55-9"><a href="#cb55-9"></a>E.Y1.cs2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., E.Y1.red)</span>
<span id="cb55-10"><a href="#cb55-10"></a></span>
<span id="cb55-11"><a href="#cb55-11"></a><span class="co"># Check for collinearity:</span></span>
<span id="cb55-12"><a href="#cb55-12"></a><span class="fu">vif.cca</span>(E.Y1.cs2) <span class="co"># seems fine</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;  augMean febRange    febSD    augSD 
R&gt; 1.153254 3.621599 4.172278 1.561752</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Test for significance:</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="fu">anova</span>(E.Y1.cs2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD, data = E.Y1.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     4   6.7530 78.528  0.001 ***
R&gt; Residual 53   1.1394                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Which axes are significant?</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="fu">anova</span>(E.Y1.cs2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Forward tests for axes
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD, data = E.Y1.red)
R&gt;          Df SumOfSqs        F Pr(&gt;F)    
R&gt; CAP1      1   5.5925 260.1358  0.001 ***
R&gt; CAP2      1   1.1231  53.2252  0.001 ***
R&gt; CAP3      1   0.0347   1.6759  0.369    
R&gt; CAP4      1   0.0027   0.1306  0.991    
R&gt; Residual 53   1.1394                    
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># The significant axes:</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>E.Y1.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(E.Y1.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb61-3"><a href="#cb61-3"></a>E.Y1.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(E.Y1.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb61-4"><a href="#cb61-4"></a>E.Y1.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(E.Y1.red[, E.Y1.ax])</span>
<span id="cb61-5"><a href="#cb61-5"></a></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb61-7"><a href="#cb61-7"></a>E.Y1.cs2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y1.cs2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb61-8"><a href="#cb61-8"></a></span>
<span id="cb61-9"><a href="#cb61-9"></a><span class="co"># Variance explained by reduced (final) model:</span></span>
<span id="cb61-10"><a href="#cb61-10"></a><span class="fu">sum</span>(E.Y1.cs2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y1.cs2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 89.7591</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># The biplot scores for constraining variables:</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="fu">scores</span>(E.Y1.cs2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;                 CAP1        CAP2
R&gt; augMean   0.98741583  0.15628849
R&gt; febRange -0.17999916 -0.90243974
R&gt; febSD    -0.08286071 -0.51021047
R&gt; augSD    -0.01956960 -0.07535446
R&gt; attr(,"const")
R&gt; [1] 4.550643</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># ...then Y2</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>E.Y2.sign <span class="ot">&lt;-</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(E.Y2.fwd)<span class="sc">$</span>biplot))</span>
<span id="cb65-3"><a href="#cb65-3"></a>E.Y2.red <span class="ot">&lt;-</span> E1[, E.Y2.sign]</span>
<span id="cb65-4"><a href="#cb65-4"></a></span>
<span id="cb65-5"><a href="#cb65-5"></a>E.Y2.cs2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., E.Y2.red)</span>
<span id="cb65-6"><a href="#cb65-6"></a></span>
<span id="cb65-7"><a href="#cb65-7"></a><span class="fu">vif.cca</span>(E.Y2.cs2) <span class="co"># seems fine</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;    annSD  annMean 
R&gt; 1.090103 1.090103</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="fu">anova</span>(E.Y2.cs2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ annSD + annMean, data = E.Y2.red)
R&gt;          Df SumOfSqs     F Pr(&gt;F)    
R&gt; Model     2  0.12451 16.05  0.001 ***
R&gt; Residual 55  0.21334                 
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>E.Y2.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(E.Y2.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="co"># E.Y2.ax &lt;- which(E.Y2.axis.test[, 4] &lt; 0.05) # doesn't work...</span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="co"># E.Y2.sign.ax &lt;- colnames(E.Y2.red[,E.Y2.ax])</span></span>
<span id="cb69-4"><a href="#cb69-4"></a>E.Y2.sign.ax <span class="ot">&lt;-</span> <span class="st">"annMean"</span> <span class="co"># a manual cheat</span></span>
<span id="cb69-5"><a href="#cb69-5"></a></span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="fu">anova</span>(E.Y2.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Terms added sequentially (first to last)
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ annSD + annMean, data = E.Y2.red)
R&gt;          Df SumOfSqs       F Pr(&gt;F)    
R&gt; annSD     1 0.109804 28.3082  0.001 ***
R&gt; annMean   1 0.014708  3.7918  0.040 *  
R&gt; Residual 55 0.213339                   
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>E.Y2.cs2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y2.cs2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb71-2"><a href="#cb71-2"></a></span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="fu">sum</span>(E.Y2.cs2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y2.cs2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 57.25464</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="fu">scores</span>(E.Y2.cs2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;              CAP1       CAP2
R&gt; annSD   0.9413063  0.3375535
R&gt; annMean 0.5939265 -0.8045193
R&gt; attr(,"const")
R&gt; [1] 1.876372</code></pre>
</div>
</div>
<p>Now I make the remaining panels of Fig. 3, these showing the spatial arrangement associated with the site scores of the environmental variables for <span class="math inline">\(Y1\)</span> and <span class="math inline">\(Y2\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># Plot the two significant canonical axes of the</span></span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="co"># db-RDA with the significant MEMs. This part of Fig. 3:</span></span>
<span id="cb75-3"><a href="#cb75-3"></a>E.Y1.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y1.cs2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb75-4"><a href="#cb75-4"></a>E.Y1.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb75-6"><a href="#cb75-6"></a>    <span class="at">data =</span> sites,</span>
<span id="cb75-7"><a href="#cb75-7"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y1.axes[, <span class="dv">1</span>]),</span>
<span id="cb75-8"><a href="#cb75-8"></a>    <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb75-9"><a href="#cb75-9"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb75-10"><a href="#cb75-10"></a>  ) <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb75-12"><a href="#cb75-12"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of thermal variables, "</span>, beta[sim])))</span>
<span id="cb75-13"><a href="#cb75-13"></a></span>
<span id="cb75-14"><a href="#cb75-14"></a>E.Y1.plt.axis2 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb75-15"><a href="#cb75-15"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb75-16"><a href="#cb75-16"></a>    <span class="at">data =</span> sites,</span>
<span id="cb75-17"><a href="#cb75-17"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y1.axes[, <span class="dv">2</span>]),</span>
<span id="cb75-18"><a href="#cb75-18"></a>    <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb75-19"><a href="#cb75-19"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb75-20"><a href="#cb75-20"></a>  ) <span class="sc">+</span></span>
<span id="cb75-21"><a href="#cb75-21"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb75-22"><a href="#cb75-22"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP2 of thermal variables, "</span>, beta[sim])))</span>
<span id="cb75-23"><a href="#cb75-23"></a></span>
<span id="cb75-24"><a href="#cb75-24"></a>E.Y2.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y2.cs2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb75-25"><a href="#cb75-25"></a></span>
<span id="cb75-26"><a href="#cb75-26"></a>E.Y2.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb75-27"><a href="#cb75-27"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb75-28"><a href="#cb75-28"></a>    <span class="at">data =</span> sites,</span>
<span id="cb75-29"><a href="#cb75-29"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y2.axes[, <span class="dv">1</span>]),</span>
<span id="cb75-30"><a href="#cb75-30"></a>    <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb75-31"><a href="#cb75-31"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb75-32"><a href="#cb75-32"></a>  ) <span class="sc">+</span></span>
<span id="cb75-33"><a href="#cb75-33"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb75-34"><a href="#cb75-34"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of thermal variables, "</span>, beta[sne])))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And now I make the remaining panels of Fig. 2 (below) for Y1 and Y2 and the environmental constraining vectors:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># The ordiplots in Fig. 2:</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>E.Y1.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y1.cs2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>, <span class="st">"wa"</span>, <span class="st">"lc"</span>, <span class="st">"bp"</span>, <span class="st">"cn"</span>))</span>
<span id="cb76-3"><a href="#cb76-3"></a>E.Y1.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(E.Y1.scrs<span class="sc">$</span>constraints)</span>
<span id="cb76-4"><a href="#cb76-4"></a>E.Y1.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb76-5"><a href="#cb76-5"></a>E.Y1.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="fu">colnames</span>(E.Y1.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb76-7"><a href="#cb76-7"></a></span>
<span id="cb76-8"><a href="#cb76-8"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(E.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb76-9"><a href="#cb76-9"></a>E.Y1.bp <span class="ot">&lt;-</span> E.Y1.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb76-10"><a href="#cb76-10"></a>E.Y1.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y1.bp)</span>
<span id="cb76-11"><a href="#cb76-11"></a>E.Y1.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y1.bp)</span>
<span id="cb76-12"><a href="#cb76-12"></a><span class="fu">colnames</span>(E.Y1.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb76-13"><a href="#cb76-13"></a>E.Y1.bp.sign <span class="ot">&lt;-</span> E.Y1.bp[E.Y1.bp<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y1.sign.ax, ]</span>
<span id="cb76-14"><a href="#cb76-14"></a></span>
<span id="cb76-15"><a href="#cb76-15"></a>E.Y1.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(E.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb76-16"><a href="#cb76-16"></a>E.Y1.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y1.text)</span>
<span id="cb76-17"><a href="#cb76-17"></a>E.Y1.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y1.text)</span>
<span id="cb76-18"><a href="#cb76-18"></a><span class="fu">colnames</span>(E.Y1.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb76-19"><a href="#cb76-19"></a>E.Y1.text.sign <span class="ot">&lt;-</span> E.Y1.text[E.Y1.text<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y1.sign.ax, ]</span>
<span id="cb76-20"><a href="#cb76-20"></a></span>
<span id="cb76-21"><a href="#cb76-21"></a>E.Y1.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> E.Y1.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span></span>
<span id="cb76-22"><a href="#cb76-22"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span></span>
<span id="cb76-23"><a href="#cb76-23"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb76-24"><a href="#cb76-24"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb76-25"><a href="#cb76-25"></a>    <span class="at">data =</span> E.Y1.bp.sign,</span>
<span id="cb76-26"><a href="#cb76-26"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb76-27"><a href="#cb76-27"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)),</span>
<span id="cb76-28"><a href="#cb76-28"></a>    <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb76-29"><a href="#cb76-29"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb76-30"><a href="#cb76-30"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb76-31"><a href="#cb76-31"></a>  ) <span class="sc">+</span></span>
<span id="cb76-32"><a href="#cb76-32"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb76-33"><a href="#cb76-33"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(E.Y1.text.sign),</span>
<span id="cb76-34"><a href="#cb76-34"></a>    <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(E.Y1.text.sign)),</span>
<span id="cb76-35"><a href="#cb76-35"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb76-36"><a href="#cb76-36"></a>  ) <span class="sc">+</span></span>
<span id="cb76-37"><a href="#cb76-37"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span></span>
<span id="cb76-38"><a href="#cb76-38"></a>  <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span></span>
<span id="cb76-39"><a href="#cb76-39"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Thermal variables and "</span>, beta[sim]))) <span class="sc">+</span></span>
<span id="cb76-40"><a href="#cb76-40"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb76-41"><a href="#cb76-41"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-42"><a href="#cb76-42"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-43"><a href="#cb76-43"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb76-44"><a href="#cb76-44"></a>    <span class="at">aspect.ratio =</span> <span class="fl">0.8</span></span>
<span id="cb76-45"><a href="#cb76-45"></a>  )</span>
<span id="cb76-46"><a href="#cb76-46"></a></span>
<span id="cb76-47"><a href="#cb76-47"></a>E.Y2.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y2.cs2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>, <span class="st">"wa"</span>, <span class="st">"lc"</span>, <span class="st">"bp"</span>, <span class="st">"cn"</span>))</span>
<span id="cb76-48"><a href="#cb76-48"></a>E.Y2.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(E.Y2.scrs<span class="sc">$</span>constraints)</span>
<span id="cb76-49"><a href="#cb76-49"></a>E.Y2.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb76-50"><a href="#cb76-50"></a>E.Y2.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb76-51"><a href="#cb76-51"></a><span class="fu">colnames</span>(E.Y2.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb76-52"><a href="#cb76-52"></a></span>
<span id="cb76-53"><a href="#cb76-53"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(E.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.45</span>)</span>
<span id="cb76-54"><a href="#cb76-54"></a>E.Y2.bp <span class="ot">&lt;-</span> E.Y2.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb76-55"><a href="#cb76-55"></a>E.Y2.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y2.bp)</span>
<span id="cb76-56"><a href="#cb76-56"></a>E.Y2.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y2.bp)</span>
<span id="cb76-57"><a href="#cb76-57"></a><span class="fu">colnames</span>(E.Y2.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb76-58"><a href="#cb76-58"></a>E.Y2.bp.sign <span class="ot">&lt;-</span> E.Y2.bp[E.Y2.bp<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y2.sign.ax, ]</span>
<span id="cb76-59"><a href="#cb76-59"></a></span>
<span id="cb76-60"><a href="#cb76-60"></a>E.Y2.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(E.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.45</span>)</span>
<span id="cb76-61"><a href="#cb76-61"></a>E.Y2.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y2.text)</span>
<span id="cb76-62"><a href="#cb76-62"></a>E.Y2.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y2.text)</span>
<span id="cb76-63"><a href="#cb76-63"></a><span class="fu">colnames</span>(E.Y2.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb76-64"><a href="#cb76-64"></a>E.Y2.text.sign <span class="ot">&lt;-</span> E.Y2.text[E.Y2.text<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y2.sign.ax, ]</span>
<span id="cb76-65"><a href="#cb76-65"></a></span>
<span id="cb76-66"><a href="#cb76-66"></a>E.Y2.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> E.Y2.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span></span>
<span id="cb76-67"><a href="#cb76-67"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span></span>
<span id="cb76-68"><a href="#cb76-68"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb76-69"><a href="#cb76-69"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb76-70"><a href="#cb76-70"></a>    <span class="at">data =</span> E.Y2.bp.sign,</span>
<span id="cb76-71"><a href="#cb76-71"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb76-72"><a href="#cb76-72"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)),</span>
<span id="cb76-73"><a href="#cb76-73"></a>    <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb76-74"><a href="#cb76-74"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb76-75"><a href="#cb76-75"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb76-76"><a href="#cb76-76"></a>  ) <span class="sc">+</span></span>
<span id="cb76-77"><a href="#cb76-77"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb76-78"><a href="#cb76-78"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(E.Y2.text.sign),</span>
<span id="cb76-79"><a href="#cb76-79"></a>    <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(E.Y2.text.sign)),</span>
<span id="cb76-80"><a href="#cb76-80"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb76-81"><a href="#cb76-81"></a>  ) <span class="sc">+</span></span>
<span id="cb76-82"><a href="#cb76-82"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span></span>
<span id="cb76-83"><a href="#cb76-83"></a>  <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span></span>
<span id="cb76-84"><a href="#cb76-84"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Thermal variables and "</span>, beta[sne]))) <span class="sc">+</span></span>
<span id="cb76-85"><a href="#cb76-85"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb76-86"><a href="#cb76-86"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-87"><a href="#cb76-87"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-88"><a href="#cb76-88"></a>    <span class="at">legend.position.inside =</span> <span class="fu">c</span>(.<span class="dv">80</span>, .<span class="dv">75</span>),</span>
<span id="cb76-89"><a href="#cb76-89"></a>    <span class="at">aspect.ratio =</span> <span class="fl">0.8</span></span>
<span id="cb76-90"><a href="#cb76-90"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Here I now assemble the various panels into what we see produced in Fig. 2 in the paper:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="fu">ggarrange</span>(</span>
<span id="cb77-2"><a href="#cb77-2"></a>  E.Y1.p,</span>
<span id="cb77-3"><a href="#cb77-3"></a>  E.Y2.p,</span>
<span id="cb77-4"><a href="#cb77-4"></a>  S.Y1.p,</span>
<span id="cb77-5"><a href="#cb77-5"></a>  S.Y2.p,</span>
<span id="cb77-6"><a href="#cb77-6"></a>  <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb77-7"><a href="#cb77-7"></a>  <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb77-8"><a href="#cb77-8"></a>  <span class="at">labels =</span> <span class="st">"AUTO"</span>,</span>
<span id="cb77-9"><a href="#cb77-9"></a>  <span class="at">common.legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb77-10"><a href="#cb77-10"></a>  <span class="at">legend =</span> <span class="st">"top"</span></span>
<span id="cb77-11"><a href="#cb77-11"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="two_oceans_appendices_files/figure-html/code-make-fig-2a-d-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="two_oceans_appendices_files/figure-html/code-make-fig-2a-d-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>And I do the same with assembling the panels that form Fig. 3 in the paper:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb78-2"><a href="#cb78-2"></a>grid<span class="sc">::</span><span class="fu">pushViewport</span>(grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout =</span> grid<span class="sc">::</span><span class="fu">grid.layout</span>(<span class="dv">3</span>, <span class="dv">2</span>)))</span>
<span id="cb78-3"><a href="#cb78-3"></a>vplayout <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb78-4"><a href="#cb78-4"></a>  grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout.pos.row =</span> x, <span class="at">layout.pos.col =</span> y)</span>
<span id="cb78-5"><a href="#cb78-5"></a>}</span>
<span id="cb78-6"><a href="#cb78-6"></a><span class="fu">print</span>(E.Y1.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="fu">print</span>(E.Y1.plt.axis2, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb78-8"><a href="#cb78-8"></a><span class="fu">print</span>(E.Y2.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb78-9"><a href="#cb78-9"></a><span class="fu">print</span>(S.Y1.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb78-10"><a href="#cb78-10"></a><span class="fu">print</span>(S.Y2.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">3</span>, <span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="two_oceans_appendices_files/figure-html/fn-make-fig-3a-e-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="two_oceans_appendices_files/figure-html/fn-make-fig-3a-e-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span><strong>MEMs and Their Interpretation</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>MEMs (Moran’s Eigenvector Maps) are spatial variables used to represent different scales of spatial structure in spatial ecological data. They accomplish the following:</p>
<ol type="1">
<li>Account for spatial autocorrelation that might be present due to the nature of ecological processes and geographic proximity of sampling sites (processes at a specific site might be affected by nearly processes, but less so by processes operating further away).</li>
<li>Capture and model spatial patterns that may not be directly accounted for by measured environmental variables.</li>
<li>Separate the effects of pure spatial processes from pure environmental influences on species distributions.</li>
</ol>
<p>In this instance, the MEMs were made from a spatial connectivity matrix that considered the geographic relationships between sampling sites. Here, I used a minimum spanning tree (MST) topology to focus on connections between neighbouring coastal sections.</p>
<p>The insights MEMs provide are:</p>
<ol type="1">
<li>Modelling spatial structures at multiple scales, from broad (large eigenvectors) to fine (smaller eigenvectors).</li>
<li>Identify spatially structured patterns in species communities that may be due to factors beyond measured environmental variables.</li>
<li>Assist with partitioning of variation in community composition into purely spatial, purely environmental, and spatially structured environmental components.</li>
</ol>
<p>The bottom panels (with the spatial structures captured by the MEMs) show the Canonical Analysis of Principal Coordinates (CAP1) of spatial variables for <span class="math inline">\(\beta_{sim}\)</span> (species turnover) and <span class="math inline">\(\beta_{sne}\)</span> (nestedness). We see that:</p>
<ol type="1">
<li>There is a strong spatial gradient along the coast, as indicated by the change in circle size and shading from west to east.</li>
<li>The spatial pattern is similar for both <span class="math inline">\(\beta_{sim}\)</span> and <span class="math inline">\(\beta_{sne}\)</span>, which suggests that both components of <span class="math inline">\(\beta\)</span>-diversity have a strong spatial structure.</li>
<li>The western and eastern ends of the coast show the most distinct spatial patterns (larger circles), indicating stronger spatial effects in these areas.</li>
<li>The middle section of the coast shows smaller circles, suggesting weaker spatial effects or more homogeneous communities in this region.</li>
<li>The differences in patterns between <span class="math inline">\(\beta_{sim}\)</span> and <span class="math inline">\(\beta_{sne}\)</span> suggests that nestedness (neutral-processes) are quite prominent along the west coast.</li>
</ol>
</div>
</div>
</section><section id="partitioning-of-variance" class="level2" data-number="8"><h2 data-number="8" class="anchored" data-anchor-id="partitioning-of-variance">
<span class="header-section-number">8</span> Partitioning of Variance</h2>
<p>Lastly, using <strong>vegan</strong>’s <code>varpart()</code> function, I partition the variance between the MEM variables and the thermal variables <span class="citation" data-cites="Peres-Neto2006 PeresNeto2010">(<a href="#ref-Peres-Neto2006" role="doc-biblioref">Peres-Neto et al. 2006</a>; <a href="#ref-PeresNeto2010" role="doc-biblioref">Peres-Neto and Legendre 2010</a>)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># These lines of code produce a few figures to visually understand</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="co"># the variance partitioning on Y1:</span></span>
<span id="cb79-3"><a href="#cb79-3"></a>vp2.Y1 <span class="ot">&lt;-</span> <span class="fu">varpart</span>(Y1, E.Y1.red, S.Y1.red)</span>
<span id="cb79-4"><a href="#cb79-4"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb79-5"><a href="#cb79-5"></a><span class="fu">showvarparts</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"Environ-</span><span class="sc">\n</span><span class="st">ment"</span>, <span class="st">""</span>, <span class="st">"Spatial"</span>, <span class="st">""</span>))</span>
<span id="cb79-6"><a href="#cb79-6"></a><span class="fu">plot</span>(vp2.Y1, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb79-7"><a href="#cb79-7"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb79-8"><a href="#cb79-8"></a></span>
<span id="cb79-9"><a href="#cb79-9"></a><span class="co"># Now I test the significant fractions [a], [b] and [c]...</span></span>
<span id="cb79-10"><a href="#cb79-10"></a>ES.Y1.red <span class="ot">&lt;-</span> <span class="fu">cbind</span>(E.Y1.red, S.Y1.red)</span>
<span id="cb79-11"><a href="#cb79-11"></a>S.Y1.mem_terms <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y1.red)</span>
<span id="cb79-12"><a href="#cb79-12"></a>S.Y1.env_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"augMean"</span>, <span class="st">"febRange"</span>, <span class="st">"febSD"</span>, <span class="st">"augSD"</span>)</span>
<span id="cb79-13"><a href="#cb79-13"></a>S.Y1.formula.E_given_S <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(</span>
<span id="cb79-14"><a href="#cb79-14"></a>  <span class="fu">paste0</span>(</span>
<span id="cb79-15"><a href="#cb79-15"></a>    <span class="st">"Y1 ~ "</span>,</span>
<span id="cb79-16"><a href="#cb79-16"></a>    <span class="fu">paste</span>(S.Y1.env_terms, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb79-17"><a href="#cb79-17"></a>    <span class="st">" + Condition("</span>,</span>
<span id="cb79-18"><a href="#cb79-18"></a>    <span class="fu">paste</span>(S.Y1.mem_terms, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb79-19"><a href="#cb79-19"></a>    <span class="st">")"</span></span>
<span id="cb79-20"><a href="#cb79-20"></a>  )</span>
<span id="cb79-21"><a href="#cb79-21"></a>)</span>
<span id="cb79-22"><a href="#cb79-22"></a>S.Y1.formula.S_given_E <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(</span>
<span id="cb79-23"><a href="#cb79-23"></a>  <span class="fu">paste0</span>(</span>
<span id="cb79-24"><a href="#cb79-24"></a>    <span class="st">"Y1 ~ "</span>,</span>
<span id="cb79-25"><a href="#cb79-25"></a>    <span class="fu">paste</span>(S.Y1.mem_terms, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb79-26"><a href="#cb79-26"></a>    <span class="st">" + Condition("</span>,</span>
<span id="cb79-27"><a href="#cb79-27"></a>    <span class="fu">paste</span>(S.Y1.env_terms, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb79-28"><a href="#cb79-28"></a>    <span class="st">")"</span></span>
<span id="cb79-29"><a href="#cb79-29"></a>  )</span>
<span id="cb79-30"><a href="#cb79-30"></a>)</span>
<span id="cb79-31"><a href="#cb79-31"></a></span>
<span id="cb79-32"><a href="#cb79-32"></a><span class="co"># Fraction E | S; pure environmental, i.e. [a]:</span></span>
<span id="cb79-33"><a href="#cb79-33"></a><span class="fu">anova.cca</span>(</span>
<span id="cb79-34"><a href="#cb79-34"></a>  <span class="fu">capscale</span>(S.Y1.formula.E_given_S, <span class="at">data =</span> ES.Y1.red),</span>
<span id="cb79-35"><a href="#cb79-35"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb79-36"><a href="#cb79-36"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb79-37"><a href="#cb79-37"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD + Condition(MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15), data = ES.Y1.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     4  0.29839 11.782  0.001 ***
R&gt; Residual 42  0.26592                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># Fraction S | E; pure spatial, i.e. [c]:</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="fu">anova.cca</span>(</span>
<span id="cb81-3"><a href="#cb81-3"></a>  <span class="fu">capscale</span>(S.Y1.formula.S_given_E, <span class="at">data =</span> ES.Y1.red),</span>
<span id="cb81-4"><a href="#cb81-4"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb81-5"><a href="#cb81-5"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb81-6"><a href="#cb81-6"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15 + Condition(augMean + febRange + febSD + augSD), data = ES.Y1.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model    11  0.87350 12.542  0.001 ***
R&gt; Residual 42  0.26592                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># Fraction E; environmental, i.e. [a] + [b]:</span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., E.Y1.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD, data = E.Y1.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     4   6.7530 78.528  0.001 ***
R&gt; Residual 53   1.1394                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># Fractions S; spatial, i.e. [b] + [c]:</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., S.Y1.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15, data = S.Y1.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model    11   7.3281 54.306  0.001 ***
R&gt; Residual 46   0.5643                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># Fractions E + S; spatial and environmental, i.e. [a] + [b] + [c]:</span></span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="fu">anova.cca</span>(</span>
<span id="cb87-3"><a href="#cb87-3"></a>  <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., <span class="fu">cbind</span>(E.Y1.red, S.Y1.red)),</span>
<span id="cb87-4"><a href="#cb87-4"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb87-5"><a href="#cb87-5"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb87-6"><a href="#cb87-6"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y1 ~ augMean + febRange + febSD + augSD + MEM5 + MEM2 + MEM3 + MEM4 + MEM6 + MEM1 + MEM8 + MEM7 + MEM10 + MEM16 + MEM15, data = cbind(E.Y1.red, S.Y1.red))
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model    15   7.6265 80.304  0.001 ***
R&gt; Residual 42   0.2659                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># And now the partitioning of the variance in Y2:</span></span>
<span id="cb89-2"><a href="#cb89-2"></a>(vp2.Y2 <span class="ot">&lt;-</span> <span class="fu">varpart</span>(Y2, E.Y2.red, S.Y2.red))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; 
R&gt; Partition of squared Unknown user-supplied distance in dbRDA 
R&gt; 
R&gt; Call: varpart(Y = Y2, X = E.Y2.red, S.Y2.red)
R&gt; 
R&gt; Explanatory tables:
R&gt; X1:  E.Y2.red
R&gt; X2:  S.Y2.red 
R&gt; 
R&gt; No. of explanatory tables: 2 
R&gt; Total variation (SS): 0.21747 
R&gt; No. of observations: 58 
R&gt; 
R&gt; Partition table:
R&gt;                      Df R.squared Adj.R.squared Testable
R&gt; [a+c] = X1            2   0.22892       0.20089     TRUE
R&gt; [b+c] = X2            7   0.59874       0.54256     TRUE
R&gt; [a+b+c] = X1+X2       9   0.59458       0.51856     TRUE
R&gt; Individual fractions                                    
R&gt; [a] = X1|X2           2                -0.02400     TRUE
R&gt; [b] = X2|X1           7                 0.31768     TRUE
R&gt; [c]                   0                 0.22488    FALSE
R&gt; [d] = Residuals                         0.48144    FALSE
R&gt; ---
R&gt; Use function 'dbrda' to test significance of fractions of interest</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="fu">showvarparts</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"Environ-</span><span class="sc">\n</span><span class="st">ment"</span>, <span class="st">""</span>, <span class="st">"Spatial"</span>, <span class="st">""</span>))</span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="fu">plot</span>(vp2.Y2, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb91-4"><a href="#cb91-4"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb91-5"><a href="#cb91-5"></a></span>
<span id="cb91-6"><a href="#cb91-6"></a><span class="co"># Tests the significant fractions [a], [b] and [c]...</span></span>
<span id="cb91-7"><a href="#cb91-7"></a>ES.Y2.red <span class="ot">&lt;-</span> <span class="fu">cbind</span>(E.Y2.red, S.Y2.red)</span>
<span id="cb91-8"><a href="#cb91-8"></a></span>
<span id="cb91-9"><a href="#cb91-9"></a><span class="co"># Fraction E | S; pure environmental, i.e. [a]:</span></span>
<span id="cb91-10"><a href="#cb91-10"></a><span class="fu">anova.cca</span>(</span>
<span id="cb91-11"><a href="#cb91-11"></a>  <span class="fu">capscale</span>(</span>
<span id="cb91-12"><a href="#cb91-12"></a>    Y2 <span class="sc">~</span></span>
<span id="cb91-13"><a href="#cb91-13"></a>      annMean <span class="sc">+</span></span>
<span id="cb91-14"><a href="#cb91-14"></a>        <span class="fu">Condition</span>(MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3 <span class="sc">+</span> MEM5),</span>
<span id="cb91-15"><a href="#cb91-15"></a>    <span class="at">data =</span> ES.Y2.red</span>
<span id="cb91-16"><a href="#cb91-16"></a>  ),</span>
<span id="cb91-17"><a href="#cb91-17"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb91-18"><a href="#cb91-18"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb91-19"><a href="#cb91-19"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ annMean + Condition(MEM1 + MEM2 + MEM3 + MEM5), data = ES.Y2.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)
R&gt; Model     1  0.00422 1.5263  0.194
R&gt; Residual 52  0.14379</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="co"># Fraction S | E; pure spatial, i.e. [c]:</span></span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="fu">anova.cca</span>(</span>
<span id="cb93-3"><a href="#cb93-3"></a>  <span class="fu">capscale</span>(</span>
<span id="cb93-4"><a href="#cb93-4"></a>    Y2 <span class="sc">~</span> MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3 <span class="sc">+</span> MEM5 <span class="sc">+</span> <span class="fu">Condition</span>(annMean),</span>
<span id="cb93-5"><a href="#cb93-5"></a>    <span class="at">data =</span> ES.Y2.red</span>
<span id="cb93-6"><a href="#cb93-6"></a>  ),</span>
<span id="cb93-7"><a href="#cb93-7"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb93-8"><a href="#cb93-8"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb93-9"><a href="#cb93-9"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ MEM1 + MEM2 + MEM3 + MEM5 + Condition(annMean), data = ES.Y2.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     4  0.14994 13.557  0.001 ***
R&gt; Residual 52  0.14379                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># Fraction E; environmental, i.e. [a] + [b]:</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., E.Y2.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ annSD + annMean, data = E.Y2.red)
R&gt;          Df SumOfSqs     F Pr(&gt;F)    
R&gt; Model     2  0.12451 16.05  0.001 ***
R&gt; Residual 55  0.21334                 
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># Fractions S; spatial, i.e. [b] + [c]:</span></span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., S.Y2.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ MEM5 + MEM1 + MEM3 + MEM2 + MEM6 + MEM7 + MEM20, data = S.Y2.red)
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     7  0.22018 13.365  0.001 ***
R&gt; Residual 50  0.11767                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># Fractions E + S; spatial and environmental, i.e. [a] + [b] + [c]:</span></span>
<span id="cb99-2"><a href="#cb99-2"></a><span class="fu">anova.cca</span>(</span>
<span id="cb99-3"><a href="#cb99-3"></a>  <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., <span class="fu">cbind</span>(E.Y2.red, S.Y2.red)),</span>
<span id="cb99-4"><a href="#cb99-4"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb99-5"><a href="#cb99-5"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb99-6"><a href="#cb99-6"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Permutation test for capscale under reduced model
R&gt; Permutation: free
R&gt; Number of permutations: 999
R&gt; 
R&gt; Model: capscale(formula = Y2 ~ annSD + annMean + MEM5 + MEM1 + MEM3 + MEM2 + MEM6 + MEM7 + MEM20, data = cbind(E.Y2.red, S.Y2.red))
R&gt;          Df SumOfSqs      F Pr(&gt;F)    
R&gt; Model     9  0.22442 10.551  0.001 ***
R&gt; Residual 48  0.11343                  
R&gt; ---
R&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-y1-y2-varpart-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="75%" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-y1-y2-varpart-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="two_oceans_appendices_files/figure-html/fig-y1-y2-varpart-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;2: "><img src="two_oceans_appendices_files/figure-html/fig-y1-y2-varpart-1.svg" id="fig-y1-y2-varpart-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-y1-y2-varpart-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption></figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-y1-y2-varpart-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="75%" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-y1-y2-varpart-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="two_oceans_appendices_files/figure-html/fig-y1-y2-varpart-2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;3: "><img src="two_oceans_appendices_files/figure-html/fig-y1-y2-varpart-2.svg" id="fig-y1-y2-varpart-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-y1-y2-varpart-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption></figure>
</div>
</div>
</div>
</section><section id="network-graphs-of-beta-diversity" class="level2" data-number="9"><h2 data-number="9" class="anchored" data-anchor-id="network-graphs-of-beta-diversity">
<span class="header-section-number">9</span> Network Graphs of <span class="math inline">\(\beta\)</span>-Diversity</h2>
<p>This is Appendix C of the paper <span class="citation" data-cites="smit2017seaweeds">Smit et al. (<a href="#ref-smit2017seaweeds" role="doc-biblioref">2017</a>)</span>.</p>
<p>I delved deeper into the patterns of -diversity by examining the properties of the full dissimilarity matrix, which gives regional -diversity mentioned above. This matrix describes all pairwise combinations of sections (582 — 1 = 3363), and as such gives us a regional perspective <span class="citation" data-cites="Anderson2013">(<a href="#ref-Anderson2013" role="doc-biblioref">Anderson et al. 2013</a>)</span>.</p>
<p>The usual visualisation approach is to plot the dissimilarity metric as a function of geographical distance along the gradient or with respect to the distance between corresponding pairs of sections <span class="citation" data-cites="Nekola1999 Davidar2007">(<em>e.g.</em>, <a href="#ref-Nekola1999" role="doc-biblioref">Nekola et al. 1999</a>; <a href="#ref-Davidar2007" role="doc-biblioref">Davidar et al. 2007</a>)</span>; these visualisations are provided here. The plots of dissimilarities were colour-coded according to the bioregion to which the section pairs belong (the Benguela Marine Province (BMP; <strong>1</strong>–<strong>17</strong>), the Benguela-Agulhas Transition Zone (B-ATZ; <strong>18</strong>–<strong>22</strong>), the Agulhas Marine Province (AMP; <strong>19</strong>–<strong>43</strong>/<strong>44</strong> — the location of this transition is somewhat uncertain at this stage), and the East Coast Transition Zone (ECTZ; <strong>44</strong>/<strong>45</strong>–<strong>58</strong>) <span class="citation" data-cites="Bolton2004">(<em>sensu</em> <a href="#ref-Bolton2004" role="doc-biblioref">Bolton and Anderson 2004</a>)</span> to distinguish bioregional properties of species distribution from the wider geographical scale structure along the whole coastline.</p>
<p>In doing so, the change in <span class="math inline">\(\beta\)</span>-diversity per unit of separating distance between sections (km<sup>-1</sup>) could be calculated for each bioregion using linear regression. Since the connectivity between sections is constrained by their location along the shore, I calculated the distances between sections not as ‘as the crow ﬂies’ distances (<em>e.g.</em>, Section <strong>1</strong> is not connected in a straight line to Section <strong>58</strong> because of the intervening land in-between), but as the great circle geodesic distances between each pair of sections along a network of connected sections (vertices on a network graph). In other words, travelling from Section <strong>1</strong> to Section <strong>58</strong> requires travelling first along the coast through Section <strong>2</strong>, then Section <strong>3</strong>, and eventually all the way up to Section <strong>58</strong>. The total distance between a pair of arbitrary sections is therefore the cumulative sum of the great circle distances between each consecutive pair of intervening sections along the ‘route’. This information is encapsulated as a square geodesic distance matrix, and can supply the distance along the abscissa against which species dissimilarities are plotted along the ordinate. The plots showing the relationship between -diversity with distance are limited because they do not provide a geographical context.</p>
<p>To overcome this problem, I relied on a visualisation technique not commonly found in biogeographical studies to explicitly provide the geographical context. I structured the sections as vertices of a network graph and assigned to them their geographical coordinates to force a familiar layout of the graph — when plotted on geographic coordinates, the sections form a map of South Africa. The species dissimilarities were assigned as edge weights (the lines connecting the <strong>58</strong> coastal sections) between pairs of sections and added to the map. The weights are directly proportional to the thickness of the edges and colours assigned to vertices (points or the 58 coastal sections) cluster the sections into their bioregions. Initially I used the <strong>igraph</strong> package that many people rave about, but I found it bothersome. So I devised a cunning way to create network graphs from scratch with some <strong>dplyr</strong> and <strong>ggplot2</strong> magic. I suppose that if I really wanted to I could have made neat functions here (and elsewhere) to reduce some of the repetitive nature of my code, but I really could not be bother doing that.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># Visualise the pairwise dissimilarities as network graphs where the</span></span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="co"># vertices are geographical coordinates and the edge lengths are the geodesic</span></span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="co"># distances.</span></span>
<span id="cb101-4"><a href="#cb101-4"></a><span class="co"># These visualisations appear in the paper as Fig. 4.</span></span>
<span id="cb101-5"><a href="#cb101-5"></a><span class="fu">colnames</span>(sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>)</span>
<span id="cb101-6"><a href="#cb101-6"></a>sites <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">site =</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)), sites)</span>
<span id="cb101-7"><a href="#cb101-7"></a></span>
<span id="cb101-8"><a href="#cb101-8"></a>Y1.sl <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">expand.grid</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>), <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)))</span>
<span id="cb101-9"><a href="#cb101-9"></a><span class="fu">colnames</span>(Y1.sl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"to"</span>, <span class="st">"from"</span>)</span>
<span id="cb101-10"><a href="#cb101-10"></a></span>
<span id="cb101-11"><a href="#cb101-11"></a>Y2.sl <span class="ot">&lt;-</span> Y1.sl</span>
<span id="cb101-12"><a href="#cb101-12"></a></span>
<span id="cb101-13"><a href="#cb101-13"></a><span class="co"># First Y1:</span></span>
<span id="cb101-14"><a href="#cb101-14"></a>Y1.sl<span class="sc">$</span>Y1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Y1)</span>
<span id="cb101-15"><a href="#cb101-15"></a></span>
<span id="cb101-16"><a href="#cb101-16"></a>Y1.sl.BMP <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb101-17"><a href="#cb101-17"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-18"><a href="#cb101-18"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-19"><a href="#cb101-19"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-20"><a href="#cb101-20"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">16</span>)</span>
<span id="cb101-21"><a href="#cb101-21"></a></span>
<span id="cb101-22"><a href="#cb101-22"></a>Y1.sl.BATZ <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb101-23"><a href="#cb101-23"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-24"><a href="#cb101-24"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-25"><a href="#cb101-25"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-26"><a href="#cb101-26"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">21</span>)</span>
<span id="cb101-27"><a href="#cb101-27"></a></span>
<span id="cb101-28"><a href="#cb101-28"></a>Y1.sl.AMP <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb101-29"><a href="#cb101-29"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-30"><a href="#cb101-30"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-31"><a href="#cb101-31"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-32"><a href="#cb101-32"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">21</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">41</span>)</span>
<span id="cb101-33"><a href="#cb101-33"></a></span>
<span id="cb101-34"><a href="#cb101-34"></a>Y1.sl.ECTZ <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb101-35"><a href="#cb101-35"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-36"><a href="#cb101-36"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-37"><a href="#cb101-37"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-38"><a href="#cb101-38"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">41</span>)</span>
<span id="cb101-39"><a href="#cb101-39"></a></span>
<span id="cb101-40"><a href="#cb101-40"></a>Y1.sl <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Y1.sl.BMP, Y1.sl.BATZ, Y1.sl.AMP, Y1.sl.ECTZ)</span>
<span id="cb101-41"><a href="#cb101-41"></a></span>
<span id="cb101-42"><a href="#cb101-42"></a><span class="co"># and then Y2:</span></span>
<span id="cb101-43"><a href="#cb101-43"></a>Y2.sl<span class="sc">$</span>Y2 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Y2)</span>
<span id="cb101-44"><a href="#cb101-44"></a></span>
<span id="cb101-45"><a href="#cb101-45"></a>Y2.sl.BMP <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb101-46"><a href="#cb101-46"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-47"><a href="#cb101-47"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-48"><a href="#cb101-48"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-49"><a href="#cb101-49"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">16</span>)</span>
<span id="cb101-50"><a href="#cb101-50"></a></span>
<span id="cb101-51"><a href="#cb101-51"></a>Y2.sl.BATZ <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb101-52"><a href="#cb101-52"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-53"><a href="#cb101-53"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-54"><a href="#cb101-54"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-55"><a href="#cb101-55"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">21</span>)</span>
<span id="cb101-56"><a href="#cb101-56"></a></span>
<span id="cb101-57"><a href="#cb101-57"></a>Y2.sl.AMP <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb101-58"><a href="#cb101-58"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-59"><a href="#cb101-59"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-60"><a href="#cb101-60"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-61"><a href="#cb101-61"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">21</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">41</span>)</span>
<span id="cb101-62"><a href="#cb101-62"></a></span>
<span id="cb101-63"><a href="#cb101-63"></a>Y2.sl.ECTZ <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb101-64"><a href="#cb101-64"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-65"><a href="#cb101-65"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-66"><a href="#cb101-66"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-67"><a href="#cb101-67"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">41</span>)</span>
<span id="cb101-68"><a href="#cb101-68"></a></span>
<span id="cb101-69"><a href="#cb101-69"></a>sa_lats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">38</span>, <span class="sc">-</span><span class="dv">26</span>)</span>
<span id="cb101-70"><a href="#cb101-70"></a>sa_lons <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">34</span>)</span>
<span id="cb101-71"><a href="#cb101-71"></a>sa_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(</span>
<span id="cb101-72"><a href="#cb101-72"></a>  <span class="fu">c</span>(<span class="at">xmin =</span> sa_lons[<span class="dv">1</span>], <span class="at">xmax =</span> sa_lons[<span class="dv">2</span>], <span class="at">ymin =</span> sa_lats[<span class="dv">1</span>], <span class="at">ymax =</span> sa_lats[<span class="dv">2</span>]),</span>
<span id="cb101-73"><a href="#cb101-73"></a>  <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)</span>
<span id="cb101-74"><a href="#cb101-74"></a>)</span>
<span id="cb101-75"><a href="#cb101-75"></a>south_africa_coast <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb101-76"><a href="#cb101-76"></a>south_africa_coast <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(south_africa_coast, sa_bbox)</span>
<span id="cb101-77"><a href="#cb101-77"></a></span>
<span id="cb101-78"><a href="#cb101-78"></a>net.plot.Y1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dissim =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">col.seq =</span> <span class="cn">NULL</span>) {</span>
<span id="cb101-79"><a href="#cb101-79"></a>  <span class="fu">ggplot</span>(dissim, <span class="fu">aes</span>(lon.x, lat.x)) <span class="sc">+</span></span>
<span id="cb101-80"><a href="#cb101-80"></a>    <span class="fu">geom_sf</span>(</span>
<span id="cb101-81"><a href="#cb101-81"></a>      <span class="at">data =</span> south_africa_coast,</span>
<span id="cb101-82"><a href="#cb101-82"></a>      <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb101-83"><a href="#cb101-83"></a>      <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb101-84"><a href="#cb101-84"></a>      <span class="at">fill =</span> <span class="st">"#F9FAEC"</span>,</span>
<span id="cb101-85"><a href="#cb101-85"></a>      <span class="at">col =</span> <span class="st">"#F9FAEC"</span></span>
<span id="cb101-86"><a href="#cb101-86"></a>    ) <span class="sc">+</span></span>
<span id="cb101-87"><a href="#cb101-87"></a>    <span class="fu">geom_curve</span>(</span>
<span id="cb101-88"><a href="#cb101-88"></a>      <span class="fu">aes</span>(<span class="at">xend =</span> lon.y, <span class="at">yend =</span> lat.y, <span class="at">col =</span> Y1, <span class="at">alpha =</span> (<span class="dv">1</span> <span class="sc">-</span> Y1) <span class="sc">-</span> <span class="fl">0.4</span>),</span>
<span id="cb101-89"><a href="#cb101-89"></a>      <span class="at">curvature =</span> <span class="fl">0.3</span></span>
<span id="cb101-90"><a href="#cb101-90"></a>    ) <span class="sc">+</span></span>
<span id="cb101-91"><a href="#cb101-91"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb101-92"><a href="#cb101-92"></a>      <span class="at">data =</span> sites,</span>
<span id="cb101-93"><a href="#cb101-93"></a>      <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">fill =</span> bioreg<span class="sc">$</span>bolton),</span>
<span id="cb101-94"><a href="#cb101-94"></a>      <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb101-95"><a href="#cb101-95"></a>      <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb101-96"><a href="#cb101-96"></a>    ) <span class="sc">+</span></span>
<span id="cb101-97"><a href="#cb101-97"></a>    <span class="fu">scale_fill_manual</span>(</span>
<span id="cb101-98"><a href="#cb101-98"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"AMP"</span>, <span class="st">"B-ATZ"</span>, <span class="st">"BMP"</span>, <span class="st">"ECTZ"</span>),</span>
<span id="cb101-99"><a href="#cb101-99"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorchid1"</span>, <span class="st">"aquamarine2"</span>, <span class="st">"blue1"</span>, <span class="st">"orangered1"</span>),</span>
<span id="cb101-100"><a href="#cb101-100"></a>      <span class="at">name =</span> <span class="st">"Bioregion"</span>,</span>
<span id="cb101-101"><a href="#cb101-101"></a>      <span class="at">guide =</span> <span class="cn">FALSE</span></span>
<span id="cb101-102"><a href="#cb101-102"></a>    ) <span class="sc">+</span></span>
<span id="cb101-103"><a href="#cb101-103"></a>    <span class="fu">scale_colour_gradient</span>(</span>
<span id="cb101-104"><a href="#cb101-104"></a>      <span class="at">name =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(beta[sim])),</span>
<span id="cb101-105"><a href="#cb101-105"></a>      <span class="at">low =</span> <span class="st">"antiquewhite4"</span>,</span>
<span id="cb101-106"><a href="#cb101-106"></a>      <span class="at">high =</span> <span class="st">"antiquewhite"</span></span>
<span id="cb101-107"><a href="#cb101-107"></a>    ) <span class="sc">+</span></span>
<span id="cb101-108"><a href="#cb101-108"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> sa_lons, <span class="at">ylim =</span> sa_lats, <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb101-109"><a href="#cb101-109"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">"°E"</span>)) <span class="sc">+</span></span>
<span id="cb101-110"><a href="#cb101-110"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">"°S"</span>)) <span class="sc">+</span></span>
<span id="cb101-111"><a href="#cb101-111"></a>    <span class="fu">scale_alpha_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb101-112"><a href="#cb101-112"></a>    <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb101-113"><a href="#cb101-113"></a>    <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb101-114"><a href="#cb101-114"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb101-115"><a href="#cb101-115"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb101-116"><a href="#cb101-116"></a>    <span class="fu">ggtitle</span>(title)</span>
<span id="cb101-117"><a href="#cb101-117"></a>}</span>
<span id="cb101-118"><a href="#cb101-118"></a></span>
<span id="cb101-119"><a href="#cb101-119"></a>a <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(</span>
<span id="cb101-120"><a href="#cb101-120"></a>  Y1.sl.BMP,</span>
<span id="cb101-121"><a href="#cb101-121"></a>  <span class="st">"Benguela Marine Province"</span>,</span>
<span id="cb101-122"><a href="#cb101-122"></a>  <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"white"</span>, <span class="st">"black"</span>)</span>
<span id="cb101-123"><a href="#cb101-123"></a>) <span class="sc">+</span> <span class="co"># alphabetical</span></span>
<span id="cb101-124"><a href="#cb101-124"></a>  <span class="fu">theme</span>(</span>
<span id="cb101-125"><a href="#cb101-125"></a>    <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb101-126"><a href="#cb101-126"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.8</span>),</span>
<span id="cb101-127"><a href="#cb101-127"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)</span>
<span id="cb101-128"><a href="#cb101-128"></a>  )</span>
<span id="cb101-129"><a href="#cb101-129"></a>b <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(</span>
<span id="cb101-130"><a href="#cb101-130"></a>  Y1.sl.BATZ,</span>
<span id="cb101-131"><a href="#cb101-131"></a>  <span class="st">"Benguela-Agulhas Transition Zone"</span>,</span>
<span id="cb101-132"><a href="#cb101-132"></a>  <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)</span>
<span id="cb101-133"><a href="#cb101-133"></a>) <span class="sc">+</span></span>
<span id="cb101-134"><a href="#cb101-134"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb101-135"><a href="#cb101-135"></a>c <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(</span>
<span id="cb101-136"><a href="#cb101-136"></a>  Y1.sl.AMP,</span>
<span id="cb101-137"><a href="#cb101-137"></a>  <span class="st">"Agulhas Marine Province"</span>,</span>
<span id="cb101-138"><a href="#cb101-138"></a>  <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)</span>
<span id="cb101-139"><a href="#cb101-139"></a>) <span class="sc">+</span></span>
<span id="cb101-140"><a href="#cb101-140"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb101-141"><a href="#cb101-141"></a>d <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(</span>
<span id="cb101-142"><a href="#cb101-142"></a>  Y1.sl.ECTZ,</span>
<span id="cb101-143"><a href="#cb101-143"></a>  <span class="st">"East Coast Transition Zone"</span>,</span>
<span id="cb101-144"><a href="#cb101-144"></a>  <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"white"</span>)</span>
<span id="cb101-145"><a href="#cb101-145"></a>) <span class="sc">+</span></span>
<span id="cb101-146"><a href="#cb101-146"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb101-147"><a href="#cb101-147"></a></span>
<span id="cb101-148"><a href="#cb101-148"></a><span class="fu">ggarrange</span>(a, b, c, d, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="st">"AUTO"</span>, <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="two_oceans_appendices_files/figure-html/fn-network-graphs-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="two_oceans_appendices_files/figure-html/fn-network-graphs-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>And that is it, folks. You will notice that I have not reproduced Fig. 5 here. I will leave that up to you… or ask me and I will send the code. All of the matrices have (mostly) been calculated above and they can be used together with some <strong>dplyr</strong> and <strong>ggplot2</strong> know-how in the creation of that graph.</p>
<p>Legalise seaweed!</p>
</section><section id="references" class="level2" data-number="10">


<!-- -->


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">
10 References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Anderson2013" class="csl-entry" role="listitem">
Anderson MJ, Tolimieri N, Millar RB (2013) <span class="nocase">Beta diversity of demersal fish assemblages in the North-Eastern Pacific: interactions of latitude and depth</span>. PLOS ONE 8:e57918.
</div>
<div id="ref-Baselga2010" class="csl-entry" role="listitem">
Baselga A (2010) <span class="nocase">Partitioning the turnover and nestedness components of beta diversity</span>. Global Ecology and Biogeography 19:134–143.
</div>
<div id="ref-Baselga2013" class="csl-entry" role="listitem">
Baselga A, Orme D, Villeger S, Bortoli JD, Leprieur F (2013) <a href="http://CRAN.R-project.org/package=betapart"><span class="nocase">betapart: Partitioning beta diversity into turnover and nestedness components</span></a>.
</div>
<div id="ref-Blanchet2008" class="csl-entry" role="listitem">
Blanchet FG, Legendre P, Borcard D (2008) <span class="nocase">Forward selection of explanatory variables</span>. Ecology 89:2623–2632.
</div>
<div id="ref-Bolton1986" class="csl-entry" role="listitem">
Bolton JJ (1986) <span class="nocase">Marine phytogeography of the Benguela upwelling region on the west coast of southern Africa: A temperature dependent approach</span>. Botanica Marina 29:251–256.
</div>
<div id="ref-Bolton2004" class="csl-entry" role="listitem">
Bolton JJ, Anderson RJ (2004) <span>Marine Vegetation</span>. In: Cowling RM, Richardson DM, Pierce SM (eds) Vegetation of southern africa. Cambridge University Press, pp 348–370
</div>
<div id="ref-Bolton2002" class="csl-entry" role="listitem">
Bolton JJ, Stegenga H (2002) <span class="nocase">Seaweed species diversity in South Africa</span>. South African Journal of Marine Science 24:9–18.
</div>
<div id="ref-Borcard2011" class="csl-entry" role="listitem">
Borcard D, Gillet F, Legendre P (2011) <a href="https://books.google.co.za/books?id=dtQNxsH4Y2wC"><span class="nocase">Numerical Ecology with R</span></a>. Springer New York
</div>
<div id="ref-Davidar2007" class="csl-entry" role="listitem">
Davidar P, Rajagopal B, Mohandass D, Puyravaud J-P, Condit R, Wright S, Leigh E (2007) The effect of climatic gradients, topographic variation and species traits on the beta diversity of rain forest trees. Global Ecology and Biogeography 16:510–518.
</div>
<div id="ref-DeClerck2005" class="csl-entry" role="listitem">
De Clerck O, Bolton JJ, Anderson RJ, Coppejans E (2005) <span class="nocase">Guide to the seaweeds of KwaZulu-Natal</span>. Scripta Botanica Belgica 33:294 pp.
</div>
<div id="ref-Dray2006" class="csl-entry" role="listitem">
Dray S, Legendre P, Peres-Neto PR (2006) <span class="nocase">Spatial modelling: a comprehensive framework for principal coordinate analysis of neighbour matrices (PCNM)</span>. Ecological Modelling 196:483–493.
</div>
<div id="ref-Dray2012a" class="csl-entry" role="listitem">
Dray S, Pélissier R, Couteron P, Fortin MJ, Legendre P, Peres-Neto PR, Bellier E, Bivand R, Blanchet FG, De Cáceres M, Dufour aB, Heegaard E, Jombart T, Munoz F, Oksanen J, Thioulouse J, Wagner HH (2012) <span class="nocase">Community ecology in the age of multivariate multiscale spatial analysis</span>. Ecological Monographs 82:257–275.
</div>
<div id="ref-Nekola1999" class="csl-entry" role="listitem">
Nekola JC, White PS, Carolina N, Nekola C, Curriculum PSW (1999) <span class="nocase">The distance decay of similarity in biogeography and ecology</span>. Journal of Biogeography 26:867–878.
</div>
<div id="ref-PeresNeto2010" class="csl-entry" role="listitem">
Peres-Neto PR, Legendre P (2010) <span class="nocase">Estimating and controlling for spatial structure in the study of ecological communities</span>. Global Ecology and Biogeography 19:174–184.
</div>
<div id="ref-Peres-Neto2006" class="csl-entry" role="listitem">
Peres-Neto PR, Legendre P, Dray S, Borcard D (2006) <span class="nocase">Variation partitioning of species data matrices: estimation and comparison of fractions</span>. Ecology 87:2614–2625.
</div>
<div id="ref-Sauer1988" class="csl-entry" role="listitem">
Sauer JD (1988) Plant migration: The dynamics of geographic patterning in seed plant species. University of California Press
</div>
<div id="ref-Smit2013" class="csl-entry" role="listitem">
Smit AJ, Roberts M, Anderson RJ, Dufois F, Dudley SFJ, Bornman TG, Olbers J, Bolton JJ (2013) <span class="nocase">A coastal seawater temperature dataset for biogeographical studies: large biases between <em>in situ</em> and remotely-sensed data sets around the coast of South Africa</span>. PLOS ONE 8:e81944.
</div>
<div id="ref-smit2017seaweeds" class="csl-entry" role="listitem">
Smit AJ, Bolton JJ, Anderson RJ (2017) Seaweeds in two oceans: Beta-diversity. <span>Frontiers in Marine Science</span> 4:404.
</div>
<div id="ref-Stegenga1997" class="csl-entry" role="listitem">
Stegenga H, Bolton JJ, Anderson RJ (1997) <span class="nocase">Seaweeds of the South African west coast</span>. Contributions of the Bolus Herbarium 18:3–637.
</div>
<div id="ref-Wernberg2013" class="csl-entry" role="listitem">
Wernberg T, Thomsen MS, Connell SD, Russell BD, Waters JM, Zuccarello GC, Kraft GT, Sanderson C, West JA, Gurgel CFD (2013) <span class="nocase">The footprint of continental-scale ocean currents on the biogeography of seaweeds.</span> PLOS ONE 8:e80168.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{smit,_a._j.2017,
  author = {Smit, A. J., and Smit, AJ and Bolton, JJ and Anderson, RJ},
  title = {Seaweeds in {Two} {Oceans:} {Beta-Diversity} {(Appendices)}},
  date = {2017-03-19},
  url = {http://tangledbank.netlify.app/BCB743/two_oceans_appendices.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-smit,_a._j.2017" class="csl-entry quarto-appendix-citeas" role="listitem">
Smit, A. J., Smit A, Bolton J, Anderson R (2017) Seaweeds in Two Oceans:
Beta-Diversity (Appendices). <a href="http://tangledbank.netlify.app/BCB743/two_oceans_appendices.html">http://tangledbank.netlify.app/BCB743/two_oceans_appendices.html.
</a>
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("http:\/\/tangledbank\.netlify\.app");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../BCB743/constrained_ordination.html" class="pagination-link" aria-label="13a: Distance-Based Redundancy Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">13a: Distance-Based Redundancy Analysis</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../BCB743/cluster_analysis.html" class="pagination-link" aria-label="14: Cluster Analysis">
        <span class="nav-page-text">14: Cluster Analysis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb102" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb102-1"><a href="#cb102-1"></a><span class="co">---</span></span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="an">title:</span><span class="co"> 'Seaweeds in Two Oceans: Beta-Diversity (Appendices)'</span></span>
<span id="cb102-3"><a href="#cb102-3"></a><span class="an">author:</span></span>
<span id="cb102-4"><a href="#cb102-4"></a><span class="co">- affiliation: University of the Western Cape</span></span>
<span id="cb102-5"><a href="#cb102-5"></a><span class="co">  name: AJ Smit</span></span>
<span id="cb102-6"><a href="#cb102-6"></a><span class="co">- affiliation: University of Cape Town</span></span>
<span id="cb102-7"><a href="#cb102-7"></a><span class="co">  name: JJ Bolton</span></span>
<span id="cb102-8"><a href="#cb102-8"></a><span class="co">- affiliation: Department of Agriculture, Forestry and Fisheries and University of Cape Town</span></span>
<span id="cb102-9"><a href="#cb102-9"></a><span class="co">  name: RJ Anderson</span></span>
<span id="cb102-10"><a href="#cb102-10"></a><span class="an">date:</span><span class="co"> "19 March 2017"</span></span>
<span id="cb102-11"><a href="#cb102-11"></a><span class="an">bibliography:</span><span class="co"> ../references.bib</span></span>
<span id="cb102-12"><a href="#cb102-12"></a><span class="an">format:</span></span>
<span id="cb102-13"><a href="#cb102-13"></a><span class="co">  html:</span></span>
<span id="cb102-14"><a href="#cb102-14"></a><span class="co">    eval: true</span></span>
<span id="cb102-15"><a href="#cb102-15"></a><span class="co">---</span></span>
<span id="cb102-16"><a href="#cb102-16"></a></span>
<span id="cb102-17"><a href="#cb102-17"></a><span class="in">```{r code-brewing-opts, echo=FALSE}</span></span>
<span id="cb102-18"><a href="#cb102-18"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb102-19"><a href="#cb102-19"></a>  <span class="at">comment =</span> <span class="st">"R&gt;"</span>, </span>
<span id="cb102-20"><a href="#cb102-20"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>, </span>
<span id="cb102-21"><a href="#cb102-21"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb102-22"><a href="#cb102-22"></a>  <span class="at">fig.width =</span> <span class="fl">4.5</span>,</span>
<span id="cb102-23"><a href="#cb102-23"></a>  <span class="at">fig.height =</span> <span class="fl">2.625</span>,</span>
<span id="cb102-24"><a href="#cb102-24"></a>  <span class="at">out.width =</span> <span class="st">"75%"</span>,</span>
<span id="cb102-25"><a href="#cb102-25"></a>  <span class="at">fig.asp =</span> <span class="cn">NULL</span>, <span class="co"># control via width/height</span></span>
<span id="cb102-26"><a href="#cb102-26"></a>  <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb102-27"><a href="#cb102-27"></a>)</span>
<span id="cb102-28"><a href="#cb102-28"></a></span>
<span id="cb102-29"><a href="#cb102-29"></a>ggplot2<span class="sc">::</span><span class="fu">theme_set</span>(</span>
<span id="cb102-30"><a href="#cb102-30"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">8</span>)</span>
<span id="cb102-31"><a href="#cb102-31"></a>)</span>
<span id="cb102-32"><a href="#cb102-32"></a>ggplot2<span class="sc">::</span><span class="fu">theme_set</span>(</span>
<span id="cb102-33"><a href="#cb102-33"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">8</span>)</span>
<span id="cb102-34"><a href="#cb102-34"></a>)</span>
<span id="cb102-35"><a href="#cb102-35"></a><span class="in">```</span></span>
<span id="cb102-36"><a href="#cb102-36"></a></span>
<span id="cb102-37"><a href="#cb102-37"></a>In this document you will find examples of a fairly complicated series of constrained ordinations performed for the paper @smit2017seaweeds. The analyses are based on the distribution of seaweeds around the coast of South Africa, and the environmental variables that might explain these distributions. </span>
<span id="cb102-38"><a href="#cb102-38"></a></span>
<span id="cb102-39"><a href="#cb102-39"></a><span class="fu">## Spatial Analysis Background and Code</span></span>
<span id="cb102-40"><a href="#cb102-40"></a></span>
<span id="cb102-41"><a href="#cb102-41"></a>This is Appendix B of the paper @smit2017seaweeds.</span>
<span id="cb102-42"><a href="#cb102-42"></a></span>
<span id="cb102-43"><a href="#cb102-43"></a>The intention of this section is to show the approach and **R** scripts used to pull apart the spatial scales at which seaweed assemblages are structured around the coast of South Africa. Specifically, I wish to determine if these scales match those expressed by the coastal thermal provinces and the ocean regime underpinned by the Agulhas and Benguela Currents.</span>
<span id="cb102-44"><a href="#cb102-44"></a></span>
<span id="cb102-45"><a href="#cb102-45"></a><span class="fu">## The Data</span></span>
<span id="cb102-46"><a href="#cb102-46"></a></span>
<span id="cb102-47"><a href="#cb102-47"></a>I use two data sets. The first, $Y$, comprises distribution records of 846 macroalgal species within each of 58 × 50 km-long sections (Appendix A) of the South African coast <span class="co">[</span><span class="ot">updated from @Bolton2002</span><span class="co">]</span>. This represents *ca*. 90% of the known seaweed flora of South Africa, but excludes some very small and/or very rare species for which data are insufficient. The data are from verifiable literature sources and John Bolton and Rob Anderson's own collections, assembled from information collected by teams of phycologists over three decades [@Bolton1986; @Stegenga1997; @Bolton2002; @DeClerck2005]. The second, $E$, is a dataset of *in situ* coastal seawater temperatures <span class="co">[</span><span class="ot">@Smit2013</span><span class="co">]</span> derived from daily measurements over up to 40 years.</span>
<span id="cb102-48"><a href="#cb102-48"></a></span>
<span id="cb102-49"><a href="#cb102-49"></a>A third data set of explanatory variables --- the spatial variables ($S$) --- is constructed as per the instructions in section *Preparation of spatial variables*, later on.</span>
<span id="cb102-50"><a href="#cb102-50"></a></span>
<span id="cb102-51"><a href="#cb102-51"></a><span class="fu">## Setting up the Analysis Environment</span></span>
<span id="cb102-52"><a href="#cb102-52"></a></span>
<span id="cb102-53"><a href="#cb102-53"></a>This is **R**, so first I need to find, install, and load various packages. Some of the packages will be available on CRAN and can be accessed and installed in the usual way, but others will have to be downloaded from <span class="co">[</span><span class="ot">R Forge</span><span class="co">](https://r-forge.r-project.org/R/?group_id=195)</span>.</span>
<span id="cb102-54"><a href="#cb102-54"></a></span>
<span id="cb102-55"><a href="#cb102-55"></a>Note: R-Forge repositories can be fragile (packages can disappear, builds can fail, and HTTP repos may be blocked). If you cannot install an R-Forge package, look for a CRAN/GitHub alternative, or ask for a pre-packaged/locked environment.</span>
<span id="cb102-56"><a href="#cb102-56"></a></span>
<span id="cb102-57"><a href="#cb102-57"></a><span class="in">```{r code-setup}</span></span>
<span id="cb102-58"><a href="#cb102-58"></a><span class="fu">library</span>(betapart)</span>
<span id="cb102-59"><a href="#cb102-59"></a><span class="fu">library</span>(vegan)</span>
<span id="cb102-60"><a href="#cb102-60"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb102-61"><a href="#cb102-61"></a><span class="fu">library</span>(grid)</span>
<span id="cb102-62"><a href="#cb102-62"></a><span class="fu">library</span>(gridBase)</span>
<span id="cb102-63"><a href="#cb102-63"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb102-64"><a href="#cb102-64"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb102-65"><a href="#cb102-65"></a><span class="fu">library</span>(spdep) <span class="co"># for dnearneigh() in PCNM.R</span></span>
<span id="cb102-66"><a href="#cb102-66"></a><span class="co"># library(devtools)</span></span>
<span id="cb102-67"><a href="#cb102-67"></a><span class="co"># install.packages("packfor", repos = "http://R-Forge.R-project.org")</span></span>
<span id="cb102-68"><a href="#cb102-68"></a><span class="co"># library(packfor) # replaced with vegan::ordistep()</span></span>
<span id="cb102-69"><a href="#cb102-69"></a><span class="co"># install.packages("AEM", repos = "http://R-Forge.R-project.org")</span></span>
<span id="cb102-70"><a href="#cb102-70"></a><span class="co"># library(AEM) # for moran.I.multi() in PCNM.R</span></span>
<span id="cb102-71"><a href="#cb102-71"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"pcoa_all.R"</span>))</span>
<span id="cb102-72"><a href="#cb102-72"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"PCNM.R"</span>))</span>
<span id="cb102-73"><a href="#cb102-73"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"spatial_MEM.R"</span>))</span>
<span id="cb102-74"><a href="#cb102-74"></a><span class="in">```</span></span>
<span id="cb102-75"><a href="#cb102-75"></a></span>
<span id="cb102-76"><a href="#cb102-76"></a>Now I get to the data. The first step involves the species table ($Y$). First I compute the Sørensen dissimilarity and then I decompose the dissimilarity into the 'turnover' (β\textsubscript{sim}) and 'nestedness-resultant' (β\textsubscript{sne}) components <span class="co">[</span><span class="ot">@Baselga2010; @Baselga2013</span><span class="co">]</span> using the <span class="in">`betapart.core()`</span> and <span class="in">`betapart.pair()`</span> functions of the **betapart** package [@Baselga2013]. These are placed into the matrices $Y1$ and $Y2$. Optionally, I can apply a principal components analysis (PCA) on $Y$ to find the major patterns in the community data. In **vegan** this is done using the `rda()` function and not supplying the constraints (*i.e.*, the environment table, $E$, or the spatial table, $S$). The formal analysis will use the species data in distance-based redundancy analyses (db-RDA as per **vegan**'s <span class="in">`capscale()`</span> function) by coupling them with $E$ and $S$. I provide the pre-calculated data only.</span>
<span id="cb102-77"><a href="#cb102-77"></a></span>
<span id="cb102-78"><a href="#cb102-78"></a><span class="in">```{r code-species-data}</span></span>
<span id="cb102-79"><a href="#cb102-79"></a><span class="co"># Read in the species data (note: on GitHub only the distance</span></span>
<span id="cb102-80"><a href="#cb102-80"></a><span class="co"># matrices obtained via 'beta.part' and 'beta.pair' (below)</span></span>
<span id="cb102-81"><a href="#cb102-81"></a><span class="co"># will be provided -- they are read in as 'Y1.Rdata' and 'Y2.Rdata':</span></span>
<span id="cb102-82"><a href="#cb102-82"></a>spp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB743"</span>, <span class="st">"seaweed"</span>, <span class="st">"SeaweedSpp.csv"</span>))</span>
<span id="cb102-83"><a href="#cb102-83"></a>spp <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(spp, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb102-84"><a href="#cb102-84"></a></span>
<span id="cb102-85"><a href="#cb102-85"></a><span class="co"># Decompose total Sørensen dissimilarity into turnover and</span></span>
<span id="cb102-86"><a href="#cb102-86"></a><span class="co"># nestedness-resultant components:</span></span>
<span id="cb102-87"><a href="#cb102-87"></a>Y.core <span class="ot">&lt;-</span> <span class="fu">betapart.core</span>(spp)</span>
<span id="cb102-88"><a href="#cb102-88"></a>Y.pair <span class="ot">&lt;-</span> <span class="fu">beta.pair</span>(Y.core, <span class="at">index.family =</span> <span class="st">"sor"</span>)</span>
<span id="cb102-89"><a href="#cb102-89"></a></span>
<span id="cb102-90"><a href="#cb102-90"></a><span class="co"># Let Y1 be the turnover component (beta-sim):</span></span>
<span id="cb102-91"><a href="#cb102-91"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Y.pair<span class="sc">$</span>beta.sim)</span>
<span id="cb102-92"><a href="#cb102-92"></a><span class="co"># save(Y1, file = "data/BCB743/Y1.Rdata")</span></span>
<span id="cb102-93"><a href="#cb102-93"></a><span class="co"># load("data/BCB743/Y1.Rdata")</span></span>
<span id="cb102-94"><a href="#cb102-94"></a></span>
<span id="cb102-95"><a href="#cb102-95"></a><span class="co"># Let Y2 be the nestedness-resultant component (beta-sne):</span></span>
<span id="cb102-96"><a href="#cb102-96"></a>Y2 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Y.pair<span class="sc">$</span>beta.sne)</span>
<span id="cb102-97"><a href="#cb102-97"></a><span class="co"># save(Y2, file = "data/BCB743/Y2.Rdata")</span></span>
<span id="cb102-98"><a href="#cb102-98"></a><span class="co"># load("data/BCB743/Y2.Rdata")</span></span>
<span id="cb102-99"><a href="#cb102-99"></a><span class="in">```</span></span>
<span id="cb102-100"><a href="#cb102-100"></a></span>
<span id="cb102-101"><a href="#cb102-101"></a><span class="in">```{r code-summary-capscale-y1}</span></span>
<span id="cb102-102"><a href="#cb102-102"></a><span class="fu">summary</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>))</span>
<span id="cb102-103"><a href="#cb102-103"></a><span class="in">```</span></span>
<span id="cb102-104"><a href="#cb102-104"></a></span>
<span id="cb102-105"><a href="#cb102-105"></a>It is now necessary to load the environmental data and some setup files that partition the 58 coastal sections (and the species and environmental data that fall within these sections) into bioregions.</span>
<span id="cb102-106"><a href="#cb102-106"></a></span>
<span id="cb102-107"><a href="#cb102-107"></a>The thermal (environmental) data contain various variables, but in the analysis I use only some of them. These data were obtained from many sites along the South African coast, but using interpolation (not included here) I calculated the thermal properties for each of the coastal sections for which seaweed data are available. Consequently we have a data frame with 58 rows and a column for each of the thermal metrics. Before use, I apply **vegan**'s <span class="in">`decostand()`</span> function to scale the data to zero mean and unit variance.</span>
<span id="cb102-108"><a href="#cb102-108"></a></span>
<span id="cb102-109"><a href="#cb102-109"></a>Four bioregions are recognised for South Africa <span class="co">[</span><span class="ot">@Bolton2004</span><span class="co">]</span>, namely the Benguela Marine Province (BMP; coastal sections **1**--**17**), the Benguela-Agulhas Transition Zone (B-ATZ; **18**--**22**), the Agulhas Marine Province (AMP; **19**--**43**/**44**), and the East Coast Transition Zone (ECTZ; **44**/**45**--**58**). My plotting functions partition the data into the bioregions and colour code the figures accordingly so I can see regional patterns in \textbeta-diversity emerging.</span>
<span id="cb102-110"><a href="#cb102-110"></a></span>
<span id="cb102-111"><a href="#cb102-111"></a><span class="in">```{r code-env-data}</span></span>
<span id="cb102-112"><a href="#cb102-112"></a><span class="co"># Now comes in the in situ temperatures for the 58 coastal sections</span></span>
<span id="cb102-113"><a href="#cb102-113"></a><span class="co"># (interpolated temperaures as per version 2 of the South African Coastal Temperature Network):</span></span>
<span id="cb102-114"><a href="#cb102-114"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB743"</span>, <span class="st">"seaweed"</span>, <span class="st">"SeaweedEnv.RData"</span>))</span>
<span id="cb102-115"><a href="#cb102-115"></a></span>
<span id="cb102-116"><a href="#cb102-116"></a><span class="co"># I select only some of the thermal vars; the rest</span></span>
<span id="cb102-117"><a href="#cb102-117"></a><span class="co"># are collinear with some of the ones I import:</span></span>
<span id="cb102-118"><a href="#cb102-118"></a>E1 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb102-119"><a href="#cb102-119"></a>  env,</span>
<span id="cb102-120"><a href="#cb102-120"></a>  febMean,</span>
<span id="cb102-121"><a href="#cb102-121"></a>  febRange,</span>
<span id="cb102-122"><a href="#cb102-122"></a>  febSD,</span>
<span id="cb102-123"><a href="#cb102-123"></a>  augMean,</span>
<span id="cb102-124"><a href="#cb102-124"></a>  augRange,</span>
<span id="cb102-125"><a href="#cb102-125"></a>  augSD,</span>
<span id="cb102-126"><a href="#cb102-126"></a>  annMean,</span>
<span id="cb102-127"><a href="#cb102-127"></a>  annRange,</span>
<span id="cb102-128"><a href="#cb102-128"></a>  annSD</span>
<span id="cb102-129"><a href="#cb102-129"></a>)</span>
<span id="cb102-130"><a href="#cb102-130"></a></span>
<span id="cb102-131"><a href="#cb102-131"></a><span class="co"># Calculate z-scores:</span></span>
<span id="cb102-132"><a href="#cb102-132"></a>E1 <span class="ot">&lt;-</span> <span class="fu">decostand</span>(E1, <span class="at">method =</span> <span class="st">"standardize"</span>)</span>
<span id="cb102-133"><a href="#cb102-133"></a></span>
<span id="cb102-134"><a href="#cb102-134"></a><span class="co"># Load the coordinates of the coastal sections:</span></span>
<span id="cb102-135"><a href="#cb102-135"></a>sites <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB743"</span>, <span class="st">"seaweed"</span>, <span class="st">"sites.csv"</span>))</span>
<span id="cb102-136"><a href="#cb102-136"></a>sites <span class="ot">&lt;-</span> sites[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)]</span>
<span id="cb102-137"><a href="#cb102-137"></a></span>
<span id="cb102-138"><a href="#cb102-138"></a><span class="co"># Load the bioregion definition:</span></span>
<span id="cb102-139"><a href="#cb102-139"></a>bioreg <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb102-140"><a href="#cb102-140"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB743"</span>, <span class="st">"seaweed"</span>, <span class="st">"bioregions.csv"</span>),</span>
<span id="cb102-141"><a href="#cb102-141"></a>  <span class="at">header =</span> <span class="cn">TRUE</span></span>
<span id="cb102-142"><a href="#cb102-142"></a>)</span>
<span id="cb102-143"><a href="#cb102-143"></a><span class="in">```</span></span>
<span id="cb102-144"><a href="#cb102-144"></a></span>
<span id="cb102-145"><a href="#cb102-145"></a><span class="fu">## Preparation of Spatial Variables</span></span>
<span id="cb102-146"><a href="#cb102-146"></a></span>
<span id="cb102-147"><a href="#cb102-147"></a>I test the niche difference mechanism as the primary species compositional assembly process operating along South African shores. I suggest that the thermal gradient along the coast provides a suite of abiotic (thermal) conditions from which species can select based on their physiological tolerances, and hence this will structure \textbeta-diversity. For this mechanism to function one would assume that all species have equal access to all sections along this stretch of coast, thus following Beijerinck's 'Law' that everything is everywhere but the environment selects <span class="co">[</span><span class="ot">@Sauer1988</span><span class="co">]</span> (but see main text!).</span>
<span id="cb102-148"><a href="#cb102-148"></a></span>
<span id="cb102-149"><a href="#cb102-149"></a>The basic approach to a spatial analysis structured around a biological response (*e.g.*, community structure and composition; $Y$), environmental variables ($E$) and their spatial representation ($S$) involves an analysis of Moran's eigenvector maps (MEM), followed by db-RDA and variance partitioning. Various literature sources discuss principle behind Moran's eigenvector maps [@Dray2006; @Dray2012a]. Worked examples are also presented in the excellent book *Numerical Ecology with R* <span class="co">[</span><span class="ot">@Borcard2011</span><span class="co">]</span> in Section 7.4. The method followed here has been adapted from these and other sources.</span>
<span id="cb102-150"><a href="#cb102-150"></a></span>
<span id="cb102-151"><a href="#cb102-151"></a>Obtaining the MEMs to use in the analysis is based on the procedure introduced by Borcard and Legendre (2002), which was later modified by @Dray2006. The basic approach involves:</span>
<span id="cb102-152"><a href="#cb102-152"></a></span>
<span id="cb102-153"><a href="#cb102-153"></a><span class="ss">1. </span>Set up a geographic or Euclidean distance matrix representing the pairwise distances between the $n$ sites ($D=<span class="co">[</span><span class="ot">d_{ij}</span><span class="co">]</span>$). I already did this when I applied the <span class="in">`decostand`</span> function earlier.</span>
<span id="cb102-154"><a href="#cb102-154"></a></span>
<span id="cb102-155"><a href="#cb102-155"></a><span class="ss">2. </span>Construct a truncated distance matrix by calculating a Minimum Spanning Tree ($S^{\star}$) and noting the following rules: $$S^{\star} =\left<span class="sc">\{</span> \begin{array}{rl} 0 &amp; \mbox{if}~i = j <span class="sc">\\</span> d_{ij} &amp; \mbox{if}~d_{ij} \leq t \\ 4t &amp; \mbox{if}~d_{ij} &gt; t \end{array} \right.$$ Weighting may be applied if desired, resulting in $S^{\star}_w$. It is not done here.</span>
<span id="cb102-156"><a href="#cb102-156"></a></span>
<span id="cb102-157"><a href="#cb102-157"></a><span class="ss">3. </span>Do a Principal Coordinates Analysis (PCoA) of the truncated distance matrix $S^{\star}$.</span>
<span id="cb102-158"><a href="#cb102-158"></a></span>
<span id="cb102-159"><a href="#cb102-159"></a>The spatial properties imprinted on the species and their environment can be specified using a matrix of Euclidean or geographic distances. These coordinates are 'truncated' into a square (section $\times$ section) matrix containing non-negative values ($S^{\star}$). By convention the diagonal values are set to zero. A very basic spatial matrix is binary, where 1 codes for pairs of neighbouring sites while 0 denotes non-connected sites according to the chosen network topology. Such matrices are called 'binary connectivity matrices' and relate to graphs made using distance criteria derived from graph theory.</span>
<span id="cb102-160"><a href="#cb102-160"></a></span>
<span id="cb102-161"><a href="#cb102-161"></a>Truncation produced by Minimum Spanning Trees (MST) focuses on the binary relationships between neighbouring sites, discarding any other connections (*i.e.*, some sites are considered to be neighbours, while for others the relationships are null). One could also choose a Gabriel graph or another kind of network topology. Such matrix representations show section-to-section connectivities. In the case of South Africa's coastline data, the MST causes sections to be connected only to other sections adjacent to two sides of it: for example, Section **4** is directly connected to *only* Sections **3** and **5**; sections at the termini of the coastal 'string' of sections are each connected to only one other section. The binary connectivity matrices, also called *topology-based connectivity matrices*, can be produced from Euclidean or geographic coordinates using functions in at least two **R** packages (I start with geographic coordinates). One option is to use the **spdep** package's `mst.nb()` function to calculate a MST, but there are also options in the **vegan** package and elsewhere. The neighbours list arrived at from the MST represents the spatial component, $S^{\star}$. The MST results in small connectivity artefacts in the Saldanha Bay region where the closest sections are not necessarily the ones adjacent one-another following along the path around the coast, because sections at opposite sides of the bay may in fact be closer together. This topological inconsistency does not affect the spatial analysis in any way.</span>
<span id="cb102-162"><a href="#cb102-162"></a></span>
<span id="cb102-163"><a href="#cb102-163"></a>Once the truncated distance matrix has been prepared, it is subjected to a PCoA and I keep the eigenvectors that represent positive spatial correlation (positive Moran's $I$). For the MEM analysis I use the function <span class="in">`PCNM()`</span> that resides in the <span class="in">`functions`</span> folder in the file <span class="in">`PCNM.R`</span> (see notes inside about authorship). PCNM stands for Principal Coordinates Analysis of Neighbourhood Matrices (the neighbourhood matrix in this instance being the MST). This method automatically constructs the spatial variables and calculates the Moran's I for each. The MEMs are completely orthogonal and represent the spatial structures over the full range of scales from 50 to 2,700 km. The large eigenvectors represent broad spatial scales while smaller ones cover finer features. The *spatial data* will be used as a set of explanatory variables in the multiple regression type analyses applied to a species dissimilarity matrix [*i.e.*, the db-RDA; @Dray2012a]</span>
<span id="cb102-164"><a href="#cb102-164"></a></span>
<span id="cb102-165"><a href="#cb102-165"></a>The code below reproduces the spatial analysis in the paper. Due to the length of the output I have prevented the script from returning any output here; rather, if the reader is for some odd reason interested in repeating this analysis, s/he may find the data and scripts in my <span class="co">[</span><span class="ot">GitHub</span><span class="co">](https://github.com/ajsmit/Seaweed-beta)</span> repository, and the full code can be run in its entirety. Well, I hope this will work, but if it does not (probably very likely) then write to me at <span class="co">[</span><span class="ot">ajsmit\@uwc.ac.za</span><span class="co">](mailto:ajsmit@uwc.ac.za)</span>{.email} and I shall assist --- this may depend on if your email has a catchy title that will make it stand out from among all the other emails which other people think are equally important.</span>
<span id="cb102-166"><a href="#cb102-166"></a></span>
<span id="cb102-167"><a href="#cb102-167"></a><span class="in">```{r code-pcnm}</span></span>
<span id="cb102-168"><a href="#cb102-168"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb102-169"><a href="#cb102-169"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-170"><a href="#cb102-170"></a><span class="co">#| fig.align: center</span></span>
<span id="cb102-171"><a href="#cb102-171"></a></span>
<span id="cb102-172"><a href="#cb102-172"></a><span class="do">## Auto PCNM:</span></span>
<span id="cb102-173"><a href="#cb102-173"></a>S.auto <span class="ot">&lt;-</span> <span class="fu">PCNM</span>(<span class="fu">dist</span>(sites), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-174"><a href="#cb102-174"></a><span class="co"># summary(S.auto)</span></span>
<span id="cb102-175"><a href="#cb102-175"></a></span>
<span id="cb102-176"><a href="#cb102-176"></a><span class="co"># The truncation distance:</span></span>
<span id="cb102-177"><a href="#cb102-177"></a>S.dmin <span class="ot">&lt;-</span> S.auto<span class="sc">$</span>thresh</span>
<span id="cb102-178"><a href="#cb102-178"></a></span>
<span id="cb102-179"><a href="#cb102-179"></a><span class="co"># The number of eigenvalues:</span></span>
<span id="cb102-180"><a href="#cb102-180"></a>S.len <span class="ot">&lt;-</span> <span class="fu">length</span>(S.auto<span class="sc">$</span>values)</span>
<span id="cb102-181"><a href="#cb102-181"></a></span>
<span id="cb102-182"><a href="#cb102-182"></a><span class="co"># Expected value of I, no spatial correlation:</span></span>
<span id="cb102-183"><a href="#cb102-183"></a>S.auto<span class="sc">$</span>expected_Moran</span>
<span id="cb102-184"><a href="#cb102-184"></a></span>
<span id="cb102-185"><a href="#cb102-185"></a><span class="co"># Select eigenfunction with positive spatial correlation:</span></span>
<span id="cb102-186"><a href="#cb102-186"></a>S.sel <span class="ot">&lt;-</span> <span class="fu">which</span>(S.auto<span class="sc">$</span>Moran_I<span class="sc">$</span>Positive <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-187"><a href="#cb102-187"></a><span class="co"># length(S.sel)</span></span>
<span id="cb102-188"><a href="#cb102-188"></a><span class="co"># there are 27 MEMs, i.e. 27 of the PCNM variables (eigenvalues) relate</span></span>
<span id="cb102-189"><a href="#cb102-189"></a><span class="co"># significantly to Moran's I</span></span>
<span id="cb102-190"><a href="#cb102-190"></a></span>
<span id="cb102-191"><a href="#cb102-191"></a><span class="co"># Extract the eigenvectors associated with those MEMs:</span></span>
<span id="cb102-192"><a href="#cb102-192"></a>S.pos <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.auto<span class="sc">$</span>vectors)[, S.sel]</span>
<span id="cb102-193"><a href="#cb102-193"></a><span class="in">```</span></span>
<span id="cb102-194"><a href="#cb102-194"></a></span>
<span id="cb102-195"><a href="#cb102-195"></a>The code below lets us visualise the configuration of the 58 coastal sections as represented by the minimum spanning tree. Because the sites are constrained by the coast the MST network topology results in a string of coastal sections arranged along the shore between Section **1** and Section **58**. This spatial network therefore also captures the spatial connectivity in the seaweed's dispersal ability along the shore, although no directionality is associated with dispersal. In the paper I discuss the possible influence of ocean currents <span class="co">[</span><span class="ot">*e.g.*, @Wernberg2013</span><span class="co">]</span> and I pointed out that it is tempting to assume that seaweeds would disperse in the direction the major ocean currents. These kinds of networks could conceivably be configured to model dispersal due to currents, but here it is simply used for representing the spatial scale of the study region.</span>
<span id="cb102-196"><a href="#cb102-196"></a></span>
<span id="cb102-197"><a href="#cb102-197"></a><span class="in">```{r fig-plot-mst}</span></span>
<span id="cb102-198"><a href="#cb102-198"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb102-199"><a href="#cb102-199"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-200"><a href="#cb102-200"></a><span class="co">#| fig.align: center</span></span>
<span id="cb102-201"><a href="#cb102-201"></a></span>
<span id="cb102-202"><a href="#cb102-202"></a><span class="co"># The spatial netwwork topology of the coastal sections can be seen by:</span></span>
<span id="cb102-203"><a href="#cb102-203"></a><span class="fu">plot</span>(S.auto<span class="sc">$</span>spanning, sites)</span>
<span id="cb102-204"><a href="#cb102-204"></a><span class="in">```</span></span>
<span id="cb102-205"><a href="#cb102-205"></a></span>
<span id="cb102-206"><a href="#cb102-206"></a><span class="fu">## db-RDA on Moran's Eigenvector Maps</span></span>
<span id="cb102-207"><a href="#cb102-207"></a></span>
<span id="cb102-208"><a href="#cb102-208"></a>The next step of the spatial analysis is to apply a db-RDA with the seaweed data ($Y1$ and $Y2$) coupled with the MEMs. I now run a full (global) db-RDA on the significant, positive MEMs selected above, and I then perform a permutation test to see if the fit is significant.</span>
<span id="cb102-209"><a href="#cb102-209"></a></span>
<span id="cb102-210"><a href="#cb102-210"></a><span class="in">```{r code-y1-pcnm-capscale-global}</span></span>
<span id="cb102-211"><a href="#cb102-211"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb102-212"><a href="#cb102-212"></a>S.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., S.pos)</span>
<span id="cb102-213"><a href="#cb102-213"></a></span>
<span id="cb102-214"><a href="#cb102-214"></a><span class="co"># Permutation test to test for the significance of the global fit:</span></span>
<span id="cb102-215"><a href="#cb102-215"></a><span class="fu">anova</span>(S.Y1.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes, significant!</span></span>
<span id="cb102-216"><a href="#cb102-216"></a></span>
<span id="cb102-217"><a href="#cb102-217"></a><span class="co"># The global adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb102-218"><a href="#cb102-218"></a>S.Y1.cs.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y1.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb102-219"><a href="#cb102-219"></a></span>
<span id="cb102-220"><a href="#cb102-220"></a><span class="co"># Variance explained by full model:</span></span>
<span id="cb102-221"><a href="#cb102-221"></a><span class="fu">sum</span>(S.Y1.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y1.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-222"><a href="#cb102-222"></a><span class="in">```</span></span>
<span id="cb102-223"><a href="#cb102-223"></a></span>
<span id="cb102-224"><a href="#cb102-224"></a><span class="in">```{r code-y2-pcnm-capscale-global}</span></span>
<span id="cb102-225"><a href="#cb102-225"></a><span class="co"># And on the Y2 data (uncommented, but same as above):</span></span>
<span id="cb102-226"><a href="#cb102-226"></a>S.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., S.pos)</span>
<span id="cb102-227"><a href="#cb102-227"></a>S.Y2.cs.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y2.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb102-228"><a href="#cb102-228"></a><span class="fu">sum</span>(S.Y2.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y2.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-229"><a href="#cb102-229"></a><span class="in">```</span></span>
<span id="cb102-230"><a href="#cb102-230"></a></span>
<span id="cb102-231"><a href="#cb102-231"></a>**Initial analysis (pre-2017):** Since the analysis is significant, I compute the adjusted *R*^2^ and run forward selection of the MEMs. The forward selection procedure of @Blanchet2008 is implemented in the **packfor** package for R, and I use it to reduce the number of MEM variables and retain only those that best fit the biotic data. Forward selection prevents the inflation of the overall type I error and reduces the number of explanatory variables used in the final model, which improves parsimony. I then run a new db-RDA analysis on the 'best' (reduced) set of MEM variables that was selected.</span>
<span id="cb102-232"><a href="#cb102-232"></a></span>
<span id="cb102-233"><a href="#cb102-233"></a><span class="in">```{r code-s-y1-fwd-forward}</span></span>
<span id="cb102-234"><a href="#cb102-234"></a><span class="co">#| eval: false</span></span>
<span id="cb102-235"><a href="#cb102-235"></a><span class="co">#| echo: false</span></span>
<span id="cb102-236"><a href="#cb102-236"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb102-237"><a href="#cb102-237"></a>S.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(Y1, <span class="fu">as.matrix</span>(S.pos), <span class="at">adjR2thresh =</span> S.Y1.cs.R2)</span>
<span id="cb102-238"><a href="#cb102-238"></a></span>
<span id="cb102-239"><a href="#cb102-239"></a><span class="co"># Forward selection on Y2:</span></span>
<span id="cb102-240"><a href="#cb102-240"></a>S.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(Y2, <span class="fu">as.matrix</span>(S.pos), <span class="at">adjR2thresh =</span> S.Y2.cs.R2)</span>
<span id="cb102-241"><a href="#cb102-241"></a><span class="in">```</span></span>
<span id="cb102-242"><a href="#cb102-242"></a></span>
<span id="cb102-243"><a href="#cb102-243"></a><span class="in">```{r code-s-y1-no-sig}</span></span>
<span id="cb102-244"><a href="#cb102-244"></a><span class="co">#| eval: false</span></span>
<span id="cb102-245"><a href="#cb102-245"></a><span class="co">#| echo: false</span></span>
<span id="cb102-246"><a href="#cb102-246"></a></span>
<span id="cb102-247"><a href="#cb102-247"></a><span class="co"># Write the significant MEMs to a new object:</span></span>
<span id="cb102-248"><a href="#cb102-248"></a>S.Y1.no.sig <span class="ot">&lt;-</span> <span class="fu">nrow</span>(S.Y1.fwd)</span>
<span id="cb102-249"><a href="#cb102-249"></a>S.Y1.sign <span class="ot">&lt;-</span> <span class="fu">sort</span>(S.Y1.fwd[, <span class="dv">2</span>])</span>
<span id="cb102-250"><a href="#cb102-250"></a>S.Y1.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">c</span>(S.Y1.sign)]</span>
<span id="cb102-251"><a href="#cb102-251"></a><span class="fu">colnames</span>(S.Y1.red) <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb102-252"><a href="#cb102-252"></a>  <span class="fu">rep</span>(<span class="st">"MEM"</span>, S.Y1.no.sig),</span>
<span id="cb102-253"><a href="#cb102-253"></a>  <span class="fu">as.character</span>(S.Y1.sign),</span>
<span id="cb102-254"><a href="#cb102-254"></a>  <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb102-255"><a href="#cb102-255"></a>)</span>
<span id="cb102-256"><a href="#cb102-256"></a></span>
<span id="cb102-257"><a href="#cb102-257"></a><span class="co"># Identity of significant MEMs:</span></span>
<span id="cb102-258"><a href="#cb102-258"></a><span class="fu">colnames</span>(S.Y1.red)</span>
<span id="cb102-259"><a href="#cb102-259"></a></span>
<span id="cb102-260"><a href="#cb102-260"></a><span class="co"># Run a new db-RDA on the best MEM variables:</span></span>
<span id="cb102-261"><a href="#cb102-261"></a>S.Y1.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., <span class="at">data =</span> S.Y1.red)</span>
<span id="cb102-262"><a href="#cb102-262"></a><span class="co"># no need to check these for collinearity as the</span></span>
<span id="cb102-263"><a href="#cb102-263"></a><span class="co"># MEMs are completely orthogonal..</span></span>
<span id="cb102-264"><a href="#cb102-264"></a></span>
<span id="cb102-265"><a href="#cb102-265"></a><span class="co"># Permutation test to test for significance:</span></span>
<span id="cb102-266"><a href="#cb102-266"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-267"><a href="#cb102-267"></a></span>
<span id="cb102-268"><a href="#cb102-268"></a><span class="co"># Test by axis:</span></span>
<span id="cb102-269"><a href="#cb102-269"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-270"><a href="#cb102-270"></a></span>
<span id="cb102-271"><a href="#cb102-271"></a><span class="co"># The significant axes:</span></span>
<span id="cb102-272"><a href="#cb102-272"></a>S.Y1.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-273"><a href="#cb102-273"></a>S.Y1.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y1.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-274"><a href="#cb102-274"></a>S.Y1.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y1.red[, S.Y1.ax])</span>
<span id="cb102-275"><a href="#cb102-275"></a></span>
<span id="cb102-276"><a href="#cb102-276"></a><span class="co"># Test by terms:</span></span>
<span id="cb102-277"><a href="#cb102-277"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-278"><a href="#cb102-278"></a></span>
<span id="cb102-279"><a href="#cb102-279"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb102-280"><a href="#cb102-280"></a><span class="co"># S.Y1.s2.R2 &lt;- RsquareAdj(S.Y1.s2)$adj.r.squared</span></span>
<span id="cb102-281"><a href="#cb102-281"></a></span>
<span id="cb102-282"><a href="#cb102-282"></a><span class="co"># Variance explained by reduced model:</span></span>
<span id="cb102-283"><a href="#cb102-283"></a><span class="fu">sum</span>(S.Y1.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y1.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-284"><a href="#cb102-284"></a></span>
<span id="cb102-285"><a href="#cb102-285"></a><span class="co"># Show only the first 6 rows:</span></span>
<span id="cb102-286"><a href="#cb102-286"></a><span class="fu">scores</span>(S.Y1.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span>
<span id="cb102-287"><a href="#cb102-287"></a><span class="in">```</span></span>
<span id="cb102-288"><a href="#cb102-288"></a></span>
<span id="cb102-289"><a href="#cb102-289"></a><span class="in">```{r code-s-y2-no-sig}</span></span>
<span id="cb102-290"><a href="#cb102-290"></a><span class="co">#| eval: false</span></span>
<span id="cb102-291"><a href="#cb102-291"></a><span class="co">#| echo: false</span></span>
<span id="cb102-292"><a href="#cb102-292"></a></span>
<span id="cb102-293"><a href="#cb102-293"></a><span class="co"># As above, but now with Y2:</span></span>
<span id="cb102-294"><a href="#cb102-294"></a>S.Y2.no.sig <span class="ot">&lt;-</span> <span class="fu">nrow</span>(S.Y2.fwd)</span>
<span id="cb102-295"><a href="#cb102-295"></a>S.Y2.sign <span class="ot">&lt;-</span> <span class="fu">sort</span>(S.Y2.fwd[, <span class="dv">2</span>])</span>
<span id="cb102-296"><a href="#cb102-296"></a>S.Y2.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">c</span>(S.Y2.sign)]</span>
<span id="cb102-297"><a href="#cb102-297"></a><span class="fu">colnames</span>(S.Y2.red) <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb102-298"><a href="#cb102-298"></a>  <span class="fu">rep</span>(<span class="st">"MEM"</span>, S.Y2.no.sig),</span>
<span id="cb102-299"><a href="#cb102-299"></a>  <span class="fu">as.character</span>(S.Y2.sign),</span>
<span id="cb102-300"><a href="#cb102-300"></a>  <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb102-301"><a href="#cb102-301"></a>)</span>
<span id="cb102-302"><a href="#cb102-302"></a><span class="fu">colnames</span>(S.Y2.red)</span>
<span id="cb102-303"><a href="#cb102-303"></a>S.Y2.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., <span class="at">data =</span> S.Y2.red)</span>
<span id="cb102-304"><a href="#cb102-304"></a></span>
<span id="cb102-305"><a href="#cb102-305"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes, significant!</span></span>
<span id="cb102-306"><a href="#cb102-306"></a></span>
<span id="cb102-307"><a href="#cb102-307"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-308"><a href="#cb102-308"></a></span>
<span id="cb102-309"><a href="#cb102-309"></a>S.Y2.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-310"><a href="#cb102-310"></a>S.Y2.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y2.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-311"><a href="#cb102-311"></a>S.Y2.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y2.red[, S.Y2.ax])</span>
<span id="cb102-312"><a href="#cb102-312"></a></span>
<span id="cb102-313"><a href="#cb102-313"></a>S.Y2.s2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y2.s2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb102-314"><a href="#cb102-314"></a></span>
<span id="cb102-315"><a href="#cb102-315"></a><span class="fu">sum</span>(S.Y2.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y2.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-316"><a href="#cb102-316"></a></span>
<span id="cb102-317"><a href="#cb102-317"></a><span class="fu">scores</span>(S.Y2.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb102-318"><a href="#cb102-318"></a><span class="in">```</span></span>
<span id="cb102-319"><a href="#cb102-319"></a></span>
<span id="cb102-320"><a href="#cb102-320"></a>**Update (2024):** The **packfor** package is no longer available so I have updated my methods to use **vegan**'s `ordiR2step()` function instead. This function is a stepwise model selection procedure that uses adjusted *R*^2^ as the criterion (as in **packfor**) for selecting the best model. I run the forward selection procedure on the full model and retain the significant ('best', reduced) MEMs in the final model. I then use only the retained MEMs in subsequent steps.</span>
<span id="cb102-321"><a href="#cb102-321"></a></span>
<span id="cb102-322"><a href="#cb102-322"></a><span class="in">```{r code-s-y1-cs-null}</span></span>
<span id="cb102-323"><a href="#cb102-323"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb102-324"><a href="#cb102-324"></a>S.Y1.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>, S.pos) <span class="co"># a null model</span></span>
<span id="cb102-325"><a href="#cb102-325"></a>S.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., S.pos)</span>
<span id="cb102-326"><a href="#cb102-326"></a></span>
<span id="cb102-327"><a href="#cb102-327"></a>S.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(S.Y1.cs.null, S.Y1.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-328"><a href="#cb102-328"></a></span>
<span id="cb102-329"><a href="#cb102-329"></a><span class="co"># the significant MEMs to retain are</span></span>
<span id="cb102-330"><a href="#cb102-330"></a><span class="fu">as.data.frame</span>(S.Y1.fwd<span class="sc">$</span>anova)</span>
<span id="cb102-331"><a href="#cb102-331"></a>S.Y1.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(S.Y1.fwd)<span class="sc">$</span>biplot))]</span>
<span id="cb102-332"><a href="#cb102-332"></a><span class="fu">names</span>(S.Y1.red) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^V"</span>, <span class="st">"MEM"</span>, <span class="fu">names</span>(S.Y1.red)) <span class="co"># rename them</span></span>
<span id="cb102-333"><a href="#cb102-333"></a><span class="in">```</span></span>
<span id="cb102-334"><a href="#cb102-334"></a></span>
<span id="cb102-335"><a href="#cb102-335"></a><span class="in">```{r code-s-y2-cs-null}</span></span>
<span id="cb102-336"><a href="#cb102-336"></a><span class="co"># Run the db-RDA on the Y2 data:</span></span>
<span id="cb102-337"><a href="#cb102-337"></a>S.Y2.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> <span class="dv">1</span>, S.pos) <span class="co"># a null model</span></span>
<span id="cb102-338"><a href="#cb102-338"></a>S.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., S.pos)</span>
<span id="cb102-339"><a href="#cb102-339"></a></span>
<span id="cb102-340"><a href="#cb102-340"></a>S.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(S.Y2.cs.null, S.Y2.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-341"><a href="#cb102-341"></a></span>
<span id="cb102-342"><a href="#cb102-342"></a><span class="co"># the significant MEMs to retain are</span></span>
<span id="cb102-343"><a href="#cb102-343"></a><span class="fu">as.data.frame</span>(S.Y2.fwd<span class="sc">$</span>anova)</span>
<span id="cb102-344"><a href="#cb102-344"></a>S.Y2.red <span class="ot">&lt;-</span> S.pos[, <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(S.Y2.fwd)<span class="sc">$</span>biplot))]</span>
<span id="cb102-345"><a href="#cb102-345"></a><span class="fu">names</span>(S.Y2.red) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^V"</span>, <span class="st">"MEM"</span>, <span class="fu">names</span>(S.Y2.red)) <span class="co"># rename them</span></span>
<span id="cb102-346"><a href="#cb102-346"></a><span class="in">```</span></span>
<span id="cb102-347"><a href="#cb102-347"></a></span>
<span id="cb102-348"><a href="#cb102-348"></a>Now I run a new db-RDA analysis on the 'best' (reduced) set of MEM variables that was selected. </span>
<span id="cb102-349"><a href="#cb102-349"></a></span>
<span id="cb102-350"><a href="#cb102-350"></a><span class="in">```{r code-y1-pcnm-capscale-final}</span></span>
<span id="cb102-351"><a href="#cb102-351"></a><span class="co"># Run a new db-RDA on the best MEM variables:</span></span>
<span id="cb102-352"><a href="#cb102-352"></a>S.Y1.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., <span class="at">data =</span> S.Y1.red)</span>
<span id="cb102-353"><a href="#cb102-353"></a><span class="co"># no need to check these for collinearity as the</span></span>
<span id="cb102-354"><a href="#cb102-354"></a><span class="co"># MEMs are completely orthogonal..</span></span>
<span id="cb102-355"><a href="#cb102-355"></a></span>
<span id="cb102-356"><a href="#cb102-356"></a><span class="co"># Permutation test to test for significance:</span></span>
<span id="cb102-357"><a href="#cb102-357"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-358"><a href="#cb102-358"></a></span>
<span id="cb102-359"><a href="#cb102-359"></a><span class="co"># Test by axis:</span></span>
<span id="cb102-360"><a href="#cb102-360"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-361"><a href="#cb102-361"></a></span>
<span id="cb102-362"><a href="#cb102-362"></a><span class="co"># The significant axes:</span></span>
<span id="cb102-363"><a href="#cb102-363"></a>S.Y1.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-364"><a href="#cb102-364"></a>S.Y1.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y1.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-365"><a href="#cb102-365"></a>S.Y1.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y1.red[, S.Y1.ax])</span>
<span id="cb102-366"><a href="#cb102-366"></a></span>
<span id="cb102-367"><a href="#cb102-367"></a><span class="co"># Test by terms:</span></span>
<span id="cb102-368"><a href="#cb102-368"></a><span class="fu">anova</span>(S.Y1.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-369"><a href="#cb102-369"></a></span>
<span id="cb102-370"><a href="#cb102-370"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb102-371"><a href="#cb102-371"></a><span class="co"># S.Y1.s2.R2 &lt;- RsquareAdj(S.Y1.s2)$adj.r.squared</span></span>
<span id="cb102-372"><a href="#cb102-372"></a></span>
<span id="cb102-373"><a href="#cb102-373"></a><span class="co"># Variance explained by reduced model:</span></span>
<span id="cb102-374"><a href="#cb102-374"></a><span class="fu">sum</span>(S.Y1.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y1.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-375"><a href="#cb102-375"></a></span>
<span id="cb102-376"><a href="#cb102-376"></a><span class="co"># Show only the first 6 rows:</span></span>
<span id="cb102-377"><a href="#cb102-377"></a><span class="fu">scores</span>(S.Y1.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span>
<span id="cb102-378"><a href="#cb102-378"></a><span class="in">```</span></span>
<span id="cb102-379"><a href="#cb102-379"></a></span>
<span id="cb102-380"><a href="#cb102-380"></a><span class="in">```{r code-y2-pcnm-capscale-final}</span></span>
<span id="cb102-381"><a href="#cb102-381"></a>S.Y2.s2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., <span class="at">data =</span> S.Y2.red)</span>
<span id="cb102-382"><a href="#cb102-382"></a></span>
<span id="cb102-383"><a href="#cb102-383"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes, significant!</span></span>
<span id="cb102-384"><a href="#cb102-384"></a><span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-385"><a href="#cb102-385"></a></span>
<span id="cb102-386"><a href="#cb102-386"></a>S.Y2.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(S.Y2.s2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-387"><a href="#cb102-387"></a>S.Y2.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(S.Y2.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-388"><a href="#cb102-388"></a>S.Y2.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y2.red[, S.Y2.ax])</span>
<span id="cb102-389"><a href="#cb102-389"></a>S.Y2.s2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(S.Y2.s2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb102-390"><a href="#cb102-390"></a><span class="fu">sum</span>(S.Y2.s2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> S.Y2.s2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-391"><a href="#cb102-391"></a><span class="fu">scores</span>(S.Y2.s2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb102-392"><a href="#cb102-392"></a><span class="in">```</span></span>
<span id="cb102-393"><a href="#cb102-393"></a></span>
<span id="cb102-394"><a href="#cb102-394"></a><span class="fu">## A Few Visualisations</span></span>
<span id="cb102-395"><a href="#cb102-395"></a></span>
<span id="cb102-396"><a href="#cb102-396"></a>Now I make a visualisation to reveal the spatial arrangement of the MEMs used in the final db-RDA involving the spatial variables (*i.e.*, \texttt{S.Y1.s2} and \texttt{S.Y2.s2}). The spatial configuration relates to broad scales as seen in Fig. 3 in the paper. Here are plots of the site scores for the MEMs and $Y1$ and $Y2$ (a few panels belonging with Fig. 3):</span>
<span id="cb102-397"><a href="#cb102-397"></a></span>
<span id="cb102-398"><a href="#cb102-398"></a><span class="in">```{r code-y1-y2-sa-score-plot}</span></span>
<span id="cb102-399"><a href="#cb102-399"></a><span class="co"># Build a simple South Africa basemap using Natural Earth polygons.</span></span>
<span id="cb102-400"><a href="#cb102-400"></a>sa_basemap <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb102-401"><a href="#cb102-401"></a>  sa_lats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">35.5</span>, <span class="sc">-</span><span class="dv">26</span>)</span>
<span id="cb102-402"><a href="#cb102-402"></a>  sa_lons <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">34</span>)</span>
<span id="cb102-403"><a href="#cb102-403"></a>  sa_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(</span>
<span id="cb102-404"><a href="#cb102-404"></a>    <span class="fu">c</span>(<span class="at">xmin =</span> sa_lons[<span class="dv">1</span>], <span class="at">xmax =</span> sa_lons[<span class="dv">2</span>], <span class="at">ymin =</span> sa_lats[<span class="dv">1</span>], <span class="at">ymax =</span> sa_lats[<span class="dv">2</span>]),</span>
<span id="cb102-405"><a href="#cb102-405"></a>    <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)</span>
<span id="cb102-406"><a href="#cb102-406"></a>  )</span>
<span id="cb102-407"><a href="#cb102-407"></a>  sa_world <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb102-408"><a href="#cb102-408"></a>  sa_world <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(sa_world, sa_bbox)</span>
<span id="cb102-409"><a href="#cb102-409"></a></span>
<span id="cb102-410"><a href="#cb102-410"></a>  <span class="cf">function</span>() {</span>
<span id="cb102-411"><a href="#cb102-411"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb102-412"><a href="#cb102-412"></a>      <span class="fu">geom_sf</span>(</span>
<span id="cb102-413"><a href="#cb102-413"></a>        <span class="at">data =</span> sa_world,</span>
<span id="cb102-414"><a href="#cb102-414"></a>        <span class="at">fill =</span> <span class="st">"#F9FAEC"</span>,</span>
<span id="cb102-415"><a href="#cb102-415"></a>        <span class="at">col =</span> <span class="st">"#F9FAEC"</span>,</span>
<span id="cb102-416"><a href="#cb102-416"></a>        <span class="at">linewidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb102-417"><a href="#cb102-417"></a>        <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb102-418"><a href="#cb102-418"></a>      ) <span class="sc">+</span></span>
<span id="cb102-419"><a href="#cb102-419"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> sa_lons, <span class="at">ylim =</span> sa_lats, <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb102-420"><a href="#cb102-420"></a>      <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb102-421"><a href="#cb102-421"></a>      <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb102-422"><a href="#cb102-422"></a>      <span class="fu">theme</span>(</span>
<span id="cb102-423"><a href="#cb102-423"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb102-424"><a href="#cb102-424"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb102-425"><a href="#cb102-425"></a>      )</span>
<span id="cb102-426"><a href="#cb102-426"></a>  }</span>
<span id="cb102-427"><a href="#cb102-427"></a>})</span>
<span id="cb102-428"><a href="#cb102-428"></a></span>
<span id="cb102-429"><a href="#cb102-429"></a><span class="co"># Plot the first canonical axis of the db-RDA with the significant MEMs for Y1;</span></span>
<span id="cb102-430"><a href="#cb102-430"></a><span class="co"># (see Fig. 3):</span></span>
<span id="cb102-431"><a href="#cb102-431"></a>S.Y1.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y1.s2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb102-432"><a href="#cb102-432"></a>S.Y1.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb102-433"><a href="#cb102-433"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb102-434"><a href="#cb102-434"></a>    <span class="at">data =</span> sites,</span>
<span id="cb102-435"><a href="#cb102-435"></a>    <span class="fu">aes</span>(</span>
<span id="cb102-436"><a href="#cb102-436"></a>      <span class="at">x =</span> Longitude,</span>
<span id="cb102-437"><a href="#cb102-437"></a>      <span class="at">y =</span> Latitude,</span>
<span id="cb102-438"><a href="#cb102-438"></a>      <span class="at">size =</span> <span class="fu">abs</span>(S.Y1.axes[, <span class="dv">1</span>]),</span>
<span id="cb102-439"><a href="#cb102-439"></a>      <span class="at">col =</span> <span class="fu">ifelse</span>(S.Y1.axes[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)</span>
<span id="cb102-440"><a href="#cb102-440"></a>    ),</span>
<span id="cb102-441"><a href="#cb102-441"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb102-442"><a href="#cb102-442"></a>  ) <span class="sc">+</span></span>
<span id="cb102-443"><a href="#cb102-443"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb102-444"><a href="#cb102-444"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">guide =</span> <span class="st">"none"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"grey60"</span>)) <span class="sc">+</span></span>
<span id="cb102-445"><a href="#cb102-445"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of spatial variables, "</span>, beta[sim])))</span>
<span id="cb102-446"><a href="#cb102-446"></a></span>
<span id="cb102-447"><a href="#cb102-447"></a><span class="co"># And the same for Y2 (see Fig. 3):</span></span>
<span id="cb102-448"><a href="#cb102-448"></a>S.Y2.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y2.s2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb102-449"><a href="#cb102-449"></a>S.Y2.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb102-450"><a href="#cb102-450"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb102-451"><a href="#cb102-451"></a>    <span class="at">data =</span> sites,</span>
<span id="cb102-452"><a href="#cb102-452"></a>    <span class="fu">aes</span>(</span>
<span id="cb102-453"><a href="#cb102-453"></a>      <span class="at">x =</span> Longitude,</span>
<span id="cb102-454"><a href="#cb102-454"></a>      <span class="at">y =</span> Latitude,</span>
<span id="cb102-455"><a href="#cb102-455"></a>      <span class="at">size =</span> <span class="fu">abs</span>(S.Y2.axes[, <span class="dv">1</span>]),</span>
<span id="cb102-456"><a href="#cb102-456"></a>      <span class="at">col =</span> <span class="fu">ifelse</span>(S.Y2.axes[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)</span>
<span id="cb102-457"><a href="#cb102-457"></a>    ),</span>
<span id="cb102-458"><a href="#cb102-458"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb102-459"><a href="#cb102-459"></a>  ) <span class="sc">+</span></span>
<span id="cb102-460"><a href="#cb102-460"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb102-461"><a href="#cb102-461"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">guide =</span> <span class="st">"none"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"grey60"</span>)) <span class="sc">+</span></span>
<span id="cb102-462"><a href="#cb102-462"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of spatial variables, "</span>, beta[sne])))</span>
<span id="cb102-463"><a href="#cb102-463"></a><span class="in">```</span></span>
<span id="cb102-464"><a href="#cb102-464"></a></span>
<span id="cb102-465"><a href="#cb102-465"></a>Now that I know that spatial structures are present in the seaweed data I check how these significant spatial patterns (two significant canonical axes, CAP1 and CAP2) are related to the environmental variables using linear regression. Checks for normality are also done but none of the output is printed here.</span>
<span id="cb102-466"><a href="#cb102-466"></a></span>
<span id="cb102-467"><a href="#cb102-467"></a>Next I want to show the ordination biplots of the MEM variables with respect to the sites using scaling = 2 (species) and showing the LC scores. Now I can see the major directions of influence of the spatial variables with respect to the sites. The code below produces a few panels of Fig. 2 (the figure is reproduced at the end of this document):</span>
<span id="cb102-468"><a href="#cb102-468"></a></span>
<span id="cb102-469"><a href="#cb102-469"></a><span class="in">```{r fig-y1-y2-spatial-ordiplot}</span></span>
<span id="cb102-470"><a href="#cb102-470"></a><span class="co"># A few of the panels that go with Fig. 2;</span></span>
<span id="cb102-471"><a href="#cb102-471"></a><span class="co"># first for Y1...:</span></span>
<span id="cb102-472"><a href="#cb102-472"></a>S.Y1.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y1.s2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>, <span class="st">"wa"</span>, <span class="st">"lc"</span>, <span class="st">"bp"</span>, <span class="st">"cn"</span>))</span>
<span id="cb102-473"><a href="#cb102-473"></a>S.Y1.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(S.Y1.scrs<span class="sc">$</span>constraints)</span>
<span id="cb102-474"><a href="#cb102-474"></a>S.Y1.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb102-475"><a href="#cb102-475"></a>S.Y1.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb102-476"><a href="#cb102-476"></a><span class="fu">colnames</span>(S.Y1.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb102-477"><a href="#cb102-477"></a></span>
<span id="cb102-478"><a href="#cb102-478"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(S.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb102-479"><a href="#cb102-479"></a>S.Y1.bp <span class="ot">&lt;-</span> S.Y1.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb102-480"><a href="#cb102-480"></a>S.Y1.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y1.bp)</span>
<span id="cb102-481"><a href="#cb102-481"></a>S.Y1.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y1.bp)</span>
<span id="cb102-482"><a href="#cb102-482"></a><span class="fu">colnames</span>(S.Y1.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb102-483"><a href="#cb102-483"></a>S.Y1.bp.sign <span class="ot">&lt;-</span> S.Y1.bp[S.Y1.bp<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y1.sign.ax, ]</span>
<span id="cb102-484"><a href="#cb102-484"></a></span>
<span id="cb102-485"><a href="#cb102-485"></a><span class="co"># A modification of the vegan ordiArrowTextXY() function to prevent the</span></span>
<span id="cb102-486"><a href="#cb102-486"></a><span class="co"># "plot.new has not been called yet" from occurring</span></span>
<span id="cb102-487"><a href="#cb102-487"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"text_mult.R"</span>))</span>
<span id="cb102-488"><a href="#cb102-488"></a></span>
<span id="cb102-489"><a href="#cb102-489"></a>S.Y1.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(S.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb102-490"><a href="#cb102-490"></a>S.Y1.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y1.text)</span>
<span id="cb102-491"><a href="#cb102-491"></a>S.Y1.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y1.text)</span>
<span id="cb102-492"><a href="#cb102-492"></a><span class="fu">colnames</span>(S.Y1.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb102-493"><a href="#cb102-493"></a>S.Y1.text.sign <span class="ot">&lt;-</span> S.Y1.text[S.Y1.text<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y1.sign.ax, ]</span>
<span id="cb102-494"><a href="#cb102-494"></a></span>
<span id="cb102-495"><a href="#cb102-495"></a>S.Y1.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> S.Y1.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span></span>
<span id="cb102-496"><a href="#cb102-496"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span></span>
<span id="cb102-497"><a href="#cb102-497"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb102-498"><a href="#cb102-498"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb102-499"><a href="#cb102-499"></a>    <span class="at">data =</span> S.Y1.bp,</span>
<span id="cb102-500"><a href="#cb102-500"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb102-501"><a href="#cb102-501"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)),</span>
<span id="cb102-502"><a href="#cb102-502"></a>    <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb102-503"><a href="#cb102-503"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb102-504"><a href="#cb102-504"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb102-505"><a href="#cb102-505"></a>  ) <span class="sc">+</span></span>
<span id="cb102-506"><a href="#cb102-506"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb102-507"><a href="#cb102-507"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(S.Y1.text),</span>
<span id="cb102-508"><a href="#cb102-508"></a>    <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(S.Y1.text)),</span>
<span id="cb102-509"><a href="#cb102-509"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb102-510"><a href="#cb102-510"></a>  ) <span class="sc">+</span></span>
<span id="cb102-511"><a href="#cb102-511"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span></span>
<span id="cb102-512"><a href="#cb102-512"></a>  <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span></span>
<span id="cb102-513"><a href="#cb102-513"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Spatial variables and "</span>, beta[sim]))) <span class="sc">+</span></span>
<span id="cb102-514"><a href="#cb102-514"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb102-515"><a href="#cb102-515"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-516"><a href="#cb102-516"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb102-517"><a href="#cb102-517"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb102-518"><a href="#cb102-518"></a>    <span class="at">aspect.ratio =</span> <span class="fl">0.8</span></span>
<span id="cb102-519"><a href="#cb102-519"></a>  )</span>
<span id="cb102-520"><a href="#cb102-520"></a></span>
<span id="cb102-521"><a href="#cb102-521"></a><span class="co"># ...then for Y2:</span></span>
<span id="cb102-522"><a href="#cb102-522"></a>S.Y2.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(S.Y2.s2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>, <span class="st">"wa"</span>, <span class="st">"lc"</span>, <span class="st">"bp"</span>, <span class="st">"cn"</span>))</span>
<span id="cb102-523"><a href="#cb102-523"></a>S.Y2.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(S.Y2.scrs<span class="sc">$</span>constraints)</span>
<span id="cb102-524"><a href="#cb102-524"></a>S.Y2.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb102-525"><a href="#cb102-525"></a>S.Y2.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb102-526"><a href="#cb102-526"></a><span class="fu">colnames</span>(S.Y2.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb102-527"><a href="#cb102-527"></a></span>
<span id="cb102-528"><a href="#cb102-528"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(S.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.25</span>)</span>
<span id="cb102-529"><a href="#cb102-529"></a>S.Y2.bp <span class="ot">&lt;-</span> S.Y2.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb102-530"><a href="#cb102-530"></a>S.Y2.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y2.bp)</span>
<span id="cb102-531"><a href="#cb102-531"></a>S.Y2.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y2.bp)</span>
<span id="cb102-532"><a href="#cb102-532"></a><span class="fu">colnames</span>(S.Y2.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb102-533"><a href="#cb102-533"></a>S.Y2.bp.sign <span class="ot">&lt;-</span> S.Y2.bp[S.Y2.bp<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y2.sign.ax, ]</span>
<span id="cb102-534"><a href="#cb102-534"></a></span>
<span id="cb102-535"><a href="#cb102-535"></a>S.Y2.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(S.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.25</span>)</span>
<span id="cb102-536"><a href="#cb102-536"></a>S.Y2.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(S.Y2.text)</span>
<span id="cb102-537"><a href="#cb102-537"></a>S.Y2.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(S.Y2.text)</span>
<span id="cb102-538"><a href="#cb102-538"></a><span class="fu">colnames</span>(S.Y2.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb102-539"><a href="#cb102-539"></a>S.Y2.text.sign <span class="ot">&lt;-</span> S.Y2.text[S.Y2.text<span class="sc">$</span>labels <span class="sc">%in%</span> S.Y2.sign.ax, ]</span>
<span id="cb102-540"><a href="#cb102-540"></a></span>
<span id="cb102-541"><a href="#cb102-541"></a>S.Y2.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> S.Y2.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span></span>
<span id="cb102-542"><a href="#cb102-542"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span></span>
<span id="cb102-543"><a href="#cb102-543"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb102-544"><a href="#cb102-544"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb102-545"><a href="#cb102-545"></a>    <span class="at">data =</span> S.Y2.bp.sign,</span>
<span id="cb102-546"><a href="#cb102-546"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb102-547"><a href="#cb102-547"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)),</span>
<span id="cb102-548"><a href="#cb102-548"></a>    <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb102-549"><a href="#cb102-549"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb102-550"><a href="#cb102-550"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb102-551"><a href="#cb102-551"></a>  ) <span class="sc">+</span></span>
<span id="cb102-552"><a href="#cb102-552"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb102-553"><a href="#cb102-553"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(S.Y2.text.sign),</span>
<span id="cb102-554"><a href="#cb102-554"></a>    <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(S.Y2.text.sign)),</span>
<span id="cb102-555"><a href="#cb102-555"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb102-556"><a href="#cb102-556"></a>  ) <span class="sc">+</span></span>
<span id="cb102-557"><a href="#cb102-557"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span></span>
<span id="cb102-558"><a href="#cb102-558"></a>  <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span></span>
<span id="cb102-559"><a href="#cb102-559"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Spatial variables and "</span>, beta[sne]))) <span class="sc">+</span></span>
<span id="cb102-560"><a href="#cb102-560"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb102-561"><a href="#cb102-561"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-562"><a href="#cb102-562"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb102-563"><a href="#cb102-563"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb102-564"><a href="#cb102-564"></a>    <span class="at">aspect.ratio =</span> <span class="fl">0.8</span></span>
<span id="cb102-565"><a href="#cb102-565"></a>  )</span>
<span id="cb102-566"><a href="#cb102-566"></a><span class="in">```</span></span>
<span id="cb102-567"><a href="#cb102-567"></a></span>
<span id="cb102-568"><a href="#cb102-568"></a><span class="fu">## Analysis of the Thermal Variables</span></span>
<span id="cb102-569"><a href="#cb102-569"></a></span>
<span id="cb102-570"><a href="#cb102-570"></a>As before with the spatial variable, I now do a db-RDA involving all the thermal variables ($E$) followed by forward selection. There is less explanation provided here as the reader should now be familiar with db-RDA --- the procedure is the same as with the MEMs, just different explanatory variables are supplied. Another difference is that the thermal variables are not necessarily orthogonal, so I check for collinearity using variance inflation factors (VIF).</span>
<span id="cb102-571"><a href="#cb102-571"></a></span>
<span id="cb102-572"><a href="#cb102-572"></a>I start with the full model and then run forward selection and repeat the db-RDA on the reduced set. Analyses shown for $Y1$ and $Y2$:</span>
<span id="cb102-573"><a href="#cb102-573"></a></span>
<span id="cb102-574"><a href="#cb102-574"></a><span class="in">```{r code-y1-env-capscale-global}</span></span>
<span id="cb102-575"><a href="#cb102-575"></a><span class="co"># First Y1:</span></span>
<span id="cb102-576"><a href="#cb102-576"></a>E.Y1.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., E1)</span>
<span id="cb102-577"><a href="#cb102-577"></a></span>
<span id="cb102-578"><a href="#cb102-578"></a><span class="co"># Is the fit significant?</span></span>
<span id="cb102-579"><a href="#cb102-579"></a><span class="fu">anova</span>(E.Y1.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span>
<span id="cb102-580"><a href="#cb102-580"></a></span>
<span id="cb102-581"><a href="#cb102-581"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb102-582"><a href="#cb102-582"></a>E.Y1.R2a <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y1.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb102-583"><a href="#cb102-583"></a></span>
<span id="cb102-584"><a href="#cb102-584"></a><span class="co"># Variance explained by full model:</span></span>
<span id="cb102-585"><a href="#cb102-585"></a><span class="fu">sum</span>(E.Y1.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y1.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-586"><a href="#cb102-586"></a><span class="in">```</span></span>
<span id="cb102-587"><a href="#cb102-587"></a></span>
<span id="cb102-588"><a href="#cb102-588"></a><span class="in">```{r code-y2-env-capscale-global}</span></span>
<span id="cb102-589"><a href="#cb102-589"></a><span class="co"># ...and now Y2:</span></span>
<span id="cb102-590"><a href="#cb102-590"></a>E.Y2.cs <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., E1)</span>
<span id="cb102-591"><a href="#cb102-591"></a><span class="fu">anova</span>(E.Y2.cs, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span>
<span id="cb102-592"><a href="#cb102-592"></a>E.Y2.R2a <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y2.cs)<span class="sc">$</span>adj.r.squared</span>
<span id="cb102-593"><a href="#cb102-593"></a><span class="fu">sum</span>(E.Y2.cs<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y2.cs<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-594"><a href="#cb102-594"></a><span class="in">```</span></span>
<span id="cb102-595"><a href="#cb102-595"></a></span>
<span id="cb102-596"><a href="#cb102-596"></a><span class="in">```{r code-e-y1-fwd-forward}</span></span>
<span id="cb102-597"><a href="#cb102-597"></a><span class="co">#| echo: false</span></span>
<span id="cb102-598"><a href="#cb102-598"></a><span class="co">#| eval: false</span></span>
<span id="cb102-599"><a href="#cb102-599"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb102-600"><a href="#cb102-600"></a>E.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(Y1, E1, <span class="at">adjR2thresh =</span> E.Y1.R2a, <span class="at">nperm =</span> <span class="dv">999</span>)</span>
<span id="cb102-601"><a href="#cb102-601"></a></span>
<span id="cb102-602"><a href="#cb102-602"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb102-603"><a href="#cb102-603"></a>E.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(Y2, E1, <span class="at">adjR2thresh =</span> E.Y2.R2a, <span class="at">nperm =</span> <span class="dv">999</span>)</span>
<span id="cb102-604"><a href="#cb102-604"></a><span class="in">```</span></span>
<span id="cb102-605"><a href="#cb102-605"></a></span>
<span id="cb102-606"><a href="#cb102-606"></a><span class="in">```{r code-y1-y2-env-forward-select-final}</span></span>
<span id="cb102-607"><a href="#cb102-607"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb102-608"><a href="#cb102-608"></a><span class="co"># Run the db-RDA on the Y1 data:</span></span>
<span id="cb102-609"><a href="#cb102-609"></a>E.Y1.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> <span class="dv">1</span>, E1) <span class="co"># a null model</span></span>
<span id="cb102-610"><a href="#cb102-610"></a></span>
<span id="cb102-611"><a href="#cb102-611"></a><span class="co"># Forward selection on Y1:</span></span>
<span id="cb102-612"><a href="#cb102-612"></a>E.Y1.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(E.Y1.cs.null, E.Y1.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-613"><a href="#cb102-613"></a>E.Y1.fwd<span class="sc">$</span>anova</span>
<span id="cb102-614"><a href="#cb102-614"></a><span class="in">```</span></span>
<span id="cb102-615"><a href="#cb102-615"></a></span>
<span id="cb102-616"><a href="#cb102-616"></a><span class="in">```{r code-e-y2-cs-null}</span></span>
<span id="cb102-617"><a href="#cb102-617"></a><span class="co"># Now Y2:</span></span>
<span id="cb102-618"><a href="#cb102-618"></a>E.Y2.cs.null <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> <span class="dv">1</span>, E1) <span class="co"># a null model</span></span>
<span id="cb102-619"><a href="#cb102-619"></a>E.Y2.fwd <span class="ot">&lt;-</span> <span class="fu">ordiR2step</span>(E.Y2.cs.null, E.Y2.cs, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-620"><a href="#cb102-620"></a>E.Y2.fwd<span class="sc">$</span>anova</span>
<span id="cb102-621"><a href="#cb102-621"></a><span class="in">```</span></span>
<span id="cb102-622"><a href="#cb102-622"></a></span>
<span id="cb102-623"><a href="#cb102-623"></a><span class="in">```{r code-y1-env-capscale-final}</span></span>
<span id="cb102-624"><a href="#cb102-624"></a><span class="co"># Write the significant envs to a new object, and</span></span>
<span id="cb102-625"><a href="#cb102-625"></a><span class="co"># identity of significant envs in increasing order;</span></span>
<span id="cb102-626"><a href="#cb102-626"></a><span class="co"># first Y1:</span></span>
<span id="cb102-627"><a href="#cb102-627"></a>E.Y1.sign <span class="ot">&lt;-</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(E.Y1.fwd)<span class="sc">$</span>biplot))</span>
<span id="cb102-628"><a href="#cb102-628"></a></span>
<span id="cb102-629"><a href="#cb102-629"></a>E.Y1.red <span class="ot">&lt;-</span> E1[, E.Y1.sign]</span>
<span id="cb102-630"><a href="#cb102-630"></a></span>
<span id="cb102-631"><a href="#cb102-631"></a><span class="co"># Run a new env analysis on the best env variables:</span></span>
<span id="cb102-632"><a href="#cb102-632"></a>E.Y1.cs2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., E.Y1.red)</span>
<span id="cb102-633"><a href="#cb102-633"></a></span>
<span id="cb102-634"><a href="#cb102-634"></a><span class="co"># Check for collinearity:</span></span>
<span id="cb102-635"><a href="#cb102-635"></a><span class="fu">vif.cca</span>(E.Y1.cs2) <span class="co"># seems fine</span></span>
<span id="cb102-636"><a href="#cb102-636"></a></span>
<span id="cb102-637"><a href="#cb102-637"></a><span class="co"># Test for significance:</span></span>
<span id="cb102-638"><a href="#cb102-638"></a><span class="fu">anova</span>(E.Y1.cs2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span>
<span id="cb102-639"><a href="#cb102-639"></a></span>
<span id="cb102-640"><a href="#cb102-640"></a><span class="co"># Which axes are significant?</span></span>
<span id="cb102-641"><a href="#cb102-641"></a><span class="fu">anova</span>(E.Y1.cs2, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span>
<span id="cb102-642"><a href="#cb102-642"></a></span>
<span id="cb102-643"><a href="#cb102-643"></a><span class="co"># The significant axes:</span></span>
<span id="cb102-644"><a href="#cb102-644"></a>E.Y1.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(E.Y1.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-645"><a href="#cb102-645"></a>E.Y1.ax <span class="ot">&lt;-</span> <span class="fu">which</span>(E.Y1.axis.test[, <span class="dv">4</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb102-646"><a href="#cb102-646"></a>E.Y1.sign.ax <span class="ot">&lt;-</span> <span class="fu">colnames</span>(E.Y1.red[, E.Y1.ax])</span>
<span id="cb102-647"><a href="#cb102-647"></a></span>
<span id="cb102-648"><a href="#cb102-648"></a><span class="co"># The adjusted R2 --- the variance explained by the constrained axes:</span></span>
<span id="cb102-649"><a href="#cb102-649"></a>E.Y1.cs2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y1.cs2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb102-650"><a href="#cb102-650"></a></span>
<span id="cb102-651"><a href="#cb102-651"></a><span class="co"># Variance explained by reduced (final) model:</span></span>
<span id="cb102-652"><a href="#cb102-652"></a><span class="fu">sum</span>(E.Y1.cs2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y1.cs2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-653"><a href="#cb102-653"></a></span>
<span id="cb102-654"><a href="#cb102-654"></a><span class="co"># The biplot scores for constraining variables:</span></span>
<span id="cb102-655"><a href="#cb102-655"></a><span class="fu">scores</span>(E.Y1.cs2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb102-656"><a href="#cb102-656"></a><span class="in">```</span></span>
<span id="cb102-657"><a href="#cb102-657"></a></span>
<span id="cb102-658"><a href="#cb102-658"></a><span class="in">```{r code-y2-env-capscale-final}</span></span>
<span id="cb102-659"><a href="#cb102-659"></a><span class="co"># ...then Y2</span></span>
<span id="cb102-660"><a href="#cb102-660"></a>E.Y2.sign <span class="ot">&lt;-</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(<span class="fu">scores</span>(E.Y2.fwd)<span class="sc">$</span>biplot))</span>
<span id="cb102-661"><a href="#cb102-661"></a>E.Y2.red <span class="ot">&lt;-</span> E1[, E.Y2.sign]</span>
<span id="cb102-662"><a href="#cb102-662"></a></span>
<span id="cb102-663"><a href="#cb102-663"></a>E.Y2.cs2 <span class="ot">&lt;-</span> <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., E.Y2.red)</span>
<span id="cb102-664"><a href="#cb102-664"></a></span>
<span id="cb102-665"><a href="#cb102-665"></a><span class="fu">vif.cca</span>(E.Y2.cs2) <span class="co"># seems fine</span></span>
<span id="cb102-666"><a href="#cb102-666"></a></span>
<span id="cb102-667"><a href="#cb102-667"></a><span class="fu">anova</span>(E.Y2.cs2, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span>
<span id="cb102-668"><a href="#cb102-668"></a></span>
<span id="cb102-669"><a href="#cb102-669"></a>E.Y2.axis.test <span class="ot">&lt;-</span> <span class="fu">anova</span>(E.Y2.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>)</span>
<span id="cb102-670"><a href="#cb102-670"></a><span class="co"># E.Y2.ax &lt;- which(E.Y2.axis.test[, 4] &lt; 0.05) # doesn't work...</span></span>
<span id="cb102-671"><a href="#cb102-671"></a><span class="co"># E.Y2.sign.ax &lt;- colnames(E.Y2.red[,E.Y2.ax])</span></span>
<span id="cb102-672"><a href="#cb102-672"></a>E.Y2.sign.ax <span class="ot">&lt;-</span> <span class="st">"annMean"</span> <span class="co"># a manual cheat</span></span>
<span id="cb102-673"><a href="#cb102-673"></a></span>
<span id="cb102-674"><a href="#cb102-674"></a><span class="fu">anova</span>(E.Y2.cs2, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">parallel =</span> <span class="dv">4</span>) <span class="co"># ... yes!</span></span>
<span id="cb102-675"><a href="#cb102-675"></a></span>
<span id="cb102-676"><a href="#cb102-676"></a>E.Y2.cs2.R2 <span class="ot">&lt;-</span> <span class="fu">RsquareAdj</span>(E.Y2.cs2)<span class="sc">$</span>adj.r.squared</span>
<span id="cb102-677"><a href="#cb102-677"></a></span>
<span id="cb102-678"><a href="#cb102-678"></a><span class="fu">sum</span>(E.Y2.cs2<span class="sc">$</span>CCA<span class="sc">$</span>eig) <span class="sc">/</span> E.Y2.cs2<span class="sc">$</span>tot.chi <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb102-679"><a href="#cb102-679"></a></span>
<span id="cb102-680"><a href="#cb102-680"></a><span class="fu">scores</span>(E.Y2.cs2, <span class="at">display =</span> <span class="st">"bp"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb102-681"><a href="#cb102-681"></a><span class="in">```</span></span>
<span id="cb102-682"><a href="#cb102-682"></a></span>
<span id="cb102-683"><a href="#cb102-683"></a>Now I make the remaining panels of Fig. 3, these showing the spatial arrangement associated with the site scores of the environmental variables for $Y1$ and $Y2$:</span>
<span id="cb102-684"><a href="#cb102-684"></a></span>
<span id="cb102-685"><a href="#cb102-685"></a><span class="in">```{r code-y1-y2-sa-env-score-plot}</span></span>
<span id="cb102-686"><a href="#cb102-686"></a><span class="co"># Plot the two significant canonical axes of the</span></span>
<span id="cb102-687"><a href="#cb102-687"></a><span class="co"># db-RDA with the significant MEMs. This part of Fig. 3:</span></span>
<span id="cb102-688"><a href="#cb102-688"></a>E.Y1.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y1.cs2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb102-689"><a href="#cb102-689"></a>E.Y1.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb102-690"><a href="#cb102-690"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb102-691"><a href="#cb102-691"></a>    <span class="at">data =</span> sites,</span>
<span id="cb102-692"><a href="#cb102-692"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y1.axes[, <span class="dv">1</span>]),</span>
<span id="cb102-693"><a href="#cb102-693"></a>    <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb102-694"><a href="#cb102-694"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb102-695"><a href="#cb102-695"></a>  ) <span class="sc">+</span></span>
<span id="cb102-696"><a href="#cb102-696"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb102-697"><a href="#cb102-697"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of thermal variables, "</span>, beta[sim])))</span>
<span id="cb102-698"><a href="#cb102-698"></a></span>
<span id="cb102-699"><a href="#cb102-699"></a>E.Y1.plt.axis2 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb102-700"><a href="#cb102-700"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb102-701"><a href="#cb102-701"></a>    <span class="at">data =</span> sites,</span>
<span id="cb102-702"><a href="#cb102-702"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y1.axes[, <span class="dv">2</span>]),</span>
<span id="cb102-703"><a href="#cb102-703"></a>    <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb102-704"><a href="#cb102-704"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb102-705"><a href="#cb102-705"></a>  ) <span class="sc">+</span></span>
<span id="cb102-706"><a href="#cb102-706"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb102-707"><a href="#cb102-707"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP2 of thermal variables, "</span>, beta[sim])))</span>
<span id="cb102-708"><a href="#cb102-708"></a></span>
<span id="cb102-709"><a href="#cb102-709"></a>E.Y2.axes <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y2.cs2, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">display =</span> <span class="st">"lc"</span>, <span class="at">scaling =</span> <span class="dv">1</span>)</span>
<span id="cb102-710"><a href="#cb102-710"></a></span>
<span id="cb102-711"><a href="#cb102-711"></a>E.Y2.plt.axis1 <span class="ot">&lt;-</span> <span class="fu">sa_basemap</span>() <span class="sc">+</span></span>
<span id="cb102-712"><a href="#cb102-712"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb102-713"><a href="#cb102-713"></a>    <span class="at">data =</span> sites,</span>
<span id="cb102-714"><a href="#cb102-714"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">size =</span> E.Y2.axes[, <span class="dv">1</span>]),</span>
<span id="cb102-715"><a href="#cb102-715"></a>    <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb102-716"><a href="#cb102-716"></a>    <span class="at">shape =</span> <span class="dv">1</span></span>
<span id="cb102-717"><a href="#cb102-717"></a>  ) <span class="sc">+</span></span>
<span id="cb102-718"><a href="#cb102-718"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb102-719"><a href="#cb102-719"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"CAP1 of thermal variables, "</span>, beta[sne])))</span>
<span id="cb102-720"><a href="#cb102-720"></a><span class="in">```</span></span>
<span id="cb102-721"><a href="#cb102-721"></a></span>
<span id="cb102-722"><a href="#cb102-722"></a>And now I make the remaining panels of Fig. 2 (below) for Y1 and Y2 and the environmental constraining vectors:</span>
<span id="cb102-723"><a href="#cb102-723"></a></span>
<span id="cb102-724"><a href="#cb102-724"></a><span class="in">```{r fig-y1-env-ordiplot}</span></span>
<span id="cb102-725"><a href="#cb102-725"></a><span class="co"># The ordiplots in Fig. 2:</span></span>
<span id="cb102-726"><a href="#cb102-726"></a>E.Y1.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y1.cs2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>, <span class="st">"wa"</span>, <span class="st">"lc"</span>, <span class="st">"bp"</span>, <span class="st">"cn"</span>))</span>
<span id="cb102-727"><a href="#cb102-727"></a>E.Y1.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(E.Y1.scrs<span class="sc">$</span>constraints)</span>
<span id="cb102-728"><a href="#cb102-728"></a>E.Y1.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb102-729"><a href="#cb102-729"></a>E.Y1.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb102-730"><a href="#cb102-730"></a><span class="fu">colnames</span>(E.Y1.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb102-731"><a href="#cb102-731"></a></span>
<span id="cb102-732"><a href="#cb102-732"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(E.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb102-733"><a href="#cb102-733"></a>E.Y1.bp <span class="ot">&lt;-</span> E.Y1.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb102-734"><a href="#cb102-734"></a>E.Y1.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y1.bp)</span>
<span id="cb102-735"><a href="#cb102-735"></a>E.Y1.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y1.bp)</span>
<span id="cb102-736"><a href="#cb102-736"></a><span class="fu">colnames</span>(E.Y1.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb102-737"><a href="#cb102-737"></a>E.Y1.bp.sign <span class="ot">&lt;-</span> E.Y1.bp[E.Y1.bp<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y1.sign.ax, ]</span>
<span id="cb102-738"><a href="#cb102-738"></a></span>
<span id="cb102-739"><a href="#cb102-739"></a>E.Y1.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(E.Y1.scrs<span class="sc">$</span>biplot)</span>
<span id="cb102-740"><a href="#cb102-740"></a>E.Y1.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y1.text)</span>
<span id="cb102-741"><a href="#cb102-741"></a>E.Y1.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y1.text)</span>
<span id="cb102-742"><a href="#cb102-742"></a><span class="fu">colnames</span>(E.Y1.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb102-743"><a href="#cb102-743"></a>E.Y1.text.sign <span class="ot">&lt;-</span> E.Y1.text[E.Y1.text<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y1.sign.ax, ]</span>
<span id="cb102-744"><a href="#cb102-744"></a></span>
<span id="cb102-745"><a href="#cb102-745"></a>E.Y1.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> E.Y1.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span></span>
<span id="cb102-746"><a href="#cb102-746"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span></span>
<span id="cb102-747"><a href="#cb102-747"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb102-748"><a href="#cb102-748"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb102-749"><a href="#cb102-749"></a>    <span class="at">data =</span> E.Y1.bp.sign,</span>
<span id="cb102-750"><a href="#cb102-750"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb102-751"><a href="#cb102-751"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)),</span>
<span id="cb102-752"><a href="#cb102-752"></a>    <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb102-753"><a href="#cb102-753"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb102-754"><a href="#cb102-754"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb102-755"><a href="#cb102-755"></a>  ) <span class="sc">+</span></span>
<span id="cb102-756"><a href="#cb102-756"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb102-757"><a href="#cb102-757"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(E.Y1.text.sign),</span>
<span id="cb102-758"><a href="#cb102-758"></a>    <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(E.Y1.text.sign)),</span>
<span id="cb102-759"><a href="#cb102-759"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb102-760"><a href="#cb102-760"></a>  ) <span class="sc">+</span></span>
<span id="cb102-761"><a href="#cb102-761"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span></span>
<span id="cb102-762"><a href="#cb102-762"></a>  <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span></span>
<span id="cb102-763"><a href="#cb102-763"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Thermal variables and "</span>, beta[sim]))) <span class="sc">+</span></span>
<span id="cb102-764"><a href="#cb102-764"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb102-765"><a href="#cb102-765"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-766"><a href="#cb102-766"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb102-767"><a href="#cb102-767"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb102-768"><a href="#cb102-768"></a>    <span class="at">aspect.ratio =</span> <span class="fl">0.8</span></span>
<span id="cb102-769"><a href="#cb102-769"></a>  )</span>
<span id="cb102-770"><a href="#cb102-770"></a></span>
<span id="cb102-771"><a href="#cb102-771"></a>E.Y2.scrs <span class="ot">&lt;-</span> <span class="fu">scores</span>(E.Y2.cs2, <span class="at">display =</span> <span class="fu">c</span>(<span class="st">"sp"</span>, <span class="st">"wa"</span>, <span class="st">"lc"</span>, <span class="st">"bp"</span>, <span class="st">"cn"</span>))</span>
<span id="cb102-772"><a href="#cb102-772"></a>E.Y2.df_sites <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(E.Y2.scrs<span class="sc">$</span>constraints)</span>
<span id="cb102-773"><a href="#cb102-773"></a>E.Y2.df_sites<span class="sc">$</span>bioreg <span class="ot">&lt;-</span> bioreg<span class="sc">$</span>bolton</span>
<span id="cb102-774"><a href="#cb102-774"></a>E.Y2.df_sites<span class="sc">$</span>section <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)</span>
<span id="cb102-775"><a href="#cb102-775"></a><span class="fu">colnames</span>(E.Y2.df_sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Bioregion"</span>, <span class="st">"Section"</span>)</span>
<span id="cb102-776"><a href="#cb102-776"></a></span>
<span id="cb102-777"><a href="#cb102-777"></a>multiplier <span class="ot">&lt;-</span> <span class="fu">ordiArrowMul</span>(E.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.45</span>)</span>
<span id="cb102-778"><a href="#cb102-778"></a>E.Y2.bp <span class="ot">&lt;-</span> E.Y2.scrs<span class="sc">$</span>biplot <span class="sc">*</span> multiplier</span>
<span id="cb102-779"><a href="#cb102-779"></a>E.Y2.bp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y2.bp)</span>
<span id="cb102-780"><a href="#cb102-780"></a>E.Y2.bp<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y2.bp)</span>
<span id="cb102-781"><a href="#cb102-781"></a><span class="fu">colnames</span>(E.Y2.bp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb102-782"><a href="#cb102-782"></a>E.Y2.bp.sign <span class="ot">&lt;-</span> E.Y2.bp[E.Y2.bp<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y2.sign.ax, ]</span>
<span id="cb102-783"><a href="#cb102-783"></a></span>
<span id="cb102-784"><a href="#cb102-784"></a>E.Y2.text <span class="ot">&lt;-</span> <span class="fu">text.mult</span>(E.Y2.scrs<span class="sc">$</span>biplot, <span class="at">fill =</span> <span class="fl">0.45</span>)</span>
<span id="cb102-785"><a href="#cb102-785"></a>E.Y2.text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(E.Y2.text)</span>
<span id="cb102-786"><a href="#cb102-786"></a>E.Y2.text<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(E.Y2.text)</span>
<span id="cb102-787"><a href="#cb102-787"></a><span class="fu">colnames</span>(E.Y2.text) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"labels"</span>)</span>
<span id="cb102-788"><a href="#cb102-788"></a>E.Y2.text.sign <span class="ot">&lt;-</span> E.Y2.text[E.Y2.text<span class="sc">$</span>labels <span class="sc">%in%</span> E.Y2.sign.ax, ]</span>
<span id="cb102-789"><a href="#cb102-789"></a></span>
<span id="cb102-790"><a href="#cb102-790"></a>E.Y2.p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> E.Y2.df_sites, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> Bioregion)) <span class="sc">+</span></span>
<span id="cb102-791"><a href="#cb102-791"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.0</span>) <span class="sc">+</span></span>
<span id="cb102-792"><a href="#cb102-792"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Section), <span class="at">size =</span> <span class="fl">3.0</span>, <span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb102-793"><a href="#cb102-793"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb102-794"><a href="#cb102-794"></a>    <span class="at">data =</span> E.Y2.bp.sign,</span>
<span id="cb102-795"><a href="#cb102-795"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> x, <span class="at">yend =</span> y),</span>
<span id="cb102-796"><a href="#cb102-796"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)),</span>
<span id="cb102-797"><a href="#cb102-797"></a>    <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb102-798"><a href="#cb102-798"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb102-799"><a href="#cb102-799"></a>    <span class="at">size =</span> <span class="fl">0.7</span></span>
<span id="cb102-800"><a href="#cb102-800"></a>  ) <span class="sc">+</span></span>
<span id="cb102-801"><a href="#cb102-801"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb102-802"><a href="#cb102-802"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(E.Y2.text.sign),</span>
<span id="cb102-803"><a href="#cb102-803"></a>    <span class="fu">aes</span>(x, y, <span class="at">label =</span> <span class="fu">rownames</span>(E.Y2.text.sign)),</span>
<span id="cb102-804"><a href="#cb102-804"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb102-805"><a href="#cb102-805"></a>  ) <span class="sc">+</span></span>
<span id="cb102-806"><a href="#cb102-806"></a>  <span class="fu">xlab</span>(<span class="st">"CAP1"</span>) <span class="sc">+</span></span>
<span id="cb102-807"><a href="#cb102-807"></a>  <span class="fu">ylab</span>(<span class="st">"CAP2"</span>) <span class="sc">+</span></span>
<span id="cb102-808"><a href="#cb102-808"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Thermal variables and "</span>, beta[sne]))) <span class="sc">+</span></span>
<span id="cb102-809"><a href="#cb102-809"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb102-810"><a href="#cb102-810"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-811"><a href="#cb102-811"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb102-812"><a href="#cb102-812"></a>    <span class="at">legend.position.inside =</span> <span class="fu">c</span>(.<span class="dv">80</span>, .<span class="dv">75</span>),</span>
<span id="cb102-813"><a href="#cb102-813"></a>    <span class="at">aspect.ratio =</span> <span class="fl">0.8</span></span>
<span id="cb102-814"><a href="#cb102-814"></a>  )</span>
<span id="cb102-815"><a href="#cb102-815"></a><span class="in">```</span></span>
<span id="cb102-816"><a href="#cb102-816"></a></span>
<span id="cb102-817"><a href="#cb102-817"></a>Here I now assemble the various panels into what we see produced in Fig. 2 in the paper:</span>
<span id="cb102-818"><a href="#cb102-818"></a></span>
<span id="cb102-819"><a href="#cb102-819"></a><span class="in">```{r code-make-fig-2a-d}</span></span>
<span id="cb102-820"><a href="#cb102-820"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb102-821"><a href="#cb102-821"></a><span class="co">#| fig-height: 8.25</span></span>
<span id="cb102-822"><a href="#cb102-822"></a><span class="co">#| fig.align: center</span></span>
<span id="cb102-823"><a href="#cb102-823"></a></span>
<span id="cb102-824"><a href="#cb102-824"></a><span class="fu">ggarrange</span>(</span>
<span id="cb102-825"><a href="#cb102-825"></a>  E.Y1.p,</span>
<span id="cb102-826"><a href="#cb102-826"></a>  E.Y2.p,</span>
<span id="cb102-827"><a href="#cb102-827"></a>  S.Y1.p,</span>
<span id="cb102-828"><a href="#cb102-828"></a>  S.Y2.p,</span>
<span id="cb102-829"><a href="#cb102-829"></a>  <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb102-830"><a href="#cb102-830"></a>  <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb102-831"><a href="#cb102-831"></a>  <span class="at">labels =</span> <span class="st">"AUTO"</span>,</span>
<span id="cb102-832"><a href="#cb102-832"></a>  <span class="at">common.legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb102-833"><a href="#cb102-833"></a>  <span class="at">legend =</span> <span class="st">"top"</span></span>
<span id="cb102-834"><a href="#cb102-834"></a>)</span>
<span id="cb102-835"><a href="#cb102-835"></a><span class="in">```</span></span>
<span id="cb102-836"><a href="#cb102-836"></a></span>
<span id="cb102-837"><a href="#cb102-837"></a>And I do the same with assembling the panels that form Fig. 3 in the paper:</span>
<span id="cb102-838"><a href="#cb102-838"></a></span>
<span id="cb102-839"><a href="#cb102-839"></a><span class="in">```{r fn-make-fig-3a-e}</span></span>
<span id="cb102-840"><a href="#cb102-840"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb102-841"><a href="#cb102-841"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb102-842"><a href="#cb102-842"></a><span class="co">#| fig.align: center</span></span>
<span id="cb102-843"><a href="#cb102-843"></a></span>
<span id="cb102-844"><a href="#cb102-844"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb102-845"><a href="#cb102-845"></a>grid<span class="sc">::</span><span class="fu">pushViewport</span>(grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout =</span> grid<span class="sc">::</span><span class="fu">grid.layout</span>(<span class="dv">3</span>, <span class="dv">2</span>)))</span>
<span id="cb102-846"><a href="#cb102-846"></a>vplayout <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb102-847"><a href="#cb102-847"></a>  grid<span class="sc">::</span><span class="fu">viewport</span>(<span class="at">layout.pos.row =</span> x, <span class="at">layout.pos.col =</span> y)</span>
<span id="cb102-848"><a href="#cb102-848"></a>}</span>
<span id="cb102-849"><a href="#cb102-849"></a><span class="fu">print</span>(E.Y1.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb102-850"><a href="#cb102-850"></a><span class="fu">print</span>(E.Y1.plt.axis2, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb102-851"><a href="#cb102-851"></a><span class="fu">print</span>(E.Y2.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb102-852"><a href="#cb102-852"></a><span class="fu">print</span>(S.Y1.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb102-853"><a href="#cb102-853"></a><span class="fu">print</span>(S.Y2.plt.axis1, <span class="at">vp =</span> <span class="fu">vplayout</span>(<span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb102-854"><a href="#cb102-854"></a><span class="in">```</span></span>
<span id="cb102-855"><a href="#cb102-855"></a></span>
<span id="cb102-856"><a href="#cb102-856"></a>::: callout-note</span>
<span id="cb102-857"><a href="#cb102-857"></a><span class="fu">## **MEMs and Their Interpretation**</span></span>
<span id="cb102-858"><a href="#cb102-858"></a></span>
<span id="cb102-859"><a href="#cb102-859"></a>MEMs (Moran's Eigenvector Maps) are spatial variables used to represent different scales of spatial structure in spatial ecological data. They accomplish the following:</span>
<span id="cb102-860"><a href="#cb102-860"></a></span>
<span id="cb102-861"><a href="#cb102-861"></a><span class="ss">1. </span>Account for spatial autocorrelation that might be present due to the nature of ecological processes and geographic proximity of sampling sites (processes at a specific site might be affected by nearly processes, but less so by processes operating further away).</span>
<span id="cb102-862"><a href="#cb102-862"></a><span class="ss">2. </span>Capture and model spatial patterns that may not be directly accounted for by measured environmental variables.</span>
<span id="cb102-863"><a href="#cb102-863"></a><span class="ss">3. </span>Separate the effects of pure spatial processes from pure environmental influences on species distributions.</span>
<span id="cb102-864"><a href="#cb102-864"></a></span>
<span id="cb102-865"><a href="#cb102-865"></a>In this instance, the MEMs were made from a spatial connectivity matrix that considered the geographic relationships between sampling sites. Here, I used a minimum spanning tree (MST) topology to focus on connections between neighbouring coastal sections.</span>
<span id="cb102-866"><a href="#cb102-866"></a></span>
<span id="cb102-867"><a href="#cb102-867"></a>The insights MEMs provide are:</span>
<span id="cb102-868"><a href="#cb102-868"></a></span>
<span id="cb102-869"><a href="#cb102-869"></a><span class="ss">1. </span>Modelling spatial structures at multiple scales, from broad (large eigenvectors) to fine (smaller eigenvectors).</span>
<span id="cb102-870"><a href="#cb102-870"></a><span class="ss">2. </span>Identify spatially structured patterns in species communities that may be due to factors beyond measured environmental variables.</span>
<span id="cb102-871"><a href="#cb102-871"></a><span class="ss">3. </span>Assist with partitioning of variation in community composition into purely spatial, purely environmental, and spatially structured environmental components.</span>
<span id="cb102-872"><a href="#cb102-872"></a></span>
<span id="cb102-873"><a href="#cb102-873"></a>The bottom panels (with the spatial structures captured by the MEMs) show the Canonical Analysis of Principal Coordinates (CAP1) of spatial variables for $\beta_{sim}$ (species turnover) and $\beta_{sne}$ (nestedness). We see that:</span>
<span id="cb102-874"><a href="#cb102-874"></a></span>
<span id="cb102-875"><a href="#cb102-875"></a><span class="ss">1. </span>There is a strong spatial gradient along the coast, as indicated by the change in circle size and shading from west to east.</span>
<span id="cb102-876"><a href="#cb102-876"></a><span class="ss">2. </span>The spatial pattern is similar for both $\beta_{sim}$ and $\beta_{sne}$, which suggests that both components of $\beta$-diversity have a strong spatial structure.</span>
<span id="cb102-877"><a href="#cb102-877"></a><span class="ss">3. </span>The western and eastern ends of the coast show the most distinct spatial patterns (larger circles), indicating stronger spatial effects in these areas.</span>
<span id="cb102-878"><a href="#cb102-878"></a><span class="ss">4. </span>The middle section of the coast shows smaller circles, suggesting weaker spatial effects or more homogeneous communities in this region.</span>
<span id="cb102-879"><a href="#cb102-879"></a><span class="ss">5. </span>The differences in patterns between $\beta_{sim}$ and $\beta_{sne}$ suggests that nestedness (neutral-processes) are quite prominent along the west coast.</span>
<span id="cb102-880"><a href="#cb102-880"></a>:::</span>
<span id="cb102-881"><a href="#cb102-881"></a></span>
<span id="cb102-882"><a href="#cb102-882"></a><span class="fu">## Partitioning of Variance</span></span>
<span id="cb102-883"><a href="#cb102-883"></a></span>
<span id="cb102-884"><a href="#cb102-884"></a>Lastly, using **vegan**'s <span class="in">`varpart()`</span> function, I partition the variance between the MEM variables and the thermal variables <span class="co">[</span><span class="ot">@Peres-Neto2006; @PeresNeto2010</span><span class="co">]</span>.</span>
<span id="cb102-885"><a href="#cb102-885"></a></span>
<span id="cb102-886"><a href="#cb102-886"></a><span class="in">```{r fig-y1-y2-varpart}</span></span>
<span id="cb102-887"><a href="#cb102-887"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb102-888"><a href="#cb102-888"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-889"><a href="#cb102-889"></a><span class="co">#| fig.align: center</span></span>
<span id="cb102-890"><a href="#cb102-890"></a></span>
<span id="cb102-891"><a href="#cb102-891"></a><span class="co"># These lines of code produce a few figures to visually understand</span></span>
<span id="cb102-892"><a href="#cb102-892"></a><span class="co"># the variance partitioning on Y1:</span></span>
<span id="cb102-893"><a href="#cb102-893"></a>vp2.Y1 <span class="ot">&lt;-</span> <span class="fu">varpart</span>(Y1, E.Y1.red, S.Y1.red)</span>
<span id="cb102-894"><a href="#cb102-894"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb102-895"><a href="#cb102-895"></a><span class="fu">showvarparts</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"Environ-</span><span class="sc">\n</span><span class="st">ment"</span>, <span class="st">""</span>, <span class="st">"Spatial"</span>, <span class="st">""</span>))</span>
<span id="cb102-896"><a href="#cb102-896"></a><span class="fu">plot</span>(vp2.Y1, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb102-897"><a href="#cb102-897"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb102-898"><a href="#cb102-898"></a></span>
<span id="cb102-899"><a href="#cb102-899"></a><span class="co"># Now I test the significant fractions [a], [b] and [c]...</span></span>
<span id="cb102-900"><a href="#cb102-900"></a>ES.Y1.red <span class="ot">&lt;-</span> <span class="fu">cbind</span>(E.Y1.red, S.Y1.red)</span>
<span id="cb102-901"><a href="#cb102-901"></a>S.Y1.mem_terms <span class="ot">&lt;-</span> <span class="fu">colnames</span>(S.Y1.red)</span>
<span id="cb102-902"><a href="#cb102-902"></a>S.Y1.env_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"augMean"</span>, <span class="st">"febRange"</span>, <span class="st">"febSD"</span>, <span class="st">"augSD"</span>)</span>
<span id="cb102-903"><a href="#cb102-903"></a>S.Y1.formula.E_given_S <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(</span>
<span id="cb102-904"><a href="#cb102-904"></a>  <span class="fu">paste0</span>(</span>
<span id="cb102-905"><a href="#cb102-905"></a>    <span class="st">"Y1 ~ "</span>,</span>
<span id="cb102-906"><a href="#cb102-906"></a>    <span class="fu">paste</span>(S.Y1.env_terms, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb102-907"><a href="#cb102-907"></a>    <span class="st">" + Condition("</span>,</span>
<span id="cb102-908"><a href="#cb102-908"></a>    <span class="fu">paste</span>(S.Y1.mem_terms, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb102-909"><a href="#cb102-909"></a>    <span class="st">")"</span></span>
<span id="cb102-910"><a href="#cb102-910"></a>  )</span>
<span id="cb102-911"><a href="#cb102-911"></a>)</span>
<span id="cb102-912"><a href="#cb102-912"></a>S.Y1.formula.S_given_E <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(</span>
<span id="cb102-913"><a href="#cb102-913"></a>  <span class="fu">paste0</span>(</span>
<span id="cb102-914"><a href="#cb102-914"></a>    <span class="st">"Y1 ~ "</span>,</span>
<span id="cb102-915"><a href="#cb102-915"></a>    <span class="fu">paste</span>(S.Y1.mem_terms, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb102-916"><a href="#cb102-916"></a>    <span class="st">" + Condition("</span>,</span>
<span id="cb102-917"><a href="#cb102-917"></a>    <span class="fu">paste</span>(S.Y1.env_terms, <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb102-918"><a href="#cb102-918"></a>    <span class="st">")"</span></span>
<span id="cb102-919"><a href="#cb102-919"></a>  )</span>
<span id="cb102-920"><a href="#cb102-920"></a>)</span>
<span id="cb102-921"><a href="#cb102-921"></a></span>
<span id="cb102-922"><a href="#cb102-922"></a><span class="co"># Fraction E | S; pure environmental, i.e. [a]:</span></span>
<span id="cb102-923"><a href="#cb102-923"></a><span class="fu">anova.cca</span>(</span>
<span id="cb102-924"><a href="#cb102-924"></a>  <span class="fu">capscale</span>(S.Y1.formula.E_given_S, <span class="at">data =</span> ES.Y1.red),</span>
<span id="cb102-925"><a href="#cb102-925"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb102-926"><a href="#cb102-926"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb102-927"><a href="#cb102-927"></a>)</span>
<span id="cb102-928"><a href="#cb102-928"></a></span>
<span id="cb102-929"><a href="#cb102-929"></a><span class="co"># Fraction S | E; pure spatial, i.e. [c]:</span></span>
<span id="cb102-930"><a href="#cb102-930"></a><span class="fu">anova.cca</span>(</span>
<span id="cb102-931"><a href="#cb102-931"></a>  <span class="fu">capscale</span>(S.Y1.formula.S_given_E, <span class="at">data =</span> ES.Y1.red),</span>
<span id="cb102-932"><a href="#cb102-932"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb102-933"><a href="#cb102-933"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb102-934"><a href="#cb102-934"></a>)</span>
<span id="cb102-935"><a href="#cb102-935"></a></span>
<span id="cb102-936"><a href="#cb102-936"></a><span class="co"># Fraction E; environmental, i.e. [a] + [b]:</span></span>
<span id="cb102-937"><a href="#cb102-937"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., E.Y1.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span>
<span id="cb102-938"><a href="#cb102-938"></a></span>
<span id="cb102-939"><a href="#cb102-939"></a><span class="co"># Fractions S; spatial, i.e. [b] + [c]:</span></span>
<span id="cb102-940"><a href="#cb102-940"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., S.Y1.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span>
<span id="cb102-941"><a href="#cb102-941"></a></span>
<span id="cb102-942"><a href="#cb102-942"></a><span class="co"># Fractions E + S; spatial and environmental, i.e. [a] + [b] + [c]:</span></span>
<span id="cb102-943"><a href="#cb102-943"></a><span class="fu">anova.cca</span>(</span>
<span id="cb102-944"><a href="#cb102-944"></a>  <span class="fu">capscale</span>(Y1 <span class="sc">~</span> ., <span class="fu">cbind</span>(E.Y1.red, S.Y1.red)),</span>
<span id="cb102-945"><a href="#cb102-945"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb102-946"><a href="#cb102-946"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb102-947"><a href="#cb102-947"></a>)</span>
<span id="cb102-948"><a href="#cb102-948"></a></span>
<span id="cb102-949"><a href="#cb102-949"></a><span class="co"># And now the partitioning of the variance in Y2:</span></span>
<span id="cb102-950"><a href="#cb102-950"></a>(vp2.Y2 <span class="ot">&lt;-</span> <span class="fu">varpart</span>(Y2, E.Y2.red, S.Y2.red))</span>
<span id="cb102-951"><a href="#cb102-951"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb102-952"><a href="#cb102-952"></a><span class="fu">showvarparts</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="st">"Environ-</span><span class="sc">\n</span><span class="st">ment"</span>, <span class="st">""</span>, <span class="st">"Spatial"</span>, <span class="st">""</span>))</span>
<span id="cb102-953"><a href="#cb102-953"></a><span class="fu">plot</span>(vp2.Y2, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb102-954"><a href="#cb102-954"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb102-955"><a href="#cb102-955"></a></span>
<span id="cb102-956"><a href="#cb102-956"></a><span class="co"># Tests the significant fractions [a], [b] and [c]...</span></span>
<span id="cb102-957"><a href="#cb102-957"></a>ES.Y2.red <span class="ot">&lt;-</span> <span class="fu">cbind</span>(E.Y2.red, S.Y2.red)</span>
<span id="cb102-958"><a href="#cb102-958"></a></span>
<span id="cb102-959"><a href="#cb102-959"></a><span class="co"># Fraction E | S; pure environmental, i.e. [a]:</span></span>
<span id="cb102-960"><a href="#cb102-960"></a><span class="fu">anova.cca</span>(</span>
<span id="cb102-961"><a href="#cb102-961"></a>  <span class="fu">capscale</span>(</span>
<span id="cb102-962"><a href="#cb102-962"></a>    Y2 <span class="sc">~</span></span>
<span id="cb102-963"><a href="#cb102-963"></a>      annMean <span class="sc">+</span></span>
<span id="cb102-964"><a href="#cb102-964"></a>        <span class="fu">Condition</span>(MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3 <span class="sc">+</span> MEM5),</span>
<span id="cb102-965"><a href="#cb102-965"></a>    <span class="at">data =</span> ES.Y2.red</span>
<span id="cb102-966"><a href="#cb102-966"></a>  ),</span>
<span id="cb102-967"><a href="#cb102-967"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb102-968"><a href="#cb102-968"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb102-969"><a href="#cb102-969"></a>)</span>
<span id="cb102-970"><a href="#cb102-970"></a></span>
<span id="cb102-971"><a href="#cb102-971"></a><span class="co"># Fraction S | E; pure spatial, i.e. [c]:</span></span>
<span id="cb102-972"><a href="#cb102-972"></a><span class="fu">anova.cca</span>(</span>
<span id="cb102-973"><a href="#cb102-973"></a>  <span class="fu">capscale</span>(</span>
<span id="cb102-974"><a href="#cb102-974"></a>    Y2 <span class="sc">~</span> MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3 <span class="sc">+</span> MEM5 <span class="sc">+</span> <span class="fu">Condition</span>(annMean),</span>
<span id="cb102-975"><a href="#cb102-975"></a>    <span class="at">data =</span> ES.Y2.red</span>
<span id="cb102-976"><a href="#cb102-976"></a>  ),</span>
<span id="cb102-977"><a href="#cb102-977"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb102-978"><a href="#cb102-978"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb102-979"><a href="#cb102-979"></a>)</span>
<span id="cb102-980"><a href="#cb102-980"></a></span>
<span id="cb102-981"><a href="#cb102-981"></a><span class="co"># Fraction E; environmental, i.e. [a] + [b]:</span></span>
<span id="cb102-982"><a href="#cb102-982"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., E.Y2.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span>
<span id="cb102-983"><a href="#cb102-983"></a></span>
<span id="cb102-984"><a href="#cb102-984"></a><span class="co"># Fractions S; spatial, i.e. [b] + [c]:</span></span>
<span id="cb102-985"><a href="#cb102-985"></a><span class="fu">anova.cca</span>(<span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., S.Y2.red), <span class="at">parallel =</span> <span class="dv">4</span>, <span class="at">step =</span> <span class="dv">1000</span>)</span>
<span id="cb102-986"><a href="#cb102-986"></a></span>
<span id="cb102-987"><a href="#cb102-987"></a><span class="co"># Fractions E + S; spatial and environmental, i.e. [a] + [b] + [c]:</span></span>
<span id="cb102-988"><a href="#cb102-988"></a><span class="fu">anova.cca</span>(</span>
<span id="cb102-989"><a href="#cb102-989"></a>  <span class="fu">capscale</span>(Y2 <span class="sc">~</span> ., <span class="fu">cbind</span>(E.Y2.red, S.Y2.red)),</span>
<span id="cb102-990"><a href="#cb102-990"></a>  <span class="at">parallel =</span> <span class="dv">4</span>,</span>
<span id="cb102-991"><a href="#cb102-991"></a>  <span class="at">step =</span> <span class="dv">1000</span></span>
<span id="cb102-992"><a href="#cb102-992"></a>)</span>
<span id="cb102-993"><a href="#cb102-993"></a><span class="in">```</span></span>
<span id="cb102-994"><a href="#cb102-994"></a></span>
<span id="cb102-995"><a href="#cb102-995"></a><span class="fu">## Network Graphs of $\beta$-Diversity</span></span>
<span id="cb102-996"><a href="#cb102-996"></a></span>
<span id="cb102-997"><a href="#cb102-997"></a>This is Appendix C of the paper @smit2017seaweeds.</span>
<span id="cb102-998"><a href="#cb102-998"></a></span>
<span id="cb102-999"><a href="#cb102-999"></a>I delved deeper into the patterns of \textbeta-diversity by examining the properties of the full dissimilarity matrix, which gives regional \textbeta-diversity mentioned above. This matrix describes all pairwise combinations of sections (582 --- 1 = 3363), and as such gives us a regional perspective <span class="co">[</span><span class="ot">@Anderson2013</span><span class="co">]</span>.</span>
<span id="cb102-1000"><a href="#cb102-1000"></a></span>
<span id="cb102-1001"><a href="#cb102-1001"></a>The usual visualisation approach is to plot the dissimilarity metric as a function of geographical distance along the gradient or with respect to the distance between corresponding pairs of sections <span class="co">[</span><span class="ot">*e.g.*, @Nekola1999; @Davidar2007</span><span class="co">]</span>; these visualisations are provided here. The plots of dissimilarities were colour-coded according to the bioregion to which the section pairs belong (the Benguela Marine Province (BMP; **1**--**17**), the Benguela-Agulhas Transition Zone (B-ATZ; **18**--**22**), the Agulhas Marine Province (AMP; **19**--**43**/**44** --- the location of this transition is somewhat uncertain at this stage), and the East Coast Transition Zone (ECTZ; **44**/**45**--**58**) <span class="co">[</span><span class="ot">*sensu* @Bolton2004</span><span class="co">]</span> to distinguish bioregional properties of species distribution from the wider geographical scale structure along the whole coastline.</span>
<span id="cb102-1002"><a href="#cb102-1002"></a></span>
<span id="cb102-1003"><a href="#cb102-1003"></a>In doing so, the change in $\beta$-diversity per unit of separating distance between sections (km^-1^) could be calculated for each bioregion using linear regression. Since the connectivity between sections is constrained by their location along the shore, I calculated the distances between sections not as 'as the crow ﬂies' distances (*e.g.*, Section **1** is not connected in a straight line to Section **58** because of the intervening land in-between), but as the great circle geodesic distances between each pair of sections along a network of connected sections (vertices on a network graph). In other words, travelling from Section **1** to Section **58** requires travelling first along the coast through Section **2**, then Section **3**, and eventually all the way up to Section **58**. The total distance between a pair of arbitrary sections is therefore the cumulative sum of the great circle distances between each consecutive pair of intervening sections along the 'route'. This information is encapsulated as a square geodesic distance matrix, and can supply the distance along the abscissa against which species dissimilarities are plotted along the ordinate. The plots showing the relationship between \textbeta-diversity with distance are limited because they do not provide a geographical context.</span>
<span id="cb102-1004"><a href="#cb102-1004"></a></span>
<span id="cb102-1005"><a href="#cb102-1005"></a>To overcome this problem, I relied on a visualisation technique not commonly found in biogeographical studies to explicitly provide the geographical context. I structured the sections as vertices of a network graph and assigned to them their geographical coordinates to force a familiar layout of the graph --- when plotted on geographic coordinates, the sections form a map of South Africa. The species dissimilarities were assigned as edge weights (the lines connecting the **58** coastal sections) between pairs of sections and added to the map. The weights are directly proportional to the thickness of the edges and colours assigned to vertices (points or the 58 coastal sections) cluster the sections into their bioregions. Initially I used the **igraph** package that many people rave about, but I found it bothersome. So I devised a cunning way to create network graphs from scratch with some **dplyr** and **ggplot2** magic. I suppose that if I really wanted to I could have made neat functions here (and elsewhere) to reduce some of the repetitive nature of my code, but I really could not be bother doing that.</span>
<span id="cb102-1006"><a href="#cb102-1006"></a></span>
<span id="cb102-1007"><a href="#cb102-1007"></a><span class="in">```{r fn-network-graphs}</span></span>
<span id="cb102-1008"><a href="#cb102-1008"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb102-1009"><a href="#cb102-1009"></a><span class="co">#| fig-height: 7</span></span>
<span id="cb102-1010"><a href="#cb102-1010"></a><span class="co">#| fig.align: center</span></span>
<span id="cb102-1011"><a href="#cb102-1011"></a></span>
<span id="cb102-1012"><a href="#cb102-1012"></a><span class="co"># Visualise the pairwise dissimilarities as network graphs where the</span></span>
<span id="cb102-1013"><a href="#cb102-1013"></a><span class="co"># vertices are geographical coordinates and the edge lengths are the geodesic</span></span>
<span id="cb102-1014"><a href="#cb102-1014"></a><span class="co"># distances.</span></span>
<span id="cb102-1015"><a href="#cb102-1015"></a><span class="co"># These visualisations appear in the paper as Fig. 4.</span></span>
<span id="cb102-1016"><a href="#cb102-1016"></a><span class="fu">colnames</span>(sites) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>)</span>
<span id="cb102-1017"><a href="#cb102-1017"></a>sites <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">site =</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)), sites)</span>
<span id="cb102-1018"><a href="#cb102-1018"></a></span>
<span id="cb102-1019"><a href="#cb102-1019"></a>Y1.sl <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">expand.grid</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>), <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">58</span>)))</span>
<span id="cb102-1020"><a href="#cb102-1020"></a><span class="fu">colnames</span>(Y1.sl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"to"</span>, <span class="st">"from"</span>)</span>
<span id="cb102-1021"><a href="#cb102-1021"></a></span>
<span id="cb102-1022"><a href="#cb102-1022"></a>Y2.sl <span class="ot">&lt;-</span> Y1.sl</span>
<span id="cb102-1023"><a href="#cb102-1023"></a></span>
<span id="cb102-1024"><a href="#cb102-1024"></a><span class="co"># First Y1:</span></span>
<span id="cb102-1025"><a href="#cb102-1025"></a>Y1.sl<span class="sc">$</span>Y1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Y1)</span>
<span id="cb102-1026"><a href="#cb102-1026"></a></span>
<span id="cb102-1027"><a href="#cb102-1027"></a>Y1.sl.BMP <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb102-1028"><a href="#cb102-1028"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1029"><a href="#cb102-1029"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1030"><a href="#cb102-1030"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1031"><a href="#cb102-1031"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">16</span>)</span>
<span id="cb102-1032"><a href="#cb102-1032"></a></span>
<span id="cb102-1033"><a href="#cb102-1033"></a>Y1.sl.BATZ <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb102-1034"><a href="#cb102-1034"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1035"><a href="#cb102-1035"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1036"><a href="#cb102-1036"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1037"><a href="#cb102-1037"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">21</span>)</span>
<span id="cb102-1038"><a href="#cb102-1038"></a></span>
<span id="cb102-1039"><a href="#cb102-1039"></a>Y1.sl.AMP <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb102-1040"><a href="#cb102-1040"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1041"><a href="#cb102-1041"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1042"><a href="#cb102-1042"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1043"><a href="#cb102-1043"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">21</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">41</span>)</span>
<span id="cb102-1044"><a href="#cb102-1044"></a></span>
<span id="cb102-1045"><a href="#cb102-1045"></a>Y1.sl.ECTZ <span class="ot">&lt;-</span> Y1.sl <span class="sc">%&gt;%</span></span>
<span id="cb102-1046"><a href="#cb102-1046"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1047"><a href="#cb102-1047"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1048"><a href="#cb102-1048"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y1 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y1 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1049"><a href="#cb102-1049"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">41</span>)</span>
<span id="cb102-1050"><a href="#cb102-1050"></a></span>
<span id="cb102-1051"><a href="#cb102-1051"></a>Y1.sl <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Y1.sl.BMP, Y1.sl.BATZ, Y1.sl.AMP, Y1.sl.ECTZ)</span>
<span id="cb102-1052"><a href="#cb102-1052"></a></span>
<span id="cb102-1053"><a href="#cb102-1053"></a><span class="co"># and then Y2:</span></span>
<span id="cb102-1054"><a href="#cb102-1054"></a>Y2.sl<span class="sc">$</span>Y2 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Y2)</span>
<span id="cb102-1055"><a href="#cb102-1055"></a></span>
<span id="cb102-1056"><a href="#cb102-1056"></a>Y2.sl.BMP <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb102-1057"><a href="#cb102-1057"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1058"><a href="#cb102-1058"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1059"><a href="#cb102-1059"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1060"><a href="#cb102-1060"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">16</span>)</span>
<span id="cb102-1061"><a href="#cb102-1061"></a></span>
<span id="cb102-1062"><a href="#cb102-1062"></a>Y2.sl.BATZ <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb102-1063"><a href="#cb102-1063"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1064"><a href="#cb102-1064"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1065"><a href="#cb102-1065"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1066"><a href="#cb102-1066"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">21</span>)</span>
<span id="cb102-1067"><a href="#cb102-1067"></a></span>
<span id="cb102-1068"><a href="#cb102-1068"></a>Y2.sl.AMP <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb102-1069"><a href="#cb102-1069"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1070"><a href="#cb102-1070"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1071"><a href="#cb102-1071"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1072"><a href="#cb102-1072"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">21</span> <span class="sc">&amp;</span> from <span class="sc">&lt;=</span> <span class="dv">41</span>)</span>
<span id="cb102-1073"><a href="#cb102-1073"></a></span>
<span id="cb102-1074"><a href="#cb102-1074"></a>Y2.sl.ECTZ <span class="ot">&lt;-</span> Y2.sl <span class="sc">%&gt;%</span></span>
<span id="cb102-1075"><a href="#cb102-1075"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1076"><a href="#cb102-1076"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"site"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1077"><a href="#cb102-1077"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Y2 <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Y2 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1078"><a href="#cb102-1078"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> from <span class="sc">&gt;</span> <span class="dv">41</span>)</span>
<span id="cb102-1079"><a href="#cb102-1079"></a></span>
<span id="cb102-1080"><a href="#cb102-1080"></a>sa_lats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">38</span>, <span class="sc">-</span><span class="dv">26</span>)</span>
<span id="cb102-1081"><a href="#cb102-1081"></a>sa_lons <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">34</span>)</span>
<span id="cb102-1082"><a href="#cb102-1082"></a>sa_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(</span>
<span id="cb102-1083"><a href="#cb102-1083"></a>  <span class="fu">c</span>(<span class="at">xmin =</span> sa_lons[<span class="dv">1</span>], <span class="at">xmax =</span> sa_lons[<span class="dv">2</span>], <span class="at">ymin =</span> sa_lats[<span class="dv">1</span>], <span class="at">ymax =</span> sa_lats[<span class="dv">2</span>]),</span>
<span id="cb102-1084"><a href="#cb102-1084"></a>  <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)</span>
<span id="cb102-1085"><a href="#cb102-1085"></a>)</span>
<span id="cb102-1086"><a href="#cb102-1086"></a>south_africa_coast <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb102-1087"><a href="#cb102-1087"></a>south_africa_coast <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(south_africa_coast, sa_bbox)</span>
<span id="cb102-1088"><a href="#cb102-1088"></a></span>
<span id="cb102-1089"><a href="#cb102-1089"></a>net.plot.Y1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dissim =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">col.seq =</span> <span class="cn">NULL</span>) {</span>
<span id="cb102-1090"><a href="#cb102-1090"></a>  <span class="fu">ggplot</span>(dissim, <span class="fu">aes</span>(lon.x, lat.x)) <span class="sc">+</span></span>
<span id="cb102-1091"><a href="#cb102-1091"></a>    <span class="fu">geom_sf</span>(</span>
<span id="cb102-1092"><a href="#cb102-1092"></a>      <span class="at">data =</span> south_africa_coast,</span>
<span id="cb102-1093"><a href="#cb102-1093"></a>      <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb102-1094"><a href="#cb102-1094"></a>      <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb102-1095"><a href="#cb102-1095"></a>      <span class="at">fill =</span> <span class="st">"#F9FAEC"</span>,</span>
<span id="cb102-1096"><a href="#cb102-1096"></a>      <span class="at">col =</span> <span class="st">"#F9FAEC"</span></span>
<span id="cb102-1097"><a href="#cb102-1097"></a>    ) <span class="sc">+</span></span>
<span id="cb102-1098"><a href="#cb102-1098"></a>    <span class="fu">geom_curve</span>(</span>
<span id="cb102-1099"><a href="#cb102-1099"></a>      <span class="fu">aes</span>(<span class="at">xend =</span> lon.y, <span class="at">yend =</span> lat.y, <span class="at">col =</span> Y1, <span class="at">alpha =</span> (<span class="dv">1</span> <span class="sc">-</span> Y1) <span class="sc">-</span> <span class="fl">0.4</span>),</span>
<span id="cb102-1100"><a href="#cb102-1100"></a>      <span class="at">curvature =</span> <span class="fl">0.3</span></span>
<span id="cb102-1101"><a href="#cb102-1101"></a>    ) <span class="sc">+</span></span>
<span id="cb102-1102"><a href="#cb102-1102"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb102-1103"><a href="#cb102-1103"></a>      <span class="at">data =</span> sites,</span>
<span id="cb102-1104"><a href="#cb102-1104"></a>      <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">fill =</span> bioreg<span class="sc">$</span>bolton),</span>
<span id="cb102-1105"><a href="#cb102-1105"></a>      <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb102-1106"><a href="#cb102-1106"></a>      <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb102-1107"><a href="#cb102-1107"></a>    ) <span class="sc">+</span></span>
<span id="cb102-1108"><a href="#cb102-1108"></a>    <span class="fu">scale_fill_manual</span>(</span>
<span id="cb102-1109"><a href="#cb102-1109"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"AMP"</span>, <span class="st">"B-ATZ"</span>, <span class="st">"BMP"</span>, <span class="st">"ECTZ"</span>),</span>
<span id="cb102-1110"><a href="#cb102-1110"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorchid1"</span>, <span class="st">"aquamarine2"</span>, <span class="st">"blue1"</span>, <span class="st">"orangered1"</span>),</span>
<span id="cb102-1111"><a href="#cb102-1111"></a>      <span class="at">name =</span> <span class="st">"Bioregion"</span>,</span>
<span id="cb102-1112"><a href="#cb102-1112"></a>      <span class="at">guide =</span> <span class="cn">FALSE</span></span>
<span id="cb102-1113"><a href="#cb102-1113"></a>    ) <span class="sc">+</span></span>
<span id="cb102-1114"><a href="#cb102-1114"></a>    <span class="fu">scale_colour_gradient</span>(</span>
<span id="cb102-1115"><a href="#cb102-1115"></a>      <span class="at">name =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(beta[sim])),</span>
<span id="cb102-1116"><a href="#cb102-1116"></a>      <span class="at">low =</span> <span class="st">"antiquewhite4"</span>,</span>
<span id="cb102-1117"><a href="#cb102-1117"></a>      <span class="at">high =</span> <span class="st">"antiquewhite"</span></span>
<span id="cb102-1118"><a href="#cb102-1118"></a>    ) <span class="sc">+</span></span>
<span id="cb102-1119"><a href="#cb102-1119"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> sa_lons, <span class="at">ylim =</span> sa_lats, <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb102-1120"><a href="#cb102-1120"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">"°E"</span>)) <span class="sc">+</span></span>
<span id="cb102-1121"><a href="#cb102-1121"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">"°S"</span>)) <span class="sc">+</span></span>
<span id="cb102-1122"><a href="#cb102-1122"></a>    <span class="fu">scale_alpha_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb102-1123"><a href="#cb102-1123"></a>    <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb102-1124"><a href="#cb102-1124"></a>    <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb102-1125"><a href="#cb102-1125"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb102-1126"><a href="#cb102-1126"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb102-1127"><a href="#cb102-1127"></a>    <span class="fu">ggtitle</span>(title)</span>
<span id="cb102-1128"><a href="#cb102-1128"></a>}</span>
<span id="cb102-1129"><a href="#cb102-1129"></a></span>
<span id="cb102-1130"><a href="#cb102-1130"></a>a <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(</span>
<span id="cb102-1131"><a href="#cb102-1131"></a>  Y1.sl.BMP,</span>
<span id="cb102-1132"><a href="#cb102-1132"></a>  <span class="st">"Benguela Marine Province"</span>,</span>
<span id="cb102-1133"><a href="#cb102-1133"></a>  <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"white"</span>, <span class="st">"black"</span>)</span>
<span id="cb102-1134"><a href="#cb102-1134"></a>) <span class="sc">+</span> <span class="co"># alphabetical</span></span>
<span id="cb102-1135"><a href="#cb102-1135"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-1136"><a href="#cb102-1136"></a>    <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb102-1137"><a href="#cb102-1137"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.8</span>),</span>
<span id="cb102-1138"><a href="#cb102-1138"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)</span>
<span id="cb102-1139"><a href="#cb102-1139"></a>  )</span>
<span id="cb102-1140"><a href="#cb102-1140"></a>b <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(</span>
<span id="cb102-1141"><a href="#cb102-1141"></a>  Y1.sl.BATZ,</span>
<span id="cb102-1142"><a href="#cb102-1142"></a>  <span class="st">"Benguela-Agulhas Transition Zone"</span>,</span>
<span id="cb102-1143"><a href="#cb102-1143"></a>  <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)</span>
<span id="cb102-1144"><a href="#cb102-1144"></a>) <span class="sc">+</span></span>
<span id="cb102-1145"><a href="#cb102-1145"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb102-1146"><a href="#cb102-1146"></a>c <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(</span>
<span id="cb102-1147"><a href="#cb102-1147"></a>  Y1.sl.AMP,</span>
<span id="cb102-1148"><a href="#cb102-1148"></a>  <span class="st">"Agulhas Marine Province"</span>,</span>
<span id="cb102-1149"><a href="#cb102-1149"></a>  <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>)</span>
<span id="cb102-1150"><a href="#cb102-1150"></a>) <span class="sc">+</span></span>
<span id="cb102-1151"><a href="#cb102-1151"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb102-1152"><a href="#cb102-1152"></a>d <span class="ot">&lt;-</span> <span class="fu">net.plot.Y1</span>(</span>
<span id="cb102-1153"><a href="#cb102-1153"></a>  Y1.sl.ECTZ,</span>
<span id="cb102-1154"><a href="#cb102-1154"></a>  <span class="st">"East Coast Transition Zone"</span>,</span>
<span id="cb102-1155"><a href="#cb102-1155"></a>  <span class="at">col.seq =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"black"</span>, <span class="st">"white"</span>)</span>
<span id="cb102-1156"><a href="#cb102-1156"></a>) <span class="sc">+</span></span>
<span id="cb102-1157"><a href="#cb102-1157"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb102-1158"><a href="#cb102-1158"></a></span>
<span id="cb102-1159"><a href="#cb102-1159"></a><span class="fu">ggarrange</span>(a, b, c, d, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="st">"AUTO"</span>, <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-1160"><a href="#cb102-1160"></a><span class="in">```</span></span>
<span id="cb102-1161"><a href="#cb102-1161"></a></span>
<span id="cb102-1162"><a href="#cb102-1162"></a>And that is it, folks. You will notice that I have not reproduced Fig. 5 here. I will leave that up to you... or ask me and I will send the code. All of the matrices have (mostly) been calculated above and they can be used together with some **dplyr** and **ggplot2** know-how in the creation of that graph.</span>
<span id="cb102-1163"><a href="#cb102-1163"></a></span>
<span id="cb102-1164"><a href="#cb102-1164"></a>Legalise seaweed!</span>
<span id="cb102-1165"><a href="#cb102-1165"></a></span>
<span id="cb102-1166"><a href="#cb102-1166"></a><span class="fu">## References</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2026, AJ Smit</p>
</div>   
    <div class="nav-footer-center">

<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ajsmit/tangled_bank/edit/main/BCB743/two_oceans_appendices.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ajsmit/tangled_bank/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>