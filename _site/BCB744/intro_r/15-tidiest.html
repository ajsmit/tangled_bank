<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Smit, A. J.">
<meta name="dcterms.date" content="2021-01-01">
<title>15. Tidiest Data – The Tangled Bank</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../BCB744/intro_r/16-recap.html" rel="next">
<link href="../../BCB744/intro_r/14-tidier.html" rel="prev">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-8b4baf804e461d9b72633f0de59a0cac.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-37d9842ca13b32c9c58adfc4ed5d9451.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SCYH68M489"></script><script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SCYH68M489', { 'anonymize_ip': true});
</script><script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script><style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><link rel="stylesheet" href="../../styles/styles.css">
<meta property="og:title" content="15. Tidiest Data – The Tangled Bank">
<meta property="og:description" content="UWC’s Biodiversity &amp; Conservation Biology Department Pages For BDC223, BDC334, BCB743, and BCB744.">
<meta property="og:image" content="http://tangledbank.netlify.app/BCB744/intro_r/data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==">
<meta property="og:site_name" content="The Tangled Bank">
</head>
<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">The Tangled Bank</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-vignettes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Vignettes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-vignettes">
<li>
    <a class="dropdown-item" href="../../vignettes/netCDF_dates.html">
 <span class="dropdown-text">Dates From netCDF Files: Two Approaches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/prep_NOAA_OISST.html">
 <span class="dropdown-text">Downloading and Prep: ERDDAP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/chl_ERDDAP.html">
 <span class="dropdown-text">Retrieving Chlorophyll-a Data from ERDDAP Servers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/alt_method.html">
 <span class="dropdown-text">Downloading and Prep: Python + CDO</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/gridded_data.html">
 <span class="dropdown-text">Detecting Events in Gridded Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/regridding.html">
 <span class="dropdown-text">Regridding gridded data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/MHW_MCS_horizonplots.html">
 <span class="dropdown-text">Displaying MHWs and MCSs as Horizon Plots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/heatwaveR_issues.html">
 <span class="dropdown-text">heatwaveR Issues</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/chl_sightings.html">
 <span class="dropdown-text">Plotting the Whale Sightings and Chlorophyll-<em>a</em> Concentrations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/chl_localisation.html">
 <span class="dropdown-text">Spatial Localisation, Subsetting, and Aggregation of the Chlorophyll-<em>a</em> Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/elem_ts_methods.html">
 <span class="dropdown-text">Wavelet Analysis of Diatom Time Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/buffer_data_extract.html">
 <span class="dropdown-text">Extracting gridded data within a buffer</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-high-performance-computing" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">High-Performance Computing</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-high-performance-computing">
<li>
    <a class="dropdown-item" href="../../vignettes/README_Lengau.html">
 <span class="dropdown-text">Using Lengau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/PBSPro_users.html">
 <span class="dropdown-text">PBSPro user and job management</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../vignettes/README_tmux.html">
 <span class="dropdown-text">Using tmux</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Tangled Bank Blog</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-blogroll" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Blogroll</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-blogroll">
<li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">R-bloggers</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">
<li>
    <a class="dropdown-item" href="https://github.com/ajsmit/tangled_bank">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../BCB744/BCB744_index.html">BCB744: Introduction to R, &amp; Biostatistics</a></li><li class="breadcrumb-item"><a href="../../BCB744/intro_r/15-tidiest.html">15. Tidiest Data</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/my_tree_hex.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none"><img src="../../images/my_tree_hex.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">UNDERGRADUATE</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">BDC223: Plant Ecophysiology</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/BDC223_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L00-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductory Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L01-worldmapper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 1: the Limits to Life</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L02-SA_V.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 2: Surface Area to Volume (SA:V) Ratio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L03-climate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 3: Earth’s Climate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L04-carbon_cycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 4: Climate Change (Carbon Cycle)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L05-light.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 5: Light</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L06-pigments_photosynthesis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 6: Pigments &amp; Photosynthesis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L07-chromatic_adaptation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 7: Chromatic Adaptation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L08a-nutrient_uptake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 8a: Nutrient Uptake</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L08b-nutrients_michaelis_menten.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 8b: Nutrient Uptake</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/L09-plant_stress.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 3: Plant Stress</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/Lab1_SA_V.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Surface Area to Volume (SA/V) Ratios in Biology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/Lab2_misc_calcs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2: Miscellaneous Calculations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/Lab3_PI_curves.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3: PI Curves — Jassby &amp; Platt</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/Lab4_nitrogen_uptake.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4: Uptake Kinetics — Michaelis-Menten</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC223/BDC223_FAQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">BDC334: Biogeography &amp; Global Ecology</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/BDC334_syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/BDC334-Lecture-Transcripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="my-highlight">BCB334 Lecture Transcript</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lec-01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 1: Introductory Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lec-02-ecosystems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 2. Overview of Ecosystems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lec-03-gradients.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 3. Ecological Gradients</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lec-04-biodiversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 4: Biodiversity Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">Lecture 5: Multivariate Data</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lec-06-unified-ecology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 6: Unified Ecology</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">Lecture 7: Threats to Biodiversity</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">Lecture 8: Nature's Contribution to People</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/IKS_Conservation.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture 9: Indigenous Knowledge Systems and Conservation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lab-01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1. Ecological Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lab-02a-r_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2a. Introduction to R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lab-02b-env_dist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2b. Environmental Distance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lab-03-biodiversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3. Quantifying Biodiversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/Lab-04-biodiversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4. Species Distribution Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BDC334/BDC334_AI_Tutor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="my-highlight">BCB334 AI Tutor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/Transboundary_systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transboundary Systems</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">HONOURS CORE</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">BCB744: Introduction to R, &amp; Biostatistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/BCB744_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About</strong></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/01-RStudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/02-working-with-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Working with Data and Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/03-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. R Markdown and Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/04-data-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data Classes and Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/05-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. R Workflows</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/06-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Graphics with <strong>ggplot2</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/07-faceting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Faceting Figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/08-brewing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Brewing Colours</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/09-mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Mapping with <strong>ggplot2</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/10-mapping_style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Mapping with Style</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/11-mapping_rnaturalearth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Mapping with Natural Earth</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/12-mapping_quakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. The Fiji Earthquake Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/13-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Tidy Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/14-tidier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Tidier Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/15-tidiest.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">15. Tidiest Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/intro_r/16-recap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16. Synthesis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/assessments/BCB744_Intro_R_Self-Assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="my-highlight">Intro R Self-Assessment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/assessments/BCB744_Intro_R_Example_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Intro R Example 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/assessments/BCB744_Intro_R_Example_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 Intro R Example 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../self-assessment_v1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self-Assessment Form</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
 <span class="menu-text">1. Introduction to Statistics</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/02-summarise-and-describe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Data Summaries &amp; Descriptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/03-visualise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Statistical Figures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/04-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Data Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/05-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Statistical Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Assumptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/07-t_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. <em>t</em>-Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/08-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/09-regressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Simple Linear Regressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/10-correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Correlations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/11-decision_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Parametric Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/12-glance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Non-Parametric Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/13-confidence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/basic_stats/14-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Data Transformations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/assessments/BCB744_Biostatistics_Self-Assessment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="my-highlight">Biostatistics Self-Assessment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB744/assessments/BCB744_BioStats_Example_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB744 BioStats 2025 Example 1</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">HONOURS ELECTIVES</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">BCB743: Quantitative Ecology</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/BCB743_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>About</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1-4: Review Concepts of Biodiversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5: Correlations &amp; Associations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7: Intro to Ordination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8a: Principal Components Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/PCA_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8b: PCA: Additional Examples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/PCA_SDG_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8c: PCA: WHO SDG Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/CA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9a: Correspondence Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/DCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9b: Detrended Correspondence Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/PCoA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10: Principal Coordinates Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/nMDS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11a: Non-metric Multidimensional Scaling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/nMDS_diatoms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11b: nMDS: PERMANOVA (Diatoms) Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/unconstrained-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12: Unconstrained Ordination Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/constrained_ordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13a: Distance-Based Redundancy Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/two_oceans_appendices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13b: db-RDA: Seaweeds Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/cluster_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14: Cluster Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/model_building.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15: Model Building</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/deep_dive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16a: Deep Dive Into Gradients</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../BCB743/multiple_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16b: Multiple Regression</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">AI &amp; POLICY</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/Combined Faculty AI Policy 15082025.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Faculty of Natural Sciences AI Policy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../AI/BCB_AI_Workshop_Sep_2025.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BCB AI Workshop</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘︎</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">SUPPORT</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Web Resources</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/general_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/ecology_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantitative Ecology Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/spatial_resources_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial R Resources</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
 <span class="menu-text">☘☘☘︎</span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li>
<a href="#group-observations-rows-by-variables-columns-with-group_by" id="toc-group-observations-rows-by-variables-columns-with-group_by" class="nav-link" data-scroll-target="#group-observations-rows-by-variables-columns-with-group_by"><span class="header-section-number">2</span> Group Observations (Rows) by Variables (Columns) with <code>group_by()</code></a>
  <ul class="collapse">
<li><a href="#grouping-by-multiple-variables" id="toc-grouping-by-multiple-variables" class="nav-link" data-scroll-target="#grouping-by-multiple-variables"><span class="header-section-number">2.1</span> Grouping by Multiple Variables</a></li>
  <li><a href="#ungrouping" id="toc-ungrouping" class="nav-link" data-scroll-target="#ungrouping"><span class="header-section-number">2.2</span> Ungrouping</a></li>
  </ul>
</li>
  <li><a href="#chain-functions-with-the-pipe" id="toc-chain-functions-with-the-pipe" class="nav-link" data-scroll-target="#chain-functions-with-the-pipe"><span class="header-section-number">3</span> Chain Functions with the Pipe (<code>%&gt;%</code>)</a></li>
  <li><a href="#group-all-the-functions" id="toc-group-all-the-functions" class="nav-link" data-scroll-target="#group-all-the-functions"><span class="header-section-number">4</span> Group All the Functions!</a></li>
  <li><a href="#going-deeper" id="toc-going-deeper" class="nav-link" data-scroll-target="#going-deeper"><span class="header-section-number">5</span> Going Deeper</a></li>
  <li><a href="#pipe-into-ggplot2" id="toc-pipe-into-ggplot2" class="nav-link" data-scroll-target="#pipe-into-ggplot2"><span class="header-section-number">6</span> Pipe into <strong>ggplot2</strong></a></li>
  <li>
<a href="#additional-useful-functions" id="toc-additional-useful-functions" class="nav-link" data-scroll-target="#additional-useful-functions"><span class="header-section-number">7</span> Additional Useful Functions</a>
  <ul class="collapse">
<li><a href="#rename-variables-columns-with-rename" id="toc-rename-variables-columns-with-rename" class="nav-link" data-scroll-target="#rename-variables-columns-with-rename"><span class="header-section-number">7.1</span> Rename Variables (Columns) with <code>rename()</code></a></li>
  <li><a href="#create-a-new-dataframe-for-a-newly-created-variable-column-with-transmute" id="toc-create-a-new-dataframe-for-a-newly-created-variable-column-with-transmute" class="nav-link" data-scroll-target="#create-a-new-dataframe-for-a-newly-created-variable-column-with-transmute"><span class="header-section-number">7.2</span> Create a New Dataframe for a Newly Created Variable (Column) with <code>transmute()</code></a></li>
  <li><a href="#count-observations-rows-with-n" id="toc-count-observations-rows-with-n" class="nav-link" data-scroll-target="#count-observations-rows-with-n"><span class="header-section-number">7.3</span> Count Observations (Rows) with <code>n()</code></a></li>
  <li><a href="#select-observations-rows-by-number-with-slice" id="toc-select-observations-rows-by-number-with-slice" class="nav-link" data-scroll-target="#select-observations-rows-by-number-with-slice"><span class="header-section-number">7.4</span> Select Observations (Rows) by Number with <code>slice()</code></a></li>
  <li><a href="#summary-functions" id="toc-summary-functions" class="nav-link" data-scroll-target="#summary-functions"><span class="header-section-number">7.5</span> Summary Functions</a></li>
  </ul>
</li>
  <li><a href="#the-new-age-redux" id="toc-the-new-age-redux" class="nav-link" data-scroll-target="#the-new-age-redux"><span class="header-section-number">8</span> The New Age <em>Redux</em></a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/ajsmit/tangled_bank/edit/main/BCB744/intro_r/15-tidiest.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ajsmit/tangled_bank/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../BCB744/BCB744_index.html">BCB744: Introduction to R, &amp; Biostatistics</a></li><li class="breadcrumb-item"><a href="../../BCB744/intro_r/15-tidiest.html">15. Tidiest Data</a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">15. Tidiest Data</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://tangledbank.netlify.app">Smit, A. J.</a> <a href="https://orcid.org/0000-0002-3799-6126" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://uwc.ac.za">
            University of the Western Cape
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2021</p>
    </div>
  </div>
  
    
  </div>
  


</header><blockquote class="blockquote">
<p>“<em>Conducting data analysis is like drinking a fine wine. It is important to swirl and sniff the wine, to unpack the complex bouquet, to appreciate the experience. Gulping the wine does not work.</em>”</p>
<p>— Daniel B. Wright</p>
</blockquote>
<blockquote class="blockquote">
<p>“<em>If you torture the data long enough, it will confess to anything.</em>”</p>
<p>— Ronald Coase</p>
</blockquote>
<section id="introduction" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Introduction</h1>
<p>In the previous session you covered the five main transformation functions you would use in a typical tidy workflow. But to really unlock their power you need to learn how to use them with <code>group_by()</code>. This is how you calculate statistics based on grouping variables within your data, such as sites, species, or soil types, for example. Let us begin by loading the <strong>tidyverse</strong> package and the SACTN data if you have not already.</p>
<p>Grouped data are not a different kind of object. A grouped tibble is a regular data frame with <strong>grouping metadata attached</strong>. That metadata changes how verbs like <code>summarise()</code>, <code>mutate()</code>, and <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> behave.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Pipes as a thinking tool
</div>
</div>
<div class="callout-body-container callout-body">
<p>Each line should answer one question: “What rows do I want?” → “How should I group them?” → “What summary do I need?” If a pipeline feels confusing, run it stepwise and inspect intermediate outputs.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># load the data from a .RData file</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB744"</span>, <span class="st">"SACTNmonthly_v4.0.RData"</span>))</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># Copy the data as a dataframe with a shorter name</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>SACTN <span class="ot">&lt;-</span> SACTNmonthly_v4<span class="fl">.0</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># Remove the original</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">rm</span>(SACTNmonthly_v4<span class="fl">.0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="group-observations-rows-by-variables-columns-with-group_by" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Group Observations (Rows) by Variables (Columns) with <code>group_by()</code>
</h1>
<p>With the SACTN dataset loaded you will now look at the effect that <code>group_by()</code> has on other <code>tidyverse</code> functions. First you will create a new object called <code>SACTN_depth</code>. If you look at this object in the RStudio GUI it will not appear to be any different from <code>SACTN</code>. That is the danger: grouping is <strong>invisible</strong> unless you check it. You will see that <code>group_by()</code> is working as intended when you create summaries from the <code>SACTN_depth</code> dataframe.</p>
<p>Remember that you do not need to put the last bracket on its own line. I like to do so in order to reduce the chances that I will forget to type it after the final argument within the last function in the code chunk.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Group by depth</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>SACTN_depth <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">group_by</span>(depth)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># Check grouping explicitly</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="fu">group_vars</span>(SACTN_depth)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "depth"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">group_keys</span>(SACTN_depth)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 1
R&gt;   depth
R&gt;   &lt;dbl&gt;
R&gt; 1     0
R&gt; 2     2
R&gt; 3     3
R&gt; 4     4
R&gt; 5     5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Calculate mean temperature by depth</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>SACTN_depth_mean <span class="ot">&lt;-</span> SACTN_depth <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="at">count =</span> <span class="fu">n</span>()</span>
<span id="cb6-5"><a href="#cb6-5"></a>)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># Visualise the results</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>SACTN_depth_mean</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 13 × 3
R&gt;    depth mean_temp count
R&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
R&gt;  1     0      19.5 26299
R&gt;  2     2      13.0   237
R&gt;  3     3      17.6   141
R&gt;  4     4      16.6   529
R&gt;  5     5      15.0   408
R&gt;  6     7      17.2   227
R&gt;  7     8      17.8   201
R&gt;  8     9      13.8   311
R&gt;  9    10      19.5   362
R&gt; 10    12      24.3   137
R&gt; 11    14      22.3   223
R&gt; 12    18      24.4   191
R&gt; 13    28      14.8   306</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Before you continue: grouping checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>How many groups do you have?</li>
<li>Which variables define them?</li>
<li>Do you expect many rows per group or one?</li>
</ul>
</div>
</div>
<p>Let us visualise the newly created summary dataframe and see what we get there.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Why does the relationship between depth and temperature look so odd?</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SACTN_depth_mean, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> depth, <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> count), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-tidiest-group-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-tidiest-group-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="15-tidiest_files/figure-html/fig-tidiest-group-2-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Relationship between depth and mean temperature."><img src="15-tidiest_files/figure-html/fig-tidiest-group-2-1.svg" class="img-fluid figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidiest-group-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Relationship between depth and mean temperature.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Row-wise vs group-wise thinking
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>group_by()</code> changes the unit of work from <strong>rows</strong> to <strong>groups</strong>.<br><code>summarise()</code> collapses each group to fewer rows; <code>mutate()</code> keeps row count but uses group-wise calculations.</p>
</div>
</div>
<section id="grouping-by-multiple-variables" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="grouping-by-multiple-variables">
<span class="header-section-number">2.1</span> Grouping by Multiple Variables</h2>
<p>As you may have guessed by now, grouping is not confined to a single column. One may use any number of columns to perform elaborate grouping measures. Let us look at some ways of doing this with the SACTN data.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Create groupings based on temperatures and depth</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>SACTN_temp_group <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">group_by</span>(<span class="fu">round</span>(temp), depth)</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co"># Create groupings based on source and date</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>SACTN_src_group <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">group_by</span>(src, date)</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co"># Create groupings based on date and depth</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>SACTN_date_group <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="fu">group_by</span>(date, depth)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now that you have created some grouped dataframes, let us think of some ways to summarise these data.</p>
<p>Why tidyverse grouping? It keeps your data in tidy shape, fits naturally into pipelines, and makes your assumptions about groups explicit. Base alternatives exist, but <code>group_by() + summarise()</code> is usually easier to read and audit.</p>
</section><section id="ungrouping" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="ungrouping">
<span class="header-section-number">2.2</span> Ungrouping</h2>
<p>Once you level up our <strong>tidyverse</strong> skills you will routinely be grouping variables while calculating statistics. This then poses the problem of losing track of which dataframes are grouped and which are not. <strong>Grouping persists</strong> until you remove it, and that persistence can surprise you in later steps. Happily, to remove any grouping we just use <code>ungroup()</code>. No arguments required, just the empty function by itself. Too easy.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>SACTN_ungroup <span class="ot">&lt;-</span> SACTN_date_group <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Tip: if you are done summarising, <code>ungroup()</code> immediately so that later steps do not inherit group structure by accident.</p>
</section></section><section id="chain-functions-with-the-pipe" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Chain Functions with the Pipe (<code>%&gt;%</code>)</h1>
<p>This now brings you to the last major concept you need to become confident with for this workshop. Everything you have learned thus far builds on everything else in a modular way, with most concepts and steps being interchangeable. The pipe takes all of the things we have learned and takes them to the next level. And the best part about it is that it requires us to learn nothing new. You have been doing it all along, perhaps without even realising it. Let us see what I mean. The following chunk does in one command what the first chunk in the previous section took two steps. This is not only faster, but saves you from having to create intermediate dataframes that only slow down our computer and clog up your environment.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>SACTN_depth_mean_2 <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> <span class="co"># Choose a base dataframe</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">group_by</span>(depth) <span class="sc">%&gt;%</span> <span class="co"># Group by the depth column</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Calculate means</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="at">count =</span> <span class="fu">n</span>() <span class="co"># Count observations</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>) <span class="co"># Safety measure</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Take a moment and compare the <code>SACTN_depth_mean_2</code> object that you have just created against the <code>SACTN_depth_mean</code> object you created at the beginning of this session. Same same.</p>
<p>Not only does this keep your workflow tidier, it also makes it easier to read for yourselves, your colleagues, and most importantly, your future selves. When you look at the previous code chunk you can think of it as a paragraph in a research report, with each line a sentence. If I were to interpret this chunk of code in plain English I think it would sound something like this:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In order to create the <code>SACTN_depth_mean_2</code> dataframe I first started by taking the original SACTN data. I then grouped the data into different depth categories. After this I calculated the mean temperature for each depth category, as well as counting the number of observations within each depth group.</p>
</div>
</div>
<p>Just like paragraphs in a human language may vary in length, so too may code chunks. There really is no limit. This is not to say that it is encouraged to attempt to reproduce a code chunk of comparable length to anything Marcel Proust would have written. It is helpful to break things up into pieces of a certain size. What that size is though is open to the discretion of the person writing the code. It is up to you to find out for yourself what works best for you.</p>
</section><section id="group-all-the-functions" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Group All the Functions!</h1>
<p>You have played around quite a bit with grouping and summarising, but that is not all you can do. You can use <code>group_by()</code> very nicely with <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> and <code>mutate()</code> as well.</p>
<p>You can do some rather imaginative things when you combine all of these tools together. In fact, you should be able to accomplish almost any task you can think of. For example, what if you wanted to create a new object that is a subset of only the sites in the <code>SACTN</code> that had at least 30 years (360 months) of data?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>SACTN_30_years <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">360</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Or what if we wanted to calculate anomaly data for each site?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>SACTN_anom <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">mutate</span>(<span class="at">anom =</span> temp <span class="sc">-</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">select</span>(site<span class="sc">:</span>date, anom, depth, type) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Thinking aloud: why each step?
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="co"># 1) Choose the rows we care about</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">filter</span>(site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Paternoster"</span>, <span class="st">"Oudekraal"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="co"># 2) Declare the grouping logic</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="co"># 3) Compute a group-wise summary</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-8"><a href="#cb14-8"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="co"># 4) Drop grouping once we are done</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Each line answers a single question. If you can explain each line, the pipeline is doing the right thing.</p>
</div>
</div>
<p>Now, let us select only two sites, calculate their mean and standard deviations. Note how whichever columns you give to<code>group_by()</code> will be carried over into the new dataframe created by <code>summarise()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Paternoster"</span> <span class="sc">|</span> site <span class="sc">==</span> <span class="st">"Oudekraal"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb15-5"><a href="#cb15-5"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 3 × 4
R&gt; # Groups:   site [2]
R&gt;   site        src   mean_temp sd_temp
R&gt;   &lt;fct&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
R&gt; 1 Paternoster DEA        12.8   0.879
R&gt; 2 Paternoster SAWS       13.6   1.40 
R&gt; 3 Oudekraal   DAFF       12.3   1.36</code></pre>
</div>
</div>
<p>Remember: grouping choices encode scientific assumptions. Summarising across the wrong groups is not just “statistically odd” – it can be conceptually invalid.</p>
</section><section id="going-deeper" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Going Deeper</h1>
<p>You learned in the previous session that you should avoid using comparison operators to compare logical arguments as this tends to not produce the results you would expect. Below you will see what happens when you try to repeat the code chunk above, but using a logical operator within a comparison operator.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Paternoster"</span> <span class="sc">|</span> <span class="st">"Oudekraal"</span>) <span class="sc">%&gt;%</span> <span class="co"># This line has been changed/shortened</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb17-5"><a href="#cb17-5"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Oh no, you broke it! This is a common error while learning to write code so do try to keep this rule in mind as it can cause a lot of headaches. An easy way to spot this problem is if your line of code has more logical operators than comparison operators you are probably going to have a bad time. This is doubly unfortunate as you would need to write less code if this were not so. Happily, there is a shortcut for just this problem, <code>%in%</code>. Whenever you want to use operators to filter by more than two things, it is most convenient to create an object that contains the names, numbers that you want to filter by. You then replace your comparison and logical operators with that one simple symbol (<code>%in%</code>).</p>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Common pitfall rule of thumb
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you see a <strong>standalone character string</strong> inside <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, something is almost certainly wrong.<br>
Use <code>%in%</code> when you want to match against a list of values.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># First create a character vector containing the desired sites</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>selected_sites <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Paternoster"</span>, <span class="st">"Oudekraal"</span>, <span class="st">"Muizenberg"</span>, <span class="st">"Humewood"</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co"># Then calculate the statistics</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">filter</span>(site <span class="sc">%in%</span> selected_sites) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb18-9"><a href="#cb18-9"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 4
R&gt; # Groups:   site [4]
R&gt;   site        src   mean_temp sd_temp
R&gt;   &lt;fct&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
R&gt; 1 Paternoster DEA        12.8   0.879
R&gt; 2 Paternoster SAWS       13.6   1.40 
R&gt; 3 Oudekraal   DAFF       12.3   1.36 
R&gt; 4 Muizenberg  SAWS       15.9   2.76 
R&gt; 5 Humewood    SAWS       18.0   2.03</code></pre>
</div>
</div>
<p>The <code>%in%</code> operator can be a very useful shortcut, but sometimes you cannot avoid the comparison, logical operator dance. For example, if you wanted to find temperatures at Port Nolloth that were over 10°C but under 15°C you could use either of the following two filters. Remember that whenever you see a <code>,</code> in the filter function it is the same as the <code>&amp;</code> logical operator. Of the two different techniques shown below, I would be more inclined to use the first one. The fewer symbols you use to write your code the better. Both for readability, error reduction.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Port Nolloth"</span>, temp <span class="sc">&gt;</span> <span class="dv">10</span>, temp <span class="sc">&lt;</span> <span class="dv">15</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Port Nolloth"</span>, <span class="sc">!</span>(temp <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">|</span> temp  <span class="sc">&gt;=</span> <span class="dv">15</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>As you may imagine, performing intricate logical arguments like this may get out of hand rather quickly. It is advisable to save intermediate steps in a complex workflow to avoid too much heartache. Where exactly these ‘fire breaks’ should be made is up to the person writing the code.</p>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Common pitfalls to watch for
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Forgetting to <code>ungroup()</code> and getting unexpected multiple rows.</li>
<li>Using <code>|</code> instead of <code>%in%</code> for multi-value matches.</li>
<li>Using <code>n()</code> without grouping and assuming it is per-group.</li>
<li>Using <code>slice()</code> as if it were stable over time.</li>
</ul>
</div>
</div>
</section><section id="pipe-into-ggplot2" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> Pipe into <strong>ggplot2</strong>
</h1>
<p>It is also possible to combine piped code chunks and <strong>ggplot2</strong> chunks into one ‘combi-chunk’. I prefer not to do this as I like saving the new dataframe I have created as an object in my environment before visualising it so that if anything has gone wrong (as things tend to do) I can more easily find the problem.</p>
<p>Regardless of what you may or may not prefer to do, the one thing that must be mentioned about piping into <strong>ggplot2</strong> is that when you start with the <code>ggplot()</code> function you switch over from the pipe (<code>%&gt;%</code>) to the plus sign (<code>+</code>). There are currently efforts to address this inconvenience, but are not yet ready for public consumption.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>SACTN <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">filter</span>(site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bordjies"</span>, <span class="st">"Tsitsikamma"</span>, <span class="st">"Humewood"</span>, <span class="st">"Durban"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">select</span>(<span class="sc">-</span>depth, <span class="sc">-</span>type) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb21-5"><a href="#cb21-5"></a>         <span class="at">index =</span> <span class="fu">paste</span>(site, src, <span class="at">sep =</span> <span class="st">"/ "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="fu">group_by</span>(index, month) <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-8"><a href="#cb21-8"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_temp <span class="sc">-</span> sd_temp, <span class="at">ymax =</span> mean_temp <span class="sc">+</span> sd_temp), </span>
<span id="cb21-11"><a href="#cb21-11"></a>              <span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"navy"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>index) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">"Temperature (°C)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-tidyiest-ggplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-tidyiest-ggplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="15-tidiest_files/figure-html/fig-tidyiest-ggplot-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: Line and ribbon plots for the climatologies of several sites."><img src="15-tidiest_files/figure-html/fig-tidyiest-ggplot-1.svg" class="img-fluid figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidyiest-ggplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Line and ribbon plots for the climatologies of several sites.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="additional-useful-functions" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> Additional Useful Functions</h1>
<p>There is an avalanche of useful functions to be found within the <strong>tidyverse</strong>. In truth, you have only looked at functions from three packages: <strong>ggplot2</strong>, <strong>dplyr</strong>, and <strong>tidyr</strong>. There are far, far too many functions even within these three packages to cover within a week. But that does not mean that the functions in other packages, such as <strong><code>purrr</code></strong> are not also massively useful for our work. For now we will see how the inclusion of a handful of choice extra functions may help to make our workflow even tidier.</p>
<section id="rename-variables-columns-with-rename" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="rename-variables-columns-with-rename">
<span class="header-section-number">7.1</span> Rename Variables (Columns) with <code>rename()</code>
</h2>
<p>You have seen that you select columns in a dataframe with <code>select()</code>, but if you want to rename columns you have to use, you guessed it, <code>rename()</code>. This functions works by first telling R the new name you would like, and then the existing name of the column to be changed. This is perhaps a bit back to front, but such is life on occasion.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">rename</span>(<span class="at">source =</span> src)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;            site source       date     temp depth type
R&gt; 1  Port Nolloth    DEA 1991-02-01 11.47029     5  UTR
R&gt; 2  Port Nolloth    DEA 1991-03-01 11.99409     5  UTR
R&gt; 3  Port Nolloth    DEA 1991-04-01 11.95556     5  UTR
R&gt; 4  Port Nolloth    DEA 1991-05-01 11.86183     5  UTR
R&gt; 5  Port Nolloth    DEA 1991-06-01 12.20722     5  UTR
R&gt; 6  Port Nolloth    DEA 1991-07-01 12.53810     5  UTR
R&gt; 7  Port Nolloth    DEA 1991-08-01 11.25202     5  UTR
R&gt; 8  Port Nolloth    DEA 1991-09-01 11.29208     5  UTR
R&gt; 9  Port Nolloth    DEA 1991-10-01 11.37661     5  UTR
R&gt; 10 Port Nolloth    DEA 1991-11-01 10.98208     5  UTR</code></pre>
</div>
</div>
</section><section id="create-a-new-dataframe-for-a-newly-created-variable-column-with-transmute" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="create-a-new-dataframe-for-a-newly-created-variable-column-with-transmute">
<span class="header-section-number">7.2</span> Create a New Dataframe for a Newly Created Variable (Column) with <code>transmute()</code>
</h2>
<p>If for whatever reason you wanted to create a new variable (column), as you would do with <code>mutate()</code>, but you do not want to keep the dataframe from which the new column was created, the function to use is <code>transmute()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">transmute</span>(<span class="at">kelvin =</span> temp <span class="sc">+</span> <span class="fl">273.15</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;  [1] 284.6203 285.1441 285.1056 285.0118 285.3572 285.6881 284.4020 284.4421
R&gt;  [9] 284.5266 284.1321</code></pre>
</div>
</div>
<p>This makes a bit more sense when paired with <code>group_by()</code> as it will pull over the grouping variables into the new dataframe. Note that when it does this for you automatically it will provide a message in the console.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">transmute</span>(<span class="at">kelvin =</span> temp <span class="sc">+</span> <span class="fl">273.15</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 10 × 3
R&gt; # Groups:   site, src [1]
R&gt;    site         src   kelvin
R&gt;    &lt;fct&gt;        &lt;chr&gt;  &lt;dbl&gt;
R&gt;  1 Port Nolloth DEA     285.
R&gt;  2 Port Nolloth DEA     285.
R&gt;  3 Port Nolloth DEA     285.
R&gt;  4 Port Nolloth DEA     285.
R&gt;  5 Port Nolloth DEA     285.
R&gt;  6 Port Nolloth DEA     286.
R&gt;  7 Port Nolloth DEA     284.
R&gt;  8 Port Nolloth DEA     284.
R&gt;  9 Port Nolloth DEA     285.
R&gt; 10 Port Nolloth DEA     284.</code></pre>
</div>
</div>
</section><section id="count-observations-rows-with-n" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="count-observations-rows-with-n">
<span class="header-section-number">7.3</span> Count Observations (Rows) with <code>n()</code>
</h2>
<p>You have already seen this function sneak its way into a few of the code chunks in the previous session. You use <code>n()</code> to count any grouped variable automatically. It cannot be given any arguments, so you must organise our dataframe in order to satisfy its needs. It is the diva function of the <strong>tidyverse</strong>; however, it is terribly useful as you usually want to know how many observations your summary stats are based on.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Read grouped output carefully
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you see multiple rows after <code>summarise()</code>, you are still grouped.<br>
If you use <code>n()</code> without grouping, it counts <strong>all</strong> rows.</p>
</div>
</div>
<p>First you will run some stats, create a figure without documenting <code>n</code>. Then you will include <code>n</code> and see how that changes your conclusions.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a> SACTN_n <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">round</span>(<span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">arrange</span>(mean_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">select</span>(mean_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="fu">unique</span>()</span>
<span id="cb28-8"><a href="#cb28-8"></a></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SACTN_n, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(SACTN_n), <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Temperature (°C)"</span>) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb28-13"><a href="#cb28-13"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-tidiest-n-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-tidiest-n-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="15-tidiest_files/figure-html/fig-tidiest-n-1-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;3: Dot plot showing range of mean temperatures for the time series in the SACTN dataset."><img src="15-tidiest_files/figure-html/fig-tidiest-n-1-1.svg" class="img-fluid figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidiest-n-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Dot plot showing range of mean temperatures for the time series in the SACTN dataset.
</figcaption></figure>
</div>
</div>
</div>
<p>This looks like a pretty linear distribution of temperatures within the SACTN dataset. But now let us change the size of the dots to show how frequently each of these mean temperatures is occurring.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a> SACTN_n <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">round</span>(<span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="fu">select</span>(mean_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6"></a>  <span class="fu">group_by</span>(mean_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb29-8"><a href="#cb29-8"></a></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SACTN_n, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(SACTN_n), <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> count)) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Temperature (°C)"</span>) <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb29-13"><a href="#cb29-13"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-tidiest-n-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-tidiest-n-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="15-tidiest_files/figure-html/fig-tidiest-n-2-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;4: Dot plot showing range of mean temperatures for the time series in the SACTN dataset with the size of each dot showing the number of occurrences of each mean."><img src="15-tidiest_files/figure-html/fig-tidiest-n-2-1.svg" class="img-fluid figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidiest-n-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Dot plot showing range of mean temperatures for the time series in the SACTN dataset with the size of each dot showing the number of occurrences of each mean.
</figcaption></figure>
</div>
</div>
</div>
<p>You see now when you include the count (<code>n</code>) of the different mean temperatures that this distribution is not so even. There appear to be humps around 17°C and 22°C. Of course, you have created dot plots here just to illustrate this point. In reality if you were interested in a distribution like this one would use a histogram, or better yet, a density polygon.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">round</span>(<span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T))</span>
<span id="cb30-4"><a href="#cb30-4"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"seagreen"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (°C)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-tidiest-n-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-tidiest-n-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="15-tidiest_files/figure-html/fig-tidiest-n-3-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;5: Frequency distribution of mean temperature for each time series in the SACTN dataset."><img src="15-tidiest_files/figure-html/fig-tidiest-n-3-1.svg" class="img-fluid figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidiest-n-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Frequency distribution of mean temperature for each time series in the SACTN dataset.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="select-observations-rows-by-number-with-slice" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="select-observations-rows-by-number-with-slice">
<span class="header-section-number">7.4</span> Select Observations (Rows) by Number with <code>slice()</code>
</h2>
<p>If you want to select only specific rows of a dataframe, rather than using some variable like you do for <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, you use <code>slice()</code>. The function expects us to provide it with a series of integers as seen in the following code chunk. Try playing around with these values and see what happens</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Slice a sequence of rows</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">slice</span>(<span class="dv">10010</span><span class="sc">:</span><span class="dv">10020</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="co"># Slice specific rows</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>SACTN <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">19</span>,<span class="dv">24</span>,<span class="dv">3</span>,<span class="dv">400</span>))</span>
<span id="cb31-8"><a href="#cb31-8"></a></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="co"># Slice all rows except these</span></span>
<span id="cb31-10"><a href="#cb31-10"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb31-11"><a href="#cb31-11"></a>  <span class="fu">slice</span>(<span class="sc">-</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">4</span>)))</span>
<span id="cb31-12"><a href="#cb31-12"></a></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="co"># Slice all rows except a sequence</span></span>
<span id="cb31-14"><a href="#cb31-14"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb31-15"><a href="#cb31-15"></a>  <span class="fu">slice</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>It is discouraged to use slice to remove or select specific rows of data as this does not discriminate against any possible future changes in ones data. Meaning that if at some point in the future new data are added to a dataset, re-running this code will likely no longer be selecting the correct rows. This is why <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> is a main function, <code>slice()</code> is not. This auxiliary function can however still be quite useful when combined with arrange.</p>
<p>Rule of thumb: if you care about <strong>reproducibility</strong>, prefer <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> over <code>slice()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># The top 5 variable sites as measured by SD</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">summarise</span>(<span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sd_temp)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 3
R&gt;   site       src   sd_temp
R&gt;   &lt;fct&gt;      &lt;chr&gt;   &lt;dbl&gt;
R&gt; 1 Muizenberg SAWS     2.76
R&gt; 2 Stilbaai   SAWS     2.72
R&gt; 3 Mossel Bay SAWS     2.65
R&gt; 4 De Hoop    DAFF     2.51
R&gt; 5 Mossel Bay DEA      2.51</code></pre>
</div>
</div>
</section><section id="summary-functions" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="summary-functions">
<span class="header-section-number">7.5</span> Summary Functions</h2>
<p>There is a near endless sea of possibilities when one starts to become comfortable with writing R code. You have seen several summary functions used thus far. Mostly in straightforward ways. But that is one of the fun things about R, the only limits to what you may create are within your mind, not the program. Here is just one example of a creative way to answer a straightforward question: ‘What is the proportion of recordings above 15°C per source?’. Note how you may refer to columns you have created within the same chunk. There is no need to save the intermediate dataframes if we choose not to.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="fu">group_by</span>(src) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), </span>
<span id="cb34-5"><a href="#cb34-5"></a>            <span class="at">count_15 =</span> <span class="fu">sum</span>(temp <span class="sc">&gt;</span> <span class="dv">15</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="#cb34-6"></a>  <span class="fu">mutate</span>(<span class="at">prop_15 =</span> count_15<span class="sc">/</span>count) <span class="sc">%&gt;%</span> </span>
<span id="cb34-7"><a href="#cb34-7"></a>  <span class="fu">arrange</span>(prop_15)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 7 × 4
R&gt;   src   count count_15 prop_15
R&gt;   &lt;chr&gt; &lt;int&gt;    &lt;int&gt;   &lt;dbl&gt;
R&gt; 1 DAFF    641      246   0.384
R&gt; 2 SAWS   8636     4882   0.565
R&gt; 3 UWC      12        7   0.583
R&gt; 4 DEA    2087     1388   0.665
R&gt; 5 SAEON   596      573   0.961
R&gt; 6 EKZNW   369      369   1    
R&gt; 7 KZNSB 15313    15313   1</code></pre>
</div>
</div>
<p>The output of grouped summaries like this is the <strong>shape most modelling and statistical functions expect</strong>: one row per unit, one column per variable. Keep that endpoint in mind as you design your pipelines.</p>
</section></section><section id="the-new-age-redux" class="level1" data-number="8"><h1 data-number="8">
<span class="header-section-number">8</span> The New Age <em>Redux</em>
</h1>
<p>Remember the spreadsheet example from the first day of the R workshop? Here it is repeated in a more efficient way. Now with bonus ribbons! In this chunk you see how to load, transform, and visualise the data all in one go. You would not normally do this, but it sure is snappy!</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB744"</span>, <span class="st">"SACTN_data.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">group_by</span>(site, month) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-5"><a href="#cb36-5"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> mean_temp, <span class="at">group =</span> site)) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_temp <span class="sc">-</span> sd_temp, <span class="at">ymax =</span> mean_temp <span class="sc">+</span> sd_temp), </span>
<span id="cb36-8"><a href="#cb36-8"></a>              <span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> site)) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour =</span> site)) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Temperature (°C)"</span>, <span class="at">colour =</span> <span class="st">"Site"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-tidiest-new-age" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-tidiest-new-age-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="15-tidiest_files/figure-html/fig-tidiest-new-age-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;6: Tidiest new age."><img src="15-tidiest_files/figure-html/fig-tidiest-new-age-1.svg" class="img-fluid figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidiest-new-age-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Tidiest new age.
</figcaption></figure>
</div>
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{smit,_a._j.2021,
  author = {Smit, A. J.,},
  title = {15. {Tidiest} {Data}},
  date = {2021-01-01},
  url = {http://tangledbank.netlify.app/BCB744/intro_r/15-tidiest.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-smit,_a._j.2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Smit, A. J. (2021) 15. Tidiest Data. <a href="http://tangledbank.netlify.app/BCB744/intro_r/15-tidiest.html">http://tangledbank.netlify.app/BCB744/intro_r/15-tidiest.html.
</a>
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("http:\/\/tangledbank\.netlify\.app");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../BCB744/intro_r/14-tidier.html" class="pagination-link" aria-label="14. Tidier Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">14. Tidier Data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../BCB744/intro_r/16-recap.html" class="pagination-link" aria-label="16. Synthesis">
        <span class="nav-page-text">16. Synthesis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="an">date:</span><span class="co"> "2021-01-01"</span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="an">title:</span><span class="co"> "15. Tidiest Data"</span></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="co">---</span></span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="in">```{r code-brewing-opts, echo=FALSE}</span></span>
<span id="cb37-7"><a href="#cb37-7"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb37-8"><a href="#cb37-8"></a>  <span class="at">comment =</span> <span class="st">"R&gt;"</span>, </span>
<span id="cb37-9"><a href="#cb37-9"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>, </span>
<span id="cb37-10"><a href="#cb37-10"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-11"><a href="#cb37-11"></a>  <span class="at">fig.width =</span> <span class="fl">4.5</span>,</span>
<span id="cb37-12"><a href="#cb37-12"></a>  <span class="at">fig.height =</span> <span class="fl">2.625</span>,</span>
<span id="cb37-13"><a href="#cb37-13"></a>  <span class="at">out.width =</span> <span class="st">"75%"</span>,</span>
<span id="cb37-14"><a href="#cb37-14"></a>  <span class="at">fig.asp =</span> <span class="cn">NULL</span>, <span class="co"># control via width/height</span></span>
<span id="cb37-15"><a href="#cb37-15"></a>  <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb37-16"><a href="#cb37-16"></a>)</span>
<span id="cb37-17"><a href="#cb37-17"></a></span>
<span id="cb37-18"><a href="#cb37-18"></a>ggplot2<span class="sc">::</span><span class="fu">theme_set</span>(</span>
<span id="cb37-19"><a href="#cb37-19"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">8</span>)</span>
<span id="cb37-20"><a href="#cb37-20"></a>)</span>
<span id="cb37-21"><a href="#cb37-21"></a>ggplot2<span class="sc">::</span><span class="fu">theme_set</span>(</span>
<span id="cb37-22"><a href="#cb37-22"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">8</span>)</span>
<span id="cb37-23"><a href="#cb37-23"></a>)</span>
<span id="cb37-24"><a href="#cb37-24"></a><span class="in">```</span></span>
<span id="cb37-25"><a href="#cb37-25"></a></span>
<span id="cb37-26"><a href="#cb37-26"></a><span class="at">&gt; "*Conducting data analysis is like drinking a fine wine. It is important to swirl and sniff the wine, to unpack the complex bouquet, to appreciate the experience. Gulping the wine does not work.*"</span></span>
<span id="cb37-27"><a href="#cb37-27"></a><span class="at">&gt; </span></span>
<span id="cb37-28"><a href="#cb37-28"></a><span class="at">&gt; --- Daniel B. Wright</span></span>
<span id="cb37-29"><a href="#cb37-29"></a>  </span>
<span id="cb37-30"><a href="#cb37-30"></a><span class="at">&gt; "*If you torture the data long enough, it will confess to anything.*"</span></span>
<span id="cb37-31"><a href="#cb37-31"></a><span class="at">&gt;</span></span>
<span id="cb37-32"><a href="#cb37-32"></a><span class="at">&gt; --- Ronald Coase</span></span>
<span id="cb37-33"><a href="#cb37-33"></a></span>
<span id="cb37-34"><a href="#cb37-34"></a><span class="fu"># Introduction</span></span>
<span id="cb37-35"><a href="#cb37-35"></a></span>
<span id="cb37-36"><a href="#cb37-36"></a>In the previous session you covered the five main transformation functions you would use in a typical tidy workflow. But to really unlock their power you need to learn how to use them with <span class="in">`group_by()`</span>. This is how you calculate statistics based on grouping variables within your data, such as sites, species, or soil types, for example. Let us begin by loading the **tidyverse** package and the SACTN data if you have not already.</span>
<span id="cb37-37"><a href="#cb37-37"></a></span>
<span id="cb37-38"><a href="#cb37-38"></a>Grouped data are not a different kind of object. A grouped tibble is a regular data frame with **grouping metadata attached**. That metadata changes how verbs like <span class="in">`summarise()`</span>, <span class="in">`mutate()`</span>, and <span class="in">`filter()`</span> behave.</span>
<span id="cb37-39"><a href="#cb37-39"></a></span>
<span id="cb37-40"><a href="#cb37-40"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb37-41"><a href="#cb37-41"></a><span class="fu">## Pipes as a thinking tool</span></span>
<span id="cb37-42"><a href="#cb37-42"></a>Each line should answer one question:</span>
<span id="cb37-43"><a href="#cb37-43"></a>"What rows do I want?" → "How should I group them?" → "What summary do I need?"</span>
<span id="cb37-44"><a href="#cb37-44"></a>If a pipeline feels confusing, run it stepwise and inspect intermediate outputs.</span>
<span id="cb37-45"><a href="#cb37-45"></a>:::</span>
<span id="cb37-46"><a href="#cb37-46"></a></span>
<span id="cb37-47"><a href="#cb37-47"></a><span class="in">```{r code-tidiest-load}</span></span>
<span id="cb37-48"><a href="#cb37-48"></a><span class="co"># Load libraries</span></span>
<span id="cb37-49"><a href="#cb37-49"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb37-50"><a href="#cb37-50"></a></span>
<span id="cb37-51"><a href="#cb37-51"></a><span class="co"># load the data from a .RData file</span></span>
<span id="cb37-52"><a href="#cb37-52"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB744"</span>, <span class="st">"SACTNmonthly_v4.0.RData"</span>))</span>
<span id="cb37-53"><a href="#cb37-53"></a></span>
<span id="cb37-54"><a href="#cb37-54"></a><span class="co"># Copy the data as a dataframe with a shorter name</span></span>
<span id="cb37-55"><a href="#cb37-55"></a>SACTN <span class="ot">&lt;-</span> SACTNmonthly_v4<span class="fl">.0</span></span>
<span id="cb37-56"><a href="#cb37-56"></a></span>
<span id="cb37-57"><a href="#cb37-57"></a><span class="co"># Remove the original</span></span>
<span id="cb37-58"><a href="#cb37-58"></a><span class="fu">rm</span>(SACTNmonthly_v4<span class="fl">.0</span>)</span>
<span id="cb37-59"><a href="#cb37-59"></a><span class="in">```</span></span>
<span id="cb37-60"><a href="#cb37-60"></a></span>
<span id="cb37-61"><a href="#cb37-61"></a><span class="fu"># Group Observations (Rows) by Variables (Columns) with `group_by()`</span></span>
<span id="cb37-62"><a href="#cb37-62"></a></span>
<span id="cb37-63"><a href="#cb37-63"></a>With the SACTN dataset loaded you will now look at the effect that <span class="in">`group_by()`</span> has on other <span class="in">`tidyverse`</span> functions. First you will create a new object called <span class="in">`SACTN_depth`</span>. If you look at this object in the RStudio GUI it will not appear to be any different from <span class="in">`SACTN`</span>. That is the danger: grouping is **invisible** unless you check it. You will see that <span class="in">`group_by()`</span> is working as intended when you create summaries from the <span class="in">`SACTN_depth`</span> dataframe.</span>
<span id="cb37-64"><a href="#cb37-64"></a></span>
<span id="cb37-65"><a href="#cb37-65"></a>Remember that you do not need to put the last bracket on its own line. I like to do so in order to reduce the chances that I will forget to type it after the final argument within the last function in the code chunk.</span>
<span id="cb37-66"><a href="#cb37-66"></a></span>
<span id="cb37-67"><a href="#cb37-67"></a><span class="in">```{r code-tidiest-group-1}</span></span>
<span id="cb37-68"><a href="#cb37-68"></a><span class="co"># Group by depth</span></span>
<span id="cb37-69"><a href="#cb37-69"></a>SACTN_depth <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-70"><a href="#cb37-70"></a>  <span class="fu">group_by</span>(depth)</span>
<span id="cb37-71"><a href="#cb37-71"></a></span>
<span id="cb37-72"><a href="#cb37-72"></a><span class="co"># Check grouping explicitly</span></span>
<span id="cb37-73"><a href="#cb37-73"></a><span class="fu">group_vars</span>(SACTN_depth)</span>
<span id="cb37-74"><a href="#cb37-74"></a><span class="fu">group_keys</span>(SACTN_depth)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb37-75"><a href="#cb37-75"></a></span>
<span id="cb37-76"><a href="#cb37-76"></a><span class="co"># Calculate mean temperature by depth</span></span>
<span id="cb37-77"><a href="#cb37-77"></a>SACTN_depth_mean <span class="ot">&lt;-</span> SACTN_depth <span class="sc">%&gt;%</span> </span>
<span id="cb37-78"><a href="#cb37-78"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-79"><a href="#cb37-79"></a>  <span class="at">count =</span> <span class="fu">n</span>()</span>
<span id="cb37-80"><a href="#cb37-80"></a>)</span>
<span id="cb37-81"><a href="#cb37-81"></a></span>
<span id="cb37-82"><a href="#cb37-82"></a><span class="co"># Visualise the results</span></span>
<span id="cb37-83"><a href="#cb37-83"></a>SACTN_depth_mean</span>
<span id="cb37-84"><a href="#cb37-84"></a><span class="in">```</span></span>
<span id="cb37-85"><a href="#cb37-85"></a></span>
<span id="cb37-86"><a href="#cb37-86"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb37-87"><a href="#cb37-87"></a><span class="fu">## Before you continue: grouping checkpoint</span></span>
<span id="cb37-88"><a href="#cb37-88"></a><span class="ss">- </span>How many groups do you have?</span>
<span id="cb37-89"><a href="#cb37-89"></a><span class="ss">- </span>Which variables define them?</span>
<span id="cb37-90"><a href="#cb37-90"></a><span class="ss">- </span>Do you expect many rows per group or one?</span>
<span id="cb37-91"><a href="#cb37-91"></a>:::</span>
<span id="cb37-92"><a href="#cb37-92"></a></span>
<span id="cb37-93"><a href="#cb37-93"></a>Let us visualise the newly created summary dataframe and see what we get there.</span>
<span id="cb37-94"><a href="#cb37-94"></a></span>
<span id="cb37-95"><a href="#cb37-95"></a><span class="in">```{r fig-tidiest-group-2, fig.cap="Relationship between depth and mean temperature."}</span></span>
<span id="cb37-96"><a href="#cb37-96"></a><span class="co"># Why does the relationship between depth and temperature look so odd?</span></span>
<span id="cb37-97"><a href="#cb37-97"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SACTN_depth_mean, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> depth, <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb37-98"><a href="#cb37-98"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> count), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb37-99"><a href="#cb37-99"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-100"><a href="#cb37-100"></a><span class="in">```</span></span>
<span id="cb37-101"><a href="#cb37-101"></a></span>
<span id="cb37-102"><a href="#cb37-102"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb37-103"><a href="#cb37-103"></a><span class="fu">## Row-wise vs group-wise thinking</span></span>
<span id="cb37-104"><a href="#cb37-104"></a><span class="in">`group_by()`</span> changes the unit of work from **rows** to **groups**.  </span>
<span id="cb37-105"><a href="#cb37-105"></a><span class="in">`summarise()`</span> collapses each group to fewer rows; <span class="in">`mutate()`</span> keeps row count but uses group-wise calculations.</span>
<span id="cb37-106"><a href="#cb37-106"></a>:::</span>
<span id="cb37-107"><a href="#cb37-107"></a></span>
<span id="cb37-108"><a href="#cb37-108"></a><span class="fu">## Grouping by Multiple Variables</span></span>
<span id="cb37-109"><a href="#cb37-109"></a></span>
<span id="cb37-110"><a href="#cb37-110"></a>As you may have guessed by now, grouping is not confined to a single column. One may use any number of columns to perform elaborate grouping measures. Let us look at some ways of doing this with the SACTN data.</span>
<span id="cb37-111"><a href="#cb37-111"></a></span>
<span id="cb37-112"><a href="#cb37-112"></a><span class="in">```{r code-tidiest-group-3, eval=FALSE}</span></span>
<span id="cb37-113"><a href="#cb37-113"></a><span class="co"># Create groupings based on temperatures and depth</span></span>
<span id="cb37-114"><a href="#cb37-114"></a>SACTN_temp_group <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-115"><a href="#cb37-115"></a>  <span class="fu">group_by</span>(<span class="fu">round</span>(temp), depth)</span>
<span id="cb37-116"><a href="#cb37-116"></a></span>
<span id="cb37-117"><a href="#cb37-117"></a><span class="co"># Create groupings based on source and date</span></span>
<span id="cb37-118"><a href="#cb37-118"></a>SACTN_src_group <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-119"><a href="#cb37-119"></a>  <span class="fu">group_by</span>(src, date)</span>
<span id="cb37-120"><a href="#cb37-120"></a></span>
<span id="cb37-121"><a href="#cb37-121"></a><span class="co"># Create groupings based on date and depth</span></span>
<span id="cb37-122"><a href="#cb37-122"></a>SACTN_date_group <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-123"><a href="#cb37-123"></a>  <span class="fu">group_by</span>(date, depth)</span>
<span id="cb37-124"><a href="#cb37-124"></a><span class="in">```</span></span>
<span id="cb37-125"><a href="#cb37-125"></a></span>
<span id="cb37-126"><a href="#cb37-126"></a>Now that you have created some grouped dataframes, let us think of some ways to summarise these data.</span>
<span id="cb37-127"><a href="#cb37-127"></a></span>
<span id="cb37-128"><a href="#cb37-128"></a>Why tidyverse grouping? It keeps your data in tidy shape, fits naturally into pipelines, and makes your assumptions about groups explicit. Base alternatives exist, but <span class="in">`group_by() + summarise()`</span> is usually easier to read and audit.</span>
<span id="cb37-129"><a href="#cb37-129"></a></span>
<span id="cb37-130"><a href="#cb37-130"></a><span class="fu">## Ungrouping</span></span>
<span id="cb37-131"><a href="#cb37-131"></a></span>
<span id="cb37-132"><a href="#cb37-132"></a>Once you level up our **tidyverse** skills you will routinely be grouping variables while calculating statistics. This then poses the problem of losing track of which dataframes are grouped and which are not. **Grouping persists** until you remove it, and that persistence can surprise you in later steps. Happily, to remove any grouping we just use <span class="in">`ungroup()`</span>. No arguments required, just the empty function by itself. Too easy. </span>
<span id="cb37-133"><a href="#cb37-133"></a></span>
<span id="cb37-134"><a href="#cb37-134"></a><span class="in">```{r code-tidiest-group-4, eval=FALSE}</span></span>
<span id="cb37-135"><a href="#cb37-135"></a>SACTN_ungroup <span class="ot">&lt;-</span> SACTN_date_group <span class="sc">%&gt;%</span> </span>
<span id="cb37-136"><a href="#cb37-136"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-137"><a href="#cb37-137"></a><span class="in">```</span></span>
<span id="cb37-138"><a href="#cb37-138"></a></span>
<span id="cb37-139"><a href="#cb37-139"></a>Tip: if you are done summarising, <span class="in">`ungroup()`</span> immediately so that later steps do not inherit group structure by accident.</span>
<span id="cb37-140"><a href="#cb37-140"></a></span>
<span id="cb37-141"><a href="#cb37-141"></a><span class="fu"># Chain Functions with the Pipe (`%&gt;%`)</span></span>
<span id="cb37-142"><a href="#cb37-142"></a></span>
<span id="cb37-143"><a href="#cb37-143"></a>This now brings you to the last major concept you need to become confident with for this workshop. Everything you have learned thus far builds on everything else in a modular way, with most concepts and steps being interchangeable. The pipe takes all of the things we have learned and takes them to the next level. And the best part about it is that it requires us to learn nothing new. You have been doing it all along, perhaps without even realising it. Let us see what I mean. The following chunk does in one command what the first chunk in the previous section took two steps. This is not only faster, but saves you from having to create intermediate dataframes that only slow down our computer and clog up your environment.</span>
<span id="cb37-144"><a href="#cb37-144"></a></span>
<span id="cb37-145"><a href="#cb37-145"></a><span class="in">```{r code-tidiest-group-5, eval=FALSE}</span></span>
<span id="cb37-146"><a href="#cb37-146"></a>SACTN_depth_mean_2 <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> <span class="co"># Choose a base dataframe</span></span>
<span id="cb37-147"><a href="#cb37-147"></a>  <span class="fu">group_by</span>(depth) <span class="sc">%&gt;%</span> <span class="co"># Group by the depth column</span></span>
<span id="cb37-148"><a href="#cb37-148"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Calculate means</span></span>
<span id="cb37-149"><a href="#cb37-149"></a>  <span class="at">count =</span> <span class="fu">n</span>() <span class="co"># Count observations</span></span>
<span id="cb37-150"><a href="#cb37-150"></a>) <span class="co"># Safety measure</span></span>
<span id="cb37-151"><a href="#cb37-151"></a><span class="in">```</span></span>
<span id="cb37-152"><a href="#cb37-152"></a></span>
<span id="cb37-153"><a href="#cb37-153"></a>Take a moment and compare the <span class="in">`SACTN_depth_mean_2`</span> object that you have just created against the <span class="in">`SACTN_depth_mean`</span> object you created at the beginning of this session. Same same.</span>
<span id="cb37-154"><a href="#cb37-154"></a></span>
<span id="cb37-155"><a href="#cb37-155"></a>Not only does this keep your workflow tidier, it also makes it easier to read for yourselves, your colleagues, and most importantly, your future selves. When you look at the previous code chunk you can think of it as a paragraph in a research report, with each line a sentence. If I were to interpret this chunk of code in plain English I think it would sound something like this: </span>
<span id="cb37-156"><a href="#cb37-156"></a>  </span>
<span id="cb37-157"><a href="#cb37-157"></a>::: {.callout-note}</span>
<span id="cb37-158"><a href="#cb37-158"></a><span class="fu">## Note</span></span>
<span id="cb37-159"><a href="#cb37-159"></a>In order to create the <span class="in">`SACTN_depth_mean_2`</span> dataframe I first started by taking the original SACTN data. I then grouped the data into different depth categories. After this I calculated the mean temperature for each depth category, as well as counting the number of observations within each depth group.</span>
<span id="cb37-160"><a href="#cb37-160"></a>:::</span>
<span id="cb37-161"><a href="#cb37-161"></a></span>
<span id="cb37-162"><a href="#cb37-162"></a>Just like paragraphs in a human language may vary in length, so too may code chunks. There really is no limit. This is not to say that it is encouraged to attempt to reproduce a code chunk of comparable length to anything Marcel Proust would have written. It is helpful to break things up into pieces of a certain size. What that size is though is open to the discretion of the person writing the code. It is up to you to find out for yourself what works best for you.</span>
<span id="cb37-163"><a href="#cb37-163"></a></span>
<span id="cb37-164"><a href="#cb37-164"></a><span class="fu"># Group All the Functions!</span></span>
<span id="cb37-165"><a href="#cb37-165"></a></span>
<span id="cb37-166"><a href="#cb37-166"></a>You have played around quite a bit with grouping and summarising, but that is not all you can do. You can use <span class="in">`group_by()`</span> very nicely with <span class="in">`filter()`</span> and <span class="in">`mutate()`</span> as well. </span>
<span id="cb37-167"><a href="#cb37-167"></a></span>
<span id="cb37-168"><a href="#cb37-168"></a>You can do some rather imaginative things when you combine all of these tools together. In fact, you should be able to accomplish almost any task you can think of. For example, what if you wanted to create a new object that is a subset of only the sites in the <span class="in">`SACTN`</span> that had at least 30 years (360 months) of data?</span>
<span id="cb37-169"><a href="#cb37-169"></a></span>
<span id="cb37-170"><a href="#cb37-170"></a><span class="in">```{r code-tidiest-group-6, eval=FALSE}</span></span>
<span id="cb37-171"><a href="#cb37-171"></a>SACTN_30_years <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span></span>
<span id="cb37-172"><a href="#cb37-172"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span></span>
<span id="cb37-173"><a href="#cb37-173"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">360</span>)</span>
<span id="cb37-174"><a href="#cb37-174"></a><span class="in">```</span></span>
<span id="cb37-175"><a href="#cb37-175"></a></span>
<span id="cb37-176"><a href="#cb37-176"></a>Or what if we wanted to calculate anomaly data for each site?</span>
<span id="cb37-177"><a href="#cb37-177"></a></span>
<span id="cb37-178"><a href="#cb37-178"></a><span class="in">```{r code-tidiest-group-7, eval=FALSE}</span></span>
<span id="cb37-179"><a href="#cb37-179"></a>SACTN_anom <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span></span>
<span id="cb37-180"><a href="#cb37-180"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-181"><a href="#cb37-181"></a>  <span class="fu">mutate</span>(<span class="at">anom =</span> temp <span class="sc">-</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-182"><a href="#cb37-182"></a>  <span class="fu">select</span>(site<span class="sc">:</span>date, anom, depth, type) <span class="sc">%&gt;%</span> </span>
<span id="cb37-183"><a href="#cb37-183"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-184"><a href="#cb37-184"></a><span class="in">```</span></span>
<span id="cb37-185"><a href="#cb37-185"></a></span>
<span id="cb37-186"><a href="#cb37-186"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb37-187"><a href="#cb37-187"></a><span class="fu">## Thinking aloud: why each step?</span></span>
<span id="cb37-188"><a href="#cb37-188"></a><span class="in">```{r code-tidiest-thinking, eval=FALSE}</span></span>
<span id="cb37-189"><a href="#cb37-189"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-190"><a href="#cb37-190"></a>  <span class="co"># 1) Choose the rows we care about</span></span>
<span id="cb37-191"><a href="#cb37-191"></a>  <span class="fu">filter</span>(site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Paternoster"</span>, <span class="st">"Oudekraal"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-192"><a href="#cb37-192"></a>  <span class="co"># 2) Declare the grouping logic</span></span>
<span id="cb37-193"><a href="#cb37-193"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span></span>
<span id="cb37-194"><a href="#cb37-194"></a>  <span class="co"># 3) Compute a group-wise summary</span></span>
<span id="cb37-195"><a href="#cb37-195"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-196"><a href="#cb37-196"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-197"><a href="#cb37-197"></a>  <span class="co"># 4) Drop grouping once we are done</span></span>
<span id="cb37-198"><a href="#cb37-198"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-199"><a href="#cb37-199"></a><span class="in">```</span></span>
<span id="cb37-200"><a href="#cb37-200"></a>Each line answers a single question. If you can explain each line, the pipeline is doing the right thing.</span>
<span id="cb37-201"><a href="#cb37-201"></a>:::</span>
<span id="cb37-202"><a href="#cb37-202"></a></span>
<span id="cb37-203"><a href="#cb37-203"></a>Now, let us select only two sites, calculate their mean and standard deviations. Note how whichever columns you give to<span class="in">`group_by()`</span> will be carried over into the new dataframe created by <span class="in">`summarise()`</span>.</span>
<span id="cb37-204"><a href="#cb37-204"></a></span>
<span id="cb37-205"><a href="#cb37-205"></a><span class="in">```{r code-tidiest-group-8}</span></span>
<span id="cb37-206"><a href="#cb37-206"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-207"><a href="#cb37-207"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Paternoster"</span> <span class="sc">|</span> site <span class="sc">==</span> <span class="st">"Oudekraal"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-208"><a href="#cb37-208"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-209"><a href="#cb37-209"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb37-210"><a href="#cb37-210"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb37-211"><a href="#cb37-211"></a><span class="in">```</span></span>
<span id="cb37-212"><a href="#cb37-212"></a></span>
<span id="cb37-213"><a href="#cb37-213"></a>Remember: grouping choices encode scientific assumptions. Summarising across the wrong groups is not just "statistically odd" -- it can be conceptually invalid.</span>
<span id="cb37-214"><a href="#cb37-214"></a></span>
<span id="cb37-215"><a href="#cb37-215"></a><span class="fu"># Going Deeper</span></span>
<span id="cb37-216"><a href="#cb37-216"></a></span>
<span id="cb37-217"><a href="#cb37-217"></a>You learned in the previous session that you should avoid using comparison operators to compare logical arguments as this tends to not produce the results you would expect. Below you will see what happens when you try to repeat the code chunk above, but using a logical operator within a comparison operator.</span>
<span id="cb37-218"><a href="#cb37-218"></a></span>
<span id="cb37-219"><a href="#cb37-219"></a><span class="in">```{r code-tidiest-logic-1, error=TRUE}</span></span>
<span id="cb37-220"><a href="#cb37-220"></a><span class="co">#| eval: false</span></span>
<span id="cb37-221"><a href="#cb37-221"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-222"><a href="#cb37-222"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Paternoster"</span> <span class="sc">|</span> <span class="st">"Oudekraal"</span>) <span class="sc">%&gt;%</span> <span class="co"># This line has been changed/shortened</span></span>
<span id="cb37-223"><a href="#cb37-223"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-224"><a href="#cb37-224"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb37-225"><a href="#cb37-225"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb37-226"><a href="#cb37-226"></a><span class="in">```</span></span>
<span id="cb37-227"><a href="#cb37-227"></a></span>
<span id="cb37-228"><a href="#cb37-228"></a>Oh no, you broke it! This is a common error while learning to write code so do try to keep this rule in mind as it can cause a lot of headaches. An easy way to spot this problem is if your line of code has more logical operators than comparison operators you are probably going to have a bad time. This is doubly unfortunate as you would need to write less code if this were not so. Happily, there is a shortcut for just this problem, <span class="in">`%in%`</span>. Whenever you want to use operators to filter by more than two things, it is most convenient to create an object that contains the names, numbers that you want to filter by. You then replace your comparison and logical operators with that one simple symbol (<span class="in">`%in%`</span>). </span>
<span id="cb37-229"><a href="#cb37-229"></a></span>
<span id="cb37-230"><a href="#cb37-230"></a>::: {.callout-warning appearance="simple"}</span>
<span id="cb37-231"><a href="#cb37-231"></a><span class="fu">## Common pitfall rule of thumb</span></span>
<span id="cb37-232"><a href="#cb37-232"></a>If you see a **standalone character string** inside <span class="in">`filter()`</span>, something is almost certainly wrong.  </span>
<span id="cb37-233"><a href="#cb37-233"></a>Use <span class="in">`%in%`</span> when you want to match against a list of values.</span>
<span id="cb37-234"><a href="#cb37-234"></a>:::</span>
<span id="cb37-235"><a href="#cb37-235"></a></span>
<span id="cb37-236"><a href="#cb37-236"></a><span class="in">```{r code-tidiest-logic-2}</span></span>
<span id="cb37-237"><a href="#cb37-237"></a><span class="co"># First create a character vector containing the desired sites</span></span>
<span id="cb37-238"><a href="#cb37-238"></a>selected_sites <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Paternoster"</span>, <span class="st">"Oudekraal"</span>, <span class="st">"Muizenberg"</span>, <span class="st">"Humewood"</span>)</span>
<span id="cb37-239"><a href="#cb37-239"></a></span>
<span id="cb37-240"><a href="#cb37-240"></a><span class="co"># Then calculate the statistics</span></span>
<span id="cb37-241"><a href="#cb37-241"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-242"><a href="#cb37-242"></a>  <span class="fu">filter</span>(site <span class="sc">%in%</span> selected_sites) <span class="sc">%&gt;%</span></span>
<span id="cb37-243"><a href="#cb37-243"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-244"><a href="#cb37-244"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb37-245"><a href="#cb37-245"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb37-246"><a href="#cb37-246"></a><span class="in">```</span></span>
<span id="cb37-247"><a href="#cb37-247"></a></span>
<span id="cb37-248"><a href="#cb37-248"></a>The <span class="in">`%in%`</span> operator can be a very useful shortcut, but sometimes you cannot avoid the comparison, logical operator dance. For example, if you wanted to find temperatures at Port Nolloth that were over 10°C but under 15°C you could use either of the following two filters. Remember that whenever you see a <span class="in">`, `</span> in the filter function it is the same as the <span class="in">`&amp;`</span> logical operator. Of the two different techniques shown below, I would be more inclined to use the first one. The fewer symbols you use to write your code the better. Both for readability, error reduction.</span>
<span id="cb37-249"><a href="#cb37-249"></a></span>
<span id="cb37-250"><a href="#cb37-250"></a><span class="in">```{r code-sactn, eval = FALSE}</span></span>
<span id="cb37-251"><a href="#cb37-251"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-252"><a href="#cb37-252"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Port Nolloth"</span>, temp <span class="sc">&gt;</span> <span class="dv">10</span>, temp <span class="sc">&lt;</span> <span class="dv">15</span>)</span>
<span id="cb37-253"><a href="#cb37-253"></a></span>
<span id="cb37-254"><a href="#cb37-254"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-255"><a href="#cb37-255"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Port Nolloth"</span>, <span class="sc">!</span>(temp <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">|</span> temp  <span class="sc">&gt;=</span> <span class="dv">15</span>))</span>
<span id="cb37-256"><a href="#cb37-256"></a><span class="in">```</span></span>
<span id="cb37-257"><a href="#cb37-257"></a></span>
<span id="cb37-258"><a href="#cb37-258"></a>As you may imagine, performing intricate logical arguments like this may get out of hand rather quickly. It is advisable to save intermediate steps in a complex workflow to avoid too much heartache. Where exactly these 'fire breaks' should be made is up to the person writing the code.</span>
<span id="cb37-259"><a href="#cb37-259"></a></span>
<span id="cb37-260"><a href="#cb37-260"></a>::: {.callout-warning appearance="simple"}</span>
<span id="cb37-261"><a href="#cb37-261"></a><span class="fu">## Common pitfalls to watch for</span></span>
<span id="cb37-262"><a href="#cb37-262"></a><span class="ss">- </span>Forgetting to <span class="in">`ungroup()`</span> and getting unexpected multiple rows.</span>
<span id="cb37-263"><a href="#cb37-263"></a><span class="ss">- </span>Using <span class="in">`|`</span> instead of <span class="in">`%in%`</span> for multi-value matches.</span>
<span id="cb37-264"><a href="#cb37-264"></a><span class="ss">- </span>Using <span class="in">`n()`</span> without grouping and assuming it is per-group.</span>
<span id="cb37-265"><a href="#cb37-265"></a><span class="ss">- </span>Using <span class="in">`slice()`</span> as if it were stable over time.</span>
<span id="cb37-266"><a href="#cb37-266"></a>:::</span>
<span id="cb37-267"><a href="#cb37-267"></a></span>
<span id="cb37-268"><a href="#cb37-268"></a><span class="fu"># Pipe into **ggplot2**</span></span>
<span id="cb37-269"><a href="#cb37-269"></a></span>
<span id="cb37-270"><a href="#cb37-270"></a>It is also possible to combine piped code chunks and **ggplot2** chunks into one 'combi-chunk'. I prefer not to do this as I like saving the new dataframe I have created as an object in my environment before visualising it so that if anything has gone wrong (as things tend to do) I can more easily find the problem.</span>
<span id="cb37-271"><a href="#cb37-271"></a></span>
<span id="cb37-272"><a href="#cb37-272"></a>Regardless of what you may or may not prefer to do, the one thing that must be mentioned about piping into **ggplot2** is that when you start with the <span class="in">`ggplot()`</span> function you switch over from the pipe (<span class="in">`%&gt;%`</span>) to the plus sign (<span class="in">`+`</span>). There are currently efforts to address this inconvenience, but are not yet ready for public consumption.</span>
<span id="cb37-273"><a href="#cb37-273"></a></span>
<span id="cb37-274"><a href="#cb37-274"></a><span class="in">```{r fig-tidyiest-ggplot, fig.cap="Line and ribbon plots for the climatologies of several sites."}</span></span>
<span id="cb37-275"><a href="#cb37-275"></a>SACTN <span class="sc">%&gt;%</span></span>
<span id="cb37-276"><a href="#cb37-276"></a>  <span class="fu">filter</span>(site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bordjies"</span>, <span class="st">"Tsitsikamma"</span>, <span class="st">"Humewood"</span>, <span class="st">"Durban"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-277"><a href="#cb37-277"></a>  <span class="fu">select</span>(<span class="sc">-</span>depth, <span class="sc">-</span>type) <span class="sc">%&gt;%</span></span>
<span id="cb37-278"><a href="#cb37-278"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb37-279"><a href="#cb37-279"></a>         <span class="at">index =</span> <span class="fu">paste</span>(site, src, <span class="at">sep =</span> <span class="st">"/ "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-280"><a href="#cb37-280"></a>  <span class="fu">group_by</span>(index, month) <span class="sc">%&gt;%</span></span>
<span id="cb37-281"><a href="#cb37-281"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-282"><a href="#cb37-282"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-283"><a href="#cb37-283"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb37-284"><a href="#cb37-284"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_temp <span class="sc">-</span> sd_temp, <span class="at">ymax =</span> mean_temp <span class="sc">+</span> sd_temp), </span>
<span id="cb37-285"><a href="#cb37-285"></a>              <span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb37-286"><a href="#cb37-286"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"navy"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb37-287"><a href="#cb37-287"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>index) <span class="sc">+</span></span>
<span id="cb37-288"><a href="#cb37-288"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb37-289"><a href="#cb37-289"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">"Temperature (°C)"</span>)</span>
<span id="cb37-290"><a href="#cb37-290"></a><span class="in">```</span></span>
<span id="cb37-291"><a href="#cb37-291"></a></span>
<span id="cb37-292"><a href="#cb37-292"></a><span class="fu"># Additional Useful Functions</span></span>
<span id="cb37-293"><a href="#cb37-293"></a></span>
<span id="cb37-294"><a href="#cb37-294"></a>There is an avalanche of useful functions to be found within the **tidyverse**. In truth, you have only looked at functions from three packages: **ggplot2**, **dplyr**, and **tidyr**. There are far, far too many functions even within these three packages to cover within a week. But that does not mean that the functions in other packages, such as **`purrr`** are not also massively useful for our work. For now we will see how the inclusion of a handful of choice extra functions may help to make our workflow even tidier.</span>
<span id="cb37-295"><a href="#cb37-295"></a></span>
<span id="cb37-296"><a href="#cb37-296"></a><span class="fu">## Rename Variables (Columns) with `rename()`</span></span>
<span id="cb37-297"><a href="#cb37-297"></a></span>
<span id="cb37-298"><a href="#cb37-298"></a>You have seen that you select columns in a dataframe with <span class="in">`select()`</span>, but if you want to rename columns you have to use, you guessed it, <span class="in">`rename()`</span>. This functions works by first telling R the new name you would like, and then the existing name of the column to be changed. This is perhaps a bit back to front, but such is life on occasion.</span>
<span id="cb37-299"><a href="#cb37-299"></a></span>
<span id="cb37-300"><a href="#cb37-300"></a><span class="in">```{r code-tidiest-rename, eval=FALSE}</span></span>
<span id="cb37-301"><a href="#cb37-301"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-302"><a href="#cb37-302"></a>  <span class="fu">rename</span>(<span class="at">source =</span> src)</span>
<span id="cb37-303"><a href="#cb37-303"></a><span class="in">```</span></span>
<span id="cb37-304"><a href="#cb37-304"></a><span class="in">```{r code-tidiest-rename-ghost, echo=FALSE}</span></span>
<span id="cb37-305"><a href="#cb37-305"></a><span class="fu">rename</span>(SACTN, <span class="at">source =</span> src)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb37-306"><a href="#cb37-306"></a><span class="in">```</span></span>
<span id="cb37-307"><a href="#cb37-307"></a></span>
<span id="cb37-308"><a href="#cb37-308"></a><span class="fu">## Create a New Dataframe for a Newly Created Variable (Column) with `transmute()`</span></span>
<span id="cb37-309"><a href="#cb37-309"></a></span>
<span id="cb37-310"><a href="#cb37-310"></a>If for whatever reason you wanted to create a new variable (column), as you would do with <span class="in">`mutate()`</span>, but you do not want to keep the dataframe from which the new column was created, the function to use is <span class="in">`transmute()`</span>.</span>
<span id="cb37-311"><a href="#cb37-311"></a></span>
<span id="cb37-312"><a href="#cb37-312"></a><span class="in">```{r code-tidiest-transmute-1, eval=FALSE}</span></span>
<span id="cb37-313"><a href="#cb37-313"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-314"><a href="#cb37-314"></a>  <span class="fu">transmute</span>(<span class="at">kelvin =</span> temp <span class="sc">+</span> <span class="fl">273.15</span>)</span>
<span id="cb37-315"><a href="#cb37-315"></a><span class="in">```</span></span>
<span id="cb37-316"><a href="#cb37-316"></a></span>
<span id="cb37-317"><a href="#cb37-317"></a><span class="in">```{r code-tidiest-transmute-1-ghost, echo=FALSE}</span></span>
<span id="cb37-318"><a href="#cb37-318"></a><span class="fu">transmute</span>(SACTN, <span class="at">kelvin =</span> temp <span class="sc">+</span> <span class="fl">273.15</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb37-319"><a href="#cb37-319"></a><span class="in">```</span></span>
<span id="cb37-320"><a href="#cb37-320"></a></span>
<span id="cb37-321"><a href="#cb37-321"></a>This makes a bit more sense when paired with <span class="in">`group_by()`</span> as it will pull over the grouping variables into the new dataframe. Note that when it does this for you automatically it will provide a message in the console.</span>
<span id="cb37-322"><a href="#cb37-322"></a></span>
<span id="cb37-323"><a href="#cb37-323"></a><span class="in">```{r code-tidiest-transmute-2, eval=FALSE}</span></span>
<span id="cb37-324"><a href="#cb37-324"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-325"><a href="#cb37-325"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-326"><a href="#cb37-326"></a>  <span class="fu">transmute</span>(<span class="at">kelvin =</span> temp <span class="sc">+</span> <span class="fl">273.15</span>)</span>
<span id="cb37-327"><a href="#cb37-327"></a><span class="in">```</span></span>
<span id="cb37-328"><a href="#cb37-328"></a></span>
<span id="cb37-329"><a href="#cb37-329"></a><span class="in">```{r code-tidiest-transmute-2-ghost, echo=FALSE}</span></span>
<span id="cb37-330"><a href="#cb37-330"></a>SACTN_trans <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-331"><a href="#cb37-331"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-332"><a href="#cb37-332"></a>  <span class="fu">transmute</span>(<span class="at">kelvin =</span> temp <span class="sc">+</span> <span class="fl">273.15</span>)</span>
<span id="cb37-333"><a href="#cb37-333"></a>SACTN_trans[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb37-334"><a href="#cb37-334"></a><span class="in">```</span></span>
<span id="cb37-335"><a href="#cb37-335"></a></span>
<span id="cb37-336"><a href="#cb37-336"></a><span class="fu">## Count Observations (Rows) with `n()`</span></span>
<span id="cb37-337"><a href="#cb37-337"></a></span>
<span id="cb37-338"><a href="#cb37-338"></a>You have already seen this function sneak its way into a few of the code chunks in the previous session. You use <span class="in">`n()`</span> to count any grouped variable automatically. It cannot be given any arguments, so you must organise our dataframe in order to satisfy its needs. It is the diva function of the **tidyverse**; however, it is terribly useful as you usually want to know how many observations your summary stats are based on.</span>
<span id="cb37-339"><a href="#cb37-339"></a></span>
<span id="cb37-340"><a href="#cb37-340"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb37-341"><a href="#cb37-341"></a><span class="fu">## Read grouped output carefully</span></span>
<span id="cb37-342"><a href="#cb37-342"></a>If you see multiple rows after <span class="in">`summarise()`</span>, you are still grouped.  </span>
<span id="cb37-343"><a href="#cb37-343"></a>If you use <span class="in">`n()`</span> without grouping, it counts **all** rows.</span>
<span id="cb37-344"><a href="#cb37-344"></a>:::</span>
<span id="cb37-345"><a href="#cb37-345"></a></span>
<span id="cb37-346"><a href="#cb37-346"></a>First you will run some stats, create a figure without documenting <span class="in">`n`</span>. Then you will include <span class="in">`n`</span> and see how that changes your conclusions.</span>
<span id="cb37-347"><a href="#cb37-347"></a></span>
<span id="cb37-348"><a href="#cb37-348"></a><span class="in">```{r fig-tidiest-n-1, fig.cap="Dot plot showing range of mean temperatures for the time series in the SACTN dataset."}</span></span>
<span id="cb37-349"><a href="#cb37-349"></a> SACTN_n <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-350"><a href="#cb37-350"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-351"><a href="#cb37-351"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">round</span>(<span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-352"><a href="#cb37-352"></a>  <span class="fu">arrange</span>(mean_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb37-353"><a href="#cb37-353"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-354"><a href="#cb37-354"></a>  <span class="fu">select</span>(mean_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb37-355"><a href="#cb37-355"></a>  <span class="fu">unique</span>()</span>
<span id="cb37-356"><a href="#cb37-356"></a></span>
<span id="cb37-357"><a href="#cb37-357"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SACTN_n, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(SACTN_n), <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb37-358"><a href="#cb37-358"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-359"><a href="#cb37-359"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Temperature (°C)"</span>) <span class="sc">+</span></span>
<span id="cb37-360"><a href="#cb37-360"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb37-361"><a href="#cb37-361"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb37-362"><a href="#cb37-362"></a><span class="in">```</span></span>
<span id="cb37-363"><a href="#cb37-363"></a></span>
<span id="cb37-364"><a href="#cb37-364"></a>This looks like a pretty linear distribution of temperatures within the SACTN dataset. But now let us change the size of the dots to show how frequently each of these mean temperatures is occurring.</span>
<span id="cb37-365"><a href="#cb37-365"></a></span>
<span id="cb37-366"><a href="#cb37-366"></a><span class="in">```{r fig-tidiest-n-2, fig.cap="Dot plot showing range of mean temperatures for the time series in the SACTN dataset with the size of each dot showing the number of occurrences of each mean."}</span></span>
<span id="cb37-367"><a href="#cb37-367"></a> SACTN_n <span class="ot">&lt;-</span> SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-368"><a href="#cb37-368"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-369"><a href="#cb37-369"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">round</span>(<span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-370"><a href="#cb37-370"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-371"><a href="#cb37-371"></a>  <span class="fu">select</span>(mean_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb37-372"><a href="#cb37-372"></a>  <span class="fu">group_by</span>(mean_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb37-373"><a href="#cb37-373"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb37-374"><a href="#cb37-374"></a></span>
<span id="cb37-375"><a href="#cb37-375"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SACTN_n, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(SACTN_n), <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb37-376"><a href="#cb37-376"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> count)) <span class="sc">+</span></span>
<span id="cb37-377"><a href="#cb37-377"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Temperature (°C)"</span>) <span class="sc">+</span></span>
<span id="cb37-378"><a href="#cb37-378"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb37-379"><a href="#cb37-379"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb37-380"><a href="#cb37-380"></a><span class="in">```</span></span>
<span id="cb37-381"><a href="#cb37-381"></a></span>
<span id="cb37-382"><a href="#cb37-382"></a>You see now when you include the count (<span class="in">`n`</span>) of the different mean temperatures that this distribution is not so even. There appear to be humps around 17°C and 22°C. Of course, you have created dot plots here just to illustrate this point. In reality if you were interested in a distribution like this one would use a histogram, or better yet, a density polygon.</span>
<span id="cb37-383"><a href="#cb37-383"></a></span>
<span id="cb37-384"><a href="#cb37-384"></a></span>
<span id="cb37-385"><a href="#cb37-385"></a><span class="in">```{r fig-tidiest-n-3, fig.cap="Frequency distribution of mean temperature for each time series in the SACTN dataset."}</span></span>
<span id="cb37-386"><a href="#cb37-386"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-387"><a href="#cb37-387"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-388"><a href="#cb37-388"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">round</span>(<span class="fu">mean</span>(temp, <span class="at">na.rm =</span> T))</span>
<span id="cb37-389"><a href="#cb37-389"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-390"><a href="#cb37-390"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-391"><a href="#cb37-391"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb37-392"><a href="#cb37-392"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"seagreen"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb37-393"><a href="#cb37-393"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (°C)"</span>)</span>
<span id="cb37-394"><a href="#cb37-394"></a><span class="in">```</span></span>
<span id="cb37-395"><a href="#cb37-395"></a></span>
<span id="cb37-396"><a href="#cb37-396"></a><span class="fu">## Select Observations (Rows) by Number with `slice()`</span></span>
<span id="cb37-397"><a href="#cb37-397"></a></span>
<span id="cb37-398"><a href="#cb37-398"></a>If you want to select only specific rows of a dataframe, rather than using some variable like you do for <span class="in">`filter()`</span>, you use <span class="in">`slice()`</span>. The function expects us to provide it with a series of integers as seen in the following code chunk. Try playing around with these values and see what happens</span>
<span id="cb37-399"><a href="#cb37-399"></a></span>
<span id="cb37-400"><a href="#cb37-400"></a><span class="in">```{r code-tidiest-slice-1, eval=FALSE}</span></span>
<span id="cb37-401"><a href="#cb37-401"></a><span class="co"># Slice a sequence of rows</span></span>
<span id="cb37-402"><a href="#cb37-402"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-403"><a href="#cb37-403"></a>  <span class="fu">slice</span>(<span class="dv">10010</span><span class="sc">:</span><span class="dv">10020</span>)</span>
<span id="cb37-404"><a href="#cb37-404"></a></span>
<span id="cb37-405"><a href="#cb37-405"></a><span class="co"># Slice specific rows</span></span>
<span id="cb37-406"><a href="#cb37-406"></a>SACTN <span class="sc">%&gt;%</span></span>
<span id="cb37-407"><a href="#cb37-407"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">19</span>,<span class="dv">24</span>,<span class="dv">3</span>,<span class="dv">400</span>))</span>
<span id="cb37-408"><a href="#cb37-408"></a></span>
<span id="cb37-409"><a href="#cb37-409"></a><span class="co"># Slice all rows except these</span></span>
<span id="cb37-410"><a href="#cb37-410"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-411"><a href="#cb37-411"></a>  <span class="fu">slice</span>(<span class="sc">-</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">4</span>)))</span>
<span id="cb37-412"><a href="#cb37-412"></a></span>
<span id="cb37-413"><a href="#cb37-413"></a><span class="co"># Slice all rows except a sequence</span></span>
<span id="cb37-414"><a href="#cb37-414"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-415"><a href="#cb37-415"></a>  <span class="fu">slice</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>))</span>
<span id="cb37-416"><a href="#cb37-416"></a><span class="in">```</span></span>
<span id="cb37-417"><a href="#cb37-417"></a></span>
<span id="cb37-418"><a href="#cb37-418"></a>It is discouraged to use slice to remove or select specific rows of data as this does not discriminate against any possible future changes in ones data. Meaning that if at some point in the future new data are added to a dataset, re-running this code will likely no longer be selecting the correct rows. This is why <span class="in">`filter()`</span> is a main function, <span class="in">`slice()`</span> is not. This auxiliary function can however still be quite useful when combined with arrange.</span>
<span id="cb37-419"><a href="#cb37-419"></a></span>
<span id="cb37-420"><a href="#cb37-420"></a>Rule of thumb: if you care about **reproducibility**, prefer <span class="in">`filter()`</span> over <span class="in">`slice()`</span>.</span>
<span id="cb37-421"><a href="#cb37-421"></a></span>
<span id="cb37-422"><a href="#cb37-422"></a><span class="in">```{r code-tidiest-slice-2}</span></span>
<span id="cb37-423"><a href="#cb37-423"></a><span class="co"># The top 5 variable sites as measured by SD</span></span>
<span id="cb37-424"><a href="#cb37-424"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-425"><a href="#cb37-425"></a>  <span class="fu">group_by</span>(site, src) <span class="sc">%&gt;%</span> </span>
<span id="cb37-426"><a href="#cb37-426"></a>  <span class="fu">summarise</span>(<span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-427"><a href="#cb37-427"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-428"><a href="#cb37-428"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sd_temp)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-429"><a href="#cb37-429"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb37-430"><a href="#cb37-430"></a><span class="in">```</span></span>
<span id="cb37-431"><a href="#cb37-431"></a></span>
<span id="cb37-432"><a href="#cb37-432"></a><span class="fu">## Summary Functions</span></span>
<span id="cb37-433"><a href="#cb37-433"></a></span>
<span id="cb37-434"><a href="#cb37-434"></a>There is a near endless sea of possibilities when one starts to become comfortable with writing R code. You have seen several summary functions used thus far. Mostly in straightforward ways. But that is one of the fun things about R, the only limits to what you may create are within your mind, not the program. Here is just one example of a creative way to answer a straightforward question: 'What is the proportion of recordings above 15°C per source?'. Note how you may refer to columns you have created within the same chunk. There is no need to save the intermediate dataframes if we choose not to.</span>
<span id="cb37-435"><a href="#cb37-435"></a>    </span>
<span id="cb37-436"><a href="#cb37-436"></a><span class="in">```{r code-tidiest-summary}</span></span>
<span id="cb37-437"><a href="#cb37-437"></a>SACTN <span class="sc">%&gt;%</span> </span>
<span id="cb37-438"><a href="#cb37-438"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-439"><a href="#cb37-439"></a>  <span class="fu">group_by</span>(src) <span class="sc">%&gt;%</span></span>
<span id="cb37-440"><a href="#cb37-440"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), </span>
<span id="cb37-441"><a href="#cb37-441"></a>            <span class="at">count_15 =</span> <span class="fu">sum</span>(temp <span class="sc">&gt;</span> <span class="dv">15</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-442"><a href="#cb37-442"></a>  <span class="fu">mutate</span>(<span class="at">prop_15 =</span> count_15<span class="sc">/</span>count) <span class="sc">%&gt;%</span> </span>
<span id="cb37-443"><a href="#cb37-443"></a>  <span class="fu">arrange</span>(prop_15)</span>
<span id="cb37-444"><a href="#cb37-444"></a><span class="in">```</span></span>
<span id="cb37-445"><a href="#cb37-445"></a></span>
<span id="cb37-446"><a href="#cb37-446"></a>The output of grouped summaries like this is the **shape most modelling and statistical functions expect**: one row per unit, one column per variable. Keep that endpoint in mind as you design your pipelines.</span>
<span id="cb37-447"><a href="#cb37-447"></a></span>
<span id="cb37-448"><a href="#cb37-448"></a><span class="fu"># The New Age *Redux*</span></span>
<span id="cb37-449"><a href="#cb37-449"></a></span>
<span id="cb37-450"><a href="#cb37-450"></a>Remember the spreadsheet example from the first day of the R workshop? Here it is repeated in a more efficient way. Now with bonus ribbons! In this chunk you see how to load, transform, and visualise the data all in one go. You would not normally do this, but it sure is snappy!</span>
<span id="cb37-451"><a href="#cb37-451"></a></span>
<span id="cb37-452"><a href="#cb37-452"></a><span class="in">```{r fig-tidiest-new-age}</span></span>
<span id="cb37-453"><a href="#cb37-453"></a><span class="co">#| fig-cap: "Tidiest new age."</span></span>
<span id="cb37-454"><a href="#cb37-454"></a><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"BCB744"</span>, <span class="st">"SACTN_data.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-455"><a href="#cb37-455"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb37-456"><a href="#cb37-456"></a>  <span class="fu">group_by</span>(site, month) <span class="sc">%&gt;%</span></span>
<span id="cb37-457"><a href="#cb37-457"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-458"><a href="#cb37-458"></a>            <span class="at">sd_temp =</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-459"><a href="#cb37-459"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> mean_temp, <span class="at">group =</span> site)) <span class="sc">+</span></span>
<span id="cb37-460"><a href="#cb37-460"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_temp <span class="sc">-</span> sd_temp, <span class="at">ymax =</span> mean_temp <span class="sc">+</span> sd_temp), </span>
<span id="cb37-461"><a href="#cb37-461"></a>              <span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb37-462"><a href="#cb37-462"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> site)) <span class="sc">+</span></span>
<span id="cb37-463"><a href="#cb37-463"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour =</span> site)) <span class="sc">+</span></span>
<span id="cb37-464"><a href="#cb37-464"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Temperature (°C)"</span>, <span class="at">colour =</span> <span class="st">"Site"</span>)</span>
<span id="cb37-465"><a href="#cb37-465"></a><span class="in">```</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2026, AJ Smit</p>
</div>   
    <div class="nav-footer-center">

<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ajsmit/tangled_bank/edit/main/BCB744/intro_r/15-tidiest.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ajsmit/tangled_bank/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>