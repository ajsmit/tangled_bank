% --- Your modified preamble.tex begins here ---
\usepackage[a4paper]{geometry}
\frenchspacing
\tolerance=400
\emergencystretch=3em
\hyphenpenalty=20

\usepackage{unicode-math}
\setmainfont{STIX Two Text}
\setmathfont{STIX Two Math}
\usepackage{mhchem}  % Chemical formula support

% Sans‐serif headings → Fira Sans (with TeX discretionary ligatures)
\setsansfont[
  UprightFont = *-Regular,
  ItalicFont = *-Italic,
  BoldFont = *-Bold,
  BoldItalicFont = *-BoldItalic,
  Ligatures = {TeX, Common, Discretionary},
  Numbers = {Proportional}
]{Fira Sans}

% Monospace Font
\setmonofont[Scale=0.89]{FiraCode Nerd Font}

\usepackage{microtype}
\microtypesetup{
  tracking = true,
  protrusion = true,
  expansion = true,
  factor = 1100,
  stretch = 15,
  shrink = 15,
}

\let\oldtexttt\texttt
\renewcommand{\texttt}[1]{\oldtexttt{\small #1}}
\usepackage{etoolbox}
\AtBeginEnvironment{Highlighting}{\footnotesize}
\AtBeginEnvironment{verbatim}{\footnotesize}
\AtBeginEnvironment{Shaded}{\footnotesize}
